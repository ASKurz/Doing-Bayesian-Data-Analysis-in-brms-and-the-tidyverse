<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>22 Nominal Predicted Variable | Doing Bayesian Data Analysis in brms and the tidyverse</title>
  <meta name="description" content="This project is an attempt to re-express the code in Kruschke’s (2015) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="22 Nominal Predicted Variable | Doing Bayesian Data Analysis in brms and the tidyverse" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This project is an attempt to re-express the code in Kruschke’s (2015) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="22 Nominal Predicted Variable | Doing Bayesian Data Analysis in brms and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is an attempt to re-express the code in Kruschke’s (2015) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2023-01-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dichotomous-predicted-variable.html"/>
<link rel="next" href="ordinal-predicted-variable.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-setup"><i class="fa fa-check"></i><strong>R</strong> setup</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-have-updates"><i class="fa fa-check"></i>We have updates</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.1.0."><i class="fa fa-check"></i>Version 0.1.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.2.0."><i class="fa fa-check"></i>Version 0.2.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.3.0."><i class="fa fa-check"></i>Version 0.3.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.4.0."><i class="fa fa-check"></i>Version 0.4.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-1.0.0."><i class="fa fa-check"></i>Version 1.0.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-1.1.0."><i class="fa fa-check"></i>Version 1.1.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#some-minor-issues-remain."><i class="fa fa-check"></i>Some minor issues remain.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license-and-citation"><i class="fa fa-check"></i>License and citation</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html"><i class="fa fa-check"></i><b>1</b> What’s in This Book (Read This First!)</a>
<ul>
<li class="chapter" data-level="1.1" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#real-people-can-read-this-book"><i class="fa fa-check"></i><b>1.1</b> Real people can read this book</a></li>
<li class="chapter" data-level="1.2" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#whats-in-this-book"><i class="fa fa-check"></i><b>1.2</b> What’s in this book</a></li>
<li class="chapter" data-level="1.3" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#whats-new-in-the-second-edition"><i class="fa fa-check"></i><b>1.3</b> What’s new in the second edition</a></li>
<li class="chapter" data-level="1.4" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#gimme-feedback-be-polite"><i class="fa fa-check"></i><b>1.4</b> Gimme feedback (be polite)</a></li>
<li class="chapter" data-level="1.5" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#thank-you"><i class="fa fa-check"></i><b>1.5</b> Thank you!</a></li>
<li class="chapter" data-level="" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html"><i class="fa fa-check"></i><b>2</b> Introduction: Credibility, Models, and Parameters</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#bayesian-inference-is-reallocation-of-credibility-across-possibilities"><i class="fa fa-check"></i><b>2.1</b> Bayesian inference is reallocation of credibility across possibilities</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#data-are-noisy-and-inferences-are-probabilistic."><i class="fa fa-check"></i><b>2.1.1</b> Data are noisy and inferences are probabilistic.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#possibilities-are-parameter-values-in-descriptive-models"><i class="fa fa-check"></i><b>2.2</b> Possibilities are parameter values in descriptive models</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#the-steps-of-bayesian-data-analysis"><i class="fa fa-check"></i><b>2.3</b> The steps of Bayesian data analysis</a></li>
<li class="chapter" data-level="" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html"><i class="fa fa-check"></i><b>3</b> The R Programming Language</a>
<ul>
<li class="chapter" data-level="3.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#get-the-software"><i class="fa fa-check"></i><b>3.1</b> Get the software</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#a-look-at-rstudio."><i class="fa fa-check"></i><b>3.1.1</b> A look at RStudio.</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#a-simple-example-of-r-in-action"><i class="fa fa-check"></i><b>3.2</b> A simple example of R in action</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#get-the-programs-used-with-this-book."><i class="fa fa-check"></i><b>3.2.1</b> Get the programs used with this book.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#basic-commands-and-operators-in-r"><i class="fa fa-check"></i><b>3.3</b> Basic commands and operators in R</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#getting-help-in-r."><i class="fa fa-check"></i><b>3.3.1</b> Getting help in R.</a></li>
<li class="chapter" data-level="3.3.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#arithmetic-and-logical-operators."><i class="fa fa-check"></i><b>3.3.2</b> Arithmetic and logical operators.</a></li>
<li class="chapter" data-level="3.3.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#assignment-relational-operators-and-tests-of-equality."><i class="fa fa-check"></i><b>3.3.3</b> Assignment, relational operators, and tests of equality.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#variable-types"><i class="fa fa-check"></i><b>3.4</b> Variable types</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#vector."><i class="fa fa-check"></i><b>3.4.1</b> Vector.</a></li>
<li class="chapter" data-level="3.4.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#factor."><i class="fa fa-check"></i><b>3.4.2</b> Factor.</a></li>
<li class="chapter" data-level="3.4.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#matrix-and-array."><i class="fa fa-check"></i><b>3.4.3</b> Matrix and array.</a></li>
<li class="chapter" data-level="3.4.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#list-and-data-frame."><i class="fa fa-check"></i><b>3.4.4</b> List and data frame.</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#loading-and-saving-data"><i class="fa fa-check"></i><b>3.5</b> Loading and saving data</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#the-read.csv-read_csv-and-read.table-read_table-functions."><i class="fa fa-check"></i><b>3.5.1</b> The <del>read.csv</del> <code>read_csv()</code> and <del>read.table</del> <code>read_table()</code> functions.</a></li>
<li class="chapter" data-level="3.5.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#saving-data-from-r."><i class="fa fa-check"></i><b>3.5.2</b> Saving data from R.</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#some-utility-functions"><i class="fa fa-check"></i><b>3.6</b> Some utility functions</a></li>
<li class="chapter" data-level="3.7" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#programming-in-r"><i class="fa fa-check"></i><b>3.7</b> Programming in R</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#variable-names-in-r."><i class="fa fa-check"></i><b>3.7.1</b> Variable names in R.</a></li>
<li class="chapter" data-level="3.7.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#running-a-program."><i class="fa fa-check"></i><b>3.7.2</b> Running a program.</a></li>
<li class="chapter" data-level="3.7.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#programming-a-function."><i class="fa fa-check"></i><b>3.7.3</b> Programming a function.</a></li>
<li class="chapter" data-level="3.7.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#conditions-and-loops."><i class="fa fa-check"></i><b>3.7.4</b> Conditions and loops.</a></li>
<li class="chapter" data-level="3.7.5" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#measuring-processing-time."><i class="fa fa-check"></i><b>3.7.5</b> Measuring processing time.</a></li>
<li class="chapter" data-level="3.7.6" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#debugging."><i class="fa fa-check"></i><b>3.7.6</b> Debugging.</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#graphical-plots-opening-and-saving"><i class="fa fa-check"></i><b>3.8</b> Graphical plots: Opening and saving</a></li>
<li class="chapter" data-level="3.9" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#conclusion-brms-related-needs"><i class="fa fa-check"></i><b>3.9</b> <del>Conclusion</del> <strong>brms</strong>-related needs</a></li>
<li class="chapter" data-level="" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#footnote"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html"><i class="fa fa-check"></i><b>4</b> What is This Stuff Called Probability?</a>
<ul>
<li class="chapter" data-level="4.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#the-set-of-all-possible-events"><i class="fa fa-check"></i><b>4.1</b> The set of all possible events</a></li>
<li class="chapter" data-level="4.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probability-outside-or-inside-the-head"><i class="fa fa-check"></i><b>4.2</b> Probability: Outside or inside the head</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#outside-the-head-long-run-relative-frequency."><i class="fa fa-check"></i><b>4.2.1</b> Outside the head: Long-run relative frequency.</a></li>
<li class="chapter" data-level="4.2.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#inside-the-head-subjective-belief."><i class="fa fa-check"></i><b>4.2.2</b> Inside the head: Subjective belief.</a></li>
<li class="chapter" data-level="4.2.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probabilities-assign-numbers-to-possibilities."><i class="fa fa-check"></i><b>4.2.3</b> Probabilities assign numbers to possibilities.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probability-distributions"><i class="fa fa-check"></i><b>4.3</b> Probability distributions</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#discrete-distributions-probability-mass."><i class="fa fa-check"></i><b>4.3.1</b> Discrete distributions: Probability mass.</a></li>
<li class="chapter" data-level="4.3.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#continuous-distributions-rendezvous-with-density."><i class="fa fa-check"></i><b>4.3.2</b> Continuous distributions: Rendezvous with density.</a></li>
<li class="chapter" data-level="4.3.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#mean-and-variance-of-a-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Mean and variance of a distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#highest-density-interval-hdi."><i class="fa fa-check"></i><b>4.3.4</b> Highest density interval (HDI).</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#two-way-distributions"><i class="fa fa-check"></i><b>4.4</b> Two-way distributions</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#conditional-probability."><i class="fa fa-check"></i><b>4.4.1</b> Conditional probability.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bayes-rule.html"><a href="bayes-rule.html"><i class="fa fa-check"></i><b>5</b> Bayes’ Rule</a>
<ul>
<li class="chapter" data-level="5.1" data-path="bayes-rule.html"><a href="bayes-rule.html#bayes-rule-1"><i class="fa fa-check"></i><b>5.1</b> Bayes’ rule</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="bayes-rule.html"><a href="bayes-rule.html#derived-from-definitions-of-conditional-probability."><i class="fa fa-check"></i><b>5.1.1</b> Derived from definitions of conditional probability.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="bayes-rule.html"><a href="bayes-rule.html#applied-to-parameters-and-data"><i class="fa fa-check"></i><b>5.2</b> Applied to parameters and data</a></li>
<li class="chapter" data-level="5.3" data-path="bayes-rule.html"><a href="bayes-rule.html#complete-examples-estimating-bias-in-a-coin"><i class="fa fa-check"></i><b>5.3</b> Complete examples: Estimating bias in a coin</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="bayes-rule.html"><a href="bayes-rule.html#influence-of-sample-size-on-the-posterior."><i class="fa fa-check"></i><b>5.3.1</b> Influence of sample size on the posterior.</a></li>
<li class="chapter" data-level="5.3.2" data-path="bayes-rule.html"><a href="bayes-rule.html#influence-of-prior-on-the-posterior."><i class="fa fa-check"></i><b>5.3.2</b> Influence of prior on the posterior.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="bayes-rule.html"><a href="bayes-rule.html#why-bayesian-inference-can-be-difficult"><i class="fa fa-check"></i><b>5.4</b> Why Bayesian inference can be difficult</a></li>
<li class="chapter" data-level="" data-path="bayes-rule.html"><a href="bayes-rule.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><i class="fa fa-check"></i><b>6</b> Inferring a Binomial Probability via Exact Mathematical Analysis</a>
<ul>
<li class="chapter" data-level="6.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#the-likelihood-function-the-bernoulli-distribution"><i class="fa fa-check"></i><b>6.1</b> The likelihood function: The Bernoulli distribution</a></li>
<li class="chapter" data-level="6.2" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#a-description-of-credibilities-the-beta-distribution"><i class="fa fa-check"></i><b>6.2</b> A description of credibilities: The beta distribution</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#specifying-a-beta-prior."><i class="fa fa-check"></i><b>6.2.1</b> Specifying a beta prior.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#the-posterior-beta"><i class="fa fa-check"></i><b>6.3</b> The posterior beta</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#posterior-is-compromise-of-prior-and-likelihood."><i class="fa fa-check"></i><b>6.3.1</b> Posterior is compromise of prior and likelihood.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#examples"><i class="fa fa-check"></i><b>6.4</b> Examples</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#prior-knowledge-expressed-as-a-beta-distribution."><i class="fa fa-check"></i><b>6.4.1</b> Prior knowledge expressed as a beta distribution.</a></li>
<li class="chapter" data-level="6.4.2" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#prior-knowledge-that-cannot-be-expressed-as-a-beta-distribution."><i class="fa fa-check"></i><b>6.4.2</b> Prior knowledge that cannot be expressed as a beta distribution.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#summary"><i class="fa fa-check"></i><b>6.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>7</b> Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="7.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#approximating-a-distribution-with-a-large-sample"><i class="fa fa-check"></i><b>7.1</b> Approximating a distribution with a large sample</a></li>
<li class="chapter" data-level="7.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-simple-case-of-the-metropolis-algorithm"><i class="fa fa-check"></i><b>7.2</b> A simple case of the Metropolis algorithm</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-politician-stumbles-upon-the-metropolis-algorithm."><i class="fa fa-check"></i><b>7.2.1</b> A politician stumbles upon the Metropolis algorithm.</a></li>
<li class="chapter" data-level="7.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-random-walk."><i class="fa fa-check"></i><b>7.2.2</b> A random walk.</a></li>
<li class="chapter" data-level="7.2.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#general-properties-of-a-random-walk."><i class="fa fa-check"></i><b>7.2.3</b> General properties of a random walk.</a></li>
<li class="chapter" data-level="7.2.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#why-we-care."><i class="fa fa-check"></i><b>7.2.4</b> Why we care.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-metropolis-algorithm-more-generally"><i class="fa fa-check"></i><b>7.3</b> The Metropolis algorithm more generally</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithm-applied-to-bernoulli-likelihood-and-beta-prior."><i class="fa fa-check"></i><b>7.3.1</b> Metropolis algorithm applied to Bernoulli likelihood and beta prior.</a></li>
<li class="chapter" data-level="7.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#summary-of-metropolis-algorithm."><i class="fa fa-check"></i><b>7.3.2</b> Summary of Metropolis algorithm.</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#toward-gibbs-sampling-estimating-two-coin-biases"><i class="fa fa-check"></i><b>7.4</b> Toward Gibbs sampling: Estimating two coin biases</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#prior-likelihood-and-posterior-for-two-biases."><i class="fa fa-check"></i><b>7.4.1</b> Prior, likelihood and posterior for two biases.</a></li>
<li class="chapter" data-level="7.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-posterior-via-exact-formal-analysis."><i class="fa fa-check"></i><b>7.4.2</b> The posterior via exact formal analysis.</a></li>
<li class="chapter" data-level="7.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-posterior-via-the-metropolis-algorithm."><i class="fa fa-check"></i><b>7.4.3</b> The posterior via the Metropolis algorithm.</a></li>
<li class="chapter" data-level="7.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-hamiltonian-monte-carlo-sampling."><i class="fa fa-check"></i><b>7.4.4</b> <del>Gibbs</del> Hamiltonian Monte Carlo sampling.</a></li>
<li class="chapter" data-level="7.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#is-there-a-difference-between-biases"><i class="fa fa-check"></i><b>7.4.5</b> Is there a difference between biases?</a></li>
<li class="chapter" data-level="7.4.6" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#terminology-mcmc."><i class="fa fa-check"></i><b>7.4.6</b> Terminology: MCMC.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-representativeness-accuracy-and-efficiency"><i class="fa fa-check"></i><b>7.5</b> MCMC representativeness, accuracy, and efficiency</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-representativeness."><i class="fa fa-check"></i><b>7.5.1</b> MCMC representativeness.</a></li>
<li class="chapter" data-level="7.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-accuracy."><i class="fa fa-check"></i><b>7.5.2</b> MCMC accuracy.</a></li>
<li class="chapter" data-level="7.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-efficiency."><i class="fa fa-check"></i><b>7.5.3</b> MCMC efficiency.</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#summary-1"><i class="fa fa-check"></i><b>7.6</b> Summary</a></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#footnote-1"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="jags-brms.html"><a href="jags-brms.html"><i class="fa fa-check"></i><b>8</b> <del>JAGS</del> brms</a>
<ul>
<li class="chapter" data-level="8.1" data-path="jags-brms.html"><a href="jags-brms.html#jags-brms-and-its-relation-to-r"><i class="fa fa-check"></i><b>8.1</b> <del>JAGS</del> brms and its relation to R</a></li>
<li class="chapter" data-level="8.2" data-path="jags-brms.html"><a href="jags-brms.html#a-complete-example"><i class="fa fa-check"></i><b>8.2</b> A complete example</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="jags-brms.html"><a href="jags-brms.html#load-data."><i class="fa fa-check"></i><b>8.2.1</b> Load data.</a></li>
<li class="chapter" data-level="8.2.2" data-path="jags-brms.html"><a href="jags-brms.html#specify-model."><i class="fa fa-check"></i><b>8.2.2</b> Specify model.</a></li>
<li class="chapter" data-level="8.2.3" data-path="jags-brms.html"><a href="jags-brms.html#initialize-chains."><i class="fa fa-check"></i><b>8.2.3</b> Initialize chains.</a></li>
<li class="chapter" data-level="8.2.4" data-path="jags-brms.html"><a href="jags-brms.html#generate-chains."><i class="fa fa-check"></i><b>8.2.4</b> Generate chains.</a></li>
<li class="chapter" data-level="8.2.5" data-path="jags-brms.html"><a href="jags-brms.html#examine-chains."><i class="fa fa-check"></i><b>8.2.5</b> Examine chains.</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="jags-brms.html"><a href="jags-brms.html#simplified-scripts-for-frequently-used-analyses"><i class="fa fa-check"></i><b>8.3</b> Simplified scripts for frequently used analyses</a></li>
<li class="chapter" data-level="8.4" data-path="jags-brms.html"><a href="jags-brms.html#example-difference-of-biases"><i class="fa fa-check"></i><b>8.4</b> Example: Difference of biases</a></li>
<li class="chapter" data-level="8.5" data-path="jags-brms.html"><a href="jags-brms.html#sampling-from-the-prior-distribution-in-jags-brms"><i class="fa fa-check"></i><b>8.5</b> Sampling from the prior distribution in <del>JAGS</del> brms</a></li>
<li class="chapter" data-level="8.6" data-path="jags-brms.html"><a href="jags-brms.html#probability-distributions-available-in-jags-brms"><i class="fa fa-check"></i><b>8.6</b> Probability distributions available in <del>JAGS</del> brms</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="jags-brms.html"><a href="jags-brms.html#defining-new-likelihood-functions."><i class="fa fa-check"></i><b>8.6.1</b> Defining new likelihood functions.</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="jags-brms.html"><a href="jags-brms.html#faster-sampling-with-parallel-processing-in-runjags-brmsbrm"><i class="fa fa-check"></i><b>8.7</b> Faster sampling with parallel processing in <del>runjags</del> <code>brms::brm()</code></a></li>
<li class="chapter" data-level="8.8" data-path="jags-brms.html"><a href="jags-brms.html#tips-for-expanding-jags-brms-models"><i class="fa fa-check"></i><b>8.8</b> Tips for expanding <del>JAGS</del> brms models</a></li>
<li class="chapter" data-level="" data-path="jags-brms.html"><a href="jags-brms.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="hierarchical-models.html"><a href="hierarchical-models.html"><i class="fa fa-check"></i><b>9</b> Hierarchical Models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-single-coin-from-a-single-mint"><i class="fa fa-check"></i><b>9.1</b> A single coin from a single mint</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#posterior-via-grid-approximation."><i class="fa fa-check"></i><b>9.1.1</b> Posterior via grid approximation.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#multiple-coins-from-a-single-mint"><i class="fa fa-check"></i><b>9.2</b> Multiple coins from a single mint</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#posterior-via-grid-approximation.-1"><i class="fa fa-check"></i><b>9.2.1</b> Posterior via grid approximation.</a></li>
<li class="chapter" data-level="9.2.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-realistic-model-with-mcmc."><i class="fa fa-check"></i><b>9.2.2</b> A realistic model with MCMC.</a></li>
<li class="chapter" data-level="9.2.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#doing-it-with-jags-brms."><i class="fa fa-check"></i><b>9.2.3</b> Doing it with <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="9.2.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-therapeutic-touch."><i class="fa fa-check"></i><b>9.2.4</b> Example: Therapeutic touch.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#shrinkage-in-hierarchical-models"><i class="fa fa-check"></i><b>9.3</b> Shrinkage in hierarchical models</a></li>
<li class="chapter" data-level="9.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#speeding-up-jags-brms"><i class="fa fa-check"></i><b>9.4</b> Speeding up <del>JAGS</del> brms</a></li>
<li class="chapter" data-level="9.5" data-path="hierarchical-models.html"><a href="hierarchical-models.html#extending-the-hierarchy-subjects-within-categories"><i class="fa fa-check"></i><b>9.5</b> Extending the hierarchy: Subjects within categories</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-baseball-batting-abilities-by-position."><i class="fa fa-check"></i><b>9.5.1</b> Example: Baseball batting abilities by position.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hierarchical-models.html"><a href="hierarchical-models.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html"><i class="fa fa-check"></i><b>10</b> Model Comparison and Hierarchical Modeling</a>
<ul>
<li class="chapter" data-level="10.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#general-formula-and-the-bayes-factor"><i class="fa fa-check"></i><b>10.1</b> General formula and the Bayes factor</a></li>
<li class="chapter" data-level="10.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#example-two-factories-of-coins"><i class="fa fa-check"></i><b>10.2</b> Example: Two factories of coins</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-formal-analysis."><i class="fa fa-check"></i><b>10.2.1</b> Solution by formal analysis.</a></li>
<li class="chapter" data-level="10.2.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-grid-approximation."><i class="fa fa-check"></i><b>10.2.2</b> Solution by grid approximation.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-mcmc"><i class="fa fa-check"></i><b>10.3</b> Solution by MCMC</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#nonhierarchical-mcmc-computation-of-each-models-marginal-likelihood."><i class="fa fa-check"></i><b>10.3.1</b> Nonhierarchical MCMC computation of each model’s marginal likelihood.</a></li>
<li class="chapter" data-level="10.3.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#hierarchical-mcmc-computation-of-relative-model-probability-is-not-available-in-brms-well-cover-information-criteria-instead."><i class="fa fa-check"></i><b>10.3.2</b> Hierarchical MCMC computation <del>of relative model probability</del> is not available in brms: We’ll cover information criteria instead.</a></li>
<li class="chapter" data-level="10.3.3" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#models-with-different-noise-distributions-in-jags-brms."><i class="fa fa-check"></i><b>10.3.3</b> Models with different “noise” distributions in <del>JAGS</del> brms.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#prediction-model-averaging"><i class="fa fa-check"></i><b>10.4</b> Prediction: Model averaging</a></li>
<li class="chapter" data-level="10.5" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#model-complexity-naturally-accounted-for"><i class="fa fa-check"></i><b>10.5</b> Model complexity naturally accounted for</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#caveats-regarding-nested-model-comparison."><i class="fa fa-check"></i><b>10.5.1</b> Caveats regarding nested model comparison.</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#extreme-sensitivity-to-prior-distribution"><i class="fa fa-check"></i><b>10.6</b> Extreme sensitivity to prior distribution</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#priors-of-different-models-should-be-equally-informed."><i class="fa fa-check"></i><b>10.6.1</b> Priors of different models should be equally informed.</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#bonus-theres-danger-ahead"><i class="fa fa-check"></i><b>10.7</b> Bonus: There’s danger ahead</a></li>
<li class="chapter" data-level="" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#footnote-2"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html"><i class="fa fa-check"></i><b>11</b> Null Hypothesis Significance Testing</a>
<ul>
<li class="chapter" data-level="11.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#paved-with-good-intentions"><i class="fa fa-check"></i><b>11.1</b> Paved with good intentions</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#definition-of-p-value."><i class="fa fa-check"></i><b>11.1.1</b> Definition of <span class="math inline">\(p\)</span> value.</a></li>
<li class="chapter" data-level="11.1.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-fix-n."><i class="fa fa-check"></i><b>11.1.2</b> With intention to fix <span class="math inline">\(N\)</span>.</a></li>
<li class="chapter" data-level="11.1.3" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-fix-z."><i class="fa fa-check"></i><b>11.1.3</b> With intention to fix <span class="math inline">\(z\)</span>.</a></li>
<li class="chapter" data-level="11.1.4" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-fix-duration."><i class="fa fa-check"></i><b>11.1.4</b> With intention to fix duration.</a></li>
<li class="chapter" data-level="11.1.5" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-make-multiple-tests."><i class="fa fa-check"></i><b>11.1.5</b> With intention to make multiple tests.</a></li>
<li class="chapter" data-level="11.1.6" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#soul-searching."><i class="fa fa-check"></i><b>11.1.6</b> Soul searching.</a></li>
<li class="chapter" data-level="11.1.7" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#bayesian-analysis."><i class="fa fa-check"></i><b>11.1.7</b> Bayesian analysis.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#prior-knowledge"><i class="fa fa-check"></i><b>11.2</b> Prior knowledge</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#nhst-analysis."><i class="fa fa-check"></i><b>11.2.1</b> NHST analysis.</a></li>
<li class="chapter" data-level="11.2.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#bayesian-analysis.-1"><i class="fa fa-check"></i><b>11.2.2</b> Bayesian analysis.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#confidence-interval-and-highest-density-interval"><i class="fa fa-check"></i><b>11.3</b> Confidence interval and highest density interval</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#ci-depends-on-intention."><i class="fa fa-check"></i><b>11.3.1</b> CI depends on intention.</a></li>
<li class="chapter" data-level="11.3.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#bayesian-hdi."><i class="fa fa-check"></i><b>11.3.2</b> Bayesian HDI.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#multiple-comparisons"><i class="fa fa-check"></i><b>11.4</b> Multiple comparisons</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#nhst-correction-for-experiment-wise-error."><i class="fa fa-check"></i><b>11.4.1</b> NHST correction for experiment wise error.</a></li>
<li class="chapter" data-level="11.4.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#just-one-bayesian-posterior-no-matter-how-you-look-at-it."><i class="fa fa-check"></i><b>11.4.2</b> Just one Bayesian posterior no matter how you look at it.</a></li>
<li class="chapter" data-level="11.4.3" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#how-bayesian-analysis-mitigates-false-alarms."><i class="fa fa-check"></i><b>11.4.3</b> How Bayesian analysis mitigates false alarms.</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#what-a-sampling-distribution-is-good-for"><i class="fa fa-check"></i><b>11.5</b> What a sampling distribution is good for</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#planning-an-experiment."><i class="fa fa-check"></i><b>11.5.1</b> Planning an experiment.</a></li>
<li class="chapter" data-level="11.5.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#exploring-model-predictions-posterior-predictive-check."><i class="fa fa-check"></i><b>11.5.2</b> Exploring model predictions (posterior predictive check).</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#footnote-3"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><i class="fa fa-check"></i><b>12</b> Bayesian Approaches to Testing a Point (“Null”) Hypothesis</a>
<ul>
<li class="chapter" data-level="12.1" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#the-estimation-approach"><i class="fa fa-check"></i><b>12.1</b> The estimation approach</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#region-of-practical-equivalence."><i class="fa fa-check"></i><b>12.1.1</b> Region of practical equivalence.</a></li>
<li class="chapter" data-level="12.1.2" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#some-examples."><i class="fa fa-check"></i><b>12.1.2</b> Some examples.</a></li>
<li class="chapter" data-level="12.1.3" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#differences-of-correlated-parameters."><i class="fa fa-check"></i><b>12.1.3</b> Differences of correlated parameters.</a></li>
<li class="chapter" data-level="12.1.4" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#why-hdi-and-not-equal-tailed-interval"><i class="fa fa-check"></i><b>12.1.4</b> Why HDI and not equal-tailed interval?</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#the-model-comparison-approach"><i class="fa fa-check"></i><b>12.2</b> The model-comparison approach</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#is-a-coin-fair-or-not"><i class="fa fa-check"></i><b>12.2.1</b> Is a coin fair or not?</a></li>
<li class="chapter" data-level="12.2.2" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#are-different-groups-equal-or-not"><i class="fa fa-check"></i><b>12.2.2</b> Are different groups equal or not?</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#relations-of-parameter-estimation-and-model-comparison"><i class="fa fa-check"></i><b>12.3</b> Relations of parameter estimation and model comparison</a></li>
<li class="chapter" data-level="12.4" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#estimation-and-model-comparison"><i class="fa fa-check"></i><b>12.4</b> Estimation and model comparison?</a></li>
<li class="chapter" data-level="" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html"><i class="fa fa-check"></i><b>13</b> Goals, Power, and Sample Size</a>
<ul>
<li class="chapter" data-level="13.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#the-will-to-power"><i class="fa fa-check"></i><b>13.1</b> The will to power</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#goals-and-obstacles."><i class="fa fa-check"></i><b>13.1.1</b> Goals and obstacles.</a></li>
<li class="chapter" data-level="13.1.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power."><i class="fa fa-check"></i><b>13.1.2</b> Power.</a></li>
<li class="chapter" data-level="13.1.3" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#sample-size."><i class="fa fa-check"></i><b>13.1.3</b> Sample size.</a></li>
<li class="chapter" data-level="13.1.4" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#other-expressions-of-goals."><i class="fa fa-check"></i><b>13.1.4</b> Other expressions of goals.</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#computing-power-and-sample-size"><i class="fa fa-check"></i><b>13.2</b> Computing power and sample size</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#when-the-goal-is-to-exclude-a-null-value."><i class="fa fa-check"></i><b>13.2.1</b> When the goal is to exclude a null value.</a></li>
<li class="chapter" data-level="13.2.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#formal-solution-and-implementation-in-r."><i class="fa fa-check"></i><b>13.2.2</b> Formal solution and implementation in R.</a></li>
<li class="chapter" data-level="13.2.3" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#when-the-goal-is-precision."><i class="fa fa-check"></i><b>13.2.3</b> When the goal is precision.</a></li>
<li class="chapter" data-level="13.2.4" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#monte-carlo-approximation-of-power."><i class="fa fa-check"></i><b>13.2.4</b> Monte Carlo approximation of power.</a></li>
<li class="chapter" data-level="13.2.5" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power-from-idealized-or-actual-data."><i class="fa fa-check"></i><b>13.2.5</b> Power from idealized or actual data.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#sequential-testing-and-the-goal-of-precision"><i class="fa fa-check"></i><b>13.3</b> Sequential testing and the goal of precision</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#examples-of-sequential-tests."><i class="fa fa-check"></i><b>13.3.1</b> Examples of sequential tests.</a></li>
<li class="chapter" data-level="13.3.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#average-behavior-of-sequential-tests."><i class="fa fa-check"></i><b>13.3.2</b> Average behavior of sequential tests.</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#discussion"><i class="fa fa-check"></i><b>13.4</b> Discussion</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power-and-multiple-comparisons."><i class="fa fa-check"></i><b>13.4.1</b> Power and multiple comparisons.</a></li>
<li class="chapter" data-level="13.4.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power-prospective-retrospective-and-replication."><i class="fa fa-check"></i><b>13.4.2</b> Power: prospective, retrospective, and replication.</a></li>
<li class="chapter" data-level="13.4.3" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power-analysis-requires-verisimilitude-of-simulated-data."><i class="fa fa-check"></i><b>13.4.3</b> Power analysis requires verisimilitude of simulated data.</a></li>
<li class="chapter" data-level="13.4.4" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#the-importance-of-planning."><i class="fa fa-check"></i><b>13.4.4</b> The importance of planning.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="stan.html"><a href="stan.html"><i class="fa fa-check"></i><b>14</b> Stan</a>
<ul>
<li class="chapter" data-level="14.1" data-path="stan.html"><a href="stan.html#hmc-sampling"><i class="fa fa-check"></i><b>14.1</b> HMC sampling</a></li>
<li class="chapter" data-level="14.2" data-path="stan.html"><a href="stan.html#installing-stan"><i class="fa fa-check"></i><b>14.2</b> Installing Stan</a></li>
<li class="chapter" data-level="14.3" data-path="stan.html"><a href="stan.html#a-complete-example-1"><i class="fa fa-check"></i><b>14.3</b> A Complete example</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="stan.html"><a href="stan.html#reusing-the-compiled-model."><i class="fa fa-check"></i><b>14.3.1</b> Reusing the compiled model.</a></li>
<li class="chapter" data-level="14.3.2" data-path="stan.html"><a href="stan.html#general-structure-of-stan-model-specification."><i class="fa fa-check"></i><b>14.3.2</b> General structure of Stan model specification.</a></li>
<li class="chapter" data-level="14.3.3" data-path="stan.html"><a href="stan.html#think-log-probability-to-think-like-stan."><i class="fa fa-check"></i><b>14.3.3</b> Think log probability to think like Stan.</a></li>
<li class="chapter" data-level="14.3.4" data-path="stan.html"><a href="stan.html#sampling-the-prior-in-stan."><i class="fa fa-check"></i><b>14.3.4</b> Sampling the prior in Stan.</a></li>
<li class="chapter" data-level="14.3.5" data-path="stan.html"><a href="stan.html#simplified-scripts-for-frequently-used-analyses."><i class="fa fa-check"></i><b>14.3.5</b> Simplified scripts for frequently used analyses.</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="stan.html"><a href="stan.html#specify-models-top-down-in-stan"><i class="fa fa-check"></i><b>14.4</b> Specify models top-down in Stan</a></li>
<li class="chapter" data-level="14.5" data-path="stan.html"><a href="stan.html#limitations-and-extras"><i class="fa fa-check"></i><b>14.5</b> Limitations and extras</a></li>
<li class="chapter" data-level="" data-path="stan.html"><a href="stan.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="stan.html"><a href="stan.html#footnote-4"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>15</b> Overview of the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="15.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#types-of-variables"><i class="fa fa-check"></i><b>15.1</b> Types of variables</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#predictor-and-predicted-variables."><i class="fa fa-check"></i><b>15.1.1</b> Predictor and predicted variables.</a></li>
<li class="chapter" data-level="15.1.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#scale-types-metric-ordinal-nominal-and-count."><i class="fa fa-check"></i><b>15.1.2</b> Scale types: metric, ordinal, nominal, and count.</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#linear-combination-of-predictors"><i class="fa fa-check"></i><b>15.2</b> Linear combination of predictors</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#linear-function-of-a-single-metric-predictor."><i class="fa fa-check"></i><b>15.2.1</b> Linear function of a single metric predictor.</a></li>
<li class="chapter" data-level="15.2.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#additive-combination-of-metric-predictors."><i class="fa fa-check"></i><b>15.2.2</b> Additive combination of metric predictors.</a></li>
<li class="chapter" data-level="15.2.3" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#nonadditive-interaction-of-metric-predictors."><i class="fa fa-check"></i><b>15.2.3</b> Nonadditive interaction of metric predictors.</a></li>
<li class="chapter" data-level="15.2.4" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#nominal-predictors."><i class="fa fa-check"></i><b>15.2.4</b> Nominal predictors.</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#linking-from-combined-predictors-to-noisy-predicted-data"><i class="fa fa-check"></i><b>15.3</b> Linking from combined predictors to noisy predicted data</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#from-predictors-to-predicted-central-tendency."><i class="fa fa-check"></i><b>15.3.1</b> From predictors to predicted central tendency.</a></li>
<li class="chapter" data-level="15.3.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#from-predicted-central-tendency-to-noisy-data."><i class="fa fa-check"></i><b>15.3.2</b> From predicted central tendency to noisy data.</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#formal-expression-of-the-glm"><i class="fa fa-check"></i><b>15.4</b> Formal expression of the GLM</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#cases-of-the-glm."><i class="fa fa-check"></i><b>15.4.1</b> Cases of the GLM.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#session-info-14"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html"><i class="fa fa-check"></i><b>16</b> Metric-Predicted Variable on One or Two Groups</a>
<ul>
<li class="chapter" data-level="16.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#estimating-the-mean-and-standard-deviation-of-a-normal-distribution"><i class="fa fa-check"></i><b>16.1</b> Estimating the mean and standard deviation of a normal distribution</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#solution-by-mathematical-analysis-heads-up-on-precision."><i class="fa fa-check"></i><b>16.1.1</b> <del>Solution by mathematical analysis</del> Heads up on precision.</a></li>
<li class="chapter" data-level="16.1.2" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#approximation-by-mcmc-in-jags-hmc-in-brms."><i class="fa fa-check"></i><b>16.1.2</b> Approximation by <del>MCMC in JAGS</del> HMC in brms.</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#outliers-and-robust-estimation-the-t-distribution"><i class="fa fa-check"></i><b>16.2</b> Outliers and robust estimation: The <span class="math inline">\(t\)</span> distribution</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#using-the-t-distribution-in-jags-brms."><i class="fa fa-check"></i><b>16.2.1</b> Using the <span class="math inline">\(t\)</span> distribution in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="16.2.2" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#using-the-t-distribution-in-stan."><i class="fa fa-check"></i><b>16.2.2</b> Using the <span class="math inline">\(t\)</span> distribution in Stan.</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#two-groups"><i class="fa fa-check"></i><b>16.3</b> Two groups</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#analysis-by-nhst."><i class="fa fa-check"></i><b>16.3.1</b> Analysis by NHST.</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#other-noise-distributions-and-transforming-data"><i class="fa fa-check"></i><b>16.4</b> Other noise distributions and transforming data</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#session-info-15"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html"><i class="fa fa-check"></i><b>17</b> Metric Predicted Variable with One Metric Predictor</a>
<ul>
<li class="chapter" data-level="17.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#simple-linear-regression"><i class="fa fa-check"></i><b>17.1</b> Simple linear regression</a></li>
<li class="chapter" data-level="17.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#robust-linear-regression"><i class="fa fa-check"></i><b>17.2</b> Robust linear regression</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#robust-linear-regression-in-jags-brms."><i class="fa fa-check"></i><b>17.2.1</b> Robust linear regression in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="17.2.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#robust-linear-regression-in-stan."><i class="fa fa-check"></i><b>17.2.2</b> Robust linear regression in Stan.</a></li>
<li class="chapter" data-level="17.2.3" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#stan-or-jags"><i class="fa fa-check"></i><b>17.2.3</b> Stan or JAGS?</a></li>
<li class="chapter" data-level="17.2.4" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#interpreting-the-posterior-distribution."><i class="fa fa-check"></i><b>17.2.4</b> Interpreting the posterior distribution.</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#hierarchical-regression-on-individuals-within-groups"><i class="fa fa-check"></i><b>17.3</b> Hierarchical regression on individuals within groups</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#the-model-and-implementation-in-jags-brms."><i class="fa fa-check"></i><b>17.3.1</b> The model and implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="17.3.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#the-posterior-distribution-shrinkage-and-prediction."><i class="fa fa-check"></i><b>17.3.2</b> The posterior distribution: Shrinkage and prediction.</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#quadratic-trend-and-weighted-data"><i class="fa fa-check"></i><b>17.4</b> Quadratic trend and weighted data</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#results-and-interpretation."><i class="fa fa-check"></i><b>17.4.1</b> Results and interpretation.</a></li>
<li class="chapter" data-level="17.4.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#further-extensions."><i class="fa fa-check"></i><b>17.4.2</b> Further extensions.</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#procedure-and-perils-for-expanding-a-model"><i class="fa fa-check"></i><b>17.5</b> Procedure and perils for expanding a model</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#session-info-16"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html"><i class="fa fa-check"></i><b>18</b> Metric Predicted Variable with Multiple Metric Predictors</a>
<ul>
<li class="chapter" data-level="18.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#multiple-linear-regression"><i class="fa fa-check"></i><b>18.1</b> Multiple linear regression</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#the-perils-of-correlated-predictors."><i class="fa fa-check"></i><b>18.1.1</b> The perils of correlated predictors.</a></li>
<li class="chapter" data-level="18.1.2" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#the-model-and-implementation."><i class="fa fa-check"></i><b>18.1.2</b> The model and implementation.</a></li>
<li class="chapter" data-level="18.1.3" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#the-posterior-distribution."><i class="fa fa-check"></i><b>18.1.3</b> The posterior distribution.</a></li>
<li class="chapter" data-level="18.1.4" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#redundant-predictors."><i class="fa fa-check"></i><b>18.1.4</b> Redundant predictors.</a></li>
<li class="chapter" data-level="18.1.5" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#informative-priors-sparse-data-and-correlated-predictors."><i class="fa fa-check"></i><b>18.1.5</b> Informative priors, sparse data, and correlated predictors.</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#multiplicative-interaction-of-metric-predictors"><i class="fa fa-check"></i><b>18.2</b> Multiplicative interaction of metric predictors</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#an-example."><i class="fa fa-check"></i><b>18.2.1</b> An example.</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#shrinkage-of-regression-coefficients"><i class="fa fa-check"></i><b>18.3</b> Shrinkage of regression coefficients</a></li>
<li class="chapter" data-level="18.4" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#variable-selection"><i class="fa fa-check"></i><b>18.4</b> Variable selection</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#inclusion-probability-is-strongly-affected-by-vagueness-of-prior."><i class="fa fa-check"></i><b>18.4.1</b> Inclusion probability is strongly affected by vagueness of prior.</a></li>
<li class="chapter" data-level="18.4.2" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#variable-selection-with-hierarchical-shrinkage."><i class="fa fa-check"></i><b>18.4.2</b> Variable selection with hierarchical shrinkage.</a></li>
<li class="chapter" data-level="18.4.3" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#what-to-report-and-what-to-conclude."><i class="fa fa-check"></i><b>18.4.3</b> What to report and what to conclude.</a></li>
<li class="chapter" data-level="18.4.4" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#caution-computational-methods."><i class="fa fa-check"></i><b>18.4.4</b> Caution: Computational methods.</a></li>
<li class="chapter" data-level="18.4.5" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#caution-interaction-variables."><i class="fa fa-check"></i><b>18.4.5</b> Caution: Interaction variables.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#session-info-17"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#footnote-5"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html"><i class="fa fa-check"></i><b>19</b> Metric Predicted Variable with One Nominal Predictor</a>
<ul>
<li class="chapter" data-level="19.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#describing-multiple-groups-of-metric-data"><i class="fa fa-check"></i><b>19.1</b> Describing multiple groups of metric data</a></li>
<li class="chapter" data-level="19.2" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#traditional-analysis-of-variance"><i class="fa fa-check"></i><b>19.2</b> Traditional analysis of variance</a></li>
<li class="chapter" data-level="19.3" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#hierarchical-bayesian-approach"><i class="fa fa-check"></i><b>19.3</b> Hierarchical Bayesian approach</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#implementation-in-jags-brms."><i class="fa fa-check"></i><b>19.3.1</b> Implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="19.3.2" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#example-sex-and-death."><i class="fa fa-check"></i><b>19.3.2</b> Example: Sex and death.</a></li>
<li class="chapter" data-level="19.3.3" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#contrasts."><i class="fa fa-check"></i><b>19.3.3</b> Contrasts.</a></li>
<li class="chapter" data-level="19.3.4" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#multiple-comparisons-and-shrinkage."><i class="fa fa-check"></i><b>19.3.4</b> Multiple comparisons and shrinkage.</a></li>
<li class="chapter" data-level="19.3.5" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#the-two-group-case."><i class="fa fa-check"></i><b>19.3.5</b> The two-group case.</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#including-a-metric-predictor"><i class="fa fa-check"></i><b>19.4</b> Including a metric predictor</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#example-sex-death-and-size."><i class="fa fa-check"></i><b>19.4.1</b> Example: Sex, death, and size.</a></li>
<li class="chapter" data-level="19.4.2" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#analogous-to-traditional-ancova."><i class="fa fa-check"></i><b>19.4.2</b> Analogous to traditional ANCOVA.</a></li>
<li class="chapter" data-level="19.4.3" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#relation-to-hierarchical-linear-regression."><i class="fa fa-check"></i><b>19.4.3</b> Relation to hierarchical linear regression.</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#heterogeneous-variances-and-robustness-against-outliers"><i class="fa fa-check"></i><b>19.5</b> Heterogeneous variances and robustness against outliers</a>
<ul>
<li class="chapter" data-level="19.5.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#example-contrast-of-means-with-different-variances."><i class="fa fa-check"></i><b>19.5.1</b> Example: Contrast of means with different variances.</a></li>
</ul></li>
<li class="chapter" data-level="19.6" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#exercises-walk-out-an-effect-size"><i class="fa fa-check"></i><b>19.6</b> <del>Exercises</del> Walk out an effect size</a>
<ul>
<li class="chapter" data-level="19.6.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#your-sample-sizes-may-differ."><i class="fa fa-check"></i><b>19.6.1</b> Your sample sizes may differ.</a></li>
<li class="chapter" data-level="19.6.2" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#populations-and-samples."><i class="fa fa-check"></i><b>19.6.2</b> Populations and samples.</a></li>
<li class="chapter" data-level="19.6.3" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#report-your-effect-sizes-effectively."><i class="fa fa-check"></i><b>19.6.3</b> Report your effect sizes effectively.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#session-info-18"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html"><i class="fa fa-check"></i><b>20</b> Metric Predicted Variable with Multiple Nominal Predictors</a>
<ul>
<li class="chapter" data-level="20.1" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#describing-groups-of-metric-data-with-multiple-nominal-predictors"><i class="fa fa-check"></i><b>20.1</b> Describing groups of metric data with multiple nominal predictors</a>
<ul>
<li class="chapter" data-level="20.1.1" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#interaction."><i class="fa fa-check"></i><b>20.1.1</b> Interaction.</a></li>
<li class="chapter" data-level="20.1.2" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#traditional-anova."><i class="fa fa-check"></i><b>20.1.2</b> Traditional ANOVA.</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#hierarchical-bayesian-approach-1"><i class="fa fa-check"></i><b>20.2</b> Hierarchical Bayesian approach</a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#implementation-in-jags-brms.-1"><i class="fa fa-check"></i><b>20.2.1</b> Implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="20.2.2" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#example-its-only-money."><i class="fa fa-check"></i><b>20.2.2</b> Example: It’s only money.</a></li>
<li class="chapter" data-level="20.2.3" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#main-effect-contrasts."><i class="fa fa-check"></i><b>20.2.3</b> Main effect contrasts.</a></li>
<li class="chapter" data-level="20.2.4" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#interaction-contrasts-and-simple-effects."><i class="fa fa-check"></i><b>20.2.4</b> Interaction contrasts and simple effects.</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#rescaling-can-change-interactions-homogeneity-and-normality"><i class="fa fa-check"></i><b>20.3</b> Rescaling can change interactions, homogeneity, and normality</a></li>
<li class="chapter" data-level="20.4" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#heterogeneous-variances-and-robustness-against-outliers-1"><i class="fa fa-check"></i><b>20.4</b> Heterogeneous variances and robustness against outliers</a></li>
<li class="chapter" data-level="20.5" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#within-subject-designs"><i class="fa fa-check"></i><b>20.5</b> Within-subject designs</a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#why-use-a-within-subject-design-and-why-not"><i class="fa fa-check"></i><b>20.5.1</b> Why use a within-subject design? And why not?</a></li>
<li class="chapter" data-level="20.5.2" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#split-plot-design."><i class="fa fa-check"></i><b>20.5.2</b> Split-plot design.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#session-info-19"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#footnote-6"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html"><i class="fa fa-check"></i><b>21</b> Dichotomous Predicted Variable</a>
<ul>
<li class="chapter" data-level="21.1" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#multiple-metric-predictors"><i class="fa fa-check"></i><b>21.1</b> Multiple metric predictors</a>
<ul>
<li class="chapter" data-level="21.1.1" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#the-model-and-implementation-in-jags-brms.-1"><i class="fa fa-check"></i><b>21.1.1</b> The model and implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="21.1.2" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#example-height-weight-and-gender."><i class="fa fa-check"></i><b>21.1.2</b> Example: Height, weight, and gender.</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#interpreting-the-regression-coefficients"><i class="fa fa-check"></i><b>21.2</b> Interpreting the regression coefficients</a>
<ul>
<li class="chapter" data-level="21.2.1" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#log-odds."><i class="fa fa-check"></i><b>21.2.1</b> Log odds.</a></li>
<li class="chapter" data-level="21.2.2" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#when-there-are-few-1s-or-0s-in-the-data."><i class="fa fa-check"></i><b>21.2.2</b> When there are few 1’s or 0’s in the data.</a></li>
<li class="chapter" data-level="21.2.3" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#correlated-predictors."><i class="fa fa-check"></i><b>21.2.3</b> Correlated predictors.</a></li>
<li class="chapter" data-level="21.2.4" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#interaction-of-metric-predictors."><i class="fa fa-check"></i><b>21.2.4</b> Interaction of metric predictors.</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#robust-logistic-regression"><i class="fa fa-check"></i><b>21.3</b> Robust logistic regression</a></li>
<li class="chapter" data-level="21.4" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#nominal-predictors"><i class="fa fa-check"></i><b>21.4</b> Nominal predictors</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#single-group."><i class="fa fa-check"></i><b>21.4.1</b> Single group.</a></li>
<li class="chapter" data-level="21.4.2" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#multiple-groups."><i class="fa fa-check"></i><b>21.4.2</b> Multiple groups.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#session-info-20"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html"><i class="fa fa-check"></i><b>22</b> Nominal Predicted Variable</a>
<ul>
<li class="chapter" data-level="22.1" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#softmax-regression"><i class="fa fa-check"></i><b>22.1</b> Softmax regression</a>
<ul>
<li class="chapter" data-level="22.1.1" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#softmax-reduces-to-logistic-for-two-outcomes."><i class="fa fa-check"></i><b>22.1.1</b> Softmax reduces to logistic for two outcomes.</a></li>
<li class="chapter" data-level="22.1.2" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#independence-from-irrelevant-attributes."><i class="fa fa-check"></i><b>22.1.2</b> Independence from irrelevant attributes.</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#conditional-logistic-regression"><i class="fa fa-check"></i><b>22.2</b> Conditional logistic regression</a></li>
<li class="chapter" data-level="22.3" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#implementation-in-jags-brms"><i class="fa fa-check"></i><b>22.3</b> Implementation in <del>JAGS</del> brms</a>
<ul>
<li class="chapter" data-level="22.3.1" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#softmax-model."><i class="fa fa-check"></i><b>22.3.1</b> Softmax model.</a></li>
<li class="chapter" data-level="22.3.2" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#conditional-logistic-model."><i class="fa fa-check"></i><b>22.3.2</b> Conditional logistic model.</a></li>
<li class="chapter" data-level="22.3.3" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#results-interpreting-the-regression-coefficients."><i class="fa fa-check"></i><b>22.3.3</b> Results: Interpreting the regression coefficients.</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#generalizations-and-variations-of-the-models"><i class="fa fa-check"></i><b>22.4</b> Generalizations and variations of the models</a></li>
<li class="chapter" data-level="" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#session-info-21"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html"><i class="fa fa-check"></i><b>23</b> Ordinal Predicted Variable</a>
<ul>
<li class="chapter" data-level="23.1" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#modeling-ordinal-data-with-an-underlying-metric-variable"><i class="fa fa-check"></i><b>23.1</b> Modeling ordinal data with an underlying metric variable</a></li>
<li class="chapter" data-level="23.2" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#the-case-of-a-single-group"><i class="fa fa-check"></i><b>23.2</b> The case of a single group</a>
<ul>
<li class="chapter" data-level="23.2.1" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#implementation-in-jags-brms.-3"><i class="fa fa-check"></i><b>23.2.1</b> Implementation in <del>JAGS</del> <strong>brms</strong>.</a></li>
<li class="chapter" data-level="23.2.2" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#examples-bayesian-estimation-recovers-true-parameter-values."><i class="fa fa-check"></i><b>23.2.2</b> Examples: Bayesian estimation recovers true parameter values.</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#the-case-of-two-groups"><i class="fa fa-check"></i><b>23.3</b> The case of two groups</a>
<ul>
<li class="chapter" data-level="23.3.1" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#implementation-in-jags-brms.-4"><i class="fa fa-check"></i><b>23.3.1</b> Implementation in <del>JAGS</del> <strong>brms</strong>.</a></li>
<li class="chapter" data-level="23.3.2" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#examples-not-funny."><i class="fa fa-check"></i><b>23.3.2</b> Examples: Not funny.</a></li>
</ul></li>
<li class="chapter" data-level="23.4" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#the-case-of-metric-predictors"><i class="fa fa-check"></i><b>23.4</b> The Case of metric predictors</a>
<ul>
<li class="chapter" data-level="23.4.1" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#implementation-in-jags-brms.-5"><i class="fa fa-check"></i><b>23.4.1</b> Implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="23.4.2" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#example-happiness-and-money."><i class="fa fa-check"></i><b>23.4.2</b> Example: Happiness and money.</a></li>
<li class="chapter" data-level="23.4.3" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#example-moviesthey-dont-make-em-like-they-used-to."><i class="fa fa-check"></i><b>23.4.3</b> Example: Movies–They don’t make ’em like they used to.</a></li>
<li class="chapter" data-level="23.4.4" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#why-are-some-thresholds-outside-the-data"><i class="fa fa-check"></i><b>23.4.4</b> Why are some thresholds outside the data?</a></li>
</ul></li>
<li class="chapter" data-level="23.5" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#posterior-prediction"><i class="fa fa-check"></i><b>23.5</b> Posterior prediction</a></li>
<li class="chapter" data-level="23.6" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#generalizations-and-extensions"><i class="fa fa-check"></i><b>23.6</b> Generalizations and extensions</a></li>
<li class="chapter" data-level="" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#session-info-22"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html"><i class="fa fa-check"></i><b>24</b> Count Predicted Variable</a>
<ul>
<li class="chapter" data-level="24.1" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#poisson-exponential-model"><i class="fa fa-check"></i><b>24.1</b> Poisson exponential model</a>
<ul>
<li class="chapter" data-level="24.1.1" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#data-structure."><i class="fa fa-check"></i><b>24.1.1</b> Data structure.</a></li>
<li class="chapter" data-level="24.1.2" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#exponential-link-function."><i class="fa fa-check"></i><b>24.1.2</b> Exponential link function.</a></li>
<li class="chapter" data-level="24.1.3" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#poisson-noise-distribution."><i class="fa fa-check"></i><b>24.1.3</b> Poisson noise distribution.</a></li>
<li class="chapter" data-level="24.1.4" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#the-complete-model-and-implementation-in-jags-brms."><i class="fa fa-check"></i><b>24.1.4</b> The complete model and implementation in <del>JAGS</del> brms.</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#example-hair-eye-go-again"><i class="fa fa-check"></i><b>24.2</b> Example: Hair eye go again</a></li>
<li class="chapter" data-level="24.3" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#example-interaction-contrasts-shrinkage-and-omnibus-test"><i class="fa fa-check"></i><b>24.3</b> Example: Interaction contrasts, shrinkage, and omnibus test</a></li>
<li class="chapter" data-level="24.4" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#log-linear-models-for-contingency-tables-bonus-alternative-parameterization"><i class="fa fa-check"></i><b>24.4</b> <del>Log-linear models for contingency tables</del> Bonus: Alternative parameterization</a></li>
<li class="chapter" data-level="" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#session-info-23"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html"><i class="fa fa-check"></i><b>25</b> Tools in the Trunk</a>
<ul>
<li class="chapter" data-level="25.1" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#reporting-a-bayesian-analysis"><i class="fa fa-check"></i><b>25.1</b> Reporting a Bayesian analysis</a>
<ul>
<li class="chapter" data-level="25.1.1" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#essential-points."><i class="fa fa-check"></i><b>25.1.1</b> Essential points.</a></li>
<li class="chapter" data-level="25.1.2" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#optional-points."><i class="fa fa-check"></i><b>25.1.2</b> Optional points.</a></li>
<li class="chapter" data-level="25.1.3" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#helpful-points."><i class="fa fa-check"></i><b>25.1.3</b> Helpful points.</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#functions-for-computing-highest-density-intervals"><i class="fa fa-check"></i><b>25.2</b> Functions for computing highest density intervals</a>
<ul>
<li class="chapter" data-level="25.2.1" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#r-code-for-computing-hdi-of-a-grid-approximation."><i class="fa fa-check"></i><b>25.2.1</b> R code for computing HDI of a grid approximation.</a></li>
<li class="chapter" data-level="25.2.2" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#hdi-of-unimodal-distribution-is-shortest-interval."><i class="fa fa-check"></i><b>25.2.2</b> HDI of unimodal distribution is shortest interval.</a></li>
<li class="chapter" data-level="25.2.3" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#r-code-for-computing-hdi-of-a-mcmc-sample."><i class="fa fa-check"></i><b>25.2.3</b> R code for computing HDI of a MCMC sample.</a></li>
<li class="chapter" data-level="25.2.4" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#r-code-for-computing-hdi-of-a-function."><i class="fa fa-check"></i><b>25.2.4</b> R code for computing HDI of a function.</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#reparameterization"><i class="fa fa-check"></i><b>25.3</b> Reparameterization</a></li>
<li class="chapter" data-level="25.4" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#censored-data-in-jags-brms"><i class="fa fa-check"></i><b>25.4</b> Censored data in <del>JAGS</del> brms</a>
<ul>
<li class="chapter" data-level="25.4.1" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#right-censoring-when-youre-uncertain-beyond-a-single-threshold."><i class="fa fa-check"></i><b>25.4.1</b> Right censoring: When you’re uncertain beyond a single threshold.</a></li>
<li class="chapter" data-level="25.4.2" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#interval-censoring-when-your-values-are-somewhere-in-the-middle."><i class="fa fa-check"></i><b>25.4.2</b> Interval censoring: When your values are somewhere in the middle.</a></li>
<li class="chapter" data-level="25.4.3" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#complex-censoring-when-the-going-gets-tough"><i class="fa fa-check"></i><b>25.4.3</b> Complex censoring: When the going gets tough…</a></li>
<li class="chapter" data-level="25.4.4" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#bonus-truncation."><i class="fa fa-check"></i><b>25.4.4</b> Bonus: Truncation.</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#what-next"><i class="fa fa-check"></i><b>25.5</b> What Next?</a></li>
<li class="chapter" data-level="" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#session-info-24"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Doing Bayesian Data Analysis</em> in brms and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="nominal-predicted-variable" class="section level1 hasAnchor" number="22">
<h1><span class="header-section-number">22</span> Nominal Predicted Variable<a href="nominal-predicted-variable.html#nominal-predicted-variable" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<blockquote>
<p>This chapter considers data structures that have a nominal predicted variable. When the nominal predicted variable has only two possible values, this reduces to the case of the dichotomous predicted variable considered in the previous chapter. In the present chapter, we generalize to cases in which the predicted variable has three or more categorical values…</p>
<p>The traditional treatment of this sort of data structure is called multinomial logistic regression or conditional logistic regression. We will consider Bayesian approaches to these methods. As usual, in Bayesian software it is easy to generalize the traditional models so they are robust to outliers, allow different variances within levels of a nominal predictor, and have hierarchical structure to share information across levels or factors as appropriate. <span class="citation">(<a href="#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">Kruschke, 2015, p. 649</a>)</span></p>
</blockquote>
<div id="softmax-regression" class="section level2 hasAnchor" number="22.1">
<h2><span class="header-section-number">22.1</span> Softmax regression<a href="nominal-predicted-variable.html#softmax-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>“The key descriptor of the [models in this chapter is their] inverse-link function, which is the softmax function (which will be defined below). Therefore, [Kruschke] refer[ed] to the method as softmax regression instead of multinomial logistic regression” (p. 650)</p>
<p>Say we have a metric predictor <span class="math inline">\(x\)</span> and a multinomial criterion <span class="math inline">\(y\)</span> with <span class="math inline">\(k\)</span> categories. We can express the basic linear model as</p>
<p><span class="math display">\[\lambda_k = \beta_{0, k} + \beta_{1, k} x,\]</span></p>
<p>for which the subscripts <span class="math inline">\(k\)</span> indicate there’s a linear model for each of the <span class="math inline">\(k\)</span> categories. We call the possible set of <span class="math inline">\(k\)</span> outcomes <span class="math inline">\(S\)</span>. Taking the case where <span class="math inline">\(k = 3\)</span>, we’d have</p>
<p><span class="math display">\[\begin{align*}
\lambda_{[1]} &amp; = \beta_{0, [1]} + \beta_{1, [1]} x, \\
\lambda_{[2]} &amp; = \beta_{0, [2]} + \beta_{1, [2]} x, \text{and} \\
\lambda_{[3]} &amp; = \beta_{0, [3]} + \beta_{1, [3]} x.
\end{align*}\]</span></p>
<p>In this scenario, what we want to know is the probability of <span class="math inline">\(\lambda_{[1]}\)</span>, <span class="math inline">\(\lambda_{[2]}\)</span>, and <span class="math inline">\(\lambda_{[3]}\)</span>. The probability of a given outcome <span class="math inline">\(k\)</span> follows the formula</p>
<p><span class="math display">\[\phi_k = \operatorname{softmax}_S (\{\lambda_k\}) = \frac{\exp (\lambda_k)}{\sum_{c \in S} \exp  (\lambda_c)}.\]</span></p>
<blockquote>
<p>In words, [the equation] says that the probability of outcome <span class="math inline">\(k\)</span> is the exponentiated linear propensity of outcome <span class="math inline">\(k\)</span> relative to the sum of exponentiated linear propensities across all outcomes in the set <span class="math inline">\(S\)</span>. You may be wondering, Why exponentiate? Intuitively, we have to go from propensities that can have negative values to probabilities that can only have non-negative values, and we have to preserve order. The exponential function satisfies that need. (p. 650)</p>
</blockquote>
<p>You may be wondering what happened to <span class="math inline">\(y\)</span> and where all those <span class="math inline">\(\lambda\)</span>’s came from. Here we’re using <span class="math inline">\(\lambda\)</span> to describe the propensity of outcome <span class="math inline">\(k\)</span>, as indexed within our criterion <span class="math inline">\(y\)</span>. So, the output of these models, <span class="math inline">\(\phi_k\)</span>, is the relative probability we’ll see each of our <span class="math inline">\(k\)</span> categories within our criterion <span class="math inline">\(y\)</span>. What we want is <span class="math inline">\(\phi_k\)</span>. The way we parameterize that with the softmax function is with <span class="math inline">\(\lambda_k\)</span>.</p>
<p>There are are indeterminacies in the system of equations Kruschke covered in this section, the upshot of which is we’ll end up making one of the <span class="math inline">\(k\)</span> categories the reference category, which we term <span class="math inline">\(r\)</span>. Continuing on with our univariable model, we choose convenient constants for our parameters for <span class="math inline">\(r\)</span>: <span class="math inline">\(\beta_{0, r} = 0\)</span> and <span class="math inline">\(\beta_{1, r} = 0\)</span>. As such, <em>the regression coefficients for the remaining categories are relative to those for</em> <span class="math inline">\(r\)</span>.</p>
<p>Kruschke saved the data for Figure 22.1 in the <code>SoftmaxRegData1.csv</code> and <code>SoftmaxRegData2.csv</code> files.</p>
<div class="sourceCode" id="cb2177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2177-1"><a href="nominal-predicted-variable.html#cb2177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2177-2"><a href="nominal-predicted-variable.html#cb2177-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2177-3"><a href="nominal-predicted-variable.html#cb2177-3" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data.R/SoftmaxRegData1.csv&quot;</span>)</span>
<span id="cb2177-4"><a href="nominal-predicted-variable.html#cb2177-4" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data.R/SoftmaxRegData2.csv&quot;</span>)</span>
<span id="cb2177-5"><a href="nominal-predicted-variable.html#cb2177-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2177-6"><a href="nominal-predicted-variable.html#cb2177-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d1)</span></code></pre></div>
<pre><code>## Rows: 475
## Columns: 3
## $ X1 &lt;dbl&gt; -0.08714736, -0.72256565, 0.17918961, -1.15975176, -0.72711762, 0.53341559, -0.18932650…
## $ X2 &lt;dbl&gt; -1.08134218, -1.58386308, 0.97179045, 0.50262438, 1.37570446, 1.77465062, -0.53727640, …
## $ Y  &lt;dbl&gt; 2, 1, 3, 3, 3, 3, 1, 4, 2, 2, 3, 2, 4, 4, 4, 1, 2, 3, 3, 3, 3, 2, 1, 1, 3, 2, 3, 2, 4, …</code></pre>
<div class="sourceCode" id="cb2179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2179-1"><a href="nominal-predicted-variable.html#cb2179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d2)</span></code></pre></div>
<pre><code>## Rows: 475
## Columns: 3
## $ X1 &lt;dbl&gt; -0.08714736, -0.72256565, 0.17918961, -1.15975176, -0.72711762, 0.53341559, -0.18932650…
## $ X2 &lt;dbl&gt; -1.08134218, -1.58386308, 0.97179045, 0.50262438, 1.37570446, 1.77465062, -0.53727640, …
## $ Y  &lt;dbl&gt; 2, 2, 3, 3, 3, 3, 2, 3, 2, 1, 3, 2, 4, 3, 3, 2, 2, 1, 1, 3, 3, 4, 2, 2, 3, 2, 3, 4, 4, …</code></pre>
<p>Before we explore these data in a plot, let’s talk color and theme. For this chapter, we’ll carry forward our practice from <a href="dichotomous-predicted-variable.html#dichotomous-predicted-variable">Chapter 21</a> and take our color palette from the <a href="https://CRAN.R-project.org/package=PNWColors"><strong>PNWColors</strong> package</a>. This time, our color palette will be <code>"Lake"</code>.</p>
<div class="sourceCode" id="cb2181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2181-1"><a href="nominal-predicted-variable.html#cb2181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PNWColors)</span>
<span id="cb2181-2"><a href="nominal-predicted-variable.html#cb2181-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2181-3"><a href="nominal-predicted-variable.html#cb2181-3" aria-hidden="true" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">pnw_palette</span>(<span class="at">name =</span> <span class="st">&quot;Lake&quot;</span>)</span>
<span id="cb2181-4"><a href="nominal-predicted-variable.html#cb2181-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2181-5"><a href="nominal-predicted-variable.html#cb2181-5" aria-hidden="true" tabindex="-1"></a>pl</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-3-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>We’ll base our overall plot theme on <code>cowplot::theme_minimal_grid()</code>, with many color adjustments from <code>PNWColors::pnw_palette(name = "Lake")</code>.</p>
<div class="sourceCode" id="cb2182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2182-1"><a href="nominal-predicted-variable.html#cb2182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb2182-2"><a href="nominal-predicted-variable.html#cb2182-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2182-3"><a href="nominal-predicted-variable.html#cb2182-3" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(</span>
<span id="cb2182-4"><a href="nominal-predicted-variable.html#cb2182-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal_grid</span>() <span class="sc">+</span></span>
<span id="cb2182-5"><a href="nominal-predicted-variable.html#cb2182-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> pl[<span class="dv">1</span>]),</span>
<span id="cb2182-6"><a href="nominal-predicted-variable.html#cb2182-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> pl[<span class="dv">1</span>]),</span>
<span id="cb2182-7"><a href="nominal-predicted-variable.html#cb2182-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> pl[<span class="dv">1</span>]),</span>
<span id="cb2182-8"><a href="nominal-predicted-variable.html#cb2182-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2182-9"><a href="nominal-predicted-variable.html#cb2182-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.box.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2182-10"><a href="nominal-predicted-variable.html#cb2182-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> pl[<span class="dv">8</span>]),</span>
<span id="cb2182-11"><a href="nominal-predicted-variable.html#cb2182-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> pl[<span class="dv">8</span>], <span class="at">color =</span> pl[<span class="dv">8</span>]),</span>
<span id="cb2182-12"><a href="nominal-predicted-variable.html#cb2182-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2182-13"><a href="nominal-predicted-variable.html#cb2182-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> pl[<span class="dv">7</span>], <span class="at">color =</span> pl[<span class="dv">7</span>]),</span>
<span id="cb2182-14"><a href="nominal-predicted-variable.html#cb2182-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> pl[<span class="dv">1</span>]))</span>
<span id="cb2182-15"><a href="nominal-predicted-variable.html#cb2182-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Now bind the two data frames together and plot our version of Figure 22.1.</p>
<div class="sourceCode" id="cb2183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2183-1"><a href="nominal-predicted-variable.html#cb2183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(d1, d2) <span class="sc">%&gt;%</span></span>
<span id="cb2183-2"><a href="nominal-predicted-variable.html#cb2183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">rep</span>(<span class="fu">str_c</span>(<span class="st">&quot;d&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb2183-3"><a href="nominal-predicted-variable.html#cb2183-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">Y =</span> <span class="fu">factor</span>(Y)) <span class="sc">%&gt;%</span> </span>
<span id="cb2183-4"><a href="nominal-predicted-variable.html#cb2183-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2183-5"><a href="nominal-predicted-variable.html#cb2183-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2, <span class="at">label =</span> Y, <span class="at">color =</span> Y)) <span class="sc">+</span></span>
<span id="cb2183-6"><a href="nominal-predicted-variable.html#cb2183-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb2183-7"><a href="nominal-predicted-variable.html#cb2183-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb2183-8"><a href="nominal-predicted-variable.html#cb2183-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2183-9"><a href="nominal-predicted-variable.html#cb2183-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pl[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb2183-10"><a href="nominal-predicted-variable.html#cb2183-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(x[<span class="dv">1</span>]),</span>
<span id="cb2183-11"><a href="nominal-predicted-variable.html#cb2183-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(x[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb2183-12"><a href="nominal-predicted-variable.html#cb2183-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb2183-13"><a href="nominal-predicted-variable.html#cb2183-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb2183-14"><a href="nominal-predicted-variable.html#cb2183-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> data, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-5-1.png" width="528" style="display: block; margin: auto;" /></p>
<div id="softmax-reduces-to-logistic-for-two-outcomes." class="section level3 hasAnchor" number="22.1.1">
<h3><span class="header-section-number">22.1.1</span> Softmax reduces to logistic for two outcomes.<a href="nominal-predicted-variable.html#softmax-reduces-to-logistic-for-two-outcomes." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>“When there are only two outcomes, the softmax formulation reduces to the logistic regression of Chapter 21” (p. 653).</p>
</div>
<div id="independence-from-irrelevant-attributes." class="section level3 hasAnchor" number="22.1.2">
<h3><span class="header-section-number">22.1.2</span> Independence from irrelevant attributes.<a href="nominal-predicted-variable.html#independence-from-irrelevant-attributes." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>An important property of the softmax function of Equation 22.2 is known as independence from irrelevant attributes <span class="citation">(<a href="#ref-luceIndividualChoiceBehavior2012" role="doc-biblioref">Luce, 2012</a>, <a href="#ref-luceLuceChoiceAxiom2008" role="doc-biblioref">2008</a>)</span>. The model implies that the ratio of probabilities of two outcomes is the same regardless of what other possible outcomes are included in the set. Let <span class="math inline">\(S\)</span> denote the set of possible outcomes. Then, from the definition of the softmax function, the ratio of outcomes <span class="math inline">\(j\)</span> and <span class="math inline">\(k\)</span> is</p>
<p><span class="math display">\[\frac{\phi_j}{\phi_k} = \frac{\exp (\lambda_j) / \sum_{c \in S} \exp (\lambda_c)}{\exp (\lambda_k) / \sum_{c \in S} \exp (\lambda_c)}\]</span></p>
<p>The summation in the denominators cancels and has no effect on the ratio of probabilities. Obviously if we changed the set of outcomes <span class="math inline">\(S\)</span> to any other set <span class="math inline">\(S^*\)</span> that still contains outcomes <span class="math inline">\(j\)</span> and <span class="math inline">\(k\)</span>, the summation <span class="math inline">\(\sum_{c \in S^*}\)</span> would still cancel and have no effect on the ratio of probabilities. (p. 654)</p>
</blockquote>
<p>Just to walk out that denominators-canceling business a little further,</p>
<p><span class="math display">\[\begin{align*}
\frac{\phi_j}{\phi_k} &amp; = \frac{\exp (\lambda_j) / \sum_{c \in S} \exp (\lambda_c)}{\exp (\lambda_k) / \sum_{c \in S} \exp (\lambda_c)} \\
&amp; = \frac{\exp (\lambda_j)}{\exp (\lambda_k)}.
\end{align*}\]</span></p>
<p>Thus even in the case of a very different set of possible outcomes <span class="math inline">\(S^\text{very different}\)</span>, it remains that <span class="math inline">\(\frac{\phi_j}{\phi_k} = \frac{\exp (\lambda_j)}{\exp (\lambda_k)}\)</span>.</p>
<p>Getting more applied, here’s a tibble presentation of Kruschke’s commute example with three modes of transportation.</p>
<div class="sourceCode" id="cb2184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2184-1"><a href="nominal-predicted-variable.html#cb2184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">mode       =</span> <span class="fu">c</span>(<span class="st">&quot;walking&quot;</span>, <span class="st">&quot;bicycling&quot;</span>, <span class="st">&quot;bussing&quot;</span>),</span>
<span id="cb2184-2"><a href="nominal-predicted-variable.html#cb2184-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">preference =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2184-3"><a href="nominal-predicted-variable.html#cb2184-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">chance %</span><span class="st">`</span> <span class="ot">=</span> (<span class="dv">100</span> <span class="sc">*</span> preference <span class="sc">/</span> <span class="fu">sum</span>(preference)) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   mode      preference `chance %`
##   &lt;chr&gt;          &lt;int&gt;      &lt;dbl&gt;
## 1 walking            3       50  
## 2 bicycling          2       33.3
## 3 bussing            1       16.7</code></pre>
<p>Sticking with the example, if we take bicycling out of the picture, the <code>preference</code> values remain, but the <code>chance %</code> values change.</p>
<div class="sourceCode" id="cb2186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2186-1"><a href="nominal-predicted-variable.html#cb2186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">mode       =</span> <span class="fu">c</span>(<span class="st">&quot;walking&quot;</span>, <span class="st">&quot;bussing&quot;</span>),</span>
<span id="cb2186-2"><a href="nominal-predicted-variable.html#cb2186-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">preference =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2186-3"><a href="nominal-predicted-variable.html#cb2186-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">chance %</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> preference <span class="sc">/</span> <span class="fu">sum</span>(preference))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   mode    preference `chance %`
##   &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;
## 1 walking          3         75
## 2 bussing          1         25</code></pre>
<p>Though we retain the same walking/bussing ratio, we end up with a different model of relative probabilities.</p>
</div>
</div>
<div id="conditional-logistic-regression" class="section level2 hasAnchor" number="22.2">
<h2><span class="header-section-number">22.2</span> Conditional logistic regression<a href="nominal-predicted-variable.html#conditional-logistic-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>Softmax regression conceives of each outcome as an independent change in log odds from the reference outcome, and a special case of that is dichotomous logistic regression. But we can generalize logistic regression another way, which may better capture some patterns of data. The idea of this generalization is that we divide the set of outcomes into a hierarchy of two-set divisions, and use a logistic to describe the probability of each branch of the two-set divisions. (p. 655)</p>
</blockquote>
<p>The model follows the generic equation</p>
<p><span class="math display">\[\begin{align*}
\phi_{S^* | S} = \operatorname{logistic}(\lambda_{S^* | S}) \\
\lambda_{S^* | S} = \beta_{0, S^* | S} + \beta_{1, {S^* | S}} x,
\end{align*}\]</span></p>
<p>where the conditional response probability (i.e., the goal of the analysis) is <span class="math inline">\(\phi_{S^* | S}\)</span>. <span class="math inline">\(S^*\)</span> and <span class="math inline">\(S\)</span> denote the subset of outcomes and larger set of outcomes, respectively, and <span class="math inline">\(\lambda_{S^* | S}\)</span> is the propensity based on some linear model. The overall point is these “regression coefficients refer to the conditional probability of outcomes for the designated subsets, not necessarily to a single outcome among the full set of outcomes” (p. 655).</p>
<p>In Figure 22.2 (p. 656), Kruschke depicted the two hierarchies of binary divisions of the models he fit to the data in his <code>CondLogistRegData1.csv</code> and <code>CondLogistRegData2.csv</code> files. Here we load those data, save them as <code>d3</code> and <code>d4</code>, and take a look at their structures.</p>
<div class="sourceCode" id="cb2188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2188-1"><a href="nominal-predicted-variable.html#cb2188-1" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data.R/CondLogistRegData1.csv&quot;</span>)</span>
<span id="cb2188-2"><a href="nominal-predicted-variable.html#cb2188-2" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data.R/CondLogistRegData2.csv&quot;</span>)</span>
<span id="cb2188-3"><a href="nominal-predicted-variable.html#cb2188-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2188-4"><a href="nominal-predicted-variable.html#cb2188-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d3)</span></code></pre></div>
<pre><code>## Rows: 475
## Columns: 3
## $ X1 &lt;dbl&gt; -0.08714736, -0.72256565, 0.17918961, -1.15975176, -0.72711762, 0.53341559, -0.18932650…
## $ X2 &lt;dbl&gt; -1.08134218, -1.58386308, 0.97179045, 0.50262438, 1.37570446, 1.77465062, -0.53727640, …
## $ Y  &lt;dbl&gt; 2, 1, 3, 1, 3, 3, 2, 3, 2, 4, 1, 2, 2, 3, 4, 2, 2, 4, 2, 3, 4, 2, 1, 1, 1, 2, 1, 2, 3, …</code></pre>
<div class="sourceCode" id="cb2190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2190-1"><a href="nominal-predicted-variable.html#cb2190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d4)</span></code></pre></div>
<pre><code>## Rows: 475
## Columns: 3
## $ X1 &lt;dbl&gt; -0.08714736, -0.72256565, 0.17918961, -1.15975176, -0.72711762, 0.53341559, -0.18932650…
## $ X2 &lt;dbl&gt; -1.08134218, -1.58386308, 0.97179045, 0.50262438, 1.37570446, 1.77465062, -0.53727640, …
## $ Y  &lt;dbl&gt; 4, 4, 3, 4, 2, 3, 4, 3, 4, 4, 2, 4, 4, 3, 3, 4, 4, 4, 4, 3, 4, 4, 1, 1, 2, 4, 3, 4, 3, …</code></pre>
<p>In both data sets, the nominal criterion is <code>Y</code> and the two predictors are <code>X1</code> and <code>X2</code>. Though the data seem simple, the conditional logistic models are complex enough that it seems like we’ll be better served by focusing on them one at a time, which means I’m going to break up Figure 22.2. Here’s how to make the diagram in the left panel.</p>
<div class="sourceCode" id="cb2192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2192-1"><a href="nominal-predicted-variable.html#cb2192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the big numbers</span></span>
<span id="cb2192-2"><a href="nominal-predicted-variable.html#cb2192-2" aria-hidden="true" tabindex="-1"></a>numbers <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2192-3"><a href="nominal-predicted-variable.html#cb2192-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x     =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb2192-4"><a href="nominal-predicted-variable.html#cb2192-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y     =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb2192-5"><a href="nominal-predicted-variable.html#cb2192-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3,4&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2,3,4&quot;</span>, <span class="st">&quot;1,2,3,4&quot;</span>)</span>
<span id="cb2192-6"><a href="nominal-predicted-variable.html#cb2192-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2192-7"><a href="nominal-predicted-variable.html#cb2192-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2192-8"><a href="nominal-predicted-variable.html#cb2192-8" aria-hidden="true" tabindex="-1"></a><span class="co"># the smaller Greek numbers</span></span>
<span id="cb2192-9"><a href="nominal-predicted-variable.html#cb2192-9" aria-hidden="true" tabindex="-1"></a>greek <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2192-10"><a href="nominal-predicted-variable.html#cb2192-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x     =</span> <span class="fu">c</span>(<span class="fl">3.4</span>, <span class="fl">4.6</span>, <span class="fl">2.4</span>, <span class="fl">3.6</span>, <span class="fl">1.4</span>, <span class="fl">2.6</span>),</span>
<span id="cb2192-11"><a href="nominal-predicted-variable.html#cb2192-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">y     =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">2.5</span>),</span>
<span id="cb2192-12"><a href="nominal-predicted-variable.html#cb2192-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb2192-13"><a href="nominal-predicted-variable.html#cb2192-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;phi[&#39;{3}|{3,4}&#39;]&quot;</span>, <span class="st">&quot;1-phi[&#39;{3}|{3,4}&#39;]&quot;</span>,</span>
<span id="cb2192-14"><a href="nominal-predicted-variable.html#cb2192-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;phi[&#39;{2}|{2,3,4}&#39;]&quot;</span>, <span class="st">&quot;1-phi[&#39;{2}|{2,3,4}&#39;]&quot;</span>,</span>
<span id="cb2192-15"><a href="nominal-predicted-variable.html#cb2192-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;phi[&#39;{1}|{1,2,3,4}&#39;]&quot;</span>, <span class="st">&quot;1-phi[&#39;{1}|{1,2,3,4}&#39;]&quot;</span>)</span>
<span id="cb2192-16"><a href="nominal-predicted-variable.html#cb2192-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2192-17"><a href="nominal-predicted-variable.html#cb2192-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2192-18"><a href="nominal-predicted-variable.html#cb2192-18" aria-hidden="true" tabindex="-1"></a><span class="co"># arrows</span></span>
<span id="cb2192-19"><a href="nominal-predicted-variable.html#cb2192-19" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb2192-20"><a href="nominal-predicted-variable.html#cb2192-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb2192-21"><a href="nominal-predicted-variable.html#cb2192-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">y    =</span> <span class="fu">c</span>(<span class="fl">0.85</span>, <span class="fl">0.85</span>, <span class="fl">1.85</span>, <span class="fl">1.85</span>, <span class="fl">2.85</span>, <span class="fl">2.85</span>),</span>
<span id="cb2192-22"><a href="nominal-predicted-variable.html#cb2192-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">xend =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb2192-23"><a href="nominal-predicted-variable.html#cb2192-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">yend =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.15</span>, <span class="fl">1.15</span>, <span class="fl">1.15</span>, <span class="fl">2.15</span>, <span class="fl">2.15</span>)</span>
<span id="cb2192-24"><a href="nominal-predicted-variable.html#cb2192-24" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span>  </span>
<span id="cb2192-25"><a href="nominal-predicted-variable.html#cb2192-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2192-26"><a href="nominal-predicted-variable.html#cb2192-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb2192-27"><a href="nominal-predicted-variable.html#cb2192-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb2192-28"><a href="nominal-predicted-variable.html#cb2192-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> xend, <span class="at">yend =</span> yend),</span>
<span id="cb2192-29"><a href="nominal-predicted-variable.html#cb2192-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,</span>
<span id="cb2192-30"><a href="nominal-predicted-variable.html#cb2192-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.08</span>, <span class="st">&quot;in&quot;</span>), <span class="at">type =</span> <span class="st">&quot;closed&quot;</span>)) <span class="sc">+</span></span>
<span id="cb2192-31"><a href="nominal-predicted-variable.html#cb2192-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> numbers,</span>
<span id="cb2192-32"><a href="nominal-predicted-variable.html#cb2192-32" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb2192-33"><a href="nominal-predicted-variable.html#cb2192-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">5</span>, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>)<span class="sc">+</span></span>
<span id="cb2192-34"><a href="nominal-predicted-variable.html#cb2192-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> greek,</span>
<span id="cb2192-35"><a href="nominal-predicted-variable.html#cb2192-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label, <span class="at">hjust =</span> hjust),</span>
<span id="cb2192-36"><a href="nominal-predicted-variable.html#cb2192-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">4.25</span>, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb2192-37"><a href="nominal-predicted-variable.html#cb2192-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb2192-38"><a href="nominal-predicted-variable.html#cb2192-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-9-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>The large numbers are the four levels in the criterion <code>Y</code> and the smaller numbers in the curly braces are various sets of those numbers. The diagram shows three levels of outcome-set divisions:</p>
<ul>
<li>1 versus 2, 3, or 4;</li>
<li>2 versus 3 or 4; and</li>
<li>3 versus 4.</li>
</ul>
<p>The divisions in each of these levels can be expressed as linear models which we’ll denote <span class="math inline">\(\lambda\)</span>. Given our data with two predictors <code>X1</code> and <code>X2</code>, we can express the three linear models as</p>
<p><span class="math display">\[
\begin{align*}
\lambda_{\{ 1 \} | \{ 1,2,3,4 \}} &amp; = \beta_{0,\{ 1 \} | \{ 1,2,3,4 \}} + \beta_{1,\{ 1 \} | \{ 1,2,3,4 \}} \text{X1} + \beta_{2,\{ 1 \} | \{ 1,2,3,4 \}} \text{X2} \\
\lambda_{\{ 2 \} | \{ 2,3,4 \}}   &amp; = \beta_{0,\{ 2 \} | \{ 2,3,4 \}} + \beta_{1,\{ 2 \} | \{ 2,3,4 \}} \text{X1} + \beta_{2,\{ 2 \} | \{ 2,3,4 \}} \text{X2} \\
\lambda_{\{ 3 \} | \{ 3,4 \}}     &amp; = \beta_{0,\{ 3 \} | \{ 3,4 \}} + \beta_{1,\{ 3 \} | \{ 3,4 \}} \text{X1} + \beta_{2,\{ 3 \} | \{ 3,4 \}} \text{X2},
\end{align*}
\]</span></p>
<p>where, for convenience, we’re omitting the typical <span class="math inline">\(i\)</span> subscripts. As these linear models are all defined within the context of the logit link, we can express the conditional probabilities of the outcome sets as</p>
<p><span class="math display">\[
\begin{align*}
\phi_{\{ 1 \} | \{ 1,2,3,4 \}} &amp; = \operatorname{logistic} \left (\lambda_{\{ 1 \} | \{ 1,2,3,4 \}} \right) \\
\phi_{\{ 2 \} | \{ 2,3,4 \}}   &amp; = \operatorname{logistic} \left (\lambda_{\{ 2 \} | \{ 2,3,4 \}} \right) \\
\phi_{\{ 3 \} | \{ 3,4 \}}     &amp; = \operatorname{logistic} \left (\lambda_{\{ 3 \} | \{ 3,4 \}} \right),
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(\phi_{\{ 1 \} | \{ 1,2,3,4 \}}\)</span> through <span class="math inline">\(\phi_{\{ 3 \} | \{ 3,4 \}}\)</span> are the conditional probabilities for the outcome sets. If, however, we want the conditional probabilities for the actual levels of the criterion <code>Y</code>, we define those with a series of (in this case) four equations:</p>
<p><span class="math display">\[
\begin{align*}
\phi_1 &amp; = \phi_{\{ 1 \} | \{ 1,2,3,4 \}} \\
\phi_2 &amp; = \phi_{\{ 2 \} | \{ 2,3,4 \}} \cdot \left ( 1 - \phi_{\{ 1 \} | \{ 1,2,3,4 \}} \right) \\
\phi_3 &amp; = \phi_{\{ 3 \} | \{ 3,4 \}} \cdot \left ( 1 - \phi_{\{ 2 \} | \{ 2,3,4 \}} \right) \cdot \left ( 1 - \phi_{\{ 1 \} | \{ 1,2,3,4 \}} \right) \\
\phi_4 &amp; = \left ( 1 - \phi_{\{ 3 \} | \{ 3,4 \}} \right) \cdot \left ( 1 - \phi_{\{ 2 \} | \{ 2,3,4 \}} \right) \cdot \left ( 1 - \phi_{\{ 1 \} | \{ 1,2,3,4 \}} \right),
\end{align*}
\]</span></p>
<p>where the sum of the probabilities <span class="math inline">\(\phi_1\)</span> through <span class="math inline">\(\phi_4\)</span> is <span class="math inline">\(1\)</span>. To get a sense of what this all means in practice, let’s visualize the data and the data-generating equations for our version of Figure 22.3. As with the previous figure, I’m going to break this figure up to focus on one model at a time. Thus, here’s the left panel of Figure 22.3.</p>
<div class="sourceCode" id="cb2193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2193-1"><a href="nominal-predicted-variable.html#cb2193-1" aria-hidden="true" tabindex="-1"></a><span class="do">## define the various population parameters</span></span>
<span id="cb2193-2"><a href="nominal-predicted-variable.html#cb2193-2" aria-hidden="true" tabindex="-1"></a><span class="co"># lambda 1</span></span>
<span id="cb2193-3"><a href="nominal-predicted-variable.html#cb2193-3" aria-hidden="true" tabindex="-1"></a>b01 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb2193-4"><a href="nominal-predicted-variable.html#cb2193-4" aria-hidden="true" tabindex="-1"></a>b11 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">5</span></span>
<span id="cb2193-5"><a href="nominal-predicted-variable.html#cb2193-5" aria-hidden="true" tabindex="-1"></a>b21 <span class="ot">&lt;-</span> <span class="fl">0.01</span>  <span class="co"># rounding up to avoid dividing by zero</span></span>
<span id="cb2193-6"><a href="nominal-predicted-variable.html#cb2193-6" aria-hidden="true" tabindex="-1"></a><span class="co"># lambda 2</span></span>
<span id="cb2193-7"><a href="nominal-predicted-variable.html#cb2193-7" aria-hidden="true" tabindex="-1"></a>b02 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span></span>
<span id="cb2193-8"><a href="nominal-predicted-variable.html#cb2193-8" aria-hidden="true" tabindex="-1"></a>b12 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2193-9"><a href="nominal-predicted-variable.html#cb2193-9" aria-hidden="true" tabindex="-1"></a>b22 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">5</span></span>
<span id="cb2193-10"><a href="nominal-predicted-variable.html#cb2193-10" aria-hidden="true" tabindex="-1"></a><span class="co"># lambda 3</span></span>
<span id="cb2193-11"><a href="nominal-predicted-variable.html#cb2193-11" aria-hidden="true" tabindex="-1"></a>b03 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb2193-12"><a href="nominal-predicted-variable.html#cb2193-12" aria-hidden="true" tabindex="-1"></a>b13 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb2193-13"><a href="nominal-predicted-variable.html#cb2193-13" aria-hidden="true" tabindex="-1"></a>b23 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb2193-14"><a href="nominal-predicted-variable.html#cb2193-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2193-15"><a href="nominal-predicted-variable.html#cb2193-15" aria-hidden="true" tabindex="-1"></a><span class="co"># use the parameters to define the lines </span></span>
<span id="cb2193-16"><a href="nominal-predicted-variable.html#cb2193-16" aria-hidden="true" tabindex="-1"></a>lines <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2193-17"><a href="nominal-predicted-variable.html#cb2193-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">intercept =</span> <span class="fu">c</span>(<span class="sc">-</span>b01 <span class="sc">/</span> b21, <span class="sc">-</span>b02 <span class="sc">/</span> b22, <span class="sc">-</span>b03 <span class="sc">/</span> b23),</span>
<span id="cb2193-18"><a href="nominal-predicted-variable.html#cb2193-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">slope =</span> <span class="fu">c</span>(<span class="sc">-</span>b11 <span class="sc">/</span> b21, <span class="sc">-</span>b12 <span class="sc">/</span> b22, <span class="sc">-</span>b13 <span class="sc">/</span> b23),</span>
<span id="cb2193-19"><a href="nominal-predicted-variable.html#cb2193-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>,<span class="st">&quot;3&quot;</span>)</span>
<span id="cb2193-20"><a href="nominal-predicted-variable.html#cb2193-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2193-21"><a href="nominal-predicted-variable.html#cb2193-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2193-22"><a href="nominal-predicted-variable.html#cb2193-22" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb2193-23"><a href="nominal-predicted-variable.html#cb2193-23" aria-hidden="true" tabindex="-1"></a>d3 <span class="sc">%&gt;%</span> </span>
<span id="cb2193-24"><a href="nominal-predicted-variable.html#cb2193-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">factor</span>(Y)) <span class="sc">%&gt;%</span> </span>
<span id="cb2193-25"><a href="nominal-predicted-variable.html#cb2193-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2193-26"><a href="nominal-predicted-variable.html#cb2193-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb2193-27"><a href="nominal-predicted-variable.html#cb2193-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2193-28"><a href="nominal-predicted-variable.html#cb2193-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb2193-29"><a href="nominal-predicted-variable.html#cb2193-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb2193-30"><a href="nominal-predicted-variable.html#cb2193-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2, <span class="at">label =</span> Y, <span class="at">color =</span> Y),</span>
<span id="cb2193-31"><a href="nominal-predicted-variable.html#cb2193-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb2193-32"><a href="nominal-predicted-variable.html#cb2193-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">data =</span> lines,</span>
<span id="cb2193-33"><a href="nominal-predicted-variable.html#cb2193-33" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">intercept =</span> intercept,</span>
<span id="cb2193-34"><a href="nominal-predicted-variable.html#cb2193-34" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope =</span> slope,</span>
<span id="cb2193-35"><a href="nominal-predicted-variable.html#cb2193-35" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> label),</span>
<span id="cb2193-36"><a href="nominal-predicted-variable.html#cb2193-36" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2193-37"><a href="nominal-predicted-variable.html#cb2193-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pl[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb2193-38"><a href="nominal-predicted-variable.html#cb2193-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="cn">NULL</span>,</span>
<span id="cb2193-39"><a href="nominal-predicted-variable.html#cb2193-39" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labels =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">c</span>(</span>
<span id="cb2193-40"><a href="nominal-predicted-variable.html#cb2193-40" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{1}|{1,2,3,4}&#39;]==-4+-5*x[1]+0*x[2]&quot;</span>, </span>
<span id="cb2193-41"><a href="nominal-predicted-variable.html#cb2193-41" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{2}|{2,3,4}&#39;]==-2+1*x[1]+-5*x[2]&quot;</span>, </span>
<span id="cb2193-42"><a href="nominal-predicted-variable.html#cb2193-42" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{3}|{3,4}&#39;]==-1+3*x[1]+3*x[2]&quot;</span>)),</span>
<span id="cb2193-43"><a href="nominal-predicted-variable.html#cb2193-43" aria-hidden="true" tabindex="-1"></a>                 <span class="at">guide =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb2193-44"><a href="nominal-predicted-variable.html#cb2193-44" aria-hidden="true" tabindex="-1"></a>                   <span class="at">direction =</span> <span class="st">&quot;vertical&quot;</span>,</span>
<span id="cb2193-45"><a href="nominal-predicted-variable.html#cb2193-45" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb2193-46"><a href="nominal-predicted-variable.html#cb2193-46" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.theme =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))) <span class="sc">+</span></span>
<span id="cb2193-47"><a href="nominal-predicted-variable.html#cb2193-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb2193-48"><a href="nominal-predicted-variable.html#cb2193-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(x[<span class="dv">1</span>]),</span>
<span id="cb2193-49"><a href="nominal-predicted-variable.html#cb2193-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(x[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb2193-50"><a href="nominal-predicted-variable.html#cb2193-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.justification =</span> <span class="fl">0.5</span>,</span>
<span id="cb2193-51"><a href="nominal-predicted-variable.html#cb2193-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-10-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Recall back on page 629, Kruschke showed the equation for the 50% threshold of a logistic regression model given two continuous predictors was</p>
<p><span class="math display">\[x_2 = (-\beta_0 / \beta_2) + (-\beta_1 / \beta_2) x_1.\]</span></p>
<p>It was that equation that gave us the values for the <code>intercept</code> and <code>slope</code> arguments (<span class="math inline">\(-\beta_0 / \beta_2\)</span> and <span class="math inline">\(-\beta_1 / \beta_2\)</span>, respectively) for the <code>geom_abline()</code> function.</p>
<p>It still might not be clear how the various <span class="math inline">\(\phi_{S^* | S}\)</span> values connect to the data. Though not in the text, here’s an alternative way of expressing the relations in Figure 22.3. This time the plot is faceted by the three levels of <span class="math inline">\(\phi_{S^* | S}\)</span> and the background fill is based on those conditional probabilities.</p>
<div class="sourceCode" id="cb2194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2194-1"><a href="nominal-predicted-variable.html#cb2194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a grid of X1 and X2 values</span></span>
<span id="cb2194-2"><a href="nominal-predicted-variable.html#cb2194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">crossing</span>(<span class="at">X1 =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">50</span>),</span>
<span id="cb2194-3"><a href="nominal-predicted-variable.html#cb2194-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">X2 =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2194-4"><a href="nominal-predicted-variable.html#cb2194-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the lambda&#39;s</span></span>
<span id="cb2194-5"><a href="nominal-predicted-variable.html#cb2194-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">lambda[&#39;{1}|{1,2,3,4}&#39;]</span><span class="st">`</span> <span class="ot">=</span> b01 <span class="sc">+</span> b11 <span class="sc">*</span> X1 <span class="sc">+</span> b21 <span class="sc">*</span> X2,</span>
<span id="cb2194-6"><a href="nominal-predicted-variable.html#cb2194-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">lambda[&#39;{2}|{2,3,4}&#39;]</span><span class="st">`</span>   <span class="ot">=</span> b02 <span class="sc">+</span> b12 <span class="sc">*</span> X1 <span class="sc">+</span> b22 <span class="sc">*</span> X2,</span>
<span id="cb2194-7"><a href="nominal-predicted-variable.html#cb2194-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">lambda[&#39;{3}|{3,4}&#39;]</span><span class="st">`</span>     <span class="ot">=</span> b03 <span class="sc">+</span> b13 <span class="sc">*</span> X1 <span class="sc">+</span> b23 <span class="sc">*</span> X2) <span class="sc">%&gt;%</span> </span>
<span id="cb2194-8"><a href="nominal-predicted-variable.html#cb2194-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the phi&#39;s</span></span>
<span id="cb2194-9"><a href="nominal-predicted-variable.html#cb2194-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">phi[&#39;{1}|{1,2,3,4}&#39;]</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">plogis</span>(<span class="st">`</span><span class="at">lambda[&#39;{1}|{1,2,3,4}&#39;]</span><span class="st">`</span>),</span>
<span id="cb2194-10"><a href="nominal-predicted-variable.html#cb2194-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">phi[&#39;{2}|{2,3,4}&#39;]</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">plogis</span>(<span class="st">`</span><span class="at">lambda[&#39;{2}|{2,3,4}&#39;]</span><span class="st">`</span>),</span>
<span id="cb2194-11"><a href="nominal-predicted-variable.html#cb2194-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">phi[&#39;{3}|{3,4}&#39;]</span><span class="st">`</span>     <span class="ot">=</span> <span class="fu">plogis</span>(<span class="st">`</span><span class="at">lambda[&#39;{3}|{3,4}&#39;]</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2194-12"><a href="nominal-predicted-variable.html#cb2194-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># wrangle</span></span>
<span id="cb2194-13"><a href="nominal-predicted-variable.html#cb2194-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;phi&quot;</span>), <span class="at">values_to =</span> <span class="st">&quot;phi&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2194-14"><a href="nominal-predicted-variable.html#cb2194-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2194-15"><a href="nominal-predicted-variable.html#cb2194-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb2194-16"><a href="nominal-predicted-variable.html#cb2194-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2)) <span class="sc">+</span></span>
<span id="cb2194-17"><a href="nominal-predicted-variable.html#cb2194-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">fill =</span> phi),</span>
<span id="cb2194-18"><a href="nominal-predicted-variable.html#cb2194-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">interpolate =</span> T) <span class="sc">+</span></span>
<span id="cb2194-19"><a href="nominal-predicted-variable.html#cb2194-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note how we&#39;re subsetting the d3 data by facet</span></span>
<span id="cb2194-20"><a href="nominal-predicted-variable.html#cb2194-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">bind_rows</span>(</span>
<span id="cb2194-21"><a href="nominal-predicted-variable.html#cb2194-21" aria-hidden="true" tabindex="-1"></a>    d3 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">name =</span> <span class="st">&quot;phi[&#39;{1}|{1,2,3,4}&#39;]&quot;</span>),</span>
<span id="cb2194-22"><a href="nominal-predicted-variable.html#cb2194-22" aria-hidden="true" tabindex="-1"></a>    d3 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">name =</span> <span class="st">&quot;phi[&#39;{2}|{2,3,4}&#39;]&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Y <span class="sc">&gt;</span> <span class="dv">1</span>),</span>
<span id="cb2194-23"><a href="nominal-predicted-variable.html#cb2194-23" aria-hidden="true" tabindex="-1"></a>    d3 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">name =</span> <span class="st">&quot;phi[&#39;{3}|{3,4}&#39;]&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Y <span class="sc">&gt;</span> <span class="dv">2</span>)),</span>
<span id="cb2194-24"><a href="nominal-predicted-variable.html#cb2194-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> Y),</span>
<span id="cb2194-25"><a href="nominal-predicted-variable.html#cb2194-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb2194-26"><a href="nominal-predicted-variable.html#cb2194-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="fu">expression</span>(phi[<span class="fu">italic</span>(S)<span class="sc">*</span><span class="st">&quot;*|&quot;</span><span class="sc">*</span><span class="fu">italic</span>(S)]),</span>
<span id="cb2194-27"><a href="nominal-predicted-variable.html#cb2194-27" aria-hidden="true" tabindex="-1"></a>                       <span class="at">colours =</span> <span class="fu">pnw_palette</span>(<span class="at">name =</span> <span class="st">&quot;Lake&quot;</span>, <span class="at">n =</span> <span class="dv">101</span>),</span>
<span id="cb2194-28"><a href="nominal-predicted-variable.html#cb2194-28" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb2194-29"><a href="nominal-predicted-variable.html#cb2194-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2194-30"><a href="nominal-predicted-variable.html#cb2194-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2194-31"><a href="nominal-predicted-variable.html#cb2194-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb2194-32"><a href="nominal-predicted-variable.html#cb2194-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb2194-33"><a href="nominal-predicted-variable.html#cb2194-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">labeller =</span> label_parsed, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Notice how because each of the levels of <span class="math inline">\(\phi\)</span> is defined by a different subset of the data, each of the facets contains a different subset of the <code>d3</code> data, too. For example, since <span class="math inline">\(\phi_{\{ 1 \} | \{ 1,2,3,4 \}}\)</span> is defined by the full subset of the possible values of <code>Y</code>, you see all the <code>Y</code> data displayed by <code>geom_text()</code> for that facet. In contrast, since <span class="math inline">\(\phi_{\{ 3 \} | \{ 3,4 \}}\)</span> is defined by a subset of the data for which <code>Y</code> is only <code>3</code> or <code>4</code>, those are the only values you see displayed within that facet of the plot.</p>
<p>Now we’ll consider an alternative way to set up the binary-choices hierarchy, as seen in the right panel of Figure 22.2. First, here’s that half of the figure.</p>
<div class="sourceCode" id="cb2195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2195-1"><a href="nominal-predicted-variable.html#cb2195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the big numbers</span></span>
<span id="cb2195-2"><a href="nominal-predicted-variable.html#cb2195-2" aria-hidden="true" tabindex="-1"></a>numbers <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2195-3"><a href="nominal-predicted-variable.html#cb2195-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">4</span>),</span>
<span id="cb2195-4"><a href="nominal-predicted-variable.html#cb2195-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb2195-5"><a href="nominal-predicted-variable.html#cb2195-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;1,2&quot;</span>, <span class="st">&quot;3,4&quot;</span>, <span class="st">&quot;1,2,3,4&quot;</span>)</span>
<span id="cb2195-6"><a href="nominal-predicted-variable.html#cb2195-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2195-7"><a href="nominal-predicted-variable.html#cb2195-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2195-8"><a href="nominal-predicted-variable.html#cb2195-8" aria-hidden="true" tabindex="-1"></a><span class="co"># the smaller Greek numbers</span></span>
<span id="cb2195-9"><a href="nominal-predicted-variable.html#cb2195-9" aria-hidden="true" tabindex="-1"></a>greek <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2195-10"><a href="nominal-predicted-variable.html#cb2195-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">1.6</span>, <span class="fl">6.4</span>, <span class="fl">7.6</span>, <span class="fl">2.1</span>, <span class="fl">5.8</span>),</span>
<span id="cb2195-11"><a href="nominal-predicted-variable.html#cb2195-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>),</span>
<span id="cb2195-12"><a href="nominal-predicted-variable.html#cb2195-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb2195-13"><a href="nominal-predicted-variable.html#cb2195-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;phi[&#39;{1}|{1,2}&#39;]&quot;</span>, <span class="st">&quot;1-phi[&#39;{1}|{1,2}&#39;]&quot;</span>,</span>
<span id="cb2195-14"><a href="nominal-predicted-variable.html#cb2195-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;phi[&#39;{3}|{3,4}&#39;]&quot;</span>, <span class="st">&quot;1-phi[&#39;{3}|{3,4}&#39;]&quot;</span>,</span>
<span id="cb2195-15"><a href="nominal-predicted-variable.html#cb2195-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;phi[&#39;{1,2}|{1,2,3,4}&#39;]&quot;</span>, <span class="st">&quot;1-phi[&#39;{1,2}|{1,2,3,4}&#39;]&quot;</span>)</span>
<span id="cb2195-16"><a href="nominal-predicted-variable.html#cb2195-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2195-17"><a href="nominal-predicted-variable.html#cb2195-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2195-18"><a href="nominal-predicted-variable.html#cb2195-18" aria-hidden="true" tabindex="-1"></a><span class="co"># arrows</span></span>
<span id="cb2195-19"><a href="nominal-predicted-variable.html#cb2195-19" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb2195-20"><a href="nominal-predicted-variable.html#cb2195-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb2195-21"><a href="nominal-predicted-variable.html#cb2195-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">0.85</span>, <span class="fl">0.85</span>, <span class="fl">0.85</span>, <span class="fl">0.85</span>, <span class="fl">1.85</span>, <span class="fl">1.85</span>),</span>
<span id="cb2195-22"><a href="nominal-predicted-variable.html#cb2195-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">xend =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">7</span>),</span>
<span id="cb2195-23"><a href="nominal-predicted-variable.html#cb2195-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">yend =</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.15</span>, <span class="fl">0.15</span>, <span class="fl">0.15</span>, <span class="fl">1.15</span>, <span class="fl">1.15</span>)</span>
<span id="cb2195-24"><a href="nominal-predicted-variable.html#cb2195-24" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span>  </span>
<span id="cb2195-25"><a href="nominal-predicted-variable.html#cb2195-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2195-26"><a href="nominal-predicted-variable.html#cb2195-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb2195-27"><a href="nominal-predicted-variable.html#cb2195-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb2195-28"><a href="nominal-predicted-variable.html#cb2195-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> xend, <span class="at">yend =</span> yend),</span>
<span id="cb2195-29"><a href="nominal-predicted-variable.html#cb2195-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>,</span>
<span id="cb2195-30"><a href="nominal-predicted-variable.html#cb2195-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.08</span>, <span class="st">&quot;in&quot;</span>), <span class="at">type =</span> <span class="st">&quot;closed&quot;</span>)) <span class="sc">+</span></span>
<span id="cb2195-31"><a href="nominal-predicted-variable.html#cb2195-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> numbers,</span>
<span id="cb2195-32"><a href="nominal-predicted-variable.html#cb2195-32" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb2195-33"><a href="nominal-predicted-variable.html#cb2195-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">5</span>, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>)<span class="sc">+</span></span>
<span id="cb2195-34"><a href="nominal-predicted-variable.html#cb2195-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> greek,</span>
<span id="cb2195-35"><a href="nominal-predicted-variable.html#cb2195-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> label, <span class="at">hjust =</span> hjust),</span>
<span id="cb2195-36"><a href="nominal-predicted-variable.html#cb2195-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">4.25</span>, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb2195-37"><a href="nominal-predicted-variable.html#cb2195-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb2195-38"><a href="nominal-predicted-variable.html#cb2195-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-12-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>This diagram shows three levels of outcome-set divisions:</p>
<ul>
<li>1 or 2 versus 3 or 4;</li>
<li>1 versus 2; and</li>
<li>3 versus 4.</li>
</ul>
<p>Given our data with two predictors <code>X1</code> and <code>X2</code>, we can express the three linear models as</p>
<p><span class="math display">\[
\begin{align*}
\lambda_{\{ 1,2 \} | \{ 1,2,3,4 \}} &amp; = \beta_{0,\{ 1,2 \} | \{ 1,2,3,4 \}} + \beta_{1,\{ 1,2 \} | \{ 1,2,3,4 \}} \text{X1} + \beta_{2,\{ 1,2 \} | \{ 1,2,3,4 \}} \text{X2} \\
\lambda_{\{ 1 \} | \{ 1,2 \}}   &amp; = \beta_{0,\{ 1 \} | \{ 1,2 \}} + \beta_{1,\{ 1 \} | \{ 1,2 \}} \text{X1} + \beta_{2,\{ 1 \} | \{ 1,2 \}} \text{X2} \\
\lambda_{\{ 3 \} | \{ 3,4 \}}     &amp; = \beta_{0,\{ 3 \} | \{ 3,4 \}} + \beta_{1,\{ 3 \} | \{ 3,4 \}} \text{X1} + \beta_{2,\{ 3 \} | \{ 3,4 \}} \text{X2}.
\end{align*}
\]</span></p>
<p>We can then express the conditional probabilities of the outcome sets as</p>
<p><span class="math display">\[
\begin{align*}
\phi_{\{ 1,2 \} | \{ 1,2,3,4 \}} &amp; = \operatorname{logistic} \left (\lambda_{\{ 1,2 \} | \{ 1,2,3,4 \}} \right) \\
\phi_{\{ 1 \} | \{ 1,2 \}}   &amp; = \operatorname{logistic} \left (\lambda_{\{ 1 \} | \{ 1,2 \}} \right) \\
\phi_{\{ 3 \} | \{ 3,4 \}}     &amp; = \operatorname{logistic} \left (\lambda_{\{ 3 \} | \{ 3,4 \}} \right).
\end{align*}
\]</span></p>
<p>For the conditional probabilities of the actual levels of the criterion <code>Y</code>, we define those with a series of (in this case) four equations:</p>
<p><span class="math display">\[
\begin{align*}
\phi_1 &amp; = \phi_{\{ 1 \} | \{ 1,2 \}} \cdot \phi_{\{ 1,2 \} | \{ 1,2,3,4 \}} \\
\phi_2 &amp; = \left ( 1 - \phi_{\{ 1 \} | \{ 1,2 \}} \right) \cdot \phi_{\{ 1,2 \} | \{ 1,2,3,4 \}} \\
\phi_3 &amp; = \phi_{\{ 3 \} | \{ 3,4 \}} \cdot \left ( 1 - \phi_{\{ 1,2 \} | \{ 1,2,3,4 \}} \right) \\
\phi_4 &amp; = \left ( 1 - \phi_{\{ 3 \} | \{ 3,4 \}} \right) \cdot \left ( 1 - \phi_{\{ 1,2 \} | \{ 1,2,3,4 \}} \right),
\end{align*}
\]</span></p>
<p>where the sum of the probabilities <span class="math inline">\(\phi_1\)</span> through <span class="math inline">\(\phi_4\)</span> is <span class="math inline">\(1\)</span>. To get a sense of what this all means, let’s visualize the data and the data-generating equations in our version of the right panel of Figure 22.3.</p>
<div class="sourceCode" id="cb2196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2196-1"><a href="nominal-predicted-variable.html#cb2196-1" aria-hidden="true" tabindex="-1"></a>d4 <span class="sc">%&gt;%</span> </span>
<span id="cb2196-2"><a href="nominal-predicted-variable.html#cb2196-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">factor</span>(Y)) <span class="sc">%&gt;%</span> </span>
<span id="cb2196-3"><a href="nominal-predicted-variable.html#cb2196-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2196-4"><a href="nominal-predicted-variable.html#cb2196-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2196-5"><a href="nominal-predicted-variable.html#cb2196-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb2196-6"><a href="nominal-predicted-variable.html#cb2196-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb2196-7"><a href="nominal-predicted-variable.html#cb2196-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2, <span class="at">label =</span> Y, <span class="at">color =</span> Y),</span>
<span id="cb2196-8"><a href="nominal-predicted-variable.html#cb2196-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb2196-9"><a href="nominal-predicted-variable.html#cb2196-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">data =</span> lines,</span>
<span id="cb2196-10"><a href="nominal-predicted-variable.html#cb2196-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">intercept =</span> intercept,</span>
<span id="cb2196-11"><a href="nominal-predicted-variable.html#cb2196-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope =</span> slope,</span>
<span id="cb2196-12"><a href="nominal-predicted-variable.html#cb2196-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> label),</span>
<span id="cb2196-13"><a href="nominal-predicted-variable.html#cb2196-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2196-14"><a href="nominal-predicted-variable.html#cb2196-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pl[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb2196-15"><a href="nominal-predicted-variable.html#cb2196-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="cn">NULL</span>,</span>
<span id="cb2196-16"><a href="nominal-predicted-variable.html#cb2196-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labels =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">c</span>(</span>
<span id="cb2196-17"><a href="nominal-predicted-variable.html#cb2196-17" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{1,2}|{1,2,3,4}&#39;]==-4+-5*x[1]+0*x[2]&quot;</span>, </span>
<span id="cb2196-18"><a href="nominal-predicted-variable.html#cb2196-18" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{1}|{1,2}&#39;]==-2+1*x[1]+-5*x[2]&quot;</span>, </span>
<span id="cb2196-19"><a href="nominal-predicted-variable.html#cb2196-19" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{3}|{3,4}&#39;]==-1+3*x[1]+3*x[2]&quot;</span>)),</span>
<span id="cb2196-20"><a href="nominal-predicted-variable.html#cb2196-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">guide =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb2196-21"><a href="nominal-predicted-variable.html#cb2196-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">direction =</span> <span class="st">&quot;vertical&quot;</span>,</span>
<span id="cb2196-22"><a href="nominal-predicted-variable.html#cb2196-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb2196-23"><a href="nominal-predicted-variable.html#cb2196-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.theme =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))) <span class="sc">+</span></span>
<span id="cb2196-24"><a href="nominal-predicted-variable.html#cb2196-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb2196-25"><a href="nominal-predicted-variable.html#cb2196-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(x[<span class="dv">1</span>]),</span>
<span id="cb2196-26"><a href="nominal-predicted-variable.html#cb2196-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(x[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb2196-27"><a href="nominal-predicted-variable.html#cb2196-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.justification =</span> <span class="fl">0.5</span>,</span>
<span id="cb2196-28"><a href="nominal-predicted-variable.html#cb2196-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-13-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Here’s an alternative way of expression the relations in the right panel of Figure 22.3. This time the plot is faceted by the three levels of <span class="math inline">\(\phi_{S^* | S}\)</span> and the background fill is based on those conditional probabilities.</p>
<div class="sourceCode" id="cb2197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2197-1"><a href="nominal-predicted-variable.html#cb2197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a grid of X1 and X2 values</span></span>
<span id="cb2197-2"><a href="nominal-predicted-variable.html#cb2197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">crossing</span>(<span class="at">X1 =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">50</span>),</span>
<span id="cb2197-3"><a href="nominal-predicted-variable.html#cb2197-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">X2 =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2197-4"><a href="nominal-predicted-variable.html#cb2197-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the lambda&#39;s</span></span>
<span id="cb2197-5"><a href="nominal-predicted-variable.html#cb2197-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">lambda[&#39;{1,2}|{1,2,3,4}&#39;]</span><span class="st">`</span> <span class="ot">=</span> b01 <span class="sc">+</span> b11 <span class="sc">*</span> X1 <span class="sc">+</span> b21 <span class="sc">*</span> X2,</span>
<span id="cb2197-6"><a href="nominal-predicted-variable.html#cb2197-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">lambda[&#39;{1}|{1,2}&#39;]</span><span class="st">`</span>       <span class="ot">=</span> b02 <span class="sc">+</span> b12 <span class="sc">*</span> X1 <span class="sc">+</span> b22 <span class="sc">*</span> X2,</span>
<span id="cb2197-7"><a href="nominal-predicted-variable.html#cb2197-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">lambda[&#39;{3}|{3,4}&#39;]</span><span class="st">`</span>       <span class="ot">=</span> b03 <span class="sc">+</span> b13 <span class="sc">*</span> X1 <span class="sc">+</span> b23 <span class="sc">*</span> X2) <span class="sc">%&gt;%</span> </span>
<span id="cb2197-8"><a href="nominal-predicted-variable.html#cb2197-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the phi&#39;s</span></span>
<span id="cb2197-9"><a href="nominal-predicted-variable.html#cb2197-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">phi[&#39;{1,2}|{1,2,3,4}&#39;]</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">plogis</span>(<span class="st">`</span><span class="at">lambda[&#39;{1,2}|{1,2,3,4}&#39;]</span><span class="st">`</span>),</span>
<span id="cb2197-10"><a href="nominal-predicted-variable.html#cb2197-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">phi[&#39;{1}|{1,2}&#39;]</span><span class="st">`</span>       <span class="ot">=</span> <span class="fu">plogis</span>(<span class="st">`</span><span class="at">lambda[&#39;{1}|{1,2}&#39;]</span><span class="st">`</span>),</span>
<span id="cb2197-11"><a href="nominal-predicted-variable.html#cb2197-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">phi[&#39;{3}|{3,4}&#39;]</span><span class="st">`</span>       <span class="ot">=</span> <span class="fu">plogis</span>(<span class="st">`</span><span class="at">lambda[&#39;{3}|{3,4}&#39;]</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2197-12"><a href="nominal-predicted-variable.html#cb2197-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># wrangle</span></span>
<span id="cb2197-13"><a href="nominal-predicted-variable.html#cb2197-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;phi&quot;</span>), <span class="at">values_to =</span> <span class="st">&quot;phi&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2197-14"><a href="nominal-predicted-variable.html#cb2197-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2197-15"><a href="nominal-predicted-variable.html#cb2197-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb2197-16"><a href="nominal-predicted-variable.html#cb2197-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2)) <span class="sc">+</span></span>
<span id="cb2197-17"><a href="nominal-predicted-variable.html#cb2197-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">fill =</span> phi),</span>
<span id="cb2197-18"><a href="nominal-predicted-variable.html#cb2197-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">interpolate =</span> T) <span class="sc">+</span></span>
<span id="cb2197-19"><a href="nominal-predicted-variable.html#cb2197-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note how we&#39;re subsetting the d3 data by facet</span></span>
<span id="cb2197-20"><a href="nominal-predicted-variable.html#cb2197-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">bind_rows</span>(</span>
<span id="cb2197-21"><a href="nominal-predicted-variable.html#cb2197-21" aria-hidden="true" tabindex="-1"></a>    d4 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">name =</span> <span class="st">&quot;phi[&#39;{1,2}|{1,2,3,4}&#39;]&quot;</span>),</span>
<span id="cb2197-22"><a href="nominal-predicted-variable.html#cb2197-22" aria-hidden="true" tabindex="-1"></a>    d4 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">name =</span> <span class="st">&quot;phi[&#39;{1}|{1,2}&#39;]&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Y <span class="sc">&lt;</span> <span class="dv">3</span>),</span>
<span id="cb2197-23"><a href="nominal-predicted-variable.html#cb2197-23" aria-hidden="true" tabindex="-1"></a>    d4 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">name =</span> <span class="st">&quot;phi[&#39;{3}|{3,4}&#39;]&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Y <span class="sc">&gt;</span> <span class="dv">2</span>)),</span>
<span id="cb2197-24"><a href="nominal-predicted-variable.html#cb2197-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> Y),</span>
<span id="cb2197-25"><a href="nominal-predicted-variable.html#cb2197-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb2197-26"><a href="nominal-predicted-variable.html#cb2197-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="fu">expression</span>(phi[<span class="fu">italic</span>(S)<span class="sc">*</span><span class="st">&quot;*|&quot;</span><span class="sc">*</span><span class="fu">italic</span>(S)]),</span>
<span id="cb2197-27"><a href="nominal-predicted-variable.html#cb2197-27" aria-hidden="true" tabindex="-1"></a>                       <span class="at">colours =</span> <span class="fu">pnw_palette</span>(<span class="at">name =</span> <span class="st">&quot;Lake&quot;</span>, <span class="at">n =</span> <span class="dv">101</span>),</span>
<span id="cb2197-28"><a href="nominal-predicted-variable.html#cb2197-28" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb2197-29"><a href="nominal-predicted-variable.html#cb2197-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2197-30"><a href="nominal-predicted-variable.html#cb2197-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2197-31"><a href="nominal-predicted-variable.html#cb2197-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb2197-32"><a href="nominal-predicted-variable.html#cb2197-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb2197-33"><a href="nominal-predicted-variable.html#cb2197-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">labeller =</span> label_parsed, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-14-1.png" width="528" style="display: block; margin: auto;" /></p>
<p>It could be easy to miss due to the way we broke up our workflow, but if you look closely at the <span class="math inline">\(\lambda\)</span> equations at the top of both panels of Figure 22.3, you’ll see the right-hand side of the equations are the same. But because of the differences in the two data hierarchies, those <span class="math inline">\(\lambda\)</span> equations had different consequences for how the <code>X1</code> and <code>X2</code> values generated the <code>Y</code> data. Also,</p>
<blockquote>
<p>In general, conditional logistic regression requires that there is a linear division between two subsets of the outcomes, and then within each of those subsets there is a linear division of smaller subsets, and so on. This sort of linear division is not required of the softmax regression model… Real data can be extremely noisy, and there can be multiple predictors, so it can be challenging or impossible to visually ascertain which sort of model is most appropriate. The choice of model is driven primarily by theoretical meaningfulness. (p. 659)</p>
</blockquote>
</div>
<div id="implementation-in-jags-brms" class="section level2 hasAnchor" number="22.3">
<h2><span class="header-section-number">22.3</span> Implementation in <del>JAGS</del> brms<a href="nominal-predicted-variable.html#implementation-in-jags-brms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="softmax-model." class="section level3 hasAnchor" number="22.3.1">
<h3><span class="header-section-number">22.3.1</span> Softmax model.<a href="nominal-predicted-variable.html#softmax-model." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Kruschke pointed out in his Figure 22.4 and the surrounding prose that we speak of the <em>categorical distribution</em> when fitting softmax models. Our <strong>brms</strong> paradigm will be much the same. To fit a softmax model with the <code>brm()</code> function, you specify <code>family = categorical</code>. The default is to use the logit link. In his <span class="citation">(<a href="#ref-Bürkner2022Parameterization" role="doc-biblioref">2022c</a>)</span> <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_families.html#ordinal-and-categorical-models"><em>Parameterization of response distributions in brms</em></a> vignette, Bürkner clarified:</p>
<blockquote>
<p>The <strong>categorical</strong> family is currently only implemented with the multivariate logit link function and has density</p>
<p><span class="math display">\[f(y) = \mu_y = \frac{\exp (\eta_y)}{\sum_{k = 1}^K \exp (\eta_k)}\]</span></p>
<p>Note that <span class="math inline">\(\eta\)</span> does also depend on the category <span class="math inline">\(k\)</span>. For reasons of identifiability, <span class="math inline">\(\eta_1\)</span> is set to <span class="math inline">\(0\)</span>.</p>
</blockquote>
<p>Though there’s no explicit softmax talk in that vignette, you can find it documented in his code <a href="https://github.com/paul-buerkner/brms/blob/bc550ff3a2d41656a6711737faf1049207657800/R/distributions.R">here</a>, starting in line 1891.</p>
<p>Now onto our <strong>ggplot2</strong> + <strong>patchwork</strong> version of the model diagram in Figure 22.4. I’m not gonna lie. The requisite code is a slog. We’ll take the task in bits. First, we make and save the elements for the diagram on the left.</p>
<div class="sourceCode" id="cb2198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2198-1"><a href="nominal-predicted-variable.html#cb2198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb2198-2"><a href="nominal-predicted-variable.html#cb2198-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2198-3"><a href="nominal-predicted-variable.html#cb2198-3" aria-hidden="true" tabindex="-1"></a><span class="co"># normal density</span></span>
<span id="cb2198-4"><a href="nominal-predicted-variable.html#cb2198-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb2198-5"><a href="nominal-predicted-variable.html#cb2198-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2198-6"><a href="nominal-predicted-variable.html#cb2198-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> (<span class="fu">dnorm</span>(x)) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">dnorm</span>(x)))) <span class="sc">+</span></span>
<span id="cb2198-7"><a href="nominal-predicted-variable.html#cb2198-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">fill =</span> pl[<span class="dv">6</span>], <span class="at">color =</span> pl[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb2198-8"><a href="nominal-predicted-variable.html#cb2198-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2198-9"><a href="nominal-predicted-variable.html#cb2198-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> .<span class="dv">2</span>,</span>
<span id="cb2198-10"><a href="nominal-predicted-variable.html#cb2198-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;normal&quot;</span>,</span>
<span id="cb2198-11"><a href="nominal-predicted-variable.html#cb2198-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2198-12"><a href="nominal-predicted-variable.html#cb2198-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2198-13"><a href="nominal-predicted-variable.html#cb2198-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">y =</span> .<span class="dv">6</span>,</span>
<span id="cb2198-14"><a href="nominal-predicted-variable.html#cb2198-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;italic(M)[0]&quot;</span>, <span class="st">&quot;italic(S)[0]&quot;</span>), </span>
<span id="cb2198-15"><a href="nominal-predicted-variable.html#cb2198-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb2198-16"><a href="nominal-predicted-variable.html#cb2198-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2198-17"><a href="nominal-predicted-variable.html#cb2198-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb2198-18"><a href="nominal-predicted-variable.html#cb2198-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">color =</span> pl[<span class="dv">1</span>]),</span>
<span id="cb2198-19"><a href="nominal-predicted-variable.html#cb2198-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> pl[<span class="dv">8</span>], <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>))</span>
<span id="cb2198-20"><a href="nominal-predicted-variable.html#cb2198-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2198-21"><a href="nominal-predicted-variable.html#cb2198-21" aria-hidden="true" tabindex="-1"></a><span class="co"># second normal density</span></span>
<span id="cb2198-22"><a href="nominal-predicted-variable.html#cb2198-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb2198-23"><a href="nominal-predicted-variable.html#cb2198-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2198-24"><a href="nominal-predicted-variable.html#cb2198-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> (<span class="fu">dnorm</span>(x)) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">dnorm</span>(x)))) <span class="sc">+</span></span>
<span id="cb2198-25"><a href="nominal-predicted-variable.html#cb2198-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">fill =</span> pl[<span class="dv">6</span>], <span class="at">color =</span> pl[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb2198-26"><a href="nominal-predicted-variable.html#cb2198-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2198-27"><a href="nominal-predicted-variable.html#cb2198-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> .<span class="dv">2</span>,</span>
<span id="cb2198-28"><a href="nominal-predicted-variable.html#cb2198-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;normal&quot;</span>,</span>
<span id="cb2198-29"><a href="nominal-predicted-variable.html#cb2198-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2198-30"><a href="nominal-predicted-variable.html#cb2198-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2198-31"><a href="nominal-predicted-variable.html#cb2198-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">y =</span> .<span class="dv">6</span>,</span>
<span id="cb2198-32"><a href="nominal-predicted-variable.html#cb2198-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;italic(M[jk])&quot;</span>, <span class="st">&quot;italic(S[jk])&quot;</span>), </span>
<span id="cb2198-33"><a href="nominal-predicted-variable.html#cb2198-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb2198-34"><a href="nominal-predicted-variable.html#cb2198-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2198-35"><a href="nominal-predicted-variable.html#cb2198-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb2198-36"><a href="nominal-predicted-variable.html#cb2198-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">color =</span> pl[<span class="dv">1</span>]),</span>
<span id="cb2198-37"><a href="nominal-predicted-variable.html#cb2198-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> pl[<span class="dv">8</span>], <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>))</span>
<span id="cb2198-38"><a href="nominal-predicted-variable.html#cb2198-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2198-39"><a href="nominal-predicted-variable.html#cb2198-39" aria-hidden="true" tabindex="-1"></a><span class="do">## an annotated arrow</span></span>
<span id="cb2198-40"><a href="nominal-predicted-variable.html#cb2198-40" aria-hidden="true" tabindex="-1"></a><span class="co"># save our custom arrow settings</span></span>
<span id="cb2198-41"><a href="nominal-predicted-variable.html#cb2198-41" aria-hidden="true" tabindex="-1"></a>my_arrow <span class="ot">&lt;-</span> <span class="fu">arrow</span>(<span class="at">angle =</span> <span class="dv">20</span>, <span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.35</span>, <span class="st">&quot;cm&quot;</span>), <span class="at">type =</span> <span class="st">&quot;closed&quot;</span>)</span>
<span id="cb2198-42"><a href="nominal-predicted-variable.html#cb2198-42" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb2198-43"><a href="nominal-predicted-variable.html#cb2198-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x    =</span> .<span class="dv">5</span>,</span>
<span id="cb2198-44"><a href="nominal-predicted-variable.html#cb2198-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="dv">1</span>,</span>
<span id="cb2198-45"><a href="nominal-predicted-variable.html#cb2198-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">xend =</span> .<span class="dv">73</span>,</span>
<span id="cb2198-46"><a href="nominal-predicted-variable.html#cb2198-46" aria-hidden="true" tabindex="-1"></a>         <span class="at">yend =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2198-47"><a href="nominal-predicted-variable.html#cb2198-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2198-48"><a href="nominal-predicted-variable.html#cb2198-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend,</span>
<span id="cb2198-49"><a href="nominal-predicted-variable.html#cb2198-49" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> y, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb2198-50"><a href="nominal-predicted-variable.html#cb2198-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">arrow =</span> my_arrow, <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2198-51"><a href="nominal-predicted-variable.html#cb2198-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2198-52"><a href="nominal-predicted-variable.html#cb2198-52" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(.<span class="dv">48</span>, .<span class="dv">72</span>), <span class="at">y =</span> .<span class="dv">5</span>,</span>
<span id="cb2198-53"><a href="nominal-predicted-variable.html#cb2198-53" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;&#39;~&#39;&quot;</span>, <span class="st">&quot;italic(k)&quot;</span>),</span>
<span id="cb2198-54"><a href="nominal-predicted-variable.html#cb2198-54" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">7</span>), <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb2198-55"><a href="nominal-predicted-variable.html#cb2198-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2198-56"><a href="nominal-predicted-variable.html#cb2198-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb2198-57"><a href="nominal-predicted-variable.html#cb2198-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2198-58"><a href="nominal-predicted-variable.html#cb2198-58" aria-hidden="true" tabindex="-1"></a><span class="do">## another annotated arrow</span></span>
<span id="cb2198-59"><a href="nominal-predicted-variable.html#cb2198-59" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span></span>
<span id="cb2198-60"><a href="nominal-predicted-variable.html#cb2198-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x    =</span> .<span class="dv">5</span>,</span>
<span id="cb2198-61"><a href="nominal-predicted-variable.html#cb2198-61" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="dv">1</span>,</span>
<span id="cb2198-62"><a href="nominal-predicted-variable.html#cb2198-62" aria-hidden="true" tabindex="-1"></a>         <span class="at">xend =</span> .<span class="dv">4</span>,</span>
<span id="cb2198-63"><a href="nominal-predicted-variable.html#cb2198-63" aria-hidden="true" tabindex="-1"></a>         <span class="at">yend =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2198-64"><a href="nominal-predicted-variable.html#cb2198-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2198-65"><a href="nominal-predicted-variable.html#cb2198-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend,</span>
<span id="cb2198-66"><a href="nominal-predicted-variable.html#cb2198-66" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> y, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb2198-67"><a href="nominal-predicted-variable.html#cb2198-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">arrow =</span> my_arrow, <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2198-68"><a href="nominal-predicted-variable.html#cb2198-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2198-69"><a href="nominal-predicted-variable.html#cb2198-69" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(.<span class="dv">34</span>, .<span class="dv">6</span>), <span class="at">y =</span> .<span class="dv">5</span>,</span>
<span id="cb2198-70"><a href="nominal-predicted-variable.html#cb2198-70" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;&#39;~&#39;&quot;</span>, <span class="st">&quot;italic(jk)&quot;</span>),</span>
<span id="cb2198-71"><a href="nominal-predicted-variable.html#cb2198-71" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">7</span>), <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb2198-72"><a href="nominal-predicted-variable.html#cb2198-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2198-73"><a href="nominal-predicted-variable.html#cb2198-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb2198-74"><a href="nominal-predicted-variable.html#cb2198-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2198-75"><a href="nominal-predicted-variable.html#cb2198-75" aria-hidden="true" tabindex="-1"></a><span class="co"># likelihood formula</span></span>
<span id="cb2198-76"><a href="nominal-predicted-variable.html#cb2198-76" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span></span>
<span id="cb2198-77"><a href="nominal-predicted-variable.html#cb2198-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> .<span class="dv">5</span>,</span>
<span id="cb2198-78"><a href="nominal-predicted-variable.html#cb2198-78" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> .<span class="dv">5</span>,</span>
<span id="cb2198-79"><a href="nominal-predicted-variable.html#cb2198-79" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="st">&quot;softmax(beta[0][&#39;[&#39;*italic(k)*&#39;]&#39;]+sum()[italic(j)]~beta[italic(j)][&#39;[&#39;*italic(k)*&#39;]&#39;]~italic(x)[italic(ji)])&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2198-80"><a href="nominal-predicted-variable.html#cb2198-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2198-81"><a href="nominal-predicted-variable.html#cb2198-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb2198-82"><a href="nominal-predicted-variable.html#cb2198-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">parse =</span> T, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="sc">+</span></span>
<span id="cb2198-83"><a href="nominal-predicted-variable.html#cb2198-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb2198-84"><a href="nominal-predicted-variable.html#cb2198-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2198-85"><a href="nominal-predicted-variable.html#cb2198-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb2198-86"><a href="nominal-predicted-variable.html#cb2198-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2198-87"><a href="nominal-predicted-variable.html#cb2198-87" aria-hidden="true" tabindex="-1"></a><span class="co"># a third annotated arrow</span></span>
<span id="cb2198-88"><a href="nominal-predicted-variable.html#cb2198-88" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span></span>
<span id="cb2198-89"><a href="nominal-predicted-variable.html#cb2198-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x     =</span> <span class="fu">c</span>(.<span class="dv">375</span>, .<span class="dv">6</span>),</span>
<span id="cb2198-90"><a href="nominal-predicted-variable.html#cb2198-90" aria-hidden="true" tabindex="-1"></a>         <span class="at">y     =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb2198-91"><a href="nominal-predicted-variable.html#cb2198-91" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;&#39;=&#39;&quot;</span>, <span class="st">&quot;italic(i)&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2198-92"><a href="nominal-predicted-variable.html#cb2198-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2198-93"><a href="nominal-predicted-variable.html#cb2198-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb2198-94"><a href="nominal-predicted-variable.html#cb2198-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">7</span>), <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">parse =</span> T, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="sc">+</span></span>
<span id="cb2198-95"><a href="nominal-predicted-variable.html#cb2198-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> .<span class="dv">5</span>, <span class="at">xend =</span> .<span class="dv">5</span>,</span>
<span id="cb2198-96"><a href="nominal-predicted-variable.html#cb2198-96" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="dv">1</span>, <span class="at">yend =</span> <span class="dv">0</span>,</span>
<span id="cb2198-97"><a href="nominal-predicted-variable.html#cb2198-97" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> my_arrow, <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2198-98"><a href="nominal-predicted-variable.html#cb2198-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2198-99"><a href="nominal-predicted-variable.html#cb2198-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb2198-100"><a href="nominal-predicted-variable.html#cb2198-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2198-101"><a href="nominal-predicted-variable.html#cb2198-101" aria-hidden="true" tabindex="-1"></a><span class="co"># bar plot of categorical data</span></span>
<span id="cb2198-102"><a href="nominal-predicted-variable.html#cb2198-102" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span></span>
<span id="cb2198-103"><a href="nominal-predicted-variable.html#cb2198-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb2198-104"><a href="nominal-predicted-variable.html#cb2198-104" aria-hidden="true" tabindex="-1"></a>         <span class="at">d =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">85</span>, .<span class="dv">5</span>, .<span class="dv">85</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2198-105"><a href="nominal-predicted-variable.html#cb2198-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> d)) <span class="sc">+</span></span>
<span id="cb2198-106"><a href="nominal-predicted-variable.html#cb2198-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> pl[<span class="dv">6</span>], <span class="at">color =</span> pl[<span class="dv">5</span>], <span class="at">width =</span> .<span class="dv">45</span>) <span class="sc">+</span></span>
<span id="cb2198-107"><a href="nominal-predicted-variable.html#cb2198-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2198-108"><a href="nominal-predicted-variable.html#cb2198-108" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> .<span class="dv">2</span>,</span>
<span id="cb2198-109"><a href="nominal-predicted-variable.html#cb2198-109" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;categorical&quot;</span>,</span>
<span id="cb2198-110"><a href="nominal-predicted-variable.html#cb2198-110" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2198-111"><a href="nominal-predicted-variable.html#cb2198-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2198-112"><a href="nominal-predicted-variable.html#cb2198-112" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fl">1.25</span>, <span class="at">y =</span> .<span class="dv">9</span>, <span class="at">hjust =</span> <span class="dv">0</span>,</span>
<span id="cb2198-113"><a href="nominal-predicted-variable.html#cb2198-113" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;mu[italic(i)*&#39;[&#39;*italic(k)*&#39;]&#39;]&quot;</span>,</span>
<span id="cb2198-114"><a href="nominal-predicted-variable.html#cb2198-114" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="at">parse =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb2198-115"><a href="nominal-predicted-variable.html#cb2198-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, <span class="fl">3.5</span>),</span>
<span id="cb2198-116"><a href="nominal-predicted-variable.html#cb2198-116" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2198-117"><a href="nominal-predicted-variable.html#cb2198-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb2198-118"><a href="nominal-predicted-variable.html#cb2198-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">color =</span> pl[<span class="dv">1</span>]),</span>
<span id="cb2198-119"><a href="nominal-predicted-variable.html#cb2198-119" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> pl[<span class="dv">8</span>], <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>))</span>
<span id="cb2198-120"><a href="nominal-predicted-variable.html#cb2198-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2198-121"><a href="nominal-predicted-variable.html#cb2198-121" aria-hidden="true" tabindex="-1"></a><span class="co"># the final annotated arrow</span></span>
<span id="cb2198-122"><a href="nominal-predicted-variable.html#cb2198-122" aria-hidden="true" tabindex="-1"></a>p8 <span class="ot">&lt;-</span></span>
<span id="cb2198-123"><a href="nominal-predicted-variable.html#cb2198-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x     =</span> <span class="fu">c</span>(.<span class="dv">375</span>, .<span class="dv">625</span>),</span>
<span id="cb2198-124"><a href="nominal-predicted-variable.html#cb2198-124" aria-hidden="true" tabindex="-1"></a>         <span class="at">y     =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>),</span>
<span id="cb2198-125"><a href="nominal-predicted-variable.html#cb2198-125" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;&#39;~&#39;&quot;</span>, <span class="st">&quot;italic(i)&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2198-126"><a href="nominal-predicted-variable.html#cb2198-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2198-127"><a href="nominal-predicted-variable.html#cb2198-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb2198-128"><a href="nominal-predicted-variable.html#cb2198-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">7</span>), <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">parse =</span> T, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="sc">+</span></span>
<span id="cb2198-129"><a href="nominal-predicted-variable.html#cb2198-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> .<span class="dv">5</span>, <span class="at">xend =</span> .<span class="dv">5</span>,</span>
<span id="cb2198-130"><a href="nominal-predicted-variable.html#cb2198-130" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="dv">1</span>, <span class="at">yend =</span> <span class="dv">0</span>, </span>
<span id="cb2198-131"><a href="nominal-predicted-variable.html#cb2198-131" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">arrow =</span> my_arrow) <span class="sc">+</span></span>
<span id="cb2198-132"><a href="nominal-predicted-variable.html#cb2198-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2198-133"><a href="nominal-predicted-variable.html#cb2198-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb2198-134"><a href="nominal-predicted-variable.html#cb2198-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2198-135"><a href="nominal-predicted-variable.html#cb2198-135" aria-hidden="true" tabindex="-1"></a><span class="co"># some text</span></span>
<span id="cb2198-136"><a href="nominal-predicted-variable.html#cb2198-136" aria-hidden="true" tabindex="-1"></a>p9 <span class="ot">&lt;-</span></span>
<span id="cb2198-137"><a href="nominal-predicted-variable.html#cb2198-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x     =</span> <span class="dv">1</span>,</span>
<span id="cb2198-138"><a href="nominal-predicted-variable.html#cb2198-138" aria-hidden="true" tabindex="-1"></a>         <span class="at">y     =</span> .<span class="dv">5</span>,</span>
<span id="cb2198-139"><a href="nominal-predicted-variable.html#cb2198-139" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="st">&quot;italic(y[i])&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2198-140"><a href="nominal-predicted-variable.html#cb2198-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2198-141"><a href="nominal-predicted-variable.html#cb2198-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb2198-142"><a href="nominal-predicted-variable.html#cb2198-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">parse =</span> T, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="sc">+</span></span>
<span id="cb2198-143"><a href="nominal-predicted-variable.html#cb2198-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2198-144"><a href="nominal-predicted-variable.html#cb2198-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb2198-145"><a href="nominal-predicted-variable.html#cb2198-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2198-146"><a href="nominal-predicted-variable.html#cb2198-146" aria-hidden="true" tabindex="-1"></a><span class="co"># define the layout</span></span>
<span id="cb2198-147"><a href="nominal-predicted-variable.html#cb2198-147" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2198-148"><a href="nominal-predicted-variable.html#cb2198-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">2</span>),</span>
<span id="cb2198-149"><a href="nominal-predicted-variable.html#cb2198-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">l =</span> <span class="dv">3</span>, <span class="at">r =</span> <span class="dv">4</span>),</span>
<span id="cb2198-150"><a href="nominal-predicted-variable.html#cb2198-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">3</span>, <span class="at">b =</span> <span class="dv">3</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">2</span>),</span>
<span id="cb2198-151"><a href="nominal-predicted-variable.html#cb2198-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">3</span>, <span class="at">b =</span> <span class="dv">3</span>, <span class="at">l =</span> <span class="dv">3</span>, <span class="at">r =</span> <span class="dv">4</span>),</span>
<span id="cb2198-152"><a href="nominal-predicted-variable.html#cb2198-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">4</span>, <span class="at">b =</span> <span class="dv">4</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">4</span>),</span>
<span id="cb2198-153"><a href="nominal-predicted-variable.html#cb2198-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">5</span>, <span class="at">b =</span> <span class="dv">5</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">r =</span> <span class="dv">3</span>),</span>
<span id="cb2198-154"><a href="nominal-predicted-variable.html#cb2198-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">6</span>, <span class="at">b =</span> <span class="dv">7</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">r =</span> <span class="dv">3</span>),</span>
<span id="cb2198-155"><a href="nominal-predicted-variable.html#cb2198-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">8</span>, <span class="at">b =</span> <span class="dv">8</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">r =</span> <span class="dv">3</span>),</span>
<span id="cb2198-156"><a href="nominal-predicted-variable.html#cb2198-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">9</span>, <span class="at">b =</span> <span class="dv">9</span>, <span class="at">l =</span> <span class="dv">2</span>, <span class="at">r =</span> <span class="dv">3</span>)</span>
<span id="cb2198-157"><a href="nominal-predicted-variable.html#cb2198-157" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2198-158"><a href="nominal-predicted-variable.html#cb2198-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2198-159"><a href="nominal-predicted-variable.html#cb2198-159" aria-hidden="true" tabindex="-1"></a><span class="co"># combine and plot!</span></span>
<span id="cb2198-160"><a href="nominal-predicted-variable.html#cb2198-160" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span></span>
<span id="cb2198-161"><a href="nominal-predicted-variable.html#cb2198-161" aria-hidden="true" tabindex="-1"></a>  (</span>
<span id="cb2198-162"><a href="nominal-predicted-variable.html#cb2198-162" aria-hidden="true" tabindex="-1"></a>    (p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4 <span class="sc">+</span> p5 <span class="sc">+</span> p6 <span class="sc">+</span> p7 <span class="sc">+</span> p8 <span class="sc">+</span> p9) <span class="sc">+</span> </span>
<span id="cb2198-163"><a href="nominal-predicted-variable.html#cb2198-163" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot_layout</span>(<span class="at">design =</span> layout) <span class="sc">&amp;</span></span>
<span id="cb2198-164"><a href="nominal-predicted-variable.html#cb2198-164" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">&amp;</span></span>
<span id="cb2198-165"><a href="nominal-predicted-variable.html#cb2198-165" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="fl">5.5</span>, <span class="dv">0</span>, <span class="fl">5.5</span>))</span>
<span id="cb2198-166"><a href="nominal-predicted-variable.html#cb2198-166" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Now we make and save the elements for the diagram on the right.</p>
<div class="sourceCode" id="cb2199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2199-1"><a href="nominal-predicted-variable.html#cb2199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># third normal density</span></span>
<span id="cb2199-2"><a href="nominal-predicted-variable.html#cb2199-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb2199-3"><a href="nominal-predicted-variable.html#cb2199-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2199-4"><a href="nominal-predicted-variable.html#cb2199-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> (<span class="fu">dnorm</span>(x)) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">dnorm</span>(x)))) <span class="sc">+</span></span>
<span id="cb2199-5"><a href="nominal-predicted-variable.html#cb2199-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">fill =</span> pl[<span class="dv">6</span>], <span class="at">color =</span> pl[<span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb2199-6"><a href="nominal-predicted-variable.html#cb2199-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2199-7"><a href="nominal-predicted-variable.html#cb2199-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> .<span class="dv">2</span>,</span>
<span id="cb2199-8"><a href="nominal-predicted-variable.html#cb2199-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;normal&quot;</span>,</span>
<span id="cb2199-9"><a href="nominal-predicted-variable.html#cb2199-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2199-10"><a href="nominal-predicted-variable.html#cb2199-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2199-11"><a href="nominal-predicted-variable.html#cb2199-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">y =</span> .<span class="dv">6</span>,</span>
<span id="cb2199-12"><a href="nominal-predicted-variable.html#cb2199-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;italic(M[j])&quot;</span>, <span class="st">&quot;italic(S[j])&quot;</span>), </span>
<span id="cb2199-13"><a href="nominal-predicted-variable.html#cb2199-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb2199-14"><a href="nominal-predicted-variable.html#cb2199-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2199-15"><a href="nominal-predicted-variable.html#cb2199-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb2199-16"><a href="nominal-predicted-variable.html#cb2199-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">color =</span> pl[<span class="dv">1</span>]),</span>
<span id="cb2199-17"><a href="nominal-predicted-variable.html#cb2199-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> pl[<span class="dv">8</span>], <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>))</span>
<span id="cb2199-18"><a href="nominal-predicted-variable.html#cb2199-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2199-19"><a href="nominal-predicted-variable.html#cb2199-19" aria-hidden="true" tabindex="-1"></a><span class="do">## an annotated arrow</span></span>
<span id="cb2199-20"><a href="nominal-predicted-variable.html#cb2199-20" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb2199-21"><a href="nominal-predicted-variable.html#cb2199-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x    =</span> .<span class="dv">5</span>,</span>
<span id="cb2199-22"><a href="nominal-predicted-variable.html#cb2199-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="dv">1</span>,</span>
<span id="cb2199-23"><a href="nominal-predicted-variable.html#cb2199-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">xend =</span> .<span class="dv">85</span>,</span>
<span id="cb2199-24"><a href="nominal-predicted-variable.html#cb2199-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">yend =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2199-25"><a href="nominal-predicted-variable.html#cb2199-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2199-26"><a href="nominal-predicted-variable.html#cb2199-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend,</span>
<span id="cb2199-27"><a href="nominal-predicted-variable.html#cb2199-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> y, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb2199-28"><a href="nominal-predicted-variable.html#cb2199-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">arrow =</span> my_arrow, <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2199-29"><a href="nominal-predicted-variable.html#cb2199-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2199-30"><a href="nominal-predicted-variable.html#cb2199-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> .<span class="dv">49</span>, <span class="at">y =</span> .<span class="dv">5</span>,</span>
<span id="cb2199-31"><a href="nominal-predicted-variable.html#cb2199-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;&#39;~&#39;&quot;</span>,</span>
<span id="cb2199-32"><a href="nominal-predicted-variable.html#cb2199-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb2199-33"><a href="nominal-predicted-variable.html#cb2199-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2199-34"><a href="nominal-predicted-variable.html#cb2199-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb2199-35"><a href="nominal-predicted-variable.html#cb2199-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2199-36"><a href="nominal-predicted-variable.html#cb2199-36" aria-hidden="true" tabindex="-1"></a><span class="do">## another annotated arrow</span></span>
<span id="cb2199-37"><a href="nominal-predicted-variable.html#cb2199-37" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span></span>
<span id="cb2199-38"><a href="nominal-predicted-variable.html#cb2199-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x    =</span> .<span class="dv">5</span>,</span>
<span id="cb2199-39"><a href="nominal-predicted-variable.html#cb2199-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="dv">1</span>,</span>
<span id="cb2199-40"><a href="nominal-predicted-variable.html#cb2199-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">xend =</span> .<span class="dv">4</span>,</span>
<span id="cb2199-41"><a href="nominal-predicted-variable.html#cb2199-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">yend =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2199-42"><a href="nominal-predicted-variable.html#cb2199-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2199-43"><a href="nominal-predicted-variable.html#cb2199-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend,</span>
<span id="cb2199-44"><a href="nominal-predicted-variable.html#cb2199-44" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> y, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb2199-45"><a href="nominal-predicted-variable.html#cb2199-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">arrow =</span> my_arrow, <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2199-46"><a href="nominal-predicted-variable.html#cb2199-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2199-47"><a href="nominal-predicted-variable.html#cb2199-47" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(.<span class="dv">35</span>, .<span class="dv">57</span>), <span class="at">y =</span> .<span class="dv">5</span>,</span>
<span id="cb2199-48"><a href="nominal-predicted-variable.html#cb2199-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;&#39;~&#39;&quot;</span>, <span class="st">&quot;italic(j)&quot;</span>),</span>
<span id="cb2199-49"><a href="nominal-predicted-variable.html#cb2199-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">7</span>), <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb2199-50"><a href="nominal-predicted-variable.html#cb2199-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2199-51"><a href="nominal-predicted-variable.html#cb2199-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb2199-52"><a href="nominal-predicted-variable.html#cb2199-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2199-53"><a href="nominal-predicted-variable.html#cb2199-53" aria-hidden="true" tabindex="-1"></a><span class="co"># likelihood formula</span></span>
<span id="cb2199-54"><a href="nominal-predicted-variable.html#cb2199-54" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span></span>
<span id="cb2199-55"><a href="nominal-predicted-variable.html#cb2199-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> .<span class="dv">5</span>,</span>
<span id="cb2199-56"><a href="nominal-predicted-variable.html#cb2199-56" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> .<span class="dv">5</span>,</span>
<span id="cb2199-57"><a href="nominal-predicted-variable.html#cb2199-57" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="st">&quot;logistic(beta[0]+sum()[italic(j)]~beta[italic(j)]~italic(x)[italic(ji)])&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2199-58"><a href="nominal-predicted-variable.html#cb2199-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2199-59"><a href="nominal-predicted-variable.html#cb2199-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb2199-60"><a href="nominal-predicted-variable.html#cb2199-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">parse =</span> T, <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>) <span class="sc">+</span></span>
<span id="cb2199-61"><a href="nominal-predicted-variable.html#cb2199-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb2199-62"><a href="nominal-predicted-variable.html#cb2199-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2199-63"><a href="nominal-predicted-variable.html#cb2199-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb2199-64"><a href="nominal-predicted-variable.html#cb2199-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2199-65"><a href="nominal-predicted-variable.html#cb2199-65" aria-hidden="true" tabindex="-1"></a><span class="co"># bar plot of Bernoulli data</span></span>
<span id="cb2199-66"><a href="nominal-predicted-variable.html#cb2199-66" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span></span>
<span id="cb2199-67"><a href="nominal-predicted-variable.html#cb2199-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb2199-68"><a href="nominal-predicted-variable.html#cb2199-68" aria-hidden="true" tabindex="-1"></a>         <span class="at">d =</span> (<span class="fu">dbinom</span>(x, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> .<span class="dv">6</span>)) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">dbinom</span>(x, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> .<span class="dv">6</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb2199-69"><a href="nominal-predicted-variable.html#cb2199-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2199-70"><a href="nominal-predicted-variable.html#cb2199-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> d)) <span class="sc">+</span></span>
<span id="cb2199-71"><a href="nominal-predicted-variable.html#cb2199-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> pl[<span class="dv">6</span>], <span class="at">color =</span> pl[<span class="dv">5</span>], <span class="at">width =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb2199-72"><a href="nominal-predicted-variable.html#cb2199-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2199-73"><a href="nominal-predicted-variable.html#cb2199-73" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> .<span class="dv">5</span>, <span class="at">y =</span> .<span class="dv">2</span>,</span>
<span id="cb2199-74"><a href="nominal-predicted-variable.html#cb2199-74" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;Bernoulli&quot;</span>,</span>
<span id="cb2199-75"><a href="nominal-predicted-variable.html#cb2199-75" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2199-76"><a href="nominal-predicted-variable.html#cb2199-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb2199-77"><a href="nominal-predicted-variable.html#cb2199-77" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> .<span class="dv">5</span>, <span class="at">y =</span> .<span class="dv">9</span>,</span>
<span id="cb2199-78"><a href="nominal-predicted-variable.html#cb2199-78" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;mu[italic(i)]&quot;</span>, </span>
<span id="cb2199-79"><a href="nominal-predicted-variable.html#cb2199-79" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">&quot;Times&quot;</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb2199-80"><a href="nominal-predicted-variable.html#cb2199-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span>.<span class="dv">75</span>, <span class="fl">1.75</span>) <span class="sc">+</span></span>
<span id="cb2199-81"><a href="nominal-predicted-variable.html#cb2199-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb2199-82"><a href="nominal-predicted-variable.html#cb2199-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">color =</span> pl[<span class="dv">1</span>]),</span>
<span id="cb2199-83"><a href="nominal-predicted-variable.html#cb2199-83" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> pl[<span class="dv">8</span>], <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>))</span>
<span id="cb2199-84"><a href="nominal-predicted-variable.html#cb2199-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2199-85"><a href="nominal-predicted-variable.html#cb2199-85" aria-hidden="true" tabindex="-1"></a><span class="co"># combine and plot!</span></span>
<span id="cb2199-86"><a href="nominal-predicted-variable.html#cb2199-86" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span></span>
<span id="cb2199-87"><a href="nominal-predicted-variable.html#cb2199-87" aria-hidden="true" tabindex="-1"></a>  (</span>
<span id="cb2199-88"><a href="nominal-predicted-variable.html#cb2199-88" aria-hidden="true" tabindex="-1"></a>    (p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4 <span class="sc">+</span> p5 <span class="sc">+</span> p6 <span class="sc">+</span> p7 <span class="sc">+</span> p8 <span class="sc">+</span> p9) <span class="sc">+</span> </span>
<span id="cb2199-89"><a href="nominal-predicted-variable.html#cb2199-89" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot_layout</span>(<span class="at">design =</span> layout) <span class="sc">&amp;</span></span>
<span id="cb2199-90"><a href="nominal-predicted-variable.html#cb2199-90" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">&amp;</span></span>
<span id="cb2199-91"><a href="nominal-predicted-variable.html#cb2199-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="fl">5.5</span>, <span class="dv">0</span>, <span class="fl">5.5</span>))</span>
<span id="cb2199-92"><a href="nominal-predicted-variable.html#cb2199-92" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Here we combine the two model diagrams and plot!</p>
<div class="sourceCode" id="cb2200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2200-1"><a href="nominal-predicted-variable.html#cb2200-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">plot_spacer</span>()</span>
<span id="cb2200-2"><a href="nominal-predicted-variable.html#cb2200-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2200-3"><a href="nominal-predicted-variable.html#cb2200-3" aria-hidden="true" tabindex="-1"></a>(a <span class="sc">|</span> b <span class="sc">|</span> c) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">4</span>))</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-17-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="conditional-logistic-model." class="section level3 hasAnchor" number="22.3.2">
<h3><span class="header-section-number">22.3.2</span> Conditional logistic model.<a href="nominal-predicted-variable.html#conditional-logistic-model." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The conditional logistic regression models are not natively supported in <strong>brms</strong> at this time. Based on <a href="https://github.com/paul-buerkner/brms/issues/560">issue #560</a> in the <strong>brms</strong> GitHub, there are ways to fit them using the nonlinear syntax. If you compare the syntax Bürkner used in that thread on January 30<sup>th</sup> to the JAGS syntax Kruschke showed on pages 661 and 662, you’ll see they appear to follow contrasting parameterizations.</p>
<p>However, there are at least two other ways to fit conditional logistic models with <strong>brms</strong>. Based on insights from <a href="http://singmann.org/">Henrik Singmann</a>, we can define conditional logistic models using the custom family approach. In contrast, <a href="https://sites.google.com/view/mattansb">Mattan Ben-Shachar</a> has shown we can also fit conditional logistic models using a tricky application of sequential ordinal regression. Rather than present them in the abstract, here, we will showcase both of these approaches in the sections below.</p>
</div>
<div id="results-interpreting-the-regression-coefficients." class="section level3 hasAnchor" number="22.3.3">
<h3><span class="header-section-number">22.3.3</span> Results: Interpreting the regression coefficients.<a href="nominal-predicted-variable.html#results-interpreting-the-regression-coefficients." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="softmax-model.-1" class="section level4 hasAnchor" number="22.3.3.1">
<h4><span class="header-section-number">22.3.3.1</span> Softmax model.<a href="nominal-predicted-variable.html#softmax-model.-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Load <strong>brms</strong>.</p>
<div class="sourceCode" id="cb2201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2201-1"><a href="nominal-predicted-variable.html#cb2201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span></code></pre></div>
<p>Along with Kruschke, we’ll be modeling the <code>d1</code> data. In case it’s not clear, the <code>X1</code> and <code>X2</code> variables are already in a standardized metric.</p>
<div class="sourceCode" id="cb2202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2202-1"><a href="nominal-predicted-variable.html#cb2202-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="sc">%&gt;%</span> </span>
<span id="cb2202-2"><a href="nominal-predicted-variable.html#cb2202-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Y) <span class="sc">%&gt;%</span> </span>
<span id="cb2202-3"><a href="nominal-predicted-variable.html#cb2202-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb2202-4"><a href="nominal-predicted-variable.html#cb2202-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value), </span>
<span id="cb2202-5"><a href="nominal-predicted-variable.html#cb2202-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd   =</span> <span class="fu">sd</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb2202-6"><a href="nominal-predicted-variable.html#cb2202-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   name   mean    sd
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 X1        0     1
## 2 X2        0     1</code></pre>
<p>This will make it easier to set the priors. Here we’ll just use the rather wide priors Kruschke indicated on page 662. Note our use of the <code>dpar</code> argument within the <code>prior()</code> function.</p>
<div class="sourceCode" id="cb2204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2204-1"><a href="nominal-predicted-variable.html#cb2204-1" aria-hidden="true" tabindex="-1"></a>fit22<span class="fl">.1</span> <span class="ot">&lt;-</span></span>
<span id="cb2204-2"><a href="nominal-predicted-variable.html#cb2204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d1, </span>
<span id="cb2204-3"><a href="nominal-predicted-variable.html#cb2204-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">categorical</span>(<span class="at">link =</span> logit),</span>
<span id="cb2204-4"><a href="nominal-predicted-variable.html#cb2204-4" aria-hidden="true" tabindex="-1"></a>      Y <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Intercept <span class="sc">+</span> X1 <span class="sc">+</span> X2,</span>
<span id="cb2204-5"><a href="nominal-predicted-variable.html#cb2204-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> b, <span class="at">dpar =</span> mu2),</span>
<span id="cb2204-6"><a href="nominal-predicted-variable.html#cb2204-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> b, <span class="at">dpar =</span> mu3),</span>
<span id="cb2204-7"><a href="nominal-predicted-variable.html#cb2204-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> b, <span class="at">dpar =</span> mu4)),</span>
<span id="cb2204-8"><a href="nominal-predicted-variable.html#cb2204-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb2204-9"><a href="nominal-predicted-variable.html#cb2204-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">22</span>,</span>
<span id="cb2204-10"><a href="nominal-predicted-variable.html#cb2204-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit22.01&quot;</span>)</span></code></pre></div>
<p>Since it’s the default, we didn’t have to include the <code>(link = logit)</code> bit in the <code>family</code> argument. I’m just being explicit for the sake of pedagogy. Take a look at the parameter summary.</p>
<div class="sourceCode" id="cb2205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2205-1"><a href="nominal-predicted-variable.html#cb2205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit22<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##  Family: categorical 
##   Links: mu2 = logit; mu3 = logit; mu4 = logit 
## Formula: Y ~ 0 + Intercept + X1 + X2 
##    Data: d1 (Number of observations: 475) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## mu2_Intercept     3.39      0.62     2.29     4.67 1.01     1324     1482
## mu2_X1            5.58      0.73     4.25     7.06 1.00     2019     2027
## mu2_X2            0.82      0.51    -0.17     1.85 1.00     1759     1934
## mu3_Intercept     2.07      0.68     0.78     3.44 1.00     1379     1650
## mu3_X1            0.73      0.57    -0.38     1.86 1.00     1658     2190
## mu3_X2            5.98      0.68     4.74     7.39 1.00     2148     2187
## mu4_Intercept    -0.41      0.89    -2.10     1.34 1.00     1917     2035
## mu4_X1           12.38      1.17    10.25    14.77 1.00     2251     2268
## mu4_X2            3.56      0.65     2.33     4.86 1.00     1949     2091
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>As indicated in the formulas in <a href="nominal-predicted-variable.html#softmax-regression">Section 22.1</a>, we get posteriors for each level of <code>Y</code>, except for <code>Y == 1</code>. That serves as the reference category. The values for <span class="math inline">\(\beta_{i, k = 1}\)</span> are all fixed at <span class="math inline">\(0\)</span>.</p>
<p>Here’s how we might make the histograms in Figure 22.5.</p>
<div class="sourceCode" id="cb2207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2207-1"><a href="nominal-predicted-variable.html#cb2207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb2207-2"><a href="nominal-predicted-variable.html#cb2207-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2207-3"><a href="nominal-predicted-variable.html#cb2207-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the posterior draws</span></span>
<span id="cb2207-4"><a href="nominal-predicted-variable.html#cb2207-4" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit22<span class="fl">.1</span>)</span>
<span id="cb2207-5"><a href="nominal-predicted-variable.html#cb2207-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2207-6"><a href="nominal-predicted-variable.html#cb2207-6" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb2207-7"><a href="nominal-predicted-variable.html#cb2207-7" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb2207-8"><a href="nominal-predicted-variable.html#cb2207-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2207-9"><a href="nominal-predicted-variable.html#cb2207-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_remove</span>(name, <span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2207-10"><a href="nominal-predicted-variable.html#cb2207-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda    =</span> <span class="fu">str_extract</span>(name, <span class="st">&quot;[2-4]+&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_c</span>(<span class="st">&quot;lambda==&quot;</span>, .),</span>
<span id="cb2207-11"><a href="nominal-predicted-variable.html#cb2207-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">parameter =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name, <span class="st">&quot;Intercept&quot;</span>) <span class="sc">~</span> <span class="st">&quot;beta[0]&quot;</span>,</span>
<span id="cb2207-12"><a href="nominal-predicted-variable.html#cb2207-12" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(name, <span class="st">&quot;X1&quot;</span>)        <span class="sc">~</span> <span class="st">&quot;beta[1]&quot;</span>,</span>
<span id="cb2207-13"><a href="nominal-predicted-variable.html#cb2207-13" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(name, <span class="st">&quot;X2&quot;</span>)        <span class="sc">~</span> <span class="st">&quot;beta[2]&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2207-14"><a href="nominal-predicted-variable.html#cb2207-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2207-15"><a href="nominal-predicted-variable.html#cb2207-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb2207-16"><a href="nominal-predicted-variable.html#cb2207-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2207-17"><a href="nominal-predicted-variable.html#cb2207-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_histinterval</span>(<span class="at">point_interval =</span> mode_hdi, <span class="at">.width =</span> .<span class="dv">95</span>,</span>
<span id="cb2207-18"><a href="nominal-predicted-variable.html#cb2207-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> pl[<span class="dv">4</span>], <span class="at">slab_color =</span> pl[<span class="dv">3</span>], <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">point_color =</span> pl[<span class="dv">2</span>],</span>
<span id="cb2207-19"><a href="nominal-predicted-variable.html#cb2207-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="sc">+</span></span>
<span id="cb2207-20"><a href="nominal-predicted-variable.html#cb2207-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2207-21"><a href="nominal-predicted-variable.html#cb2207-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;marginal posterior&quot;</span>) <span class="sc">+</span></span>
<span id="cb2207-22"><a href="nominal-predicted-variable.html#cb2207-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(lambda <span class="sc">~</span> parameter, <span class="at">labeller =</span> label_parsed, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-21-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Because the <span class="math inline">\(\beta\)</span> values for when <span class="math inline">\(\lambda = 1\)</span> are all fixed to 0, we left those plots out of our version of the figure. If you really wanted them, you’d have to enter the corresponding cells into the data before plotting. If you summarize each parameter by it’s posterior mean, <code>round()</code>, and wrangle a little, you can arrange the results in a similar way that the equations for <span class="math inline">\(\lambda_2\)</span> through <span class="math inline">\(\lambda_4\)</span> are displayed on the left side of Figure 22.5.</p>
<div class="sourceCode" id="cb2208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2208-1"><a href="nominal-predicted-variable.html#cb2208-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb2208-2"><a href="nominal-predicted-variable.html#cb2208-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2208-3"><a href="nominal-predicted-variable.html#cb2208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_remove</span>(name, <span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2208-4"><a href="nominal-predicted-variable.html#cb2208-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda    =</span> <span class="fu">str_extract</span>(name, <span class="st">&quot;[2-4]+&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_c</span>(<span class="st">&quot;lambda[&quot;</span>, ., <span class="st">&quot;]&quot;</span>),</span>
<span id="cb2208-5"><a href="nominal-predicted-variable.html#cb2208-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">parameter =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name, <span class="st">&quot;Intercept&quot;</span>) <span class="sc">~</span> <span class="st">&quot;beta[0]&quot;</span>,</span>
<span id="cb2208-6"><a href="nominal-predicted-variable.html#cb2208-6" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(name, <span class="st">&quot;X1&quot;</span>)        <span class="sc">~</span> <span class="st">&quot;beta[1]&quot;</span>,</span>
<span id="cb2208-7"><a href="nominal-predicted-variable.html#cb2208-7" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(name, <span class="st">&quot;X2&quot;</span>)        <span class="sc">~</span> <span class="st">&quot;beta[2]&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2208-8"><a href="nominal-predicted-variable.html#cb2208-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(lambda, parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb2208-9"><a href="nominal-predicted-variable.html#cb2208-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2208-10"><a href="nominal-predicted-variable.html#cb2208-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> parameter,</span>
<span id="cb2208-11"><a href="nominal-predicted-variable.html#cb2208-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> mean)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 4
## # Groups:   lambda [3]
##   lambda    `beta[0]` `beta[1]` `beta[2]`
##   &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 lambda[2]       3.4       5.6       0.8
## 2 lambda[3]       2.1       0.7       6  
## 3 lambda[4]      -0.4      12.4       3.6</code></pre>
<p>As Kruschke mentioned in the text, “the estimated parameter values should be near the generating values, but not exactly the same because the data are merely a finite random sample” (pp. 662–663). Furthermore,</p>
<blockquote>
<p>interpreting the parameters is always contextualized relative to the model. For the softmax model, the regression coefficient for outcome <span class="math inline">\(k\)</span> on predictor <span class="math inline">\(x_j\)</span> indicates that rate at which the log odds of that outcome increase relative to the reference outcome for a one unit increase in <span class="math inline">\(x_j\)</span>, assuming that a softmax model is a reasonable description of the data. (p. 663)</p>
</blockquote>
<p>Unfortunately, this makes the parameters difficult to interpret directly. Kruschke didn’t show a plot like this, but it might be helpful to further understand what this model means in terms of probabilities for a given <code>Y</code> value. Here we’ll use the <code>fitted()</code> function to return the conditional probabilities for all four response options for <code>Y</code> based on various combinations of <code>X1</code> and <code>X2</code>.</p>
<div class="sourceCode" id="cb2210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2210-1"><a href="nominal-predicted-variable.html#cb2210-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">X1 =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">50</span>),</span>
<span id="cb2210-2"><a href="nominal-predicted-variable.html#cb2210-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">X2 =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">50</span>))</span>
<span id="cb2210-3"><a href="nominal-predicted-variable.html#cb2210-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2210-4"><a href="nominal-predicted-variable.html#cb2210-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(fit22<span class="fl">.1</span>,</span>
<span id="cb2210-5"><a href="nominal-predicted-variable.html#cb2210-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb2210-6"><a href="nominal-predicted-variable.html#cb2210-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2210-7"><a href="nominal-predicted-variable.html#cb2210-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;Estimate&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2210-8"><a href="nominal-predicted-variable.html#cb2210-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="st">&quot;Y==&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2210-9"><a href="nominal-predicted-variable.html#cb2210-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb2210-10"><a href="nominal-predicted-variable.html#cb2210-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;Y&quot;</span>),</span>
<span id="cb2210-11"><a href="nominal-predicted-variable.html#cb2210-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;phi&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2210-12"><a href="nominal-predicted-variable.html#cb2210-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2210-13"><a href="nominal-predicted-variable.html#cb2210-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2, <span class="at">fill =</span> phi)) <span class="sc">+</span></span>
<span id="cb2210-14"><a href="nominal-predicted-variable.html#cb2210-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">interpolate =</span> T) <span class="sc">+</span></span>
<span id="cb2210-15"><a href="nominal-predicted-variable.html#cb2210-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="fu">expression</span>(phi[<span class="fu">italic</span>(k)<span class="sc">*</span><span class="st">&quot;|&quot;</span><span class="sc">*</span><span class="fu">italic</span>(S)]),</span>
<span id="cb2210-16"><a href="nominal-predicted-variable.html#cb2210-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">colours =</span> <span class="fu">pnw_palette</span>(<span class="at">name =</span> <span class="st">&quot;Lake&quot;</span>, <span class="at">n =</span> <span class="dv">101</span>),</span>
<span id="cb2210-17"><a href="nominal-predicted-variable.html#cb2210-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb2210-18"><a href="nominal-predicted-variable.html#cb2210-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2210-19"><a href="nominal-predicted-variable.html#cb2210-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2210-20"><a href="nominal-predicted-variable.html#cb2210-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">labeller =</span> label_parsed)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-23-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Now use that plot while you walk through the final paragraph in this subsection.</p>
<blockquote>
<p>It is easy to transform the estimated parameter values to a different reference category. Recall from Equation 22.3 (p. 651) that arbitrary constants can be added to all the regression coefficients without changing the model prediction. Therefore, to change the parameters estimates so they are relative to outcome <span class="math inline">\(R\)</span>, we simply subtract <span class="math inline">\(\beta_{j, R}\)</span> from <span class="math inline">\(\beta_{j, k}\)</span> for all predictors <span class="math inline">\(j\)</span> and all outcomes <span class="math inline">\(k\)</span>. We do this at every step in the MCMC chain. For example, in Figure 22.5, consider the regression coefficient on <span class="math inline">\(x_1\)</span> for outcome <span class="math inline">\(2\)</span>. Relative to reference outcome <span class="math inline">\(1\)</span>, this coefficient is positive, meaning that the probability of outcome <span class="math inline">\(2\)</span> increases relative to outcome <span class="math inline">\(1\)</span> when <span class="math inline">\(x_1\)</span> increases. You can see this in the data graph, as the region of <span class="math inline">\(2\)</span>’s falls to right side (positive <span class="math inline">\(x_1\)</span> direction) of the region of <span class="math inline">\(1\)</span>’s. But if the reference outcome is changed to outcome <span class="math inline">\(4\)</span>, then the coefficient on <span class="math inline">\(x_1\)</span> for outcome <span class="math inline">\(2\)</span> changes to a negative value. Algebraically this happens because the coefficient on <span class="math inline">\(x_1\)</span> for outcome <span class="math inline">\(4\)</span> is larger than for outcome <span class="math inline">\(2\)</span>, so when the coefficient for outcome <span class="math inline">\(4\)</span> is subtracted, the result is a negative value for the coefficient on outcome <span class="math inline">\(2\)</span>. Visually, you can see this in the data graph, as the region of <span class="math inline">\(2\)</span>’s falls to the left side (negative <span class="math inline">\(x_1\)</span> direction) of the region of <span class="math inline">\(4\)</span>’s. Thus, <em>interpreting regression coefficients in a softmax model is rather different than in linear regression. In linear regression, a positive regression coefficient implies that</em> <span class="math inline">\(y\)</span> <em>increases when the predictor increases. But not in softmax regression, where a positive regression coefficient is only positive with respect to a particular reference outcome</em>. (p. 664, <em>emphasis</em> added)</p>
</blockquote>
<div id="bonus-consider-the-interceps-only-softmax-model." class="section level5 hasAnchor" number="22.3.3.1.1">
<h5><span class="header-section-number">22.3.3.1.1</span> Bonus: Consider the interceps-only softmax model.<a href="nominal-predicted-variable.html#bonus-consider-the-interceps-only-softmax-model." class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Models like <code>fit22.1</code>, above, are great when you want to explore predictors for your nominal variables. However, these models are also really useful when you aren’t interested in predictor variables. In these cases, the intercepts-only model will help you compute high-quality Bayesian intervals around the category percentages. Let’s walk through an example to see what I mean. Fit an intercepts-only version of the model, above.</p>
<div class="sourceCode" id="cb2211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2211-1"><a href="nominal-predicted-variable.html#cb2211-1" aria-hidden="true" tabindex="-1"></a>fit22<span class="fl">.2</span> <span class="ot">&lt;-</span></span>
<span id="cb2211-2"><a href="nominal-predicted-variable.html#cb2211-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d1, </span>
<span id="cb2211-3"><a href="nominal-predicted-variable.html#cb2211-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">categorical</span>(<span class="at">link =</span> logit),</span>
<span id="cb2211-4"><a href="nominal-predicted-variable.html#cb2211-4" aria-hidden="true" tabindex="-1"></a>      Y <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb2211-5"><a href="nominal-predicted-variable.html#cb2211-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept, <span class="at">dpar =</span> mu2),</span>
<span id="cb2211-6"><a href="nominal-predicted-variable.html#cb2211-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept, <span class="at">dpar =</span> mu3),</span>
<span id="cb2211-7"><a href="nominal-predicted-variable.html#cb2211-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept, <span class="at">dpar =</span> mu4)),</span>
<span id="cb2211-8"><a href="nominal-predicted-variable.html#cb2211-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb2211-9"><a href="nominal-predicted-variable.html#cb2211-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">22</span>,</span>
<span id="cb2211-10"><a href="nominal-predicted-variable.html#cb2211-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit22.02&quot;</span>)</span></code></pre></div>
<p>Review the model summary.</p>
<div class="sourceCode" id="cb2212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2212-1"><a href="nominal-predicted-variable.html#cb2212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit22<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>##  Family: categorical 
##   Links: mu2 = logit; mu3 = logit; mu4 = logit 
## Formula: Y ~ 1 
##    Data: d1 (Number of observations: 475) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## mu2_Intercept     0.36      0.14     0.08     0.64 1.00     1752     2129
## mu3_Intercept     0.55      0.14     0.27     0.83 1.00     1590     1663
## mu4_Intercept     0.59      0.14     0.31     0.86 1.00     1549     1480
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Even with an intercepts-only model, the parameters in a softmax model are difficult to interpret directly. Though you might be tempted to presume <code>mu2_Intercept</code> through <code>mu4_Intercept</code> were probabilities on the log-odds scale, they’re not. This, recall, is due to their connection to the reference category. If we return to the equation from <a href="nominal-predicted-variable.html#softmax-regression">Section 22.1</a>,</p>
<p><span class="math display">\[\phi_k = \operatorname{softmax}_S (\{\lambda_k\}) = \frac{\exp (\lambda_k)}{\sum_{c \in S} \exp  (\lambda_c)},\]</span></p>
<p>we can get a sense of how to convert these parameters to relative probabilities. Here’s how to do so by hand with the posterior draws.</p>
<div class="sourceCode" id="cb2214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2214-1"><a href="nominal-predicted-variable.html#cb2214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(fit22<span class="fl">.2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2214-2"><a href="nominal-predicted-variable.html#cb2214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">lambda[1]</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>,  <span class="co"># recall this is the default</span></span>
<span id="cb2214-3"><a href="nominal-predicted-variable.html#cb2214-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">lambda[2]</span><span class="st">`</span> <span class="ot">=</span> b_mu2_Intercept,</span>
<span id="cb2214-4"><a href="nominal-predicted-variable.html#cb2214-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">lambda[3]</span><span class="st">`</span> <span class="ot">=</span> b_mu3_Intercept,</span>
<span id="cb2214-5"><a href="nominal-predicted-variable.html#cb2214-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">lambda[4]</span><span class="st">`</span> <span class="ot">=</span> b_mu4_Intercept) <span class="sc">%&gt;%</span> </span>
<span id="cb2214-6"><a href="nominal-predicted-variable.html#cb2214-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;lambda&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2214-7"><a href="nominal-predicted-variable.html#cb2214-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the next two rows are where the magic happens</span></span>
<span id="cb2214-8"><a href="nominal-predicted-variable.html#cb2214-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(.draw) <span class="sc">%&gt;%</span> </span>
<span id="cb2214-9"><a href="nominal-predicted-variable.html#cb2214-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">phi =</span> <span class="fu">exp</span>(value) <span class="sc">/</span> <span class="fu">sum</span>(<span class="fu">exp</span>(value)),</span>
<span id="cb2214-10"><a href="nominal-predicted-variable.html#cb2214-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Y   =</span> <span class="fu">str_extract</span>(name, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2214-11"><a href="nominal-predicted-variable.html#cb2214-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Y) <span class="sc">%&gt;%</span> </span>
<span id="cb2214-12"><a href="nominal-predicted-variable.html#cb2214-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(phi) <span class="sc">%&gt;%</span> </span>
<span id="cb2214-13"><a href="nominal-predicted-variable.html#cb2214-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 7
##   Y       phi .lower .upper .width .point .interval
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 1      0.17   0.14   0.2    0.95 mean   qi       
## 2 2      0.24   0.2    0.28   0.95 mean   qi       
## 3 3      0.29   0.25   0.33   0.95 mean   qi       
## 4 4      0.3    0.26   0.34   0.95 mean   qi</code></pre>
<p>We can compute these relative probability values (<span class="math inline">\(\phi_k\)</span>) much easier with <code>fitted()</code>.</p>
<div class="sourceCode" id="cb2216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2216-1"><a href="nominal-predicted-variable.html#cb2216-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit22<span class="fl">.2</span>)</span>
<span id="cb2216-2"><a href="nominal-predicted-variable.html#cb2216-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2216-3"><a href="nominal-predicted-variable.html#cb2216-3" aria-hidden="true" tabindex="-1"></a>f[<span class="dv">1</span>, , ] <span class="sc">%&gt;%</span> </span>
<span id="cb2216-4"><a href="nominal-predicted-variable.html#cb2216-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2216-5"><a href="nominal-predicted-variable.html#cb2216-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##          Estimate Est.Error Q2.5 Q97.5
## P(Y = 1)     0.17      0.02 0.14  0.20
## P(Y = 2)     0.24      0.02 0.20  0.28
## P(Y = 3)     0.29      0.02 0.25  0.33
## P(Y = 4)     0.30      0.02 0.26  0.34</code></pre>
<p>Anyway, the reason you might want to go through the trouble of fitting an intercepts-only softmax model is to improve on the kinds of bar plots people often report in their manuscripts. Consider these two:</p>
<div class="sourceCode" id="cb2218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2218-1"><a href="nominal-predicted-variable.html#cb2218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># descriptive statistics</span></span>
<span id="cb2218-2"><a href="nominal-predicted-variable.html#cb2218-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb2218-3"><a href="nominal-predicted-variable.html#cb2218-3" aria-hidden="true" tabindex="-1"></a>  d1 <span class="sc">%&gt;%</span> </span>
<span id="cb2218-4"><a href="nominal-predicted-variable.html#cb2218-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Y) <span class="sc">%&gt;%</span>  </span>
<span id="cb2218-5"><a href="nominal-predicted-variable.html#cb2218-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb2218-6"><a href="nominal-predicted-variable.html#cb2218-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2218-7"><a href="nominal-predicted-variable.html#cb2218-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Y, <span class="at">y =</span> p)) <span class="sc">+</span></span>
<span id="cb2218-8"><a href="nominal-predicted-variable.html#cb2218-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> pl[<span class="dv">6</span>]) <span class="sc">+</span></span>
<span id="cb2218-9"><a href="nominal-predicted-variable.html#cb2218-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb2218-10"><a href="nominal-predicted-variable.html#cb2218-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb2218-11"><a href="nominal-predicted-variable.html#cb2218-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;sample statistics&quot;</span>)</span>
<span id="cb2218-12"><a href="nominal-predicted-variable.html#cb2218-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2218-13"><a href="nominal-predicted-variable.html#cb2218-13" aria-hidden="true" tabindex="-1"></a><span class="co"># population percentages</span></span>
<span id="cb2218-14"><a href="nominal-predicted-variable.html#cb2218-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb2218-15"><a href="nominal-predicted-variable.html#cb2218-15" aria-hidden="true" tabindex="-1"></a>  f[<span class="dv">1</span>, , ] <span class="sc">%&gt;%</span> </span>
<span id="cb2218-16"><a href="nominal-predicted-variable.html#cb2218-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2218-17"><a href="nominal-predicted-variable.html#cb2218-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2218-18"><a href="nominal-predicted-variable.html#cb2218-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;level&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2218-19"><a href="nominal-predicted-variable.html#cb2218-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">str_extract</span>(level, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2218-20"><a href="nominal-predicted-variable.html#cb2218-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2218-21"><a href="nominal-predicted-variable.html#cb2218-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Y, <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb2218-22"><a href="nominal-predicted-variable.html#cb2218-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> pl[<span class="dv">6</span>]) <span class="sc">+</span></span>
<span id="cb2218-23"><a href="nominal-predicted-variable.html#cb2218-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb2218-24"><a href="nominal-predicted-variable.html#cb2218-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> pl[<span class="dv">2</span>], <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2218-25"><a href="nominal-predicted-variable.html#cb2218-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb2218-26"><a href="nominal-predicted-variable.html#cb2218-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb2218-27"><a href="nominal-predicted-variable.html#cb2218-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;model-based population percentages</span><span class="sc">\n</span><span class="st">(with 95% interval bars)&quot;</span>)</span>
<span id="cb2218-28"><a href="nominal-predicted-variable.html#cb2218-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2218-29"><a href="nominal-predicted-variable.html#cb2218-29" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;The softmax model adds information to the conventional sample-based</span><span class="sc">\n</span><span class="st">bar plot.&quot;</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-27-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>The plot on the left is the kind of sample data summary you’ll see in countless articles and data presentations. Though it’s a great way to quickly summarize the relative percentages of each category, it does nothing to express how (un)certain we are those sample statistics will describe the population. The intercepts-only softmax model returns the posterior distributions for the population probabilities. In the plot on the right, the bars mark off the posterior means and the vertical lines mark off the 95% intervals. This is why we want the intercepts-only softmax model.</p>
<p>Okay, now just for kicks and giggles, I’d like to go on a plotting tangent. If data analysts broadly replaced the typical sample-based plots (on the left) for the model-based plots (on the right), it would be a great improvement. At a personal level, though, I think simple bar plots are over used. Let’s explore four alternatives. In this block, we’ll make and save the first three.</p>
<div class="sourceCode" id="cb2219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2219-1"><a href="nominal-predicted-variable.html#cb2219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rotated bar plot</span></span>
<span id="cb2219-2"><a href="nominal-predicted-variable.html#cb2219-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb2219-3"><a href="nominal-predicted-variable.html#cb2219-3" aria-hidden="true" tabindex="-1"></a>  f[<span class="dv">1</span>, , ] <span class="sc">%&gt;%</span> </span>
<span id="cb2219-4"><a href="nominal-predicted-variable.html#cb2219-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2219-5"><a href="nominal-predicted-variable.html#cb2219-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2219-6"><a href="nominal-predicted-variable.html#cb2219-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;level&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2219-7"><a href="nominal-predicted-variable.html#cb2219-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">str_extract</span>(level, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2219-8"><a href="nominal-predicted-variable.html#cb2219-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2219-9"><a href="nominal-predicted-variable.html#cb2219-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb2219-10"><a href="nominal-predicted-variable.html#cb2219-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> pl[<span class="dv">6</span>]) <span class="sc">+</span></span>
<span id="cb2219-11"><a href="nominal-predicted-variable.html#cb2219-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb2219-12"><a href="nominal-predicted-variable.html#cb2219-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> pl[<span class="dv">2</span>], <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2219-13"><a href="nominal-predicted-variable.html#cb2219-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> scales<span class="sc">::</span>percent,</span>
<span id="cb2219-14"><a href="nominal-predicted-variable.html#cb2219-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb2219-15"><a href="nominal-predicted-variable.html#cb2219-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;rotated bar plot&quot;</span>)</span>
<span id="cb2219-16"><a href="nominal-predicted-variable.html#cb2219-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2219-17"><a href="nominal-predicted-variable.html#cb2219-17" aria-hidden="true" tabindex="-1"></a><span class="co"># coefficient plot</span></span>
<span id="cb2219-18"><a href="nominal-predicted-variable.html#cb2219-18" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb2219-19"><a href="nominal-predicted-variable.html#cb2219-19" aria-hidden="true" tabindex="-1"></a>  f[<span class="dv">1</span>, , ] <span class="sc">%&gt;%</span> </span>
<span id="cb2219-20"><a href="nominal-predicted-variable.html#cb2219-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2219-21"><a href="nominal-predicted-variable.html#cb2219-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2219-22"><a href="nominal-predicted-variable.html#cb2219-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;level&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2219-23"><a href="nominal-predicted-variable.html#cb2219-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">str_extract</span>(level, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2219-24"><a href="nominal-predicted-variable.html#cb2219-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2219-25"><a href="nominal-predicted-variable.html#cb2219-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Y, <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb2219-26"><a href="nominal-predicted-variable.html#cb2219-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb2219-27"><a href="nominal-predicted-variable.html#cb2219-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> pl[<span class="dv">2</span>], <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">fatten =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2219-28"><a href="nominal-predicted-variable.html#cb2219-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> scales<span class="sc">::</span>percent,</span>
<span id="cb2219-29"><a href="nominal-predicted-variable.html#cb2219-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb2219-30"><a href="nominal-predicted-variable.html#cb2219-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;coefficient plot&quot;</span>)</span>
<span id="cb2219-31"><a href="nominal-predicted-variable.html#cb2219-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2219-32"><a href="nominal-predicted-variable.html#cb2219-32" aria-hidden="true" tabindex="-1"></a><span class="co"># CCDF bar plots</span></span>
<span id="cb2219-33"><a href="nominal-predicted-variable.html#cb2219-33" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb2219-34"><a href="nominal-predicted-variable.html#cb2219-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(fit22<span class="fl">.2</span>, <span class="at">summary =</span> F)[, <span class="dv">1</span>, ] <span class="sc">%&gt;%</span> </span>
<span id="cb2219-35"><a href="nominal-predicted-variable.html#cb2219-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2219-36"><a href="nominal-predicted-variable.html#cb2219-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2219-37"><a href="nominal-predicted-variable.html#cb2219-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to =</span> <span class="st">&quot;p&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2219-38"><a href="nominal-predicted-variable.html#cb2219-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">factor</span>(name)) <span class="sc">%&gt;%</span> </span>
<span id="cb2219-39"><a href="nominal-predicted-variable.html#cb2219-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2219-40"><a href="nominal-predicted-variable.html#cb2219-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Y, <span class="at">y =</span> p)) <span class="sc">+</span></span>
<span id="cb2219-41"><a href="nominal-predicted-variable.html#cb2219-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ccdfinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">fill =</span> pl[<span class="dv">6</span>], <span class="at">color =</span> pl[<span class="dv">2</span>],</span>
<span id="cb2219-42"><a href="nominal-predicted-variable.html#cb2219-42" aria-hidden="true" tabindex="-1"></a>                    <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">point_size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2219-43"><a href="nominal-predicted-variable.html#cb2219-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">/</span> <span class="dv">10</span>,</span>
<span id="cb2219-44"><a href="nominal-predicted-variable.html#cb2219-44" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb2219-45"><a href="nominal-predicted-variable.html#cb2219-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;CCDF bar plot&quot;</span>)</span></code></pre></div>
<p>The fourth alternative is a little weird AND it’s going to take a bit more work than the first three.</p>
<div class="sourceCode" id="cb2220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2220-1"><a href="nominal-predicted-variable.html#cb2220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for annotation</span></span>
<span id="cb2220-2"><a href="nominal-predicted-variable.html#cb2220-2" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span></span>
<span id="cb2220-3"><a href="nominal-predicted-variable.html#cb2220-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">fitted</span>(fit22<span class="fl">.2</span>)[<span class="dv">1</span>, , ] <span class="sc">%&gt;%</span> </span>
<span id="cb2220-4"><a href="nominal-predicted-variable.html#cb2220-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2220-5"><a href="nominal-predicted-variable.html#cb2220-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2220-6"><a href="nominal-predicted-variable.html#cb2220-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;level&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2220-7"><a href="nominal-predicted-variable.html#cb2220-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y       =</span> (Estimate <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">lag</span>(<span class="fu">cumsum</span>(Estimate), <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb2220-8"><a href="nominal-predicted-variable.html#cb2220-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">summary =</span> <span class="fu">str_c</span>(<span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> Estimate, <span class="dv">1</span>), <span class="st">&quot;*&#39;% ± &#39;*&quot;</span>, <span class="fu">round</span>(<span class="dv">200</span> <span class="sc">*</span> Est.Error, <span class="dv">1</span>)),</span>
<span id="cb2220-9"><a href="nominal-predicted-variable.html#cb2220-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">label_y =</span> <span class="fu">str_c</span>(<span class="st">&quot;Y = &quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span>
<span id="cb2220-10"><a href="nominal-predicted-variable.html#cb2220-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2220-11"><a href="nominal-predicted-variable.html#cb2220-11" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span></span>
<span id="cb2220-12"><a href="nominal-predicted-variable.html#cb2220-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># wrangle</span></span>
<span id="cb2220-13"><a href="nominal-predicted-variable.html#cb2220-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(fit22<span class="fl">.2</span>, <span class="at">summary =</span> F)[, <span class="dv">1</span>, ] <span class="sc">%&gt;%</span> </span>
<span id="cb2220-14"><a href="nominal-predicted-variable.html#cb2220-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2220-15"><a href="nominal-predicted-variable.html#cb2220-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2220-16"><a href="nominal-predicted-variable.html#cb2220-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2220-17"><a href="nominal-predicted-variable.html#cb2220-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>row) <span class="sc">%&gt;%</span> </span>
<span id="cb2220-18"><a href="nominal-predicted-variable.html#cb2220-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">fct_rev</span>(name)) <span class="sc">%&gt;%</span> </span>
<span id="cb2220-19"><a href="nominal-predicted-variable.html#cb2220-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2220-20"><a href="nominal-predicted-variable.html#cb2220-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb2220-21"><a href="nominal-predicted-variable.html#cb2220-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> row, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb2220-22"><a href="nominal-predicted-variable.html#cb2220-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Y),</span>
<span id="cb2220-23"><a href="nominal-predicted-variable.html#cb2220-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2220-24"><a href="nominal-predicted-variable.html#cb2220-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb2220-25"><a href="nominal-predicted-variable.html#cb2220-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">2000</span>, <span class="at">y =</span> y, <span class="at">label =</span> label_y),</span>
<span id="cb2220-26"><a href="nominal-predicted-variable.html#cb2220-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2220-27"><a href="nominal-predicted-variable.html#cb2220-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> text,</span>
<span id="cb2220-28"><a href="nominal-predicted-variable.html#cb2220-28" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">6000</span>, <span class="at">y =</span> y, <span class="at">label =</span> summary),</span>
<span id="cb2220-29"><a href="nominal-predicted-variable.html#cb2220-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb2220-30"><a href="nominal-predicted-variable.html#cb2220-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pl[<span class="dv">7</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2220-31"><a href="nominal-predicted-variable.html#cb2220-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4000</span>, <span class="dv">8000</span>)) <span class="sc">+</span></span>
<span id="cb2220-32"><a href="nominal-predicted-variable.html#cb2220-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2220-33"><a href="nominal-predicted-variable.html#cb2220-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;stacked bar plot with uncertain boundaries&quot;</span>)</span></code></pre></div>
<p>Okay, now combine the four ggplots and behold!</p>
<div class="sourceCode" id="cb2221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2221-1"><a href="nominal-predicted-variable.html#cb2221-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb2221-2"><a href="nominal-predicted-variable.html#cb2221-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4 <span class="sc">+</span> </span>
<span id="cb2221-3"><a href="nominal-predicted-variable.html#cb2221-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Alternatives to the conventional bar plot&quot;</span>,</span>
<span id="cb2221-4"><a href="nominal-predicted-variable.html#cb2221-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tag_levels =</span> <span class="st">&quot;a&quot;</span>, <span class="at">tag_prefix =</span> <span class="st">&quot;(&quot;</span>, <span class="at">tag_suffix =</span> <span class="st">&quot;)&quot;</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-30-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>The rotated bar plot (a) is most useful when the names of the levels are longer character strings. For example, imagine that instead of <code>1</code> through <code>4</code>, the four levels were countries or pharmaceutical drugs. You wouldn’t want to mess with formatting those on an <span class="math inline">\(x\)</span>-axis. Use a rotated bar plot, instead. For my taste, the simple coefficient plot (b) gets the job done nicely without the unnecessary clutter of the bars. Matthew Kay’s CCDF bar plots (c) provide a fuller expression of the shape of the posterior uncertainty in each percentage. If desired, you could even omit the dot intervals from those and the visual expression of uncertainty would still remain. The final stacked bar plot with the fuzzy boundaries (d) is the result of a little back-and-forth on twitter (<a href="https://twitter.com/SolomonKurz/status/1372632774285348864">original tweet</a>). It’s the oddball of the group, but what it does uniquely well is show how the percentages of the groups all depend on one another and must, by definition, sum to 100.</p>
</div>
</div>
<div id="conditional-logistic-model.-1" class="section level4 hasAnchor" number="22.3.3.2">
<h4><span class="header-section-number">22.3.3.2</span> Conditional logistic model.<a href="nominal-predicted-variable.html#conditional-logistic-model.-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Since we will be fitting the conditional logistic model with two different strategies, I’m going to deviate from how Kruschke organized this part of the text and break this section up into two subsections:</p>
<ol style="list-style-type: decimal">
<li>First we’ll walk through the custom family approach.</li>
<li>Second we’ll explore the sequential ordinal approach.</li>
</ol>
<div id="conditional-logistic-models-with-custom-likelihoods." class="section level5 hasAnchor" number="22.3.3.2.1">
<h5><span class="header-section-number">22.3.3.2.1</span> Conditional logistic models with custom likelihoods.<a href="nominal-predicted-variable.html#conditional-logistic-models-with-custom-likelihoods." class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>As we briefly learned in <a href="jags-brms.html#defining-new-likelihood-functions.">Section 8.6.1</a>, <strong>brms</strong> users can define their own custom likelihood functions, which Bürkner outlined in his <span class="citation">(<a href="#ref-Bürkner2022Define" role="doc-biblioref">2022d</a>)</span> vignette, <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_customfamilies.html"><em>Define custom response distributions with brms</em></a>. As part of the <a href="https://discourse.mc-stan.org/t/nominal-data-and-kruschkes-conditional-logistic-approach/21433"><em>Nominal data and Kruschke’s “conditional logistic” approach</em></a> thread on the Stan forums, Henrik Singmann showed how you can use this functionality to fit conditional logistic models with <strong>brms</strong>. We will practice how to do this for the models of both the <code>d3</code> and <code>d4</code> data sets, which were showcased in the left and right panels of Figure 22.3 in <a href="nominal-predicted-variable.html#conditional-logistic-regression">Section 22.2</a>. Going in order, we’ll focus first on how to model the data in <code>d3</code>.</p>
<p>For the first step, we use the <code>custom_family()</code> function to</p>
<ul>
<li>name the new family with the <code>name</code> argument,</li>
<li>name the family’s parameters with the <code>dpars</code> argument,</li>
<li>name the link function(s) with the <code>links</code> argument,</li>
<li>define whether the distribution is discrete or continuous with the <code>type</code> argument,</li>
<li>provide the names of any variables that are part of the internal workings of the family but are not among the distributional parameters with the <code>vars</code> argument, and</li>
<li>provide supporting information with the <code>specials</code> argument.</li>
</ul>
<div class="sourceCode" id="cb2222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2222-1"><a href="nominal-predicted-variable.html#cb2222-1" aria-hidden="true" tabindex="-1"></a>cond_log_1 <span class="ot">&lt;-</span> <span class="fu">custom_family</span>(</span>
<span id="cb2222-2"><a href="nominal-predicted-variable.html#cb2222-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name     =</span> <span class="st">&quot;cond_log_1&quot;</span>, </span>
<span id="cb2222-3"><a href="nominal-predicted-variable.html#cb2222-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpars    =</span> <span class="fu">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;mub&quot;</span>, <span class="st">&quot;muc&quot;</span>), </span>
<span id="cb2222-4"><a href="nominal-predicted-variable.html#cb2222-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">links    =</span> <span class="st">&quot;identity&quot;</span>, </span>
<span id="cb2222-5"><a href="nominal-predicted-variable.html#cb2222-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type     =</span> <span class="st">&quot;int&quot;</span>,</span>
<span id="cb2222-6"><a href="nominal-predicted-variable.html#cb2222-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars     =</span> <span class="fu">c</span>(<span class="st">&quot;n_cat&quot;</span>),</span>
<span id="cb2222-7"><a href="nominal-predicted-variable.html#cb2222-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">specials =</span> <span class="st">&quot;categorical&quot;</span></span>
<span id="cb2222-8"><a href="nominal-predicted-variable.html#cb2222-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>In the second step, we use the <code>stanvar()</code> function to define our custom probability mass function and the corresponding function that will allow us to return predictions.</p>
<div class="sourceCode" id="cb2223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2223-1"><a href="nominal-predicted-variable.html#cb2223-1" aria-hidden="true" tabindex="-1"></a>stan_lpmf_1 <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="at">block =</span> <span class="st">&quot;functions&quot;</span>, </span>
<span id="cb2223-2"><a href="nominal-predicted-variable.html#cb2223-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">scode =</span> <span class="st">&quot;</span></span>
<span id="cb2223-3"><a href="nominal-predicted-variable.html#cb2223-3" aria-hidden="true" tabindex="-1"></a><span class="st">real cond_log_1_lpmf(int y, real mu, real mu_b, real mu_c, int n_cat) {</span></span>
<span id="cb2223-4"><a href="nominal-predicted-variable.html#cb2223-4" aria-hidden="true" tabindex="-1"></a><span class="st">  real p_mu  = inv_logit(mu);</span></span>
<span id="cb2223-5"><a href="nominal-predicted-variable.html#cb2223-5" aria-hidden="true" tabindex="-1"></a><span class="st">  real p_mub = inv_logit(mu_b);</span></span>
<span id="cb2223-6"><a href="nominal-predicted-variable.html#cb2223-6" aria-hidden="true" tabindex="-1"></a><span class="st">  real p_muc = inv_logit(mu_c);</span></span>
<span id="cb2223-7"><a href="nominal-predicted-variable.html#cb2223-7" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[n_cat] prob;</span></span>
<span id="cb2223-8"><a href="nominal-predicted-variable.html#cb2223-8" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[1] = p_mu;</span></span>
<span id="cb2223-9"><a href="nominal-predicted-variable.html#cb2223-9" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[2] = p_mub * (1 - p_mu);</span></span>
<span id="cb2223-10"><a href="nominal-predicted-variable.html#cb2223-10" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[3] = p_muc * (1 - p_mub) * (1 - p_mu);</span></span>
<span id="cb2223-11"><a href="nominal-predicted-variable.html#cb2223-11" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[4] = (1 - p_mu) * (1 - p_mub) * (1 - p_muc);</span></span>
<span id="cb2223-12"><a href="nominal-predicted-variable.html#cb2223-12" aria-hidden="true" tabindex="-1"></a><span class="st">  return(categorical_lpmf(y | prob));</span></span>
<span id="cb2223-13"><a href="nominal-predicted-variable.html#cb2223-13" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb2223-14"><a href="nominal-predicted-variable.html#cb2223-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2223-15"><a href="nominal-predicted-variable.html#cb2223-15" aria-hidden="true" tabindex="-1"></a><span class="st">vector cond_log_1_pred(int y, real mu, real mu_b, real mu_c, int n_cat) {</span></span>
<span id="cb2223-16"><a href="nominal-predicted-variable.html#cb2223-16" aria-hidden="true" tabindex="-1"></a><span class="st">  real p_mu  = inv_logit(mu);</span></span>
<span id="cb2223-17"><a href="nominal-predicted-variable.html#cb2223-17" aria-hidden="true" tabindex="-1"></a><span class="st">  real p_mub = inv_logit(mu_b);</span></span>
<span id="cb2223-18"><a href="nominal-predicted-variable.html#cb2223-18" aria-hidden="true" tabindex="-1"></a><span class="st">  real p_muc = inv_logit(mu_c);</span></span>
<span id="cb2223-19"><a href="nominal-predicted-variable.html#cb2223-19" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[n_cat] prob;</span></span>
<span id="cb2223-20"><a href="nominal-predicted-variable.html#cb2223-20" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[1] = p_mu;</span></span>
<span id="cb2223-21"><a href="nominal-predicted-variable.html#cb2223-21" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[2] = p_mub * (1 - p_mu);</span></span>
<span id="cb2223-22"><a href="nominal-predicted-variable.html#cb2223-22" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[3] = p_muc * (1 - p_mub) * (1 - p_mu);</span></span>
<span id="cb2223-23"><a href="nominal-predicted-variable.html#cb2223-23" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[4] = (1 - p_mu) * (1 - p_mub) * (1 - p_muc);</span></span>
<span id="cb2223-24"><a href="nominal-predicted-variable.html#cb2223-24" aria-hidden="true" tabindex="-1"></a><span class="st">  return(prob);</span></span>
<span id="cb2223-25"><a href="nominal-predicted-variable.html#cb2223-25" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb2223-26"><a href="nominal-predicted-variable.html#cb2223-26" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>) </span></code></pre></div>
<p>Note how we have defined the four <code>prob[i]</code> values based on the four equations from above:</p>
<p><span class="math display">\[
\begin{align*}
\phi_1 &amp; = \phi_{\{ 1 \} | \{ 1,2,3,4 \}} \\
\phi_2 &amp; = \phi_{\{ 2 \} | \{ 2,3,4 \}} \cdot \left ( 1 - \phi_{\{ 1 \} | \{ 1,2,3,4 \}} \right) \\
\phi_3 &amp; = \phi_{\{ 3 \} | \{ 3,4 \}} \cdot \left ( 1 - \phi_{\{ 2 \} | \{ 2,3,4 \}} \right) \cdot \left ( 1 - \phi_{\{ 1 \} | \{ 1,2,3,4 \}} \right) \\
\phi_4 &amp; = \left ( 1 - \phi_{\{ 3 \} | \{ 3,4 \}} \right) \cdot \left ( 1 - \phi_{\{ 2 \} | \{ 2,3,4 \}} \right) \cdot \left ( 1 - \phi_{\{ 1 \} | \{ 1,2,3,4 \}} \right).
\end{align*}
\]</span></p>
<p>Third, we save another <code>stanvar()</code> object with additional information.</p>
<div class="sourceCode" id="cb2224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2224-1"><a href="nominal-predicted-variable.html#cb2224-1" aria-hidden="true" tabindex="-1"></a>stanvars <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="at">x =</span> <span class="dv">4</span>, <span class="at">name =</span> <span class="st">&quot;n_cat&quot;</span>, <span class="at">scode =</span> <span class="st">&quot;  int n_cat;&quot;</span>)</span></code></pre></div>
<p>Now we’re ready to fit the model with <code>brm()</code>. Notice how our use of the <code>family</code> and <code>stanvars</code> functions.</p>
<div class="sourceCode" id="cb2225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2225-1"><a href="nominal-predicted-variable.html#cb2225-1" aria-hidden="true" tabindex="-1"></a>fit22<span class="fl">.3</span> <span class="ot">&lt;-</span></span>
<span id="cb2225-2"><a href="nominal-predicted-variable.html#cb2225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d3, </span>
<span id="cb2225-3"><a href="nominal-predicted-variable.html#cb2225-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> cond_log_1,</span>
<span id="cb2225-4"><a href="nominal-predicted-variable.html#cb2225-4" aria-hidden="true" tabindex="-1"></a>      Y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> X1 <span class="sc">+</span> X2,</span>
<span id="cb2225-5"><a href="nominal-predicted-variable.html#cb2225-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb2225-6"><a href="nominal-predicted-variable.html#cb2225-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept, <span class="at">dpar =</span> mub),</span>
<span id="cb2225-7"><a href="nominal-predicted-variable.html#cb2225-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept, <span class="at">dpar =</span> muc),</span>
<span id="cb2225-8"><a href="nominal-predicted-variable.html#cb2225-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> b),</span>
<span id="cb2225-9"><a href="nominal-predicted-variable.html#cb2225-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> b, <span class="at">dpar =</span> mub),</span>
<span id="cb2225-10"><a href="nominal-predicted-variable.html#cb2225-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> b, <span class="at">dpar =</span> muc)),</span>
<span id="cb2225-11"><a href="nominal-predicted-variable.html#cb2225-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb2225-12"><a href="nominal-predicted-variable.html#cb2225-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">22</span>,</span>
<span id="cb2225-13"><a href="nominal-predicted-variable.html#cb2225-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">stanvars =</span> stan_lpmf_1 <span class="sc">+</span> stanvars,</span>
<span id="cb2225-14"><a href="nominal-predicted-variable.html#cb2225-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit22.03&quot;</span>)</span></code></pre></div>
<p>Check the model summary.</p>
<div class="sourceCode" id="cb2226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2226-1"><a href="nominal-predicted-variable.html#cb2226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit22<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>##  Family: cond_log_1 
##   Links: mu = identity; mub = identity; muc = identity 
## Formula: Y ~ 1 + X1 + X2 
##    Data: d3 (Number of observations: 475) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept        -4.02      0.46    -4.99    -3.17 1.00     2681     2389
## mub_Intercept    -2.11      0.36    -2.85    -1.45 1.00     2942     2993
## muc_Intercept    -0.96      0.32    -1.64    -0.35 1.00     3357     2857
## X1               -4.92      0.54    -6.05    -3.92 1.00     2668     2259
## X2                0.01      0.19    -0.37     0.38 1.00     4660     2705
## mub_X1            0.74      0.29     0.20     1.31 1.00     3840     3365
## mub_X2           -5.19      0.64    -6.54    -4.02 1.00     3266     2842
## muc_X1            3.00      0.49     2.11     4.02 1.00     3047     2918
## muc_X2            3.08      0.53     2.12     4.20 1.00     3101     3186
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>As they aren’t the most intuitive, here’s how to understand our two prefixes:</p>
<ul>
<li>the lines with no prefix have to do with <span class="math inline">\(\lambda_{\{ 1 \} | \{ 1,2,3,4 \}}\)</span>,</li>
<li><code>mub_</code> has to do with <span class="math inline">\(\lambda_{\{ 2 \} | \{ 2,3,4 \}}\)</span>, and</li>
<li><code>muc_</code> has to do with <span class="math inline">\(\lambda_{\{ 3 \} | \{ 3,4 \}}\)</span>.</li>
</ul>
<p>If you compare those posterior means of each of those parameters from the data-generating equations at the top of Figure 22.3, you’ll see they are spot on (within simulation variance). Here’s how we might visualize those posteriors in our version of the histograms in the top right panel(s) of Figure 22.6.</p>
<div class="sourceCode" id="cb2228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2228-1"><a href="nominal-predicted-variable.html#cb2228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the posterior draws</span></span>
<span id="cb2228-2"><a href="nominal-predicted-variable.html#cb2228-2" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit22<span class="fl">.3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2228-3"><a href="nominal-predicted-variable.html#cb2228-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># our lives will be easier if we adjust the column names</span></span>
<span id="cb2228-4"><a href="nominal-predicted-variable.html#cb2228-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">a_Intercept =</span> b_Intercept,</span>
<span id="cb2228-5"><a href="nominal-predicted-variable.html#cb2228-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">b_Intercept =</span> b_mub_Intercept,</span>
<span id="cb2228-6"><a href="nominal-predicted-variable.html#cb2228-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">c_Intercept =</span> b_muc_Intercept,</span>
<span id="cb2228-7"><a href="nominal-predicted-variable.html#cb2228-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">a_X1 =</span> b_X1,</span>
<span id="cb2228-8"><a href="nominal-predicted-variable.html#cb2228-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">a_X2 =</span> b_X2,</span>
<span id="cb2228-9"><a href="nominal-predicted-variable.html#cb2228-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">b_X1 =</span> b_mub_X1,</span>
<span id="cb2228-10"><a href="nominal-predicted-variable.html#cb2228-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">b_X2 =</span> b_mub_X2,</span>
<span id="cb2228-11"><a href="nominal-predicted-variable.html#cb2228-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">c_X1 =</span> b_muc_X1,</span>
<span id="cb2228-12"><a href="nominal-predicted-variable.html#cb2228-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">c_X2 =</span> b_muc_X2)</span>
<span id="cb2228-13"><a href="nominal-predicted-variable.html#cb2228-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2228-14"><a href="nominal-predicted-variable.html#cb2228-14" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb2228-15"><a href="nominal-predicted-variable.html#cb2228-15" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb2228-16"><a href="nominal-predicted-variable.html#cb2228-16" aria-hidden="true" tabindex="-1"></a>  draws <span class="sc">%&gt;%</span> </span>
<span id="cb2228-17"><a href="nominal-predicted-variable.html#cb2228-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(a_Intercept<span class="sc">:</span>c_X2) <span class="sc">%&gt;%</span> </span>
<span id="cb2228-18"><a href="nominal-predicted-variable.html#cb2228-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda    =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name, <span class="st">&quot;a_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;lambda[&#39;{1}|{1,2,3,4}&#39;]&quot;</span>,</span>
<span id="cb2228-19"><a href="nominal-predicted-variable.html#cb2228-19" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(name, <span class="st">&quot;b_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;lambda[&#39;{2}|{2,3,4}&#39;]&quot;</span>,</span>
<span id="cb2228-20"><a href="nominal-predicted-variable.html#cb2228-20" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(name, <span class="st">&quot;c_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;lambda[&#39;{3}|{3,4}&#39;]&quot;</span>),</span>
<span id="cb2228-21"><a href="nominal-predicted-variable.html#cb2228-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">parameter =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name, <span class="st">&quot;Intercept&quot;</span>) <span class="sc">~</span> <span class="st">&quot;beta[0]&quot;</span>,</span>
<span id="cb2228-22"><a href="nominal-predicted-variable.html#cb2228-22" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(name, <span class="st">&quot;X1&quot;</span>)        <span class="sc">~</span> <span class="st">&quot;beta[1]&quot;</span>,</span>
<span id="cb2228-23"><a href="nominal-predicted-variable.html#cb2228-23" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(name, <span class="st">&quot;X2&quot;</span>)        <span class="sc">~</span> <span class="st">&quot;beta[2]&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2228-24"><a href="nominal-predicted-variable.html#cb2228-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2228-25"><a href="nominal-predicted-variable.html#cb2228-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb2228-26"><a href="nominal-predicted-variable.html#cb2228-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2228-27"><a href="nominal-predicted-variable.html#cb2228-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_histinterval</span>(<span class="at">point_interval =</span> mode_hdi, <span class="at">.width =</span> .<span class="dv">95</span>,</span>
<span id="cb2228-28"><a href="nominal-predicted-variable.html#cb2228-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> pl[<span class="dv">4</span>], <span class="at">slab_color =</span> pl[<span class="dv">3</span>], <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">point_color =</span> pl[<span class="dv">2</span>],</span>
<span id="cb2228-29"><a href="nominal-predicted-variable.html#cb2228-29" aria-hidden="true" tabindex="-1"></a>                    <span class="at">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="sc">+</span></span>
<span id="cb2228-30"><a href="nominal-predicted-variable.html#cb2228-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2228-31"><a href="nominal-predicted-variable.html#cb2228-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;marginal posterior&quot;</span>) <span class="sc">+</span></span>
<span id="cb2228-32"><a href="nominal-predicted-variable.html#cb2228-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(lambda <span class="sc">~</span> parameter, <span class="at">labeller =</span> label_parsed, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb2228-33"><a href="nominal-predicted-variable.html#cb2228-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span></code></pre></div>
<p>If we use the threshold formula from above,</p>
<p><span class="math display">\[x_2 = (-\beta_0 / \beta_2) + (-\beta_1 / \beta_2)x_1,\]</span></p>
<p>to the posterior draws, we can make our version of the upper left panel of Figure 22.6.</p>
<div class="sourceCode" id="cb2229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2229-1"><a href="nominal-predicted-variable.html#cb2229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">22</span>)</span>
<span id="cb2229-2"><a href="nominal-predicted-variable.html#cb2229-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2229-3"><a href="nominal-predicted-variable.html#cb2229-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb2229-4"><a href="nominal-predicted-variable.html#cb2229-4" aria-hidden="true" tabindex="-1"></a>  draws <span class="sc">%&gt;%</span> </span>
<span id="cb2229-5"><a href="nominal-predicted-variable.html#cb2229-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2229-6"><a href="nominal-predicted-variable.html#cb2229-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(a_Intercept<span class="sc">:</span>c_X2) <span class="sc">%&gt;%</span> </span>
<span id="cb2229-7"><a href="nominal-predicted-variable.html#cb2229-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;parameter&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2229-8"><a href="nominal-predicted-variable.html#cb2229-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> parameter, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb2229-9"><a href="nominal-predicted-variable.html#cb2229-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intercept =</span> <span class="sc">-</span>Intercept <span class="sc">/</span> X2,</span>
<span id="cb2229-10"><a href="nominal-predicted-variable.html#cb2229-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">slope     =</span> <span class="sc">-</span>X1 <span class="sc">/</span> X2) <span class="sc">%&gt;%</span> </span>
<span id="cb2229-11"><a href="nominal-predicted-variable.html#cb2229-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2229-12"><a href="nominal-predicted-variable.html#cb2229-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2229-13"><a href="nominal-predicted-variable.html#cb2229-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> d3,</span>
<span id="cb2229-14"><a href="nominal-predicted-variable.html#cb2229-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2, <span class="at">label =</span> Y, <span class="at">color =</span> <span class="fu">factor</span>(Y)),</span>
<span id="cb2229-15"><a href="nominal-predicted-variable.html#cb2229-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb2229-16"><a href="nominal-predicted-variable.html#cb2229-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> intercept,</span>
<span id="cb2229-17"><a href="nominal-predicted-variable.html#cb2229-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope =</span> slope,</span>
<span id="cb2229-18"><a href="nominal-predicted-variable.html#cb2229-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">group =</span> <span class="fu">interaction</span>(.draw, mu),</span>
<span id="cb2229-19"><a href="nominal-predicted-variable.html#cb2229-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> mu),</span>
<span id="cb2229-20"><a href="nominal-predicted-variable.html#cb2229-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2229-21"><a href="nominal-predicted-variable.html#cb2229-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pl[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb2229-22"><a href="nominal-predicted-variable.html#cb2229-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="cn">NULL</span>,</span>
<span id="cb2229-23"><a href="nominal-predicted-variable.html#cb2229-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labels =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">c</span>(</span>
<span id="cb2229-24"><a href="nominal-predicted-variable.html#cb2229-24" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{1}|{1,2,3,4}&#39;]&quot;</span>, </span>
<span id="cb2229-25"><a href="nominal-predicted-variable.html#cb2229-25" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{2}|{2,3,4}&#39;]&quot;</span>, </span>
<span id="cb2229-26"><a href="nominal-predicted-variable.html#cb2229-26" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{3}|{3,4}&#39;]&quot;</span>)),</span>
<span id="cb2229-27"><a href="nominal-predicted-variable.html#cb2229-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">guide =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb2229-28"><a href="nominal-predicted-variable.html#cb2229-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">direction =</span> <span class="st">&quot;vertical&quot;</span>,</span>
<span id="cb2229-29"><a href="nominal-predicted-variable.html#cb2229-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb2229-30"><a href="nominal-predicted-variable.html#cb2229-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.theme =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))) <span class="sc">+</span></span>
<span id="cb2229-31"><a href="nominal-predicted-variable.html#cb2229-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(x[<span class="dv">1</span>]),</span>
<span id="cb2229-32"><a href="nominal-predicted-variable.html#cb2229-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(x[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb2229-33"><a href="nominal-predicted-variable.html#cb2229-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.justification =</span> <span class="fl">0.5</span>,</span>
<span id="cb2229-34"><a href="nominal-predicted-variable.html#cb2229-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p>Now combine the two ggplots, add a little formatting, and show the full upper half of Figure 22.6, based on the <code>custom_family()</code> approach.</p>
<div class="sourceCode" id="cb2230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2230-1"><a href="nominal-predicted-variable.html#cb2230-1" aria-hidden="true" tabindex="-1"></a>(p2 <span class="sc">+</span> p1) <span class="sc">&amp;</span> </span>
<span id="cb2230-2"><a href="nominal-predicted-variable.html#cb2230-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">&amp;</span></span>
<span id="cb2230-3"><a href="nominal-predicted-variable.html#cb2230-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Figure 22.6, upper half&quot;</span>,</span>
<span id="cb2230-4"><a href="nominal-predicted-variable.html#cb2230-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">&quot;Results from the conditional logistic model fit to the d3 data via the custom-family approach&quot;</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-37-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>Though it isn’t necessary to reproduce any of the plots in this section of Kruschke’s text, we’ll want to use the <code>expose_functions()</code> function if we wanted to use any of the <strong>brms</strong> post-processing functions for our model fit with the custom likelihood.</p>
<div class="sourceCode" id="cb2231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2231-1"><a href="nominal-predicted-variable.html#cb2231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expose_functions</span>(fit22<span class="fl">.3</span>, <span class="at">vectorize =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Here’s what we’d need to do before computing information criteria estimates, such as with the WAIC.</p>
<div class="sourceCode" id="cb2232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2232-1"><a href="nominal-predicted-variable.html#cb2232-1" aria-hidden="true" tabindex="-1"></a>log_lik_cond_log_1 <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep) {</span>
<span id="cb2232-2"><a href="nominal-predicted-variable.html#cb2232-2" aria-hidden="true" tabindex="-1"></a>  mu  <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;mu&quot;</span>, <span class="at">i =</span> i)</span>
<span id="cb2232-3"><a href="nominal-predicted-variable.html#cb2232-3" aria-hidden="true" tabindex="-1"></a>  mub <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;mub&quot;</span>, <span class="at">i =</span> i)</span>
<span id="cb2232-4"><a href="nominal-predicted-variable.html#cb2232-4" aria-hidden="true" tabindex="-1"></a>  muc <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;muc&quot;</span>, <span class="at">i =</span> i)</span>
<span id="cb2232-5"><a href="nominal-predicted-variable.html#cb2232-5" aria-hidden="true" tabindex="-1"></a>  n_cat <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>n_cat</span>
<span id="cb2232-6"><a href="nominal-predicted-variable.html#cb2232-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>Y[i]</span>
<span id="cb2232-7"><a href="nominal-predicted-variable.html#cb2232-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cond_log_1_lpmf</span>(y, mu, mub, muc, n_cat)</span>
<span id="cb2232-8"><a href="nominal-predicted-variable.html#cb2232-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2232-9"><a href="nominal-predicted-variable.html#cb2232-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2232-10"><a href="nominal-predicted-variable.html#cb2232-10" aria-hidden="true" tabindex="-1"></a>fit22<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit22<span class="fl">.3</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb2232-11"><a href="nominal-predicted-variable.html#cb2232-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2232-12"><a href="nominal-predicted-variable.html#cb2232-12" aria-hidden="true" tabindex="-1"></a><span class="fu">waic</span>(fit22<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>## 
## Computed from 4000 by 475 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic   -230.8 16.8
## p_waic         9.3  1.1
## waic         461.5 33.6
## 
## 2 (0.4%) p_waic estimates greater than 0.4. We recommend trying loo instead.</code></pre>
<p>If we wanted to use one of the functions that relies on conditional expectations, such as <code>conditional_effects()</code>, we’d execute something like this.</p>
<div class="sourceCode" id="cb2234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2234-1"><a href="nominal-predicted-variable.html#cb2234-1" aria-hidden="true" tabindex="-1"></a>posterior_epred_cond_log_1 <span class="ot">&lt;-</span> <span class="cf">function</span>(prep) {</span>
<span id="cb2234-2"><a href="nominal-predicted-variable.html#cb2234-2" aria-hidden="true" tabindex="-1"></a>  mu   <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;mu&quot;</span>)</span>
<span id="cb2234-3"><a href="nominal-predicted-variable.html#cb2234-3" aria-hidden="true" tabindex="-1"></a>  mu_b <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;mub&quot;</span>)</span>
<span id="cb2234-4"><a href="nominal-predicted-variable.html#cb2234-4" aria-hidden="true" tabindex="-1"></a>  mu_c <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;muc&quot;</span>)</span>
<span id="cb2234-5"><a href="nominal-predicted-variable.html#cb2234-5" aria-hidden="true" tabindex="-1"></a>  n_cat <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>n_cat</span>
<span id="cb2234-6"><a href="nominal-predicted-variable.html#cb2234-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>Y</span>
<span id="cb2234-7"><a href="nominal-predicted-variable.html#cb2234-7" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">&lt;-</span> <span class="fu">cond_log_1_pred</span>(<span class="at">y =</span> y, <span class="at">mu =</span> mu, <span class="at">mu_b =</span> mu_b, <span class="at">mu_c =</span> mu_c, <span class="at">n_cat =</span> n_cat)</span>
<span id="cb2234-8"><a href="nominal-predicted-variable.html#cb2234-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(prob) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">dim</span>(prob)[<span class="dv">1</span>], <span class="fu">dim</span>(mu))</span>
<span id="cb2234-9"><a href="nominal-predicted-variable.html#cb2234-9" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">&lt;-</span> <span class="fu">aperm</span>(prob, <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb2234-10"><a href="nominal-predicted-variable.html#cb2234-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(prob) <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2234-11"><a href="nominal-predicted-variable.html#cb2234-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(<span class="fu">seq_len</span>(<span class="fu">dim</span>(prob)[<span class="dv">1</span>])), </span>
<span id="cb2234-12"><a href="nominal-predicted-variable.html#cb2234-12" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NULL</span>, </span>
<span id="cb2234-13"><a href="nominal-predicted-variable.html#cb2234-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(<span class="fu">seq_len</span>(<span class="fu">dim</span>(prob)[<span class="dv">3</span>]))</span>
<span id="cb2234-14"><a href="nominal-predicted-variable.html#cb2234-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2234-15"><a href="nominal-predicted-variable.html#cb2234-15" aria-hidden="true" tabindex="-1"></a>  prob</span>
<span id="cb2234-16"><a href="nominal-predicted-variable.html#cb2234-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2234-17"><a href="nominal-predicted-variable.html#cb2234-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2234-18"><a href="nominal-predicted-variable.html#cb2234-18" aria-hidden="true" tabindex="-1"></a>ce <span class="ot">&lt;-</span> <span class="fu">conditional_effects</span>(</span>
<span id="cb2234-19"><a href="nominal-predicted-variable.html#cb2234-19" aria-hidden="true" tabindex="-1"></a>  fit22<span class="fl">.3</span>, </span>
<span id="cb2234-20"><a href="nominal-predicted-variable.html#cb2234-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">categorical =</span> T,</span>
<span id="cb2234-21"><a href="nominal-predicted-variable.html#cb2234-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">effects =</span> <span class="st">&quot;X1&quot;</span>)</span>
<span id="cb2234-22"><a href="nominal-predicted-variable.html#cb2234-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2234-23"><a href="nominal-predicted-variable.html#cb2234-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ce, <span class="at">plot =</span> <span class="cn">FALSE</span>)[[<span class="dv">1</span>]] <span class="sc">+</span> </span>
<span id="cb2234-24"><a href="nominal-predicted-variable.html#cb2234-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pl[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb2234-25"><a href="nominal-predicted-variable.html#cb2234-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pl[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>])</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-40-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>If we wanted to do a posterior predictive check with the <code>pp_check()</code> function, we’d need to do something like this.</p>
<div class="sourceCode" id="cb2235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2235-1"><a href="nominal-predicted-variable.html#cb2235-1" aria-hidden="true" tabindex="-1"></a>posterior_predict_cond_log_1 <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep, ...) {</span>
<span id="cb2235-2"><a href="nominal-predicted-variable.html#cb2235-2" aria-hidden="true" tabindex="-1"></a>  mu   <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;mu&quot;</span>, <span class="at">i =</span> i)</span>
<span id="cb2235-3"><a href="nominal-predicted-variable.html#cb2235-3" aria-hidden="true" tabindex="-1"></a>  mu_b <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;mub&quot;</span>, <span class="at">i =</span> i)</span>
<span id="cb2235-4"><a href="nominal-predicted-variable.html#cb2235-4" aria-hidden="true" tabindex="-1"></a>  mu_c <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;muc&quot;</span>, <span class="at">i =</span> i)</span>
<span id="cb2235-5"><a href="nominal-predicted-variable.html#cb2235-5" aria-hidden="true" tabindex="-1"></a>  n_cat <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>n_cat</span>
<span id="cb2235-6"><a href="nominal-predicted-variable.html#cb2235-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>Y[i]</span>
<span id="cb2235-7"><a href="nominal-predicted-variable.html#cb2235-7" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">&lt;-</span> <span class="fu">cond_log_1_pred</span>(y, mu, mu_b, mu_c, n_cat)</span>
<span id="cb2235-8"><a href="nominal-predicted-variable.html#cb2235-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure you have the extraDistr package</span></span>
<span id="cb2235-9"><a href="nominal-predicted-variable.html#cb2235-9" aria-hidden="true" tabindex="-1"></a>  extraDistr<span class="sc">::</span><span class="fu">rcat</span>(<span class="fu">length</span>(mu), <span class="fu">t</span>(prob))</span>
<span id="cb2235-10"><a href="nominal-predicted-variable.html#cb2235-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2235-11"><a href="nominal-predicted-variable.html#cb2235-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2235-12"><a href="nominal-predicted-variable.html#cb2235-12" aria-hidden="true" tabindex="-1"></a>bayesplot<span class="sc">::</span><span class="fu">color_scheme_set</span>(pl[<span class="dv">7</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb2235-13"><a href="nominal-predicted-variable.html#cb2235-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2235-14"><a href="nominal-predicted-variable.html#cb2235-14" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit22<span class="fl">.3</span>, </span>
<span id="cb2235-15"><a href="nominal-predicted-variable.html#cb2235-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">&quot;bars&quot;</span>, </span>
<span id="cb2235-16"><a href="nominal-predicted-variable.html#cb2235-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">ndraws =</span> <span class="dv">100</span>, </span>
<span id="cb2235-17"><a href="nominal-predicted-variable.html#cb2235-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb2235-18"><a href="nominal-predicted-variable.html#cb2235-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">fatten =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-41-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>So far all of this has been with the conditional logistic model based on the first hierarchy of two-set divisions, which Kruschke used to simulate the <code>d3</code> data. Now we’ll switch to consider the second hierarchy of two-set divisions, with which Kruschke simulated the <code>d4</code> data. That second hierarchy, recall, resulted in the following definition for the conditional probabilities for the four levels of <code>Y</code>:</p>
<p><span class="math display">\[
\begin{align*}
\phi_1 &amp; = \phi_{\{ 1 \} | \{ 1,2 \}} \cdot \phi_{\{ 1,2 \} | \{ 1,2,3,4 \}} \\
\phi_2 &amp; = \left ( 1 - \phi_{\{ 1 \} | \{ 1,2 \}} \right) \cdot \phi_{\{ 1,2 \} | \{ 1,2,3,4 \}} \\
\phi_3 &amp; = \phi_{\{ 3 \} | \{ 3,4 \}} \cdot \left ( 1 - \phi_{\{ 1,2 \} | \{ 1,2,3,4 \}} \right) \\
\phi_4 &amp; = \left ( 1 - \phi_{\{ 3 \} | \{ 3,4 \}} \right) \cdot \left ( 1 - \phi_{\{ 1,2 \} | \{ 1,2,3,4 \}} \right).
\end{align*}
\]</span></p>
<p>This will require us to define a new custom family, which we’ll call <code>cond_log_2</code>.</p>
<div class="sourceCode" id="cb2236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2236-1"><a href="nominal-predicted-variable.html#cb2236-1" aria-hidden="true" tabindex="-1"></a>cond_log_2 <span class="ot">&lt;-</span> <span class="fu">custom_family</span>(</span>
<span id="cb2236-2"><a href="nominal-predicted-variable.html#cb2236-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name     =</span> <span class="st">&quot;cond_log_2&quot;</span>, </span>
<span id="cb2236-3"><a href="nominal-predicted-variable.html#cb2236-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpars    =</span> <span class="fu">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;mub&quot;</span>, <span class="st">&quot;muc&quot;</span>), </span>
<span id="cb2236-4"><a href="nominal-predicted-variable.html#cb2236-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">links    =</span> <span class="st">&quot;identity&quot;</span>, </span>
<span id="cb2236-5"><a href="nominal-predicted-variable.html#cb2236-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type     =</span> <span class="st">&quot;int&quot;</span>,</span>
<span id="cb2236-6"><a href="nominal-predicted-variable.html#cb2236-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars     =</span> <span class="fu">c</span>(<span class="st">&quot;n_cat&quot;</span>),</span>
<span id="cb2236-7"><a href="nominal-predicted-variable.html#cb2236-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">specials =</span> <span class="st">&quot;categorical&quot;</span></span>
<span id="cb2236-8"><a href="nominal-predicted-variable.html#cb2236-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Next, we use the <code>stanvar()</code> function to define our custom probability mass function and the corresponding function that will allow us to return predictions, which we’ll just save as <code>stan_lpmf_2</code>. Other than the names, notice that the major change is how we have defined the <code>prob[i]</code> parameters.</p>
<div class="sourceCode" id="cb2237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2237-1"><a href="nominal-predicted-variable.html#cb2237-1" aria-hidden="true" tabindex="-1"></a>stan_lpmf_2 <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="at">block =</span> <span class="st">&quot;functions&quot;</span>, </span>
<span id="cb2237-2"><a href="nominal-predicted-variable.html#cb2237-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">scode =</span> <span class="st">&quot;</span></span>
<span id="cb2237-3"><a href="nominal-predicted-variable.html#cb2237-3" aria-hidden="true" tabindex="-1"></a><span class="st">real cond_log_2_lpmf(int y, real mu, real mu_b, real mu_c, int n_cat) {</span></span>
<span id="cb2237-4"><a href="nominal-predicted-variable.html#cb2237-4" aria-hidden="true" tabindex="-1"></a><span class="st">  real p_mu  = inv_logit(mu);</span></span>
<span id="cb2237-5"><a href="nominal-predicted-variable.html#cb2237-5" aria-hidden="true" tabindex="-1"></a><span class="st">  real p_mub = inv_logit(mu_b);</span></span>
<span id="cb2237-6"><a href="nominal-predicted-variable.html#cb2237-6" aria-hidden="true" tabindex="-1"></a><span class="st">  real p_muc = inv_logit(mu_c);</span></span>
<span id="cb2237-7"><a href="nominal-predicted-variable.html#cb2237-7" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[n_cat] prob;</span></span>
<span id="cb2237-8"><a href="nominal-predicted-variable.html#cb2237-8" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[1] = p_mub * p_mu;</span></span>
<span id="cb2237-9"><a href="nominal-predicted-variable.html#cb2237-9" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[2] = (1 - p_mub) * p_mu;</span></span>
<span id="cb2237-10"><a href="nominal-predicted-variable.html#cb2237-10" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[3] = p_muc * (1 - p_mu);</span></span>
<span id="cb2237-11"><a href="nominal-predicted-variable.html#cb2237-11" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[4] = (1 - p_muc) * (1 - p_mu);</span></span>
<span id="cb2237-12"><a href="nominal-predicted-variable.html#cb2237-12" aria-hidden="true" tabindex="-1"></a><span class="st">  return(categorical_lpmf(y | prob));</span></span>
<span id="cb2237-13"><a href="nominal-predicted-variable.html#cb2237-13" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb2237-14"><a href="nominal-predicted-variable.html#cb2237-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2237-15"><a href="nominal-predicted-variable.html#cb2237-15" aria-hidden="true" tabindex="-1"></a><span class="st">vector cond_log_2_pred(int y, real mu, real mu_b, real mu_c, int n_cat) {</span></span>
<span id="cb2237-16"><a href="nominal-predicted-variable.html#cb2237-16" aria-hidden="true" tabindex="-1"></a><span class="st">  real p_mu  = inv_logit(mu);</span></span>
<span id="cb2237-17"><a href="nominal-predicted-variable.html#cb2237-17" aria-hidden="true" tabindex="-1"></a><span class="st">  real p_mub = inv_logit(mu_b);</span></span>
<span id="cb2237-18"><a href="nominal-predicted-variable.html#cb2237-18" aria-hidden="true" tabindex="-1"></a><span class="st">  real p_muc = inv_logit(mu_c);</span></span>
<span id="cb2237-19"><a href="nominal-predicted-variable.html#cb2237-19" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[n_cat] prob;</span></span>
<span id="cb2237-20"><a href="nominal-predicted-variable.html#cb2237-20" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[1] = p_mub * p_mu;</span></span>
<span id="cb2237-21"><a href="nominal-predicted-variable.html#cb2237-21" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[2] = (1 - p_mub) * p_mu;</span></span>
<span id="cb2237-22"><a href="nominal-predicted-variable.html#cb2237-22" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[3] = p_muc * (1 - p_mu);</span></span>
<span id="cb2237-23"><a href="nominal-predicted-variable.html#cb2237-23" aria-hidden="true" tabindex="-1"></a><span class="st">  prob[4] = (1 - p_muc) * (1 - p_mu);</span></span>
<span id="cb2237-24"><a href="nominal-predicted-variable.html#cb2237-24" aria-hidden="true" tabindex="-1"></a><span class="st">  return(prob);</span></span>
<span id="cb2237-25"><a href="nominal-predicted-variable.html#cb2237-25" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb2237-26"><a href="nominal-predicted-variable.html#cb2237-26" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>) </span></code></pre></div>
<p>Now we’re ready to fit the model with <code>brm()</code>. Again, notice how our use of the <code>family</code> and <code>stanvars</code> functions.</p>
<div class="sourceCode" id="cb2238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2238-1"><a href="nominal-predicted-variable.html#cb2238-1" aria-hidden="true" tabindex="-1"></a>fit22<span class="fl">.4</span> <span class="ot">&lt;-</span></span>
<span id="cb2238-2"><a href="nominal-predicted-variable.html#cb2238-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d4, </span>
<span id="cb2238-3"><a href="nominal-predicted-variable.html#cb2238-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> cond_log_2,</span>
<span id="cb2238-4"><a href="nominal-predicted-variable.html#cb2238-4" aria-hidden="true" tabindex="-1"></a>      Y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> X1 <span class="sc">+</span> X2,</span>
<span id="cb2238-5"><a href="nominal-predicted-variable.html#cb2238-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb2238-6"><a href="nominal-predicted-variable.html#cb2238-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept, <span class="at">dpar =</span> mub),</span>
<span id="cb2238-7"><a href="nominal-predicted-variable.html#cb2238-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept, <span class="at">dpar =</span> muc),</span>
<span id="cb2238-8"><a href="nominal-predicted-variable.html#cb2238-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> b),</span>
<span id="cb2238-9"><a href="nominal-predicted-variable.html#cb2238-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> b, <span class="at">dpar =</span> mub),</span>
<span id="cb2238-10"><a href="nominal-predicted-variable.html#cb2238-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> b, <span class="at">dpar =</span> muc)),</span>
<span id="cb2238-11"><a href="nominal-predicted-variable.html#cb2238-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb2238-12"><a href="nominal-predicted-variable.html#cb2238-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">22</span>,</span>
<span id="cb2238-13"><a href="nominal-predicted-variable.html#cb2238-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">stanvars =</span> stan_lpmf_2 <span class="sc">+</span> stanvars,</span>
<span id="cb2238-14"><a href="nominal-predicted-variable.html#cb2238-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit22.04&quot;</span>)</span></code></pre></div>
<p>Check the model summary.</p>
<div class="sourceCode" id="cb2239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2239-1"><a href="nominal-predicted-variable.html#cb2239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit22<span class="fl">.4</span>)</span></code></pre></div>
<pre><code>##  Family: cond_log_2 
##   Links: mu = identity; mub = identity; muc = identity 
## Formula: Y ~ 1 + X1 + X2 
##    Data: d4 (Number of observations: 475) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept        -4.06      0.46    -5.03    -3.22 1.00     2431     2044
## mub_Intercept    -1.40      1.21    -3.86     0.93 1.00     2543     1878
## muc_Intercept    -1.03      0.24    -1.51    -0.58 1.00     2945     2658
## X1               -4.80      0.51    -5.87    -3.87 1.00     2420     2016
## X2                0.36      0.20    -0.03     0.74 1.00     4353     2921
## mub_X1            1.54      0.90    -0.15     3.44 1.00     2675     2365
## mub_X2           -5.37      1.18    -8.07    -3.36 1.00     2927     1298
## muc_X1            3.03      0.39     2.32     3.82 1.00     2386     2232
## muc_X2            3.13      0.36     2.47     3.88 1.00     2649     2446
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>We can use the same basic workflow as before to make our version of the upper half of Figure 22.7.</p>
<div class="sourceCode" id="cb2241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2241-1"><a href="nominal-predicted-variable.html#cb2241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the posterior draws</span></span>
<span id="cb2241-2"><a href="nominal-predicted-variable.html#cb2241-2" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit22<span class="fl">.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2241-3"><a href="nominal-predicted-variable.html#cb2241-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># like before, let&#39;s adjust the column names</span></span>
<span id="cb2241-4"><a href="nominal-predicted-variable.html#cb2241-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">a_Intercept =</span> b_Intercept,</span>
<span id="cb2241-5"><a href="nominal-predicted-variable.html#cb2241-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">b_Intercept =</span> b_mub_Intercept,</span>
<span id="cb2241-6"><a href="nominal-predicted-variable.html#cb2241-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">c_Intercept =</span> b_muc_Intercept,</span>
<span id="cb2241-7"><a href="nominal-predicted-variable.html#cb2241-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">a_X1 =</span> b_X1,</span>
<span id="cb2241-8"><a href="nominal-predicted-variable.html#cb2241-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">a_X2 =</span> b_X2,</span>
<span id="cb2241-9"><a href="nominal-predicted-variable.html#cb2241-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">b_X1 =</span> b_mub_X1,</span>
<span id="cb2241-10"><a href="nominal-predicted-variable.html#cb2241-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">b_X2 =</span> b_mub_X2,</span>
<span id="cb2241-11"><a href="nominal-predicted-variable.html#cb2241-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">c_X1 =</span> b_muc_X1,</span>
<span id="cb2241-12"><a href="nominal-predicted-variable.html#cb2241-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">c_X2 =</span> b_muc_X2)</span>
<span id="cb2241-13"><a href="nominal-predicted-variable.html#cb2241-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2241-14"><a href="nominal-predicted-variable.html#cb2241-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2D thresholds on the left</span></span>
<span id="cb2241-15"><a href="nominal-predicted-variable.html#cb2241-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">22</span>)</span>
<span id="cb2241-16"><a href="nominal-predicted-variable.html#cb2241-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2241-17"><a href="nominal-predicted-variable.html#cb2241-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb2241-18"><a href="nominal-predicted-variable.html#cb2241-18" aria-hidden="true" tabindex="-1"></a>  draws <span class="sc">%&gt;%</span> </span>
<span id="cb2241-19"><a href="nominal-predicted-variable.html#cb2241-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2241-20"><a href="nominal-predicted-variable.html#cb2241-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(a_Intercept<span class="sc">:</span>c_X2) <span class="sc">%&gt;%</span> </span>
<span id="cb2241-21"><a href="nominal-predicted-variable.html#cb2241-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;parameter&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2241-22"><a href="nominal-predicted-variable.html#cb2241-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> parameter, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb2241-23"><a href="nominal-predicted-variable.html#cb2241-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intercept =</span> <span class="sc">-</span>Intercept <span class="sc">/</span> X2,</span>
<span id="cb2241-24"><a href="nominal-predicted-variable.html#cb2241-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">slope     =</span> <span class="sc">-</span>X1 <span class="sc">/</span> X2) <span class="sc">%&gt;%</span> </span>
<span id="cb2241-25"><a href="nominal-predicted-variable.html#cb2241-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2241-26"><a href="nominal-predicted-variable.html#cb2241-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2241-27"><a href="nominal-predicted-variable.html#cb2241-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> d4,</span>
<span id="cb2241-28"><a href="nominal-predicted-variable.html#cb2241-28" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2, <span class="at">label =</span> Y, <span class="at">color =</span> <span class="fu">factor</span>(Y)),</span>
<span id="cb2241-29"><a href="nominal-predicted-variable.html#cb2241-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb2241-30"><a href="nominal-predicted-variable.html#cb2241-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> intercept,</span>
<span id="cb2241-31"><a href="nominal-predicted-variable.html#cb2241-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope =</span> slope,</span>
<span id="cb2241-32"><a href="nominal-predicted-variable.html#cb2241-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">group =</span> <span class="fu">interaction</span>(.draw, mu),</span>
<span id="cb2241-33"><a href="nominal-predicted-variable.html#cb2241-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> mu),</span>
<span id="cb2241-34"><a href="nominal-predicted-variable.html#cb2241-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2241-35"><a href="nominal-predicted-variable.html#cb2241-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pl[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb2241-36"><a href="nominal-predicted-variable.html#cb2241-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="cn">NULL</span>,</span>
<span id="cb2241-37"><a href="nominal-predicted-variable.html#cb2241-37" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labels =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">c</span>(</span>
<span id="cb2241-38"><a href="nominal-predicted-variable.html#cb2241-38" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{1,2}|{1,2,3,4}&#39;]&quot;</span>, </span>
<span id="cb2241-39"><a href="nominal-predicted-variable.html#cb2241-39" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{1}|{1,2}&#39;]&quot;</span>, </span>
<span id="cb2241-40"><a href="nominal-predicted-variable.html#cb2241-40" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{3}|{3,4}&#39;]&quot;</span>)),</span>
<span id="cb2241-41"><a href="nominal-predicted-variable.html#cb2241-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">guide =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb2241-42"><a href="nominal-predicted-variable.html#cb2241-42" aria-hidden="true" tabindex="-1"></a>                   <span class="at">direction =</span> <span class="st">&quot;vertical&quot;</span>,</span>
<span id="cb2241-43"><a href="nominal-predicted-variable.html#cb2241-43" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb2241-44"><a href="nominal-predicted-variable.html#cb2241-44" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.theme =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))) <span class="sc">+</span></span>
<span id="cb2241-45"><a href="nominal-predicted-variable.html#cb2241-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(x[<span class="dv">1</span>]),</span>
<span id="cb2241-46"><a href="nominal-predicted-variable.html#cb2241-46" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(x[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb2241-47"><a href="nominal-predicted-variable.html#cb2241-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.justification =</span> <span class="fl">0.5</span>,</span>
<span id="cb2241-48"><a href="nominal-predicted-variable.html#cb2241-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb2241-49"><a href="nominal-predicted-variable.html#cb2241-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2241-50"><a href="nominal-predicted-variable.html#cb2241-50" aria-hidden="true" tabindex="-1"></a><span class="co"># marginal posteriors on the right</span></span>
<span id="cb2241-51"><a href="nominal-predicted-variable.html#cb2241-51" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb2241-52"><a href="nominal-predicted-variable.html#cb2241-52" aria-hidden="true" tabindex="-1"></a>  draws <span class="sc">%&gt;%</span> </span>
<span id="cb2241-53"><a href="nominal-predicted-variable.html#cb2241-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(a_Intercept<span class="sc">:</span>c_X2) <span class="sc">%&gt;%</span> </span>
<span id="cb2241-54"><a href="nominal-predicted-variable.html#cb2241-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda    =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name, <span class="st">&quot;a_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;lambda[&#39;{1,2}|{1,2,3,4}&#39;]&quot;</span>,</span>
<span id="cb2241-55"><a href="nominal-predicted-variable.html#cb2241-55" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(name, <span class="st">&quot;b_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;lambda[&#39;{1}|{1,2}&#39;]&quot;</span>,</span>
<span id="cb2241-56"><a href="nominal-predicted-variable.html#cb2241-56" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(name, <span class="st">&quot;c_&quot;</span>) <span class="sc">~</span> <span class="st">&quot;lambda[&#39;{3}|{3,4}&#39;]&quot;</span>),</span>
<span id="cb2241-57"><a href="nominal-predicted-variable.html#cb2241-57" aria-hidden="true" tabindex="-1"></a>         <span class="at">parameter =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(name, <span class="st">&quot;Intercept&quot;</span>) <span class="sc">~</span> <span class="st">&quot;beta[0]&quot;</span>,</span>
<span id="cb2241-58"><a href="nominal-predicted-variable.html#cb2241-58" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(name, <span class="st">&quot;X1&quot;</span>)        <span class="sc">~</span> <span class="st">&quot;beta[1]&quot;</span>,</span>
<span id="cb2241-59"><a href="nominal-predicted-variable.html#cb2241-59" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_detect</span>(name, <span class="st">&quot;X2&quot;</span>)        <span class="sc">~</span> <span class="st">&quot;beta[2]&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2241-60"><a href="nominal-predicted-variable.html#cb2241-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2241-61"><a href="nominal-predicted-variable.html#cb2241-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb2241-62"><a href="nominal-predicted-variable.html#cb2241-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2241-63"><a href="nominal-predicted-variable.html#cb2241-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_histinterval</span>(<span class="at">point_interval =</span> mode_hdi, <span class="at">.width =</span> .<span class="dv">95</span>,</span>
<span id="cb2241-64"><a href="nominal-predicted-variable.html#cb2241-64" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> pl[<span class="dv">4</span>], <span class="at">slab_color =</span> pl[<span class="dv">3</span>], <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">point_color =</span> pl[<span class="dv">2</span>],</span>
<span id="cb2241-65"><a href="nominal-predicted-variable.html#cb2241-65" aria-hidden="true" tabindex="-1"></a>                    <span class="at">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="sc">+</span></span>
<span id="cb2241-66"><a href="nominal-predicted-variable.html#cb2241-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2241-67"><a href="nominal-predicted-variable.html#cb2241-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;marginal posterior&quot;</span>) <span class="sc">+</span></span>
<span id="cb2241-68"><a href="nominal-predicted-variable.html#cb2241-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(lambda <span class="sc">~</span> parameter, <span class="at">labeller =</span> label_parsed, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>)</span>
<span id="cb2241-69"><a href="nominal-predicted-variable.html#cb2241-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2241-70"><a href="nominal-predicted-variable.html#cb2241-70" aria-hidden="true" tabindex="-1"></a><span class="co"># combine, entitle, and display the results</span></span>
<span id="cb2241-71"><a href="nominal-predicted-variable.html#cb2241-71" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">&amp;</span> </span>
<span id="cb2241-72"><a href="nominal-predicted-variable.html#cb2241-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">&amp;</span></span>
<span id="cb2241-73"><a href="nominal-predicted-variable.html#cb2241-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Figure 22.7, upper half&quot;</span>,</span>
<span id="cb2241-74"><a href="nominal-predicted-variable.html#cb2241-74" aria-hidden="true" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">&quot;Results from the conditional logistic model fit to the d4 data via the custom-family approach&quot;</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-45-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>As Kruschke pointed out in the text,</p>
<blockquote>
<p>notice that the estimates for <span class="math inline">\(\lambda_2\)</span> are more uncertain, with wider HDI’s, than the other coefficients. This uncertainty is also shown in the threshold lines on the data: The lines separating the <span class="math inline">\(1\)</span>’s from the <span class="math inline">\(2\)</span>’s have a much wider spread than the other boundaries. Inspection of the scatter plot explains why: There is only a small zone of data that informs the separation of <span class="math inline">\(1\)</span>’s from <span class="math inline">\(2\)</span>’s, and therefore the estimate must be relatively ambiguous. (p. 665)</p>
</blockquote>
<p>I’m not going to go through a full demonstration like before, but if you want to use more <strong>brms</strong> post processing functions for <code>fit22.4</code> or any other model fit with our custom <code>cond_log_2</code> function, you’d need to execute this block of code first. Then post process to your heart’s desire.</p>
<div class="sourceCode" id="cb2242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2242-1"><a href="nominal-predicted-variable.html#cb2242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expose_functions</span>(fit22<span class="fl">.4</span>, <span class="at">vectorize =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2242-2"><a href="nominal-predicted-variable.html#cb2242-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2242-3"><a href="nominal-predicted-variable.html#cb2242-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for information criteria</span></span>
<span id="cb2242-4"><a href="nominal-predicted-variable.html#cb2242-4" aria-hidden="true" tabindex="-1"></a>log_lik_cond_log_2 <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep) {</span>
<span id="cb2242-5"><a href="nominal-predicted-variable.html#cb2242-5" aria-hidden="true" tabindex="-1"></a>  mu  <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;mu&quot;</span>, <span class="at">i =</span> i)</span>
<span id="cb2242-6"><a href="nominal-predicted-variable.html#cb2242-6" aria-hidden="true" tabindex="-1"></a>  mub <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;mub&quot;</span>, <span class="at">i =</span> i)</span>
<span id="cb2242-7"><a href="nominal-predicted-variable.html#cb2242-7" aria-hidden="true" tabindex="-1"></a>  muc <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;muc&quot;</span>, <span class="at">i =</span> i)</span>
<span id="cb2242-8"><a href="nominal-predicted-variable.html#cb2242-8" aria-hidden="true" tabindex="-1"></a>  n_cat <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>n_cat</span>
<span id="cb2242-9"><a href="nominal-predicted-variable.html#cb2242-9" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>Y[i]</span>
<span id="cb2242-10"><a href="nominal-predicted-variable.html#cb2242-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cond_log_2_lpmf</span>(y, mu, mub, muc, n_cat)</span>
<span id="cb2242-11"><a href="nominal-predicted-variable.html#cb2242-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2242-12"><a href="nominal-predicted-variable.html#cb2242-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2242-13"><a href="nominal-predicted-variable.html#cb2242-13" aria-hidden="true" tabindex="-1"></a><span class="co"># for conditional expectations</span></span>
<span id="cb2242-14"><a href="nominal-predicted-variable.html#cb2242-14" aria-hidden="true" tabindex="-1"></a>posterior_epred_cond_log_2 <span class="ot">&lt;-</span> <span class="cf">function</span>(prep) {</span>
<span id="cb2242-15"><a href="nominal-predicted-variable.html#cb2242-15" aria-hidden="true" tabindex="-1"></a>  mu   <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;mu&quot;</span>)</span>
<span id="cb2242-16"><a href="nominal-predicted-variable.html#cb2242-16" aria-hidden="true" tabindex="-1"></a>  mu_b <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;mub&quot;</span>)</span>
<span id="cb2242-17"><a href="nominal-predicted-variable.html#cb2242-17" aria-hidden="true" tabindex="-1"></a>  mu_c <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;muc&quot;</span>)</span>
<span id="cb2242-18"><a href="nominal-predicted-variable.html#cb2242-18" aria-hidden="true" tabindex="-1"></a>  n_cat <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>n_cat</span>
<span id="cb2242-19"><a href="nominal-predicted-variable.html#cb2242-19" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>Y</span>
<span id="cb2242-20"><a href="nominal-predicted-variable.html#cb2242-20" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">&lt;-</span> <span class="fu">cond_log_2_pred</span>(<span class="at">y =</span> y, <span class="at">mu =</span> mu, <span class="at">mu_b =</span> mu_b, <span class="at">mu_c =</span> mu_c, <span class="at">n_cat =</span> n_cat)</span>
<span id="cb2242-21"><a href="nominal-predicted-variable.html#cb2242-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(prob) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">dim</span>(prob)[<span class="dv">1</span>], <span class="fu">dim</span>(mu))</span>
<span id="cb2242-22"><a href="nominal-predicted-variable.html#cb2242-22" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">&lt;-</span> <span class="fu">aperm</span>(prob, <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb2242-23"><a href="nominal-predicted-variable.html#cb2242-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(prob) <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2242-24"><a href="nominal-predicted-variable.html#cb2242-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(<span class="fu">seq_len</span>(<span class="fu">dim</span>(prob)[<span class="dv">1</span>])), </span>
<span id="cb2242-25"><a href="nominal-predicted-variable.html#cb2242-25" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NULL</span>, </span>
<span id="cb2242-26"><a href="nominal-predicted-variable.html#cb2242-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(<span class="fu">seq_len</span>(<span class="fu">dim</span>(prob)[<span class="dv">3</span>]))</span>
<span id="cb2242-27"><a href="nominal-predicted-variable.html#cb2242-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2242-28"><a href="nominal-predicted-variable.html#cb2242-28" aria-hidden="true" tabindex="-1"></a>  prob</span>
<span id="cb2242-29"><a href="nominal-predicted-variable.html#cb2242-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2242-30"><a href="nominal-predicted-variable.html#cb2242-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2242-31"><a href="nominal-predicted-variable.html#cb2242-31" aria-hidden="true" tabindex="-1"></a><span class="co"># for posterior predictions</span></span>
<span id="cb2242-32"><a href="nominal-predicted-variable.html#cb2242-32" aria-hidden="true" tabindex="-1"></a>posterior_predict_cond_log_2 <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep, ...) {</span>
<span id="cb2242-33"><a href="nominal-predicted-variable.html#cb2242-33" aria-hidden="true" tabindex="-1"></a>  mu   <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;mu&quot;</span>, <span class="at">i =</span> i)</span>
<span id="cb2242-34"><a href="nominal-predicted-variable.html#cb2242-34" aria-hidden="true" tabindex="-1"></a>  mu_b <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;mub&quot;</span>, <span class="at">i =</span> i)</span>
<span id="cb2242-35"><a href="nominal-predicted-variable.html#cb2242-35" aria-hidden="true" tabindex="-1"></a>  mu_c <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">&quot;muc&quot;</span>, <span class="at">i =</span> i)</span>
<span id="cb2242-36"><a href="nominal-predicted-variable.html#cb2242-36" aria-hidden="true" tabindex="-1"></a>  n_cat <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>n_cat</span>
<span id="cb2242-37"><a href="nominal-predicted-variable.html#cb2242-37" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>Y[i]</span>
<span id="cb2242-38"><a href="nominal-predicted-variable.html#cb2242-38" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">&lt;-</span> <span class="fu">cond_log_2_pred</span>(y, mu, mu_b, mu_c, n_cat)</span>
<span id="cb2242-39"><a href="nominal-predicted-variable.html#cb2242-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure you have the extraDistr package</span></span>
<span id="cb2242-40"><a href="nominal-predicted-variable.html#cb2242-40" aria-hidden="true" tabindex="-1"></a>  extraDistr<span class="sc">::</span><span class="fu">rcat</span>(<span class="fu">length</span>(mu), <span class="fu">t</span>(prob))</span>
<span id="cb2242-41"><a href="nominal-predicted-variable.html#cb2242-41" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In this section of the text, Kruschke also showed the results of when he analyzed the two data sets with the non-data-generating likelihoods. In the lower half of Figure 22.6, he showed the results of his second version of the conditional logistic model applied to the <code>d3</code> data. In the lower half of Figure 22.7, he showed the results of his first version of the conditional logistic model applied to the <code>d4</code> data. Since this section is already complicated enough, we’re not going to do that. But if you’d like to see what happens, consider it a personal homework assignment.</p>
<blockquote>
<p>In principle, the different conditional logistic models could be put into an overarching hierarchical model comparison. If you have only a few specific candidate models to compare, this could be a feasible approach. But it is not an easily pursued approach to selecting a partition of outcomes from all possible partitions of outcomes when there are many outcomes… Therefore, it is typical to consider a single model, or small set of models, that are motivated by being meaningful in the context of the application, and interpreting the parameter estimates in that meaningful context. (p. 667)</p>
</blockquote>
<p>Kruschke finished this section with:</p>
<blockquote>
<p>Finally, when you run the models in JAGS, you may find that there is high autocorrelation in the MCMC chains (even with standardized data), which requires a very long chain for adequate ESS. This suggests that Stan might be a more efficient approach.</p>
</blockquote>
<p>Since we fit our models with Stan via <strong>brms</strong>, high autocorrelations and low effective sample sizes weren’t a problem. For example, here are the bulk and tail effective sample sizes for both of our two models.</p>
<div class="sourceCode" id="cb2243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2243-1"><a href="nominal-predicted-variable.html#cb2243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb2243-2"><a href="nominal-predicted-variable.html#cb2243-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2243-3"><a href="nominal-predicted-variable.html#cb2243-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb2243-4"><a href="nominal-predicted-variable.html#cb2243-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(fit22<span class="fl">.3</span>) <span class="sc">%&gt;%</span> <span class="fu">summarise_draws</span>(),</span>
<span id="cb2243-5"><a href="nominal-predicted-variable.html#cb2243-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(fit22<span class="fl">.4</span>) <span class="sc">%&gt;%</span> <span class="fu">summarise_draws</span>()</span>
<span id="cb2243-6"><a href="nominal-predicted-variable.html#cb2243-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2243-7"><a href="nominal-predicted-variable.html#cb2243-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;fit22.3&quot;</span>, <span class="st">&quot;fit22.4&quot;</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2243-8"><a href="nominal-predicted-variable.html#cb2243-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;ess&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2243-9"><a href="nominal-predicted-variable.html#cb2243-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2243-10"><a href="nominal-predicted-variable.html#cb2243-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb2243-11"><a href="nominal-predicted-variable.html#cb2243-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dotplot</span>(<span class="at">binwidth =</span> <span class="dv">325</span>, <span class="at">color =</span> pl[<span class="dv">8</span>], <span class="at">fill =</span> pl[<span class="dv">5</span>], <span class="at">stroke =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2243-12"><a href="nominal-predicted-variable.html#cb2243-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2243-13"><a href="nominal-predicted-variable.html#cb2243-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb2243-14"><a href="nominal-predicted-variable.html#cb2243-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(fit <span class="sc">~</span> name) <span class="sc">+</span></span>
<span id="cb2243-15"><a href="nominal-predicted-variable.html#cb2243-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>))</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-47-1.png" width="528" style="display: block; margin: auto;" /></p>
<p>The values look pretty good. We may as well look at the autocorrelations. To keep things simple, this time we’ll restrict our analysis to <code>fit22.4</code>. [The results are largely the same for <code>fit22.3</code>.]</p>
<div class="sourceCode" id="cb2244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2244-1"><a href="nominal-predicted-variable.html#cb2244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb2244-2"><a href="nominal-predicted-variable.html#cb2244-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2244-3"><a href="nominal-predicted-variable.html#cb2244-3" aria-hidden="true" tabindex="-1"></a>ac <span class="ot">&lt;-</span></span>
<span id="cb2244-4"><a href="nominal-predicted-variable.html#cb2244-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(fit22<span class="fl">.4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2244-5"><a href="nominal-predicted-variable.html#cb2244-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> .chain) <span class="sc">%&gt;%</span> </span>
<span id="cb2244-6"><a href="nominal-predicted-variable.html#cb2244-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_Intercept<span class="sc">:</span>b_muc_X2, chain) <span class="sc">%&gt;%</span> </span>
<span id="cb2244-7"><a href="nominal-predicted-variable.html#cb2244-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_acf</span>(<span class="at">lags =</span> <span class="dv">5</span>)</span>
<span id="cb2244-8"><a href="nominal-predicted-variable.html#cb2244-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2244-9"><a href="nominal-predicted-variable.html#cb2244-9" aria-hidden="true" tabindex="-1"></a>ac<span class="sc">$</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb2244-10"><a href="nominal-predicted-variable.html#cb2244-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Lag <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2244-11"><a href="nominal-predicted-variable.html#cb2244-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2244-12"><a href="nominal-predicted-variable.html#cb2244-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> AC)) <span class="sc">+</span></span>
<span id="cb2244-13"><a href="nominal-predicted-variable.html#cb2244-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb2244-14"><a href="nominal-predicted-variable.html#cb2244-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dotplot</span>(<span class="at">binwidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">14</span>, <span class="at">color =</span> pl[<span class="dv">8</span>], <span class="at">fill =</span> pl[<span class="dv">5</span>], <span class="at">stroke =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2244-15"><a href="nominal-predicted-variable.html#cb2244-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;autocorrelation&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb2244-16"><a href="nominal-predicted-variable.html#cb2244-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;-1&quot;</span>, <span class="st">&quot;-.5&quot;</span>, <span class="st">&quot;0&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;1&quot;</span>)) <span class="sc">+</span></span>
<span id="cb2244-17"><a href="nominal-predicted-variable.html#cb2244-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2244-18"><a href="nominal-predicted-variable.html#cb2244-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Lag <span class="sc">~</span> Chain, <span class="at">labeller =</span> label_both)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-48-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>On the whole, the autocorrelations are reasonably low across all parameters, chains, and lags.</p>
</div>
<div id="conditional-logistic-models-by-sequential-ordinal-regression." class="section level5 hasAnchor" number="22.3.3.2.2">
<h5><span class="header-section-number">22.3.3.2.2</span> Conditional logistic models by sequential ordinal regression.<a href="nominal-predicted-variable.html#conditional-logistic-models-by-sequential-ordinal-regression." class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>In their <span class="citation">(<a href="#ref-burknerOrdinalRegressionModels2019" role="doc-biblioref">2019</a>)</span> paper, <a href="https://psyarxiv.com/x8swp/"><em>Ordinal regression models in psychology: A tutorial</em></a>, Bürkner and Vourre outlined a framework for fitting a variety of orginal models with <strong>brms</strong>. We’ll learn more about ordinal models in <a href="ordinal-predicted-variable.html#ordinal-predicted-variable">Chapter 23</a>. In this section, we’ll use Mattan Ben-Shachar’s strategy and purpose one of the ordinal models to fit a conditional logistic model to our nominal data.</p>
<p>As outlined in <span class="citation">Bürkner &amp; Vuorre (<a href="#ref-burknerOrdinalRegressionModels2019" role="doc-biblioref">2019</a>)</span>, and as we will learn in greater detain in the next chapter, many ordinal regression models presume an underlying continuous process. However, you can use a sequential model in cases where one level of the criterion is only possible after the lower levels of the criterion have been achieved. Although this is not technically correct for the nominal variable <code>Y</code> in the <code>d3</code> data set, the simple hierarchical sequence Kruschke used to model those data does follow that same pattern. Ben-Shachar’s insight was that if we treat our nominal variable <code>Y</code> as ordinal, the sequential model will mimic the sequential-ness of Kruschke’s binary-choices hierarchy. To get this to work, we first have to save an ordinal version of <code>Y</code>, which we’ll call <code>Y_ord</code>.</p>
<div class="sourceCode" id="cb2245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2245-1"><a href="nominal-predicted-variable.html#cb2245-1" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span></span>
<span id="cb2245-2"><a href="nominal-predicted-variable.html#cb2245-2" aria-hidden="true" tabindex="-1"></a>  d3 <span class="sc">%&gt;%</span> </span>
<span id="cb2245-3"><a href="nominal-predicted-variable.html#cb2245-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y_ord =</span> <span class="fu">ordered</span>(Y))</span>
<span id="cb2245-4"><a href="nominal-predicted-variable.html#cb2245-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2245-5"><a href="nominal-predicted-variable.html#cb2245-5" aria-hidden="true" tabindex="-1"></a><span class="co"># what are the new attributes?</span></span>
<span id="cb2245-6"><a href="nominal-predicted-variable.html#cb2245-6" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(d3<span class="sc">$</span>Y_ord)</span></code></pre></div>
<pre><code>## $levels
## [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot;
## 
## $class
## [1] &quot;ordered&quot; &quot;factor&quot;</code></pre>
<p>Within <code>brm()</code> we fit sequential models using <code>family = sratio</code>, which defaults to the logit link. If you want to use predictors in a model of this kind and you would like those coefficients to vary across the different levels of the criterion, you need to insert the predictor terms within the <code>cs()</code> function. Here’s how to fit the model with <code>brm()</code>.</p>
<div class="sourceCode" id="cb2247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2247-1"><a href="nominal-predicted-variable.html#cb2247-1" aria-hidden="true" tabindex="-1"></a>fit22<span class="fl">.5</span> <span class="ot">&lt;-</span></span>
<span id="cb2247-2"><a href="nominal-predicted-variable.html#cb2247-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d3, </span>
<span id="cb2247-3"><a href="nominal-predicted-variable.html#cb2247-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> sratio,</span>
<span id="cb2247-4"><a href="nominal-predicted-variable.html#cb2247-4" aria-hidden="true" tabindex="-1"></a>      Y_ord <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">cs</span>(X1) <span class="sc">+</span> <span class="fu">cs</span>(X2),</span>
<span id="cb2247-5"><a href="nominal-predicted-variable.html#cb2247-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb2247-6"><a href="nominal-predicted-variable.html#cb2247-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> b)),</span>
<span id="cb2247-7"><a href="nominal-predicted-variable.html#cb2247-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb2247-8"><a href="nominal-predicted-variable.html#cb2247-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">22</span>,</span>
<span id="cb2247-9"><a href="nominal-predicted-variable.html#cb2247-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit22.05&quot;</span>)</span></code></pre></div>
<p>Check the model summary.</p>
<div class="sourceCode" id="cb2248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2248-1"><a href="nominal-predicted-variable.html#cb2248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit22<span class="fl">.5</span>)</span></code></pre></div>
<pre><code>##  Family: sratio 
##   Links: mu = logit; disc = identity 
## Formula: Y_ord ~ 1 + cs(X1) + cs(X2) 
##    Data: d3 (Number of observations: 475) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept[1]    -4.01      0.45    -4.96    -3.22 1.00     3175     2508
## Intercept[2]    -2.13      0.37    -2.91    -1.47 1.00     2787     2545
## Intercept[3]    -0.96      0.33    -1.64    -0.36 1.00     2907     2690
## X1[1]            4.91      0.51     3.98     5.98 1.00     3171     2532
## X1[2]           -0.74      0.30    -1.34    -0.18 1.00     3524     2945
## X1[3]           -3.00      0.50    -4.08    -2.12 1.00     3315     2819
## X2[1]           -0.01      0.19    -0.40     0.37 1.00     4535     2885
## X2[2]            5.23      0.65     4.07     6.57 1.00     2869     2615
## X2[3]           -3.10      0.53    -4.21    -2.14 1.00     2876     2378
## 
## Family Specific Parameters: 
##      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## disc     1.00      0.00     1.00     1.00   NA       NA       NA
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>One thing that might not be apparent at first glance is that although this model is essentially equivalent to the <code>family = cond_log_1</code> version of the model we fit with <code>fit22.3</code>, above, the parameters are a little different. The intercepts are largely the same. However, the coefficients for the <code>X1</code> and <code>X2</code> predictors have switched signs. This will be easier to see with a coefficient plot comparing <code>fit22.3</code> and <code>fit22.5</code>.</p>
<div class="sourceCode" id="cb2250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2250-1"><a href="nominal-predicted-variable.html#cb2250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">fixef</span>(fit22<span class="fl">.3</span>)[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>), ], <span class="fu">fixef</span>(fit22<span class="fl">.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2250-2"><a href="nominal-predicted-variable.html#cb2250-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2250-3"><a href="nominal-predicted-variable.html#cb2250-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">beta =</span> <span class="fu">rep</span>(<span class="fu">str_c</span>(<span class="st">&quot;beta[&quot;</span>, <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>), <span class="st">&quot;]&quot;</span>), <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb2250-4"><a href="nominal-predicted-variable.html#cb2250-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">lambda =</span> <span class="fu">rep</span>(<span class="fu">str_c</span>(<span class="st">&quot;lambda==&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">times =</span> <span class="dv">3</span> <span class="sc">*</span> <span class="dv">2</span>),</span>
<span id="cb2250-5"><a href="nominal-predicted-variable.html#cb2250-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;cond_log_1&quot;</span>, <span class="st">&quot;sratio&quot;</span>), <span class="at">each =</span> <span class="dv">9</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2250-6"><a href="nominal-predicted-variable.html#cb2250-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2250-7"><a href="nominal-predicted-variable.html#cb2250-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb2250-8"><a href="nominal-predicted-variable.html#cb2250-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>, <span class="at">y =</span> family)) <span class="sc">+</span></span>
<span id="cb2250-9"><a href="nominal-predicted-variable.html#cb2250-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb2250-10"><a href="nominal-predicted-variable.html#cb2250-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">fatten =</span> <span class="dv">5</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb2250-11"><a href="nominal-predicted-variable.html#cb2250-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># stat_pointinterval(.width = .95, point_size = 1.5, size = 1) +</span></span>
<span id="cb2250-12"><a href="nominal-predicted-variable.html#cb2250-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;marginal posterior&quot;</span>,</span>
<span id="cb2250-13"><a href="nominal-predicted-variable.html#cb2250-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2250-14"><a href="nominal-predicted-variable.html#cb2250-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(lambda <span class="sc">~</span> beta, <span class="at">labeller =</span> label_parsed, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-51-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Even though the <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> parameters switched signs, their magnitudes are about the same. Thus, if we want to use our <code>fit22.5</code> to plot the thresholds as in Figure 22.6, we’ll have to update our threshold formula to</p>
<p><span class="math display">\[x_2 = (\color{#984136}{+\beta_0} / \beta_2) + (\beta_1 / \beta_2)x_1.\]</span></p>
<p>With that adjustment in line, here’s our updated version of the left panel of Figure 22.6.</p>
<div class="sourceCode" id="cb2251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2251-1"><a href="nominal-predicted-variable.html#cb2251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># no need to rename the columns, this time</span></span>
<span id="cb2251-2"><a href="nominal-predicted-variable.html#cb2251-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(fit22<span class="fl">.5</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb2251-3"><a href="nominal-predicted-variable.html#cb2251-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2251-4"><a href="nominal-predicted-variable.html#cb2251-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2251-5"><a href="nominal-predicted-variable.html#cb2251-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_remove</span>(name, <span class="st">&quot;b_&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(., <span class="st">&quot;bcs_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2251-6"><a href="nominal-predicted-variable.html#cb2251-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;parameter&quot;</span>, <span class="st">&quot;lambda&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2251-7"><a href="nominal-predicted-variable.html#cb2251-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> parameter, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb2251-8"><a href="nominal-predicted-variable.html#cb2251-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intercept =</span> Intercept <span class="sc">/</span> X2,</span>
<span id="cb2251-9"><a href="nominal-predicted-variable.html#cb2251-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">slope     =</span> <span class="sc">-</span>X1 <span class="sc">/</span> X2) <span class="sc">%&gt;%</span> </span>
<span id="cb2251-10"><a href="nominal-predicted-variable.html#cb2251-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2251-11"><a href="nominal-predicted-variable.html#cb2251-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2251-12"><a href="nominal-predicted-variable.html#cb2251-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> d3,</span>
<span id="cb2251-13"><a href="nominal-predicted-variable.html#cb2251-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2, <span class="at">label =</span> Y, <span class="at">color =</span> <span class="fu">factor</span>(Y)),</span>
<span id="cb2251-14"><a href="nominal-predicted-variable.html#cb2251-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb2251-15"><a href="nominal-predicted-variable.html#cb2251-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> intercept,</span>
<span id="cb2251-16"><a href="nominal-predicted-variable.html#cb2251-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope =</span> slope,</span>
<span id="cb2251-17"><a href="nominal-predicted-variable.html#cb2251-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">group =</span> <span class="fu">interaction</span>(.draw, lambda),</span>
<span id="cb2251-18"><a href="nominal-predicted-variable.html#cb2251-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> lambda),</span>
<span id="cb2251-19"><a href="nominal-predicted-variable.html#cb2251-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2251-20"><a href="nominal-predicted-variable.html#cb2251-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pl[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb2251-21"><a href="nominal-predicted-variable.html#cb2251-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="cn">NULL</span>,</span>
<span id="cb2251-22"><a href="nominal-predicted-variable.html#cb2251-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labels =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">c</span>(</span>
<span id="cb2251-23"><a href="nominal-predicted-variable.html#cb2251-23" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{1}|{1,2,3,4}&#39;]&quot;</span>, </span>
<span id="cb2251-24"><a href="nominal-predicted-variable.html#cb2251-24" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{2}|{2,3,4}&#39;]&quot;</span>, </span>
<span id="cb2251-25"><a href="nominal-predicted-variable.html#cb2251-25" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{3}|{3,4}&#39;]&quot;</span>)),</span>
<span id="cb2251-26"><a href="nominal-predicted-variable.html#cb2251-26" aria-hidden="true" tabindex="-1"></a>                 <span class="at">guide =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb2251-27"><a href="nominal-predicted-variable.html#cb2251-27" aria-hidden="true" tabindex="-1"></a>                   <span class="at">direction =</span> <span class="st">&quot;vertical&quot;</span>,</span>
<span id="cb2251-28"><a href="nominal-predicted-variable.html#cb2251-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb2251-29"><a href="nominal-predicted-variable.html#cb2251-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.theme =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))) <span class="sc">+</span></span>
<span id="cb2251-30"><a href="nominal-predicted-variable.html#cb2251-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb2251-31"><a href="nominal-predicted-variable.html#cb2251-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(x[<span class="dv">1</span>]),</span>
<span id="cb2251-32"><a href="nominal-predicted-variable.html#cb2251-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(x[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb2251-33"><a href="nominal-predicted-variable.html#cb2251-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.justification =</span> <span class="fl">0.5</span>,</span>
<span id="cb2251-34"><a href="nominal-predicted-variable.html#cb2251-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-53-1.png" width="288" style="display: block; margin: auto;" /></p>
<p>Though we used a different likelihood and a different formula for the thresholds, we got same basic model results. They’re just parameterized in a slightly different way. The nice thing with the <code>family = sratio</code> approach is all of the typical <strong>brms</strong> post processing functions will work out of the box. For example, here’s the posterior predictive check via <code>pp_check()</code>.</p>
<div class="sourceCode" id="cb2252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2252-1"><a href="nominal-predicted-variable.html#cb2252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(fit22<span class="fl">.5</span>, </span>
<span id="cb2252-2"><a href="nominal-predicted-variable.html#cb2252-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">&quot;bars&quot;</span>, </span>
<span id="cb2252-3"><a href="nominal-predicted-variable.html#cb2252-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ndraws =</span> <span class="dv">100</span>, </span>
<span id="cb2252-4"><a href="nominal-predicted-variable.html#cb2252-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb2252-5"><a href="nominal-predicted-variable.html#cb2252-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">fatten =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-54-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Also note how the information criteria estimates for the two approaches are essentially the same.</p>
<div class="sourceCode" id="cb2253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2253-1"><a href="nominal-predicted-variable.html#cb2253-1" aria-hidden="true" tabindex="-1"></a>fit22<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(fit22<span class="fl">.5</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb2253-2"><a href="nominal-predicted-variable.html#cb2253-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2253-3"><a href="nominal-predicted-variable.html#cb2253-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(fit22<span class="fl">.3</span>, fit22<span class="fl">.5</span>, <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2253-4"><a href="nominal-predicted-variable.html#cb2253-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> F)</span></code></pre></div>
<pre><code>##         elpd_diff se_diff elpd_waic se_elpd_waic p_waic se_p_waic waic   se_waic
## fit22.3    0.0       0.0  -230.8      16.8          9.3    1.1     461.5   33.6 
## fit22.5   -0.1       0.1  -230.8      16.8          9.3    1.1     461.6   33.6</code></pre>
<p>A limitation of the <code>family = sratio</code> method for conditional logistic models is it requires a simple binary-divisions hierarchy that resembles the one we just used, the one in the left panel of Figure 22.2. It is not well suited for the more complicated hierarchy displayed in the right panel of Figure 22.2, nor will it help you make sense of data generated by that kind of mechanism. For example, consider what happens when we try to use <code>family = sratio</code> with the <code>d4</code> data.</p>
<div class="sourceCode" id="cb2255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2255-1"><a href="nominal-predicted-variable.html#cb2255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make an ordinal version of Y</span></span>
<span id="cb2255-2"><a href="nominal-predicted-variable.html#cb2255-2" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span></span>
<span id="cb2255-3"><a href="nominal-predicted-variable.html#cb2255-3" aria-hidden="true" tabindex="-1"></a>  d4 <span class="sc">%&gt;%</span> </span>
<span id="cb2255-4"><a href="nominal-predicted-variable.html#cb2255-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y_ord =</span> <span class="fu">ordered</span>(Y))</span>
<span id="cb2255-5"><a href="nominal-predicted-variable.html#cb2255-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2255-6"><a href="nominal-predicted-variable.html#cb2255-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model</span></span>
<span id="cb2255-7"><a href="nominal-predicted-variable.html#cb2255-7" aria-hidden="true" tabindex="-1"></a>fit22<span class="fl">.6</span> <span class="ot">&lt;-</span></span>
<span id="cb2255-8"><a href="nominal-predicted-variable.html#cb2255-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d4, </span>
<span id="cb2255-9"><a href="nominal-predicted-variable.html#cb2255-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> sratio,</span>
<span id="cb2255-10"><a href="nominal-predicted-variable.html#cb2255-10" aria-hidden="true" tabindex="-1"></a>      Y_ord <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">cs</span>(X1) <span class="sc">+</span> <span class="fu">cs</span>(X2),</span>
<span id="cb2255-11"><a href="nominal-predicted-variable.html#cb2255-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb2255-12"><a href="nominal-predicted-variable.html#cb2255-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">class =</span> b)),</span>
<span id="cb2255-13"><a href="nominal-predicted-variable.html#cb2255-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb2255-14"><a href="nominal-predicted-variable.html#cb2255-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">22</span>,</span>
<span id="cb2255-15"><a href="nominal-predicted-variable.html#cb2255-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit22.06&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb2256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2256-1"><a href="nominal-predicted-variable.html#cb2256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit22<span class="fl">.6</span>)</span></code></pre></div>
<pre><code>##  Family: sratio 
##   Links: mu = logit; disc = identity 
## Formula: Y_ord ~ 1 + cs(X1) + cs(X2) 
##    Data: d4 (Number of observations: 475) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept[1]    -6.01      0.72    -7.53    -4.70 1.00     1968     2049
## Intercept[2]    -5.43      0.70    -6.98    -4.19 1.00     2174     1810
## Intercept[3]    -1.02      0.23    -1.48    -0.57 1.00     2985     3132
## X1[1]            2.70      0.44     1.88     3.61 1.00     2412     2527
## X1[2]            5.59      0.72     4.31     7.17 1.00     2389     1746
## X1[3]           -3.02      0.38    -3.81    -2.30 1.00     2558     2829
## X2[1]            2.37      0.42     1.60     3.22 1.00     2518     2706
## X2[2]           -1.17      0.29    -1.75    -0.62 1.00     2941     2773
## X2[3]           -3.11      0.35    -3.85    -2.47 1.00     2981     2833
## 
## Family Specific Parameters: 
##      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## disc     1.00      0.00     1.00     1.00   NA       NA       NA
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>If you look at the parameter summary, nothing obviously bad happened. The computer didn’t crash or anything. To get a better sense of the damage, we plot.</p>
<div class="sourceCode" id="cb2258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2258-1"><a href="nominal-predicted-variable.html#cb2258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the posterior draws for fit22.6</span></span>
<span id="cb2258-2"><a href="nominal-predicted-variable.html#cb2258-2" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit22<span class="fl">.6</span>)</span>
<span id="cb2258-3"><a href="nominal-predicted-variable.html#cb2258-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2258-4"><a href="nominal-predicted-variable.html#cb2258-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2D thresholds on the left</span></span>
<span id="cb2258-5"><a href="nominal-predicted-variable.html#cb2258-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">22</span>)</span>
<span id="cb2258-6"><a href="nominal-predicted-variable.html#cb2258-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2258-7"><a href="nominal-predicted-variable.html#cb2258-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> </span>
<span id="cb2258-8"><a href="nominal-predicted-variable.html#cb2258-8" aria-hidden="true" tabindex="-1"></a>  draws <span class="sc">%&gt;%</span> </span>
<span id="cb2258-9"><a href="nominal-predicted-variable.html#cb2258-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2258-10"><a href="nominal-predicted-variable.html#cb2258-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2258-11"><a href="nominal-predicted-variable.html#cb2258-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_remove</span>(name, <span class="st">&quot;b_&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(., <span class="st">&quot;bcs_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2258-12"><a href="nominal-predicted-variable.html#cb2258-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;parameter&quot;</span>, <span class="st">&quot;lambda&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2258-13"><a href="nominal-predicted-variable.html#cb2258-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> parameter, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb2258-14"><a href="nominal-predicted-variable.html#cb2258-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># still using the adjusted formula for the thresholds</span></span>
<span id="cb2258-15"><a href="nominal-predicted-variable.html#cb2258-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intercept =</span> Intercept <span class="sc">/</span> X2,</span>
<span id="cb2258-16"><a href="nominal-predicted-variable.html#cb2258-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">slope     =</span> <span class="sc">-</span>X1 <span class="sc">/</span> X2) <span class="sc">%&gt;%</span> </span>
<span id="cb2258-17"><a href="nominal-predicted-variable.html#cb2258-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2258-18"><a href="nominal-predicted-variable.html#cb2258-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2258-19"><a href="nominal-predicted-variable.html#cb2258-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> d3,</span>
<span id="cb2258-20"><a href="nominal-predicted-variable.html#cb2258-20" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2, <span class="at">label =</span> Y, <span class="at">color =</span> <span class="fu">factor</span>(Y)),</span>
<span id="cb2258-21"><a href="nominal-predicted-variable.html#cb2258-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb2258-22"><a href="nominal-predicted-variable.html#cb2258-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> intercept,</span>
<span id="cb2258-23"><a href="nominal-predicted-variable.html#cb2258-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope =</span> slope,</span>
<span id="cb2258-24"><a href="nominal-predicted-variable.html#cb2258-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">group =</span> <span class="fu">interaction</span>(.draw, lambda),</span>
<span id="cb2258-25"><a href="nominal-predicted-variable.html#cb2258-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> lambda),</span>
<span id="cb2258-26"><a href="nominal-predicted-variable.html#cb2258-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> pl[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb2258-27"><a href="nominal-predicted-variable.html#cb2258-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pl[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">+</span></span>
<span id="cb2258-28"><a href="nominal-predicted-variable.html#cb2258-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype</span>(<span class="cn">NULL</span>,</span>
<span id="cb2258-29"><a href="nominal-predicted-variable.html#cb2258-29" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labels =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="fu">c</span>(</span>
<span id="cb2258-30"><a href="nominal-predicted-variable.html#cb2258-30" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{1}|{1,2,3,4}&#39;]&quot;</span>, </span>
<span id="cb2258-31"><a href="nominal-predicted-variable.html#cb2258-31" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{2}|{2,3,4}&#39;]&quot;</span>, </span>
<span id="cb2258-32"><a href="nominal-predicted-variable.html#cb2258-32" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;lambda[&#39;{3}|{3,4}&#39;]&quot;</span>)),</span>
<span id="cb2258-33"><a href="nominal-predicted-variable.html#cb2258-33" aria-hidden="true" tabindex="-1"></a>                 <span class="at">guide =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb2258-34"><a href="nominal-predicted-variable.html#cb2258-34" aria-hidden="true" tabindex="-1"></a>                   <span class="at">direction =</span> <span class="st">&quot;vertical&quot;</span>,</span>
<span id="cb2258-35"><a href="nominal-predicted-variable.html#cb2258-35" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb2258-36"><a href="nominal-predicted-variable.html#cb2258-36" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label.theme =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))) <span class="sc">+</span></span>
<span id="cb2258-37"><a href="nominal-predicted-variable.html#cb2258-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(x[<span class="dv">1</span>]),</span>
<span id="cb2258-38"><a href="nominal-predicted-variable.html#cb2258-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(x[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb2258-39"><a href="nominal-predicted-variable.html#cb2258-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.justification =</span> <span class="fl">0.5</span>,</span>
<span id="cb2258-40"><a href="nominal-predicted-variable.html#cb2258-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb2258-41"><a href="nominal-predicted-variable.html#cb2258-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2258-42"><a href="nominal-predicted-variable.html#cb2258-42" aria-hidden="true" tabindex="-1"></a><span class="co"># marginal posteriors on the right</span></span>
<span id="cb2258-43"><a href="nominal-predicted-variable.html#cb2258-43" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb2258-44"><a href="nominal-predicted-variable.html#cb2258-44" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb2258-45"><a href="nominal-predicted-variable.html#cb2258-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2258-46"><a href="nominal-predicted-variable.html#cb2258-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_remove</span>(name, <span class="st">&quot;b_&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(., <span class="st">&quot;bcs_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2258-47"><a href="nominal-predicted-variable.html#cb2258-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;parameter&quot;</span>, <span class="st">&quot;lambda&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2258-48"><a href="nominal-predicted-variable.html#cb2258-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda    =</span> <span class="fu">case_when</span>(lambda <span class="sc">==</span> <span class="st">&quot;1&quot;</span> <span class="sc">~</span> <span class="st">&quot;lambda[&#39;{1}|{1,2,3,4}&#39;]&quot;</span>,</span>
<span id="cb2258-49"><a href="nominal-predicted-variable.html#cb2258-49" aria-hidden="true" tabindex="-1"></a>                               lambda <span class="sc">==</span> <span class="st">&quot;2&quot;</span> <span class="sc">~</span> <span class="st">&quot;lambda[&#39;{2}|{2,3,4}&#39;]&quot;</span>,</span>
<span id="cb2258-50"><a href="nominal-predicted-variable.html#cb2258-50" aria-hidden="true" tabindex="-1"></a>                               lambda <span class="sc">==</span> <span class="st">&quot;3&quot;</span> <span class="sc">~</span> <span class="st">&quot;lambda[&#39;{3}|{3,4}&#39;]&quot;</span>),</span>
<span id="cb2258-51"><a href="nominal-predicted-variable.html#cb2258-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">parameter =</span> <span class="fu">case_when</span>(parameter <span class="sc">==</span> <span class="st">&quot;Intercept&quot;</span> <span class="sc">~</span> <span class="st">&quot;beta[0]&quot;</span>,</span>
<span id="cb2258-52"><a href="nominal-predicted-variable.html#cb2258-52" aria-hidden="true" tabindex="-1"></a>                               parameter <span class="sc">==</span> <span class="st">&quot;X1&quot;</span>        <span class="sc">~</span> <span class="st">&quot;beta[1]&quot;</span>,</span>
<span id="cb2258-53"><a href="nominal-predicted-variable.html#cb2258-53" aria-hidden="true" tabindex="-1"></a>                               parameter <span class="sc">==</span> <span class="st">&quot;X2&quot;</span>        <span class="sc">~</span> <span class="st">&quot;beta[2]&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2258-54"><a href="nominal-predicted-variable.html#cb2258-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2258-55"><a href="nominal-predicted-variable.html#cb2258-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb2258-56"><a href="nominal-predicted-variable.html#cb2258-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb2258-57"><a href="nominal-predicted-variable.html#cb2258-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_histinterval</span>(<span class="at">point_interval =</span> mode_hdi, <span class="at">.width =</span> .<span class="dv">95</span>,</span>
<span id="cb2258-58"><a href="nominal-predicted-variable.html#cb2258-58" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> pl[<span class="dv">4</span>], <span class="at">slab_color =</span> pl[<span class="dv">3</span>], <span class="at">color =</span> pl[<span class="dv">1</span>], <span class="at">point_color =</span> pl[<span class="dv">2</span>],</span>
<span id="cb2258-59"><a href="nominal-predicted-variable.html#cb2258-59" aria-hidden="true" tabindex="-1"></a>                    <span class="at">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="sc">+</span></span>
<span id="cb2258-60"><a href="nominal-predicted-variable.html#cb2258-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb2258-61"><a href="nominal-predicted-variable.html#cb2258-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;marginal posterior&quot;</span>) <span class="sc">+</span></span>
<span id="cb2258-62"><a href="nominal-predicted-variable.html#cb2258-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(lambda <span class="sc">~</span> parameter, <span class="at">labeller =</span> label_parsed, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb2258-63"><a href="nominal-predicted-variable.html#cb2258-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>))</span>
<span id="cb2258-64"><a href="nominal-predicted-variable.html#cb2258-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2258-65"><a href="nominal-predicted-variable.html#cb2258-65" aria-hidden="true" tabindex="-1"></a><span class="co"># combine, entitle, and display the results</span></span>
<span id="cb2258-66"><a href="nominal-predicted-variable.html#cb2258-66" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">&amp;</span> </span>
<span id="cb2258-67"><a href="nominal-predicted-variable.html#cb2258-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">&amp;</span></span>
<span id="cb2258-68"><a href="nominal-predicted-variable.html#cb2258-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Figure 22.7, lower half&quot;</span>,</span>
<span id="cb2258-69"><a href="nominal-predicted-variable.html#cb2258-69" aria-hidden="true" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">&quot;Results from the conditional logistic model fit to the d4 data via the sequential-ordinal approach&quot;</span>)</span></code></pre></div>
<p><img src="22_files/figure-html/unnamed-chunk-57-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>We ended up with our version of the lower half of Figure 22.7. As with the previous model, the sequential-ordinal approach reverses the signs for the <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> parameters, which isn’t a big deal as long as you keep that in mind. The larger issue is that the thresholds displayed in the left panel do a poor job differentiating among the various <code>Y</code> categories. The model underlying those thresholds is a bad match for the data.</p>
</div>
<div id="conditional-logistic-wrap-up." class="section level5 hasAnchor" number="22.3.3.2.3">
<h5><span class="header-section-number">22.3.3.2.3</span> Conditional logistic wrap-up.<a href="nominal-predicted-variable.html#conditional-logistic-wrap-up." class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>To wrap this section up, we walked through approaches for fitting conditional logistic models with <strong>brms</strong>. First we considered Singmann’s method for using the <strong>brms</strong> custom family functionality to define bespoke likelihood functions. Though it requires a lot of custom coding and an above-average knowledge of the inner workings of <strong>brms</strong> and Stan, the custom-family approach is very general and will possibly work for all your conditional-logistic needs. Then we considered Ben-Shachar sequential-ordinal approach. Ben-Shachar’s insight was that if we are willing to augment the nominal data with the <code>ordered()</code> function, modeling them with a sequential-ordinal model via <code>family = sratio</code> will return near equivalent results to the conditional-logistic method. Though this method is attractive in that it uses a built-in likelihood and thus avoids a lot of custom coding, it is limited in that it will only handle nominal data which are well described by the simple binary-divisions hierarchy displayed in the left panel of Figure 22.2.</p>
<p>In closing, I would like to thank Singmann and Ben-Shachar for their time and insights. 🍻 I could not have finished this section without them. If you would like more examples of both of their methods applied to different data sets, check out the Stan forum thread called <a href="https://discourse.mc-stan.org/t/nominal-data-and-kruschkes-conditional-logistic-approach/21433">Nominal data and Kruschke’s “conditional logistic” approach</a>.</p>
</div>
</div>
</div>
</div>
<div id="generalizations-and-variations-of-the-models" class="section level2 hasAnchor" number="22.4">
<h2><span class="header-section-number">22.4</span> Generalizations and variations of the models<a href="nominal-predicted-variable.html#generalizations-and-variations-of-the-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>These models can be generalized to include different kinds of predictors, variants robust to outliers, and model comparison via information criteria and so forth. You can find a few more examples with softmax regression in Chapter 10 of the first edition of McElreath’s <span class="citation">(<a href="#ref-mcelreathStatisticalRethinkingBayesian2015" role="doc-biblioref">2015</a>)</span> <a href="https://xcelab.net/rm/statistical-rethinking/"><em>Statistical rethinking</em></a> and Chapter 11 of his second edition <span class="citation">(<a href="#ref-mcelreathStatisticalRethinkingBayesian2020" role="doc-biblioref">McElreath, 2020</a>)</span>. See also Kurz <span class="citation">(<a href="#ref-kurzStatisticalRethinkingSecondEd2023" role="doc-biblioref">2023b, pp. Section 11.3</a>)</span> and Kurz <span class="citation">(<a href="#ref-kurzStatisticalRethinkingBrms2023" role="doc-biblioref">2023a, pp. Section 10.3.1</a>)</span> for walk-throughs with <strong>brms</strong>.</p>
</div>
<div id="session-info-21" class="section level2 unnumbered hasAnchor">
<h2>Session info<a href="nominal-predicted-variable.html#session-info-21" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb2259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2259-1"><a href="nominal-predicted-variable.html#cb2259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.2.2 (2022-10-31)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] bayesplot_1.10.0 posterior_1.3.1  tidybayes_3.0.2  brms_2.18.0      Rcpp_1.0.9      
##  [6] patchwork_1.1.2  cowplot_1.1.1    PNWColors_0.1.0  forcats_0.5.1    stringr_1.4.1   
## [11] dplyr_1.0.10     purrr_1.0.1      readr_2.1.2      tidyr_1.2.1      tibble_3.1.8    
## [16] ggplot2_3.4.0    tidyverse_1.3.2 
## 
## loaded via a namespace (and not attached):
##   [1] readxl_1.4.1         backports_1.4.1      RcppEigen_0.3.3.9.3  plyr_1.8.7          
##   [5] igraph_1.3.4         svUnit_1.0.6         splines_4.2.2        crosstalk_1.2.0     
##   [9] TH.data_1.1-1        rstantools_2.2.0     inline_0.3.19        digest_0.6.31       
##  [13] htmltools_0.5.3      fansi_1.0.3          BH_1.78.0-0          magrittr_2.0.3      
##  [17] checkmate_2.1.0      googlesheets4_1.0.1  tzdb_0.3.0           modelr_0.1.8        
##  [21] RcppParallel_5.1.5   matrixStats_0.63.0   vroom_1.5.7          xts_0.12.1          
##  [25] sandwich_3.0-2       prettyunits_1.1.1    colorspace_2.0-3     rvest_1.0.2         
##  [29] ggdist_3.2.1         haven_2.5.1          xfun_0.35            callr_3.7.3         
##  [33] crayon_1.5.2         jsonlite_1.8.4       lme4_1.1-31          survival_3.4-0      
##  [37] zoo_1.8-10           glue_1.6.2           gtable_0.3.1         gargle_1.2.0        
##  [41] emmeans_1.8.0        distributional_0.3.1 pkgbuild_1.3.1       rstan_2.21.8        
##  [45] abind_1.4-5          scales_1.2.1         mvtnorm_1.1-3        emo_0.0.0.9000      
##  [49] DBI_1.1.3            miniUI_0.1.1.1       xtable_1.8-4         HDInterval_0.2.4    
##  [53] bit_4.0.4            stats4_4.2.2         StanHeaders_2.21.0-7 DT_0.24             
##  [57] htmlwidgets_1.5.4    httr_1.4.4           threejs_0.3.3        arrayhelpers_1.1-0  
##  [61] ellipsis_0.3.2       pkgconfig_2.0.3      loo_2.5.1            farver_2.1.1        
##  [65] sass_0.4.2           dbplyr_2.2.1         utf8_1.2.2           tidyselect_1.2.0    
##  [69] labeling_0.4.2       rlang_1.0.6          reshape2_1.4.4       later_1.3.0         
##  [73] munsell_0.5.0        cellranger_1.1.0     tools_4.2.2          cachem_1.0.6        
##  [77] cli_3.6.0            generics_0.1.3       broom_1.0.2          evaluate_0.18       
##  [81] fastmap_1.1.0        processx_3.8.0       knitr_1.40           bit64_4.0.5         
##  [85] fs_1.5.2             nlme_3.1-160         projpred_2.2.1       mime_0.12           
##  [89] xml2_1.3.3           compiler_4.2.2       shinythemes_1.2.0    rstudioapi_0.13     
##  [93] gamm4_0.2-6          reprex_2.0.2         bslib_0.4.0          stringi_1.7.8       
##  [97] highr_0.9            ps_1.7.2             Brobdingnag_1.2-8    lattice_0.20-45     
## [101] Matrix_1.5-1         nloptr_2.0.3         markdown_1.1         shinyjs_2.1.0       
## [105] tensorA_0.36.2       vctrs_0.5.1          pillar_1.8.1         lifecycle_1.0.3     
## [109] jquerylib_0.1.4      bridgesampling_1.1-2 estimability_1.4.1   httpuv_1.6.5        
## [113] extraDistr_1.9.1     R6_2.5.1             bookdown_0.28        promises_1.2.0.1    
## [117] gridExtra_2.3        codetools_0.2-18     boot_1.3-28          MASS_7.3-58.1       
## [121] colourpicker_1.1.1   gtools_3.9.4         assertthat_0.2.1     withr_2.5.0         
## [125] shinystan_2.6.0      multcomp_1.4-20      mgcv_1.8-41          parallel_4.2.2      
## [129] hms_1.1.1            grid_4.2.2           minqa_1.2.5          coda_0.19-4         
## [133] rmarkdown_2.16       googledrive_2.0.0    shiny_1.7.2          lubridate_1.8.0     
## [137] base64enc_0.1-3      dygraphs_1.1.1.6</code></pre>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-Bürkner2022Parameterization" class="csl-entry">
Bürkner, P.-C. (2022c). <em>Parameterization of response distributions in brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_families.html">https://CRAN.R-project.org/package=brms/vignettes/brms_families.html</a>
</div>
<div id="ref-Bürkner2022Define" class="csl-entry">
Bürkner, P.-C. (2022d). <em>Define custom response distributions with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_customfamilies.html">https://CRAN.R-project.org/package=brms/vignettes/brms_customfamilies.html</a>
</div>
<div id="ref-burknerOrdinalRegressionModels2019" class="csl-entry">
Bürkner, P.-C., &amp; Vuorre, M. (2019). Ordinal regression models in psychology: <span>A</span> tutorial. <em>Advances in Methods and Practices in Psychological Science</em>, <em>2</em>(1), 77–101. <a href="https://doi.org/10.1177/2515245918823199">https://doi.org/10.1177/2515245918823199</a>
</div>
<div id="ref-kruschkeDoingBayesianData2015" class="csl-entry">
Kruschke, J. K. (2015). <em>Doing <span>Bayesian</span> data analysis: <span>A</span> tutorial with <span>R</span>, <span>JAGS</span>, and <span>Stan</span></em>. <span>Academic Press</span>. <a href="https://sites.google.com/site/doingbayesiandataanalysis/">https://sites.google.com/site/doingbayesiandataanalysis/</a>
</div>
<div id="ref-kurzStatisticalRethinkingBrms2023" class="csl-entry">
Kurz, A. S. (2023a). <em>Statistical <span>Rethinking</span> with <span class="nocase">brms</span>, <span class="nocase">ggplot2</span>, and the <span class="nocase">tidyverse</span></em> (version 1.3.0). <a href="https://bookdown.org/content/3890/">https://bookdown.org/content/3890/</a>
</div>
<div id="ref-kurzStatisticalRethinkingSecondEd2023" class="csl-entry">
Kurz, A. S. (2023b). <em>Statistical <span>Rethinking</span> with brms, <span class="nocase">ggplot2</span>, and the tidyverse: <span>Second Edition</span></em> (version 0.4.0). <a href="https://bookdown.org/content/4857/">https://bookdown.org/content/4857/</a>
</div>
<div id="ref-luceIndividualChoiceBehavior2012" class="csl-entry">
Luce, R. D. (2012). <em>Individual choice behavior: <span>A</span> theoretical analysis</em>. <span>Courier Corporation</span>. <a href="https://books.google.com?id=ERQsKkPiKkkC">https://books.google.com?id=ERQsKkPiKkkC</a>
</div>
<div id="ref-luceLuceChoiceAxiom2008" class="csl-entry">
Luce, R. D. (2008). Luce’s choice axiom. <em>Scholarpedia</em>, <em>3</em>(12), 8077. <a href="https://doi.org/10.4249/scholarpedia.8077">https://doi.org/10.4249/scholarpedia.8077</a>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2020" class="csl-entry">
McElreath, R. (2020). <em>Statistical rethinking: <span>A Bayesian</span> course with examples in <span>R</span> and <span>Stan</span></em> (Second Edition). <span>CRC Press</span>. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2015" class="csl-entry">
McElreath, R. (2015). <em>Statistical rethinking: <span>A Bayesian</span> course with examples in <span>R</span> and <span>Stan</span></em>. <span>CRC press</span>. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dichotomous-predicted-variable.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ordinal-predicted-variable.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
