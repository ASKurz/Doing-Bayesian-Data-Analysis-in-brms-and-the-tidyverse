<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Markov Chain Monte Carlo | Doing Bayesian Data Analysis in brms and the tidyverse</title>
  <meta name="description" content="This project is an attempt to re-express the code in Kruschke’s (2015) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Markov Chain Monte Carlo | Doing Bayesian Data Analysis in brms and the tidyverse" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This project is an attempt to re-express the code in Kruschke’s (2015) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Markov Chain Monte Carlo | Doing Bayesian Data Analysis in brms and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is an attempt to re-express the code in Kruschke’s (2015) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2023-01-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"/>
<link rel="next" href="jags-brms.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-setup"><i class="fa fa-check"></i><strong>R</strong> setup</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-have-updates"><i class="fa fa-check"></i>We have updates</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.1.0."><i class="fa fa-check"></i>Version 0.1.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.2.0."><i class="fa fa-check"></i>Version 0.2.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.3.0."><i class="fa fa-check"></i>Version 0.3.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.4.0."><i class="fa fa-check"></i>Version 0.4.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-1.0.0."><i class="fa fa-check"></i>Version 1.0.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-1.1.0."><i class="fa fa-check"></i>Version 1.1.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#some-minor-issues-remain."><i class="fa fa-check"></i>Some minor issues remain.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license-and-citation"><i class="fa fa-check"></i>License and citation</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html"><i class="fa fa-check"></i><b>1</b> What’s in This Book (Read This First!)</a>
<ul>
<li class="chapter" data-level="1.1" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#real-people-can-read-this-book"><i class="fa fa-check"></i><b>1.1</b> Real people can read this book</a></li>
<li class="chapter" data-level="1.2" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#whats-in-this-book"><i class="fa fa-check"></i><b>1.2</b> What’s in this book</a></li>
<li class="chapter" data-level="1.3" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#whats-new-in-the-second-edition"><i class="fa fa-check"></i><b>1.3</b> What’s new in the second edition</a></li>
<li class="chapter" data-level="1.4" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#gimme-feedback-be-polite"><i class="fa fa-check"></i><b>1.4</b> Gimme feedback (be polite)</a></li>
<li class="chapter" data-level="1.5" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#thank-you"><i class="fa fa-check"></i><b>1.5</b> Thank you!</a></li>
<li class="chapter" data-level="" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html"><i class="fa fa-check"></i><b>2</b> Introduction: Credibility, Models, and Parameters</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#bayesian-inference-is-reallocation-of-credibility-across-possibilities"><i class="fa fa-check"></i><b>2.1</b> Bayesian inference is reallocation of credibility across possibilities</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#data-are-noisy-and-inferences-are-probabilistic."><i class="fa fa-check"></i><b>2.1.1</b> Data are noisy and inferences are probabilistic.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#possibilities-are-parameter-values-in-descriptive-models"><i class="fa fa-check"></i><b>2.2</b> Possibilities are parameter values in descriptive models</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#the-steps-of-bayesian-data-analysis"><i class="fa fa-check"></i><b>2.3</b> The steps of Bayesian data analysis</a></li>
<li class="chapter" data-level="" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html"><i class="fa fa-check"></i><b>3</b> The R Programming Language</a>
<ul>
<li class="chapter" data-level="3.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#get-the-software"><i class="fa fa-check"></i><b>3.1</b> Get the software</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#a-look-at-rstudio."><i class="fa fa-check"></i><b>3.1.1</b> A look at RStudio.</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#a-simple-example-of-r-in-action"><i class="fa fa-check"></i><b>3.2</b> A simple example of R in action</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#get-the-programs-used-with-this-book."><i class="fa fa-check"></i><b>3.2.1</b> Get the programs used with this book.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#basic-commands-and-operators-in-r"><i class="fa fa-check"></i><b>3.3</b> Basic commands and operators in R</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#getting-help-in-r."><i class="fa fa-check"></i><b>3.3.1</b> Getting help in R.</a></li>
<li class="chapter" data-level="3.3.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#arithmetic-and-logical-operators."><i class="fa fa-check"></i><b>3.3.2</b> Arithmetic and logical operators.</a></li>
<li class="chapter" data-level="3.3.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#assignment-relational-operators-and-tests-of-equality."><i class="fa fa-check"></i><b>3.3.3</b> Assignment, relational operators, and tests of equality.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#variable-types"><i class="fa fa-check"></i><b>3.4</b> Variable types</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#vector."><i class="fa fa-check"></i><b>3.4.1</b> Vector.</a></li>
<li class="chapter" data-level="3.4.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#factor."><i class="fa fa-check"></i><b>3.4.2</b> Factor.</a></li>
<li class="chapter" data-level="3.4.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#matrix-and-array."><i class="fa fa-check"></i><b>3.4.3</b> Matrix and array.</a></li>
<li class="chapter" data-level="3.4.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#list-and-data-frame."><i class="fa fa-check"></i><b>3.4.4</b> List and data frame.</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#loading-and-saving-data"><i class="fa fa-check"></i><b>3.5</b> Loading and saving data</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#the-read.csv-read_csv-and-read.table-read_table-functions."><i class="fa fa-check"></i><b>3.5.1</b> The <del>read.csv</del> <code>read_csv()</code> and <del>read.table</del> <code>read_table()</code> functions.</a></li>
<li class="chapter" data-level="3.5.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#saving-data-from-r."><i class="fa fa-check"></i><b>3.5.2</b> Saving data from R.</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#some-utility-functions"><i class="fa fa-check"></i><b>3.6</b> Some utility functions</a></li>
<li class="chapter" data-level="3.7" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#programming-in-r"><i class="fa fa-check"></i><b>3.7</b> Programming in R</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#variable-names-in-r."><i class="fa fa-check"></i><b>3.7.1</b> Variable names in R.</a></li>
<li class="chapter" data-level="3.7.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#running-a-program."><i class="fa fa-check"></i><b>3.7.2</b> Running a program.</a></li>
<li class="chapter" data-level="3.7.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#programming-a-function."><i class="fa fa-check"></i><b>3.7.3</b> Programming a function.</a></li>
<li class="chapter" data-level="3.7.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#conditions-and-loops."><i class="fa fa-check"></i><b>3.7.4</b> Conditions and loops.</a></li>
<li class="chapter" data-level="3.7.5" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#measuring-processing-time."><i class="fa fa-check"></i><b>3.7.5</b> Measuring processing time.</a></li>
<li class="chapter" data-level="3.7.6" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#debugging."><i class="fa fa-check"></i><b>3.7.6</b> Debugging.</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#graphical-plots-opening-and-saving"><i class="fa fa-check"></i><b>3.8</b> Graphical plots: Opening and saving</a></li>
<li class="chapter" data-level="3.9" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#conclusion-brms-related-needs"><i class="fa fa-check"></i><b>3.9</b> <del>Conclusion</del> <strong>brms</strong>-related needs</a></li>
<li class="chapter" data-level="" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#footnote"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html"><i class="fa fa-check"></i><b>4</b> What is This Stuff Called Probability?</a>
<ul>
<li class="chapter" data-level="4.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#the-set-of-all-possible-events"><i class="fa fa-check"></i><b>4.1</b> The set of all possible events</a></li>
<li class="chapter" data-level="4.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probability-outside-or-inside-the-head"><i class="fa fa-check"></i><b>4.2</b> Probability: Outside or inside the head</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#outside-the-head-long-run-relative-frequency."><i class="fa fa-check"></i><b>4.2.1</b> Outside the head: Long-run relative frequency.</a></li>
<li class="chapter" data-level="4.2.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#inside-the-head-subjective-belief."><i class="fa fa-check"></i><b>4.2.2</b> Inside the head: Subjective belief.</a></li>
<li class="chapter" data-level="4.2.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probabilities-assign-numbers-to-possibilities."><i class="fa fa-check"></i><b>4.2.3</b> Probabilities assign numbers to possibilities.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probability-distributions"><i class="fa fa-check"></i><b>4.3</b> Probability distributions</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#discrete-distributions-probability-mass."><i class="fa fa-check"></i><b>4.3.1</b> Discrete distributions: Probability mass.</a></li>
<li class="chapter" data-level="4.3.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#continuous-distributions-rendezvous-with-density."><i class="fa fa-check"></i><b>4.3.2</b> Continuous distributions: Rendezvous with density.</a></li>
<li class="chapter" data-level="4.3.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#mean-and-variance-of-a-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Mean and variance of a distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#highest-density-interval-hdi."><i class="fa fa-check"></i><b>4.3.4</b> Highest density interval (HDI).</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#two-way-distributions"><i class="fa fa-check"></i><b>4.4</b> Two-way distributions</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#conditional-probability."><i class="fa fa-check"></i><b>4.4.1</b> Conditional probability.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bayes-rule.html"><a href="bayes-rule.html"><i class="fa fa-check"></i><b>5</b> Bayes’ Rule</a>
<ul>
<li class="chapter" data-level="5.1" data-path="bayes-rule.html"><a href="bayes-rule.html#bayes-rule-1"><i class="fa fa-check"></i><b>5.1</b> Bayes’ rule</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="bayes-rule.html"><a href="bayes-rule.html#derived-from-definitions-of-conditional-probability."><i class="fa fa-check"></i><b>5.1.1</b> Derived from definitions of conditional probability.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="bayes-rule.html"><a href="bayes-rule.html#applied-to-parameters-and-data"><i class="fa fa-check"></i><b>5.2</b> Applied to parameters and data</a></li>
<li class="chapter" data-level="5.3" data-path="bayes-rule.html"><a href="bayes-rule.html#complete-examples-estimating-bias-in-a-coin"><i class="fa fa-check"></i><b>5.3</b> Complete examples: Estimating bias in a coin</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="bayes-rule.html"><a href="bayes-rule.html#influence-of-sample-size-on-the-posterior."><i class="fa fa-check"></i><b>5.3.1</b> Influence of sample size on the posterior.</a></li>
<li class="chapter" data-level="5.3.2" data-path="bayes-rule.html"><a href="bayes-rule.html#influence-of-prior-on-the-posterior."><i class="fa fa-check"></i><b>5.3.2</b> Influence of prior on the posterior.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="bayes-rule.html"><a href="bayes-rule.html#why-bayesian-inference-can-be-difficult"><i class="fa fa-check"></i><b>5.4</b> Why Bayesian inference can be difficult</a></li>
<li class="chapter" data-level="" data-path="bayes-rule.html"><a href="bayes-rule.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><i class="fa fa-check"></i><b>6</b> Inferring a Binomial Probability via Exact Mathematical Analysis</a>
<ul>
<li class="chapter" data-level="6.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#the-likelihood-function-the-bernoulli-distribution"><i class="fa fa-check"></i><b>6.1</b> The likelihood function: The Bernoulli distribution</a></li>
<li class="chapter" data-level="6.2" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#a-description-of-credibilities-the-beta-distribution"><i class="fa fa-check"></i><b>6.2</b> A description of credibilities: The beta distribution</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#specifying-a-beta-prior."><i class="fa fa-check"></i><b>6.2.1</b> Specifying a beta prior.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#the-posterior-beta"><i class="fa fa-check"></i><b>6.3</b> The posterior beta</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#posterior-is-compromise-of-prior-and-likelihood."><i class="fa fa-check"></i><b>6.3.1</b> Posterior is compromise of prior and likelihood.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#examples"><i class="fa fa-check"></i><b>6.4</b> Examples</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#prior-knowledge-expressed-as-a-beta-distribution."><i class="fa fa-check"></i><b>6.4.1</b> Prior knowledge expressed as a beta distribution.</a></li>
<li class="chapter" data-level="6.4.2" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#prior-knowledge-that-cannot-be-expressed-as-a-beta-distribution."><i class="fa fa-check"></i><b>6.4.2</b> Prior knowledge that cannot be expressed as a beta distribution.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#summary"><i class="fa fa-check"></i><b>6.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>7</b> Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="7.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#approximating-a-distribution-with-a-large-sample"><i class="fa fa-check"></i><b>7.1</b> Approximating a distribution with a large sample</a></li>
<li class="chapter" data-level="7.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-simple-case-of-the-metropolis-algorithm"><i class="fa fa-check"></i><b>7.2</b> A simple case of the Metropolis algorithm</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-politician-stumbles-upon-the-metropolis-algorithm."><i class="fa fa-check"></i><b>7.2.1</b> A politician stumbles upon the Metropolis algorithm.</a></li>
<li class="chapter" data-level="7.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-random-walk."><i class="fa fa-check"></i><b>7.2.2</b> A random walk.</a></li>
<li class="chapter" data-level="7.2.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#general-properties-of-a-random-walk."><i class="fa fa-check"></i><b>7.2.3</b> General properties of a random walk.</a></li>
<li class="chapter" data-level="7.2.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#why-we-care."><i class="fa fa-check"></i><b>7.2.4</b> Why we care.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-metropolis-algorithm-more-generally"><i class="fa fa-check"></i><b>7.3</b> The Metropolis algorithm more generally</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithm-applied-to-bernoulli-likelihood-and-beta-prior."><i class="fa fa-check"></i><b>7.3.1</b> Metropolis algorithm applied to Bernoulli likelihood and beta prior.</a></li>
<li class="chapter" data-level="7.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#summary-of-metropolis-algorithm."><i class="fa fa-check"></i><b>7.3.2</b> Summary of Metropolis algorithm.</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#toward-gibbs-sampling-estimating-two-coin-biases"><i class="fa fa-check"></i><b>7.4</b> Toward Gibbs sampling: Estimating two coin biases</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#prior-likelihood-and-posterior-for-two-biases."><i class="fa fa-check"></i><b>7.4.1</b> Prior, likelihood and posterior for two biases.</a></li>
<li class="chapter" data-level="7.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-posterior-via-exact-formal-analysis."><i class="fa fa-check"></i><b>7.4.2</b> The posterior via exact formal analysis.</a></li>
<li class="chapter" data-level="7.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-posterior-via-the-metropolis-algorithm."><i class="fa fa-check"></i><b>7.4.3</b> The posterior via the Metropolis algorithm.</a></li>
<li class="chapter" data-level="7.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-hamiltonian-monte-carlo-sampling."><i class="fa fa-check"></i><b>7.4.4</b> <del>Gibbs</del> Hamiltonian Monte Carlo sampling.</a></li>
<li class="chapter" data-level="7.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#is-there-a-difference-between-biases"><i class="fa fa-check"></i><b>7.4.5</b> Is there a difference between biases?</a></li>
<li class="chapter" data-level="7.4.6" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#terminology-mcmc."><i class="fa fa-check"></i><b>7.4.6</b> Terminology: MCMC.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-representativeness-accuracy-and-efficiency"><i class="fa fa-check"></i><b>7.5</b> MCMC representativeness, accuracy, and efficiency</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-representativeness."><i class="fa fa-check"></i><b>7.5.1</b> MCMC representativeness.</a></li>
<li class="chapter" data-level="7.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-accuracy."><i class="fa fa-check"></i><b>7.5.2</b> MCMC accuracy.</a></li>
<li class="chapter" data-level="7.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-efficiency."><i class="fa fa-check"></i><b>7.5.3</b> MCMC efficiency.</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#summary-1"><i class="fa fa-check"></i><b>7.6</b> Summary</a></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#footnote-1"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="jags-brms.html"><a href="jags-brms.html"><i class="fa fa-check"></i><b>8</b> <del>JAGS</del> brms</a>
<ul>
<li class="chapter" data-level="8.1" data-path="jags-brms.html"><a href="jags-brms.html#jags-brms-and-its-relation-to-r"><i class="fa fa-check"></i><b>8.1</b> <del>JAGS</del> brms and its relation to R</a></li>
<li class="chapter" data-level="8.2" data-path="jags-brms.html"><a href="jags-brms.html#a-complete-example"><i class="fa fa-check"></i><b>8.2</b> A complete example</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="jags-brms.html"><a href="jags-brms.html#load-data."><i class="fa fa-check"></i><b>8.2.1</b> Load data.</a></li>
<li class="chapter" data-level="8.2.2" data-path="jags-brms.html"><a href="jags-brms.html#specify-model."><i class="fa fa-check"></i><b>8.2.2</b> Specify model.</a></li>
<li class="chapter" data-level="8.2.3" data-path="jags-brms.html"><a href="jags-brms.html#initialize-chains."><i class="fa fa-check"></i><b>8.2.3</b> Initialize chains.</a></li>
<li class="chapter" data-level="8.2.4" data-path="jags-brms.html"><a href="jags-brms.html#generate-chains."><i class="fa fa-check"></i><b>8.2.4</b> Generate chains.</a></li>
<li class="chapter" data-level="8.2.5" data-path="jags-brms.html"><a href="jags-brms.html#examine-chains."><i class="fa fa-check"></i><b>8.2.5</b> Examine chains.</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="jags-brms.html"><a href="jags-brms.html#simplified-scripts-for-frequently-used-analyses"><i class="fa fa-check"></i><b>8.3</b> Simplified scripts for frequently used analyses</a></li>
<li class="chapter" data-level="8.4" data-path="jags-brms.html"><a href="jags-brms.html#example-difference-of-biases"><i class="fa fa-check"></i><b>8.4</b> Example: Difference of biases</a></li>
<li class="chapter" data-level="8.5" data-path="jags-brms.html"><a href="jags-brms.html#sampling-from-the-prior-distribution-in-jags-brms"><i class="fa fa-check"></i><b>8.5</b> Sampling from the prior distribution in <del>JAGS</del> brms</a></li>
<li class="chapter" data-level="8.6" data-path="jags-brms.html"><a href="jags-brms.html#probability-distributions-available-in-jags-brms"><i class="fa fa-check"></i><b>8.6</b> Probability distributions available in <del>JAGS</del> brms</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="jags-brms.html"><a href="jags-brms.html#defining-new-likelihood-functions."><i class="fa fa-check"></i><b>8.6.1</b> Defining new likelihood functions.</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="jags-brms.html"><a href="jags-brms.html#faster-sampling-with-parallel-processing-in-runjags-brmsbrm"><i class="fa fa-check"></i><b>8.7</b> Faster sampling with parallel processing in <del>runjags</del> <code>brms::brm()</code></a></li>
<li class="chapter" data-level="8.8" data-path="jags-brms.html"><a href="jags-brms.html#tips-for-expanding-jags-brms-models"><i class="fa fa-check"></i><b>8.8</b> Tips for expanding <del>JAGS</del> brms models</a></li>
<li class="chapter" data-level="" data-path="jags-brms.html"><a href="jags-brms.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="hierarchical-models.html"><a href="hierarchical-models.html"><i class="fa fa-check"></i><b>9</b> Hierarchical Models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-single-coin-from-a-single-mint"><i class="fa fa-check"></i><b>9.1</b> A single coin from a single mint</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#posterior-via-grid-approximation."><i class="fa fa-check"></i><b>9.1.1</b> Posterior via grid approximation.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#multiple-coins-from-a-single-mint"><i class="fa fa-check"></i><b>9.2</b> Multiple coins from a single mint</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#posterior-via-grid-approximation.-1"><i class="fa fa-check"></i><b>9.2.1</b> Posterior via grid approximation.</a></li>
<li class="chapter" data-level="9.2.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-realistic-model-with-mcmc."><i class="fa fa-check"></i><b>9.2.2</b> A realistic model with MCMC.</a></li>
<li class="chapter" data-level="9.2.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#doing-it-with-jags-brms."><i class="fa fa-check"></i><b>9.2.3</b> Doing it with <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="9.2.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-therapeutic-touch."><i class="fa fa-check"></i><b>9.2.4</b> Example: Therapeutic touch.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#shrinkage-in-hierarchical-models"><i class="fa fa-check"></i><b>9.3</b> Shrinkage in hierarchical models</a></li>
<li class="chapter" data-level="9.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#speeding-up-jags-brms"><i class="fa fa-check"></i><b>9.4</b> Speeding up <del>JAGS</del> brms</a></li>
<li class="chapter" data-level="9.5" data-path="hierarchical-models.html"><a href="hierarchical-models.html#extending-the-hierarchy-subjects-within-categories"><i class="fa fa-check"></i><b>9.5</b> Extending the hierarchy: Subjects within categories</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-baseball-batting-abilities-by-position."><i class="fa fa-check"></i><b>9.5.1</b> Example: Baseball batting abilities by position.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hierarchical-models.html"><a href="hierarchical-models.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html"><i class="fa fa-check"></i><b>10</b> Model Comparison and Hierarchical Modeling</a>
<ul>
<li class="chapter" data-level="10.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#general-formula-and-the-bayes-factor"><i class="fa fa-check"></i><b>10.1</b> General formula and the Bayes factor</a></li>
<li class="chapter" data-level="10.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#example-two-factories-of-coins"><i class="fa fa-check"></i><b>10.2</b> Example: Two factories of coins</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-formal-analysis."><i class="fa fa-check"></i><b>10.2.1</b> Solution by formal analysis.</a></li>
<li class="chapter" data-level="10.2.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-grid-approximation."><i class="fa fa-check"></i><b>10.2.2</b> Solution by grid approximation.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-mcmc"><i class="fa fa-check"></i><b>10.3</b> Solution by MCMC</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#nonhierarchical-mcmc-computation-of-each-models-marginal-likelihood."><i class="fa fa-check"></i><b>10.3.1</b> Nonhierarchical MCMC computation of each model’s marginal likelihood.</a></li>
<li class="chapter" data-level="10.3.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#hierarchical-mcmc-computation-of-relative-model-probability-is-not-available-in-brms-well-cover-information-criteria-instead."><i class="fa fa-check"></i><b>10.3.2</b> Hierarchical MCMC computation <del>of relative model probability</del> is not available in brms: We’ll cover information criteria instead.</a></li>
<li class="chapter" data-level="10.3.3" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#models-with-different-noise-distributions-in-jags-brms."><i class="fa fa-check"></i><b>10.3.3</b> Models with different “noise” distributions in <del>JAGS</del> brms.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#prediction-model-averaging"><i class="fa fa-check"></i><b>10.4</b> Prediction: Model averaging</a></li>
<li class="chapter" data-level="10.5" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#model-complexity-naturally-accounted-for"><i class="fa fa-check"></i><b>10.5</b> Model complexity naturally accounted for</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#caveats-regarding-nested-model-comparison."><i class="fa fa-check"></i><b>10.5.1</b> Caveats regarding nested model comparison.</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#extreme-sensitivity-to-prior-distribution"><i class="fa fa-check"></i><b>10.6</b> Extreme sensitivity to prior distribution</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#priors-of-different-models-should-be-equally-informed."><i class="fa fa-check"></i><b>10.6.1</b> Priors of different models should be equally informed.</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#bonus-theres-danger-ahead"><i class="fa fa-check"></i><b>10.7</b> Bonus: There’s danger ahead</a></li>
<li class="chapter" data-level="" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#footnote-2"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html"><i class="fa fa-check"></i><b>11</b> Null Hypothesis Significance Testing</a>
<ul>
<li class="chapter" data-level="11.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#paved-with-good-intentions"><i class="fa fa-check"></i><b>11.1</b> Paved with good intentions</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#definition-of-p-value."><i class="fa fa-check"></i><b>11.1.1</b> Definition of <span class="math inline">\(p\)</span> value.</a></li>
<li class="chapter" data-level="11.1.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-fix-n."><i class="fa fa-check"></i><b>11.1.2</b> With intention to fix <span class="math inline">\(N\)</span>.</a></li>
<li class="chapter" data-level="11.1.3" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-fix-z."><i class="fa fa-check"></i><b>11.1.3</b> With intention to fix <span class="math inline">\(z\)</span>.</a></li>
<li class="chapter" data-level="11.1.4" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-fix-duration."><i class="fa fa-check"></i><b>11.1.4</b> With intention to fix duration.</a></li>
<li class="chapter" data-level="11.1.5" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-make-multiple-tests."><i class="fa fa-check"></i><b>11.1.5</b> With intention to make multiple tests.</a></li>
<li class="chapter" data-level="11.1.6" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#soul-searching."><i class="fa fa-check"></i><b>11.1.6</b> Soul searching.</a></li>
<li class="chapter" data-level="11.1.7" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#bayesian-analysis."><i class="fa fa-check"></i><b>11.1.7</b> Bayesian analysis.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#prior-knowledge"><i class="fa fa-check"></i><b>11.2</b> Prior knowledge</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#nhst-analysis."><i class="fa fa-check"></i><b>11.2.1</b> NHST analysis.</a></li>
<li class="chapter" data-level="11.2.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#bayesian-analysis.-1"><i class="fa fa-check"></i><b>11.2.2</b> Bayesian analysis.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#confidence-interval-and-highest-density-interval"><i class="fa fa-check"></i><b>11.3</b> Confidence interval and highest density interval</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#ci-depends-on-intention."><i class="fa fa-check"></i><b>11.3.1</b> CI depends on intention.</a></li>
<li class="chapter" data-level="11.3.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#bayesian-hdi."><i class="fa fa-check"></i><b>11.3.2</b> Bayesian HDI.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#multiple-comparisons"><i class="fa fa-check"></i><b>11.4</b> Multiple comparisons</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#nhst-correction-for-experiment-wise-error."><i class="fa fa-check"></i><b>11.4.1</b> NHST correction for experiment wise error.</a></li>
<li class="chapter" data-level="11.4.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#just-one-bayesian-posterior-no-matter-how-you-look-at-it."><i class="fa fa-check"></i><b>11.4.2</b> Just one Bayesian posterior no matter how you look at it.</a></li>
<li class="chapter" data-level="11.4.3" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#how-bayesian-analysis-mitigates-false-alarms."><i class="fa fa-check"></i><b>11.4.3</b> How Bayesian analysis mitigates false alarms.</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#what-a-sampling-distribution-is-good-for"><i class="fa fa-check"></i><b>11.5</b> What a sampling distribution is good for</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#planning-an-experiment."><i class="fa fa-check"></i><b>11.5.1</b> Planning an experiment.</a></li>
<li class="chapter" data-level="11.5.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#exploring-model-predictions-posterior-predictive-check."><i class="fa fa-check"></i><b>11.5.2</b> Exploring model predictions (posterior predictive check).</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#footnote-3"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><i class="fa fa-check"></i><b>12</b> Bayesian Approaches to Testing a Point (“Null”) Hypothesis</a>
<ul>
<li class="chapter" data-level="12.1" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#the-estimation-approach"><i class="fa fa-check"></i><b>12.1</b> The estimation approach</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#region-of-practical-equivalence."><i class="fa fa-check"></i><b>12.1.1</b> Region of practical equivalence.</a></li>
<li class="chapter" data-level="12.1.2" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#some-examples."><i class="fa fa-check"></i><b>12.1.2</b> Some examples.</a></li>
<li class="chapter" data-level="12.1.3" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#differences-of-correlated-parameters."><i class="fa fa-check"></i><b>12.1.3</b> Differences of correlated parameters.</a></li>
<li class="chapter" data-level="12.1.4" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#why-hdi-and-not-equal-tailed-interval"><i class="fa fa-check"></i><b>12.1.4</b> Why HDI and not equal-tailed interval?</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#the-model-comparison-approach"><i class="fa fa-check"></i><b>12.2</b> The model-comparison approach</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#is-a-coin-fair-or-not"><i class="fa fa-check"></i><b>12.2.1</b> Is a coin fair or not?</a></li>
<li class="chapter" data-level="12.2.2" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#are-different-groups-equal-or-not"><i class="fa fa-check"></i><b>12.2.2</b> Are different groups equal or not?</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#relations-of-parameter-estimation-and-model-comparison"><i class="fa fa-check"></i><b>12.3</b> Relations of parameter estimation and model comparison</a></li>
<li class="chapter" data-level="12.4" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#estimation-and-model-comparison"><i class="fa fa-check"></i><b>12.4</b> Estimation and model comparison?</a></li>
<li class="chapter" data-level="" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html"><i class="fa fa-check"></i><b>13</b> Goals, Power, and Sample Size</a>
<ul>
<li class="chapter" data-level="13.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#the-will-to-power"><i class="fa fa-check"></i><b>13.1</b> The will to power</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#goals-and-obstacles."><i class="fa fa-check"></i><b>13.1.1</b> Goals and obstacles.</a></li>
<li class="chapter" data-level="13.1.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power."><i class="fa fa-check"></i><b>13.1.2</b> Power.</a></li>
<li class="chapter" data-level="13.1.3" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#sample-size."><i class="fa fa-check"></i><b>13.1.3</b> Sample size.</a></li>
<li class="chapter" data-level="13.1.4" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#other-expressions-of-goals."><i class="fa fa-check"></i><b>13.1.4</b> Other expressions of goals.</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#computing-power-and-sample-size"><i class="fa fa-check"></i><b>13.2</b> Computing power and sample size</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#when-the-goal-is-to-exclude-a-null-value."><i class="fa fa-check"></i><b>13.2.1</b> When the goal is to exclude a null value.</a></li>
<li class="chapter" data-level="13.2.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#formal-solution-and-implementation-in-r."><i class="fa fa-check"></i><b>13.2.2</b> Formal solution and implementation in R.</a></li>
<li class="chapter" data-level="13.2.3" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#when-the-goal-is-precision."><i class="fa fa-check"></i><b>13.2.3</b> When the goal is precision.</a></li>
<li class="chapter" data-level="13.2.4" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#monte-carlo-approximation-of-power."><i class="fa fa-check"></i><b>13.2.4</b> Monte Carlo approximation of power.</a></li>
<li class="chapter" data-level="13.2.5" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power-from-idealized-or-actual-data."><i class="fa fa-check"></i><b>13.2.5</b> Power from idealized or actual data.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#sequential-testing-and-the-goal-of-precision"><i class="fa fa-check"></i><b>13.3</b> Sequential testing and the goal of precision</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#examples-of-sequential-tests."><i class="fa fa-check"></i><b>13.3.1</b> Examples of sequential tests.</a></li>
<li class="chapter" data-level="13.3.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#average-behavior-of-sequential-tests."><i class="fa fa-check"></i><b>13.3.2</b> Average behavior of sequential tests.</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#discussion"><i class="fa fa-check"></i><b>13.4</b> Discussion</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power-and-multiple-comparisons."><i class="fa fa-check"></i><b>13.4.1</b> Power and multiple comparisons.</a></li>
<li class="chapter" data-level="13.4.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power-prospective-retrospective-and-replication."><i class="fa fa-check"></i><b>13.4.2</b> Power: prospective, retrospective, and replication.</a></li>
<li class="chapter" data-level="13.4.3" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power-analysis-requires-verisimilitude-of-simulated-data."><i class="fa fa-check"></i><b>13.4.3</b> Power analysis requires verisimilitude of simulated data.</a></li>
<li class="chapter" data-level="13.4.4" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#the-importance-of-planning."><i class="fa fa-check"></i><b>13.4.4</b> The importance of planning.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="stan.html"><a href="stan.html"><i class="fa fa-check"></i><b>14</b> Stan</a>
<ul>
<li class="chapter" data-level="14.1" data-path="stan.html"><a href="stan.html#hmc-sampling"><i class="fa fa-check"></i><b>14.1</b> HMC sampling</a></li>
<li class="chapter" data-level="14.2" data-path="stan.html"><a href="stan.html#installing-stan"><i class="fa fa-check"></i><b>14.2</b> Installing Stan</a></li>
<li class="chapter" data-level="14.3" data-path="stan.html"><a href="stan.html#a-complete-example-1"><i class="fa fa-check"></i><b>14.3</b> A Complete example</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="stan.html"><a href="stan.html#reusing-the-compiled-model."><i class="fa fa-check"></i><b>14.3.1</b> Reusing the compiled model.</a></li>
<li class="chapter" data-level="14.3.2" data-path="stan.html"><a href="stan.html#general-structure-of-stan-model-specification."><i class="fa fa-check"></i><b>14.3.2</b> General structure of Stan model specification.</a></li>
<li class="chapter" data-level="14.3.3" data-path="stan.html"><a href="stan.html#think-log-probability-to-think-like-stan."><i class="fa fa-check"></i><b>14.3.3</b> Think log probability to think like Stan.</a></li>
<li class="chapter" data-level="14.3.4" data-path="stan.html"><a href="stan.html#sampling-the-prior-in-stan."><i class="fa fa-check"></i><b>14.3.4</b> Sampling the prior in Stan.</a></li>
<li class="chapter" data-level="14.3.5" data-path="stan.html"><a href="stan.html#simplified-scripts-for-frequently-used-analyses."><i class="fa fa-check"></i><b>14.3.5</b> Simplified scripts for frequently used analyses.</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="stan.html"><a href="stan.html#specify-models-top-down-in-stan"><i class="fa fa-check"></i><b>14.4</b> Specify models top-down in Stan</a></li>
<li class="chapter" data-level="14.5" data-path="stan.html"><a href="stan.html#limitations-and-extras"><i class="fa fa-check"></i><b>14.5</b> Limitations and extras</a></li>
<li class="chapter" data-level="" data-path="stan.html"><a href="stan.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="stan.html"><a href="stan.html#footnote-4"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>15</b> Overview of the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="15.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#types-of-variables"><i class="fa fa-check"></i><b>15.1</b> Types of variables</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#predictor-and-predicted-variables."><i class="fa fa-check"></i><b>15.1.1</b> Predictor and predicted variables.</a></li>
<li class="chapter" data-level="15.1.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#scale-types-metric-ordinal-nominal-and-count."><i class="fa fa-check"></i><b>15.1.2</b> Scale types: metric, ordinal, nominal, and count.</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#linear-combination-of-predictors"><i class="fa fa-check"></i><b>15.2</b> Linear combination of predictors</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#linear-function-of-a-single-metric-predictor."><i class="fa fa-check"></i><b>15.2.1</b> Linear function of a single metric predictor.</a></li>
<li class="chapter" data-level="15.2.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#additive-combination-of-metric-predictors."><i class="fa fa-check"></i><b>15.2.2</b> Additive combination of metric predictors.</a></li>
<li class="chapter" data-level="15.2.3" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#nonadditive-interaction-of-metric-predictors."><i class="fa fa-check"></i><b>15.2.3</b> Nonadditive interaction of metric predictors.</a></li>
<li class="chapter" data-level="15.2.4" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#nominal-predictors."><i class="fa fa-check"></i><b>15.2.4</b> Nominal predictors.</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#linking-from-combined-predictors-to-noisy-predicted-data"><i class="fa fa-check"></i><b>15.3</b> Linking from combined predictors to noisy predicted data</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#from-predictors-to-predicted-central-tendency."><i class="fa fa-check"></i><b>15.3.1</b> From predictors to predicted central tendency.</a></li>
<li class="chapter" data-level="15.3.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#from-predicted-central-tendency-to-noisy-data."><i class="fa fa-check"></i><b>15.3.2</b> From predicted central tendency to noisy data.</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#formal-expression-of-the-glm"><i class="fa fa-check"></i><b>15.4</b> Formal expression of the GLM</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#cases-of-the-glm."><i class="fa fa-check"></i><b>15.4.1</b> Cases of the GLM.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#session-info-14"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html"><i class="fa fa-check"></i><b>16</b> Metric-Predicted Variable on One or Two Groups</a>
<ul>
<li class="chapter" data-level="16.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#estimating-the-mean-and-standard-deviation-of-a-normal-distribution"><i class="fa fa-check"></i><b>16.1</b> Estimating the mean and standard deviation of a normal distribution</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#solution-by-mathematical-analysis-heads-up-on-precision."><i class="fa fa-check"></i><b>16.1.1</b> <del>Solution by mathematical analysis</del> Heads up on precision.</a></li>
<li class="chapter" data-level="16.1.2" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#approximation-by-mcmc-in-jags-hmc-in-brms."><i class="fa fa-check"></i><b>16.1.2</b> Approximation by <del>MCMC in JAGS</del> HMC in brms.</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#outliers-and-robust-estimation-the-t-distribution"><i class="fa fa-check"></i><b>16.2</b> Outliers and robust estimation: The <span class="math inline">\(t\)</span> distribution</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#using-the-t-distribution-in-jags-brms."><i class="fa fa-check"></i><b>16.2.1</b> Using the <span class="math inline">\(t\)</span> distribution in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="16.2.2" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#using-the-t-distribution-in-stan."><i class="fa fa-check"></i><b>16.2.2</b> Using the <span class="math inline">\(t\)</span> distribution in Stan.</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#two-groups"><i class="fa fa-check"></i><b>16.3</b> Two groups</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#analysis-by-nhst."><i class="fa fa-check"></i><b>16.3.1</b> Analysis by NHST.</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#other-noise-distributions-and-transforming-data"><i class="fa fa-check"></i><b>16.4</b> Other noise distributions and transforming data</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#session-info-15"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html"><i class="fa fa-check"></i><b>17</b> Metric Predicted Variable with One Metric Predictor</a>
<ul>
<li class="chapter" data-level="17.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#simple-linear-regression"><i class="fa fa-check"></i><b>17.1</b> Simple linear regression</a></li>
<li class="chapter" data-level="17.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#robust-linear-regression"><i class="fa fa-check"></i><b>17.2</b> Robust linear regression</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#robust-linear-regression-in-jags-brms."><i class="fa fa-check"></i><b>17.2.1</b> Robust linear regression in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="17.2.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#robust-linear-regression-in-stan."><i class="fa fa-check"></i><b>17.2.2</b> Robust linear regression in Stan.</a></li>
<li class="chapter" data-level="17.2.3" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#stan-or-jags"><i class="fa fa-check"></i><b>17.2.3</b> Stan or JAGS?</a></li>
<li class="chapter" data-level="17.2.4" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#interpreting-the-posterior-distribution."><i class="fa fa-check"></i><b>17.2.4</b> Interpreting the posterior distribution.</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#hierarchical-regression-on-individuals-within-groups"><i class="fa fa-check"></i><b>17.3</b> Hierarchical regression on individuals within groups</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#the-model-and-implementation-in-jags-brms."><i class="fa fa-check"></i><b>17.3.1</b> The model and implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="17.3.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#the-posterior-distribution-shrinkage-and-prediction."><i class="fa fa-check"></i><b>17.3.2</b> The posterior distribution: Shrinkage and prediction.</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#quadratic-trend-and-weighted-data"><i class="fa fa-check"></i><b>17.4</b> Quadratic trend and weighted data</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#results-and-interpretation."><i class="fa fa-check"></i><b>17.4.1</b> Results and interpretation.</a></li>
<li class="chapter" data-level="17.4.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#further-extensions."><i class="fa fa-check"></i><b>17.4.2</b> Further extensions.</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#procedure-and-perils-for-expanding-a-model"><i class="fa fa-check"></i><b>17.5</b> Procedure and perils for expanding a model</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#session-info-16"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html"><i class="fa fa-check"></i><b>18</b> Metric Predicted Variable with Multiple Metric Predictors</a>
<ul>
<li class="chapter" data-level="18.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#multiple-linear-regression"><i class="fa fa-check"></i><b>18.1</b> Multiple linear regression</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#the-perils-of-correlated-predictors."><i class="fa fa-check"></i><b>18.1.1</b> The perils of correlated predictors.</a></li>
<li class="chapter" data-level="18.1.2" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#the-model-and-implementation."><i class="fa fa-check"></i><b>18.1.2</b> The model and implementation.</a></li>
<li class="chapter" data-level="18.1.3" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#the-posterior-distribution."><i class="fa fa-check"></i><b>18.1.3</b> The posterior distribution.</a></li>
<li class="chapter" data-level="18.1.4" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#redundant-predictors."><i class="fa fa-check"></i><b>18.1.4</b> Redundant predictors.</a></li>
<li class="chapter" data-level="18.1.5" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#informative-priors-sparse-data-and-correlated-predictors."><i class="fa fa-check"></i><b>18.1.5</b> Informative priors, sparse data, and correlated predictors.</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#multiplicative-interaction-of-metric-predictors"><i class="fa fa-check"></i><b>18.2</b> Multiplicative interaction of metric predictors</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#an-example."><i class="fa fa-check"></i><b>18.2.1</b> An example.</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#shrinkage-of-regression-coefficients"><i class="fa fa-check"></i><b>18.3</b> Shrinkage of regression coefficients</a></li>
<li class="chapter" data-level="18.4" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#variable-selection"><i class="fa fa-check"></i><b>18.4</b> Variable selection</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#inclusion-probability-is-strongly-affected-by-vagueness-of-prior."><i class="fa fa-check"></i><b>18.4.1</b> Inclusion probability is strongly affected by vagueness of prior.</a></li>
<li class="chapter" data-level="18.4.2" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#variable-selection-with-hierarchical-shrinkage."><i class="fa fa-check"></i><b>18.4.2</b> Variable selection with hierarchical shrinkage.</a></li>
<li class="chapter" data-level="18.4.3" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#what-to-report-and-what-to-conclude."><i class="fa fa-check"></i><b>18.4.3</b> What to report and what to conclude.</a></li>
<li class="chapter" data-level="18.4.4" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#caution-computational-methods."><i class="fa fa-check"></i><b>18.4.4</b> Caution: Computational methods.</a></li>
<li class="chapter" data-level="18.4.5" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#caution-interaction-variables."><i class="fa fa-check"></i><b>18.4.5</b> Caution: Interaction variables.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#session-info-17"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#footnote-5"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html"><i class="fa fa-check"></i><b>19</b> Metric Predicted Variable with One Nominal Predictor</a>
<ul>
<li class="chapter" data-level="19.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#describing-multiple-groups-of-metric-data"><i class="fa fa-check"></i><b>19.1</b> Describing multiple groups of metric data</a></li>
<li class="chapter" data-level="19.2" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#traditional-analysis-of-variance"><i class="fa fa-check"></i><b>19.2</b> Traditional analysis of variance</a></li>
<li class="chapter" data-level="19.3" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#hierarchical-bayesian-approach"><i class="fa fa-check"></i><b>19.3</b> Hierarchical Bayesian approach</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#implementation-in-jags-brms."><i class="fa fa-check"></i><b>19.3.1</b> Implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="19.3.2" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#example-sex-and-death."><i class="fa fa-check"></i><b>19.3.2</b> Example: Sex and death.</a></li>
<li class="chapter" data-level="19.3.3" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#contrasts."><i class="fa fa-check"></i><b>19.3.3</b> Contrasts.</a></li>
<li class="chapter" data-level="19.3.4" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#multiple-comparisons-and-shrinkage."><i class="fa fa-check"></i><b>19.3.4</b> Multiple comparisons and shrinkage.</a></li>
<li class="chapter" data-level="19.3.5" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#the-two-group-case."><i class="fa fa-check"></i><b>19.3.5</b> The two-group case.</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#including-a-metric-predictor"><i class="fa fa-check"></i><b>19.4</b> Including a metric predictor</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#example-sex-death-and-size."><i class="fa fa-check"></i><b>19.4.1</b> Example: Sex, death, and size.</a></li>
<li class="chapter" data-level="19.4.2" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#analogous-to-traditional-ancova."><i class="fa fa-check"></i><b>19.4.2</b> Analogous to traditional ANCOVA.</a></li>
<li class="chapter" data-level="19.4.3" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#relation-to-hierarchical-linear-regression."><i class="fa fa-check"></i><b>19.4.3</b> Relation to hierarchical linear regression.</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#heterogeneous-variances-and-robustness-against-outliers"><i class="fa fa-check"></i><b>19.5</b> Heterogeneous variances and robustness against outliers</a>
<ul>
<li class="chapter" data-level="19.5.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#example-contrast-of-means-with-different-variances."><i class="fa fa-check"></i><b>19.5.1</b> Example: Contrast of means with different variances.</a></li>
</ul></li>
<li class="chapter" data-level="19.6" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#exercises-walk-out-an-effect-size"><i class="fa fa-check"></i><b>19.6</b> <del>Exercises</del> Walk out an effect size</a>
<ul>
<li class="chapter" data-level="19.6.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#your-sample-sizes-may-differ."><i class="fa fa-check"></i><b>19.6.1</b> Your sample sizes may differ.</a></li>
<li class="chapter" data-level="19.6.2" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#populations-and-samples."><i class="fa fa-check"></i><b>19.6.2</b> Populations and samples.</a></li>
<li class="chapter" data-level="19.6.3" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#report-your-effect-sizes-effectively."><i class="fa fa-check"></i><b>19.6.3</b> Report your effect sizes effectively.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#session-info-18"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html"><i class="fa fa-check"></i><b>20</b> Metric Predicted Variable with Multiple Nominal Predictors</a>
<ul>
<li class="chapter" data-level="20.1" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#describing-groups-of-metric-data-with-multiple-nominal-predictors"><i class="fa fa-check"></i><b>20.1</b> Describing groups of metric data with multiple nominal predictors</a>
<ul>
<li class="chapter" data-level="20.1.1" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#interaction."><i class="fa fa-check"></i><b>20.1.1</b> Interaction.</a></li>
<li class="chapter" data-level="20.1.2" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#traditional-anova."><i class="fa fa-check"></i><b>20.1.2</b> Traditional ANOVA.</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#hierarchical-bayesian-approach-1"><i class="fa fa-check"></i><b>20.2</b> Hierarchical Bayesian approach</a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#implementation-in-jags-brms.-1"><i class="fa fa-check"></i><b>20.2.1</b> Implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="20.2.2" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#example-its-only-money."><i class="fa fa-check"></i><b>20.2.2</b> Example: It’s only money.</a></li>
<li class="chapter" data-level="20.2.3" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#main-effect-contrasts."><i class="fa fa-check"></i><b>20.2.3</b> Main effect contrasts.</a></li>
<li class="chapter" data-level="20.2.4" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#interaction-contrasts-and-simple-effects."><i class="fa fa-check"></i><b>20.2.4</b> Interaction contrasts and simple effects.</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#rescaling-can-change-interactions-homogeneity-and-normality"><i class="fa fa-check"></i><b>20.3</b> Rescaling can change interactions, homogeneity, and normality</a></li>
<li class="chapter" data-level="20.4" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#heterogeneous-variances-and-robustness-against-outliers-1"><i class="fa fa-check"></i><b>20.4</b> Heterogeneous variances and robustness against outliers</a></li>
<li class="chapter" data-level="20.5" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#within-subject-designs"><i class="fa fa-check"></i><b>20.5</b> Within-subject designs</a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#why-use-a-within-subject-design-and-why-not"><i class="fa fa-check"></i><b>20.5.1</b> Why use a within-subject design? And why not?</a></li>
<li class="chapter" data-level="20.5.2" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#split-plot-design."><i class="fa fa-check"></i><b>20.5.2</b> Split-plot design.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#session-info-19"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#footnote-6"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html"><i class="fa fa-check"></i><b>21</b> Dichotomous Predicted Variable</a>
<ul>
<li class="chapter" data-level="21.1" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#multiple-metric-predictors"><i class="fa fa-check"></i><b>21.1</b> Multiple metric predictors</a>
<ul>
<li class="chapter" data-level="21.1.1" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#the-model-and-implementation-in-jags-brms.-1"><i class="fa fa-check"></i><b>21.1.1</b> The model and implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="21.1.2" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#example-height-weight-and-gender."><i class="fa fa-check"></i><b>21.1.2</b> Example: Height, weight, and gender.</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#interpreting-the-regression-coefficients"><i class="fa fa-check"></i><b>21.2</b> Interpreting the regression coefficients</a>
<ul>
<li class="chapter" data-level="21.2.1" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#log-odds."><i class="fa fa-check"></i><b>21.2.1</b> Log odds.</a></li>
<li class="chapter" data-level="21.2.2" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#when-there-are-few-1s-or-0s-in-the-data."><i class="fa fa-check"></i><b>21.2.2</b> When there are few 1’s or 0’s in the data.</a></li>
<li class="chapter" data-level="21.2.3" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#correlated-predictors."><i class="fa fa-check"></i><b>21.2.3</b> Correlated predictors.</a></li>
<li class="chapter" data-level="21.2.4" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#interaction-of-metric-predictors."><i class="fa fa-check"></i><b>21.2.4</b> Interaction of metric predictors.</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#robust-logistic-regression"><i class="fa fa-check"></i><b>21.3</b> Robust logistic regression</a></li>
<li class="chapter" data-level="21.4" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#nominal-predictors"><i class="fa fa-check"></i><b>21.4</b> Nominal predictors</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#single-group."><i class="fa fa-check"></i><b>21.4.1</b> Single group.</a></li>
<li class="chapter" data-level="21.4.2" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#multiple-groups."><i class="fa fa-check"></i><b>21.4.2</b> Multiple groups.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#session-info-20"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html"><i class="fa fa-check"></i><b>22</b> Nominal Predicted Variable</a>
<ul>
<li class="chapter" data-level="22.1" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#softmax-regression"><i class="fa fa-check"></i><b>22.1</b> Softmax regression</a>
<ul>
<li class="chapter" data-level="22.1.1" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#softmax-reduces-to-logistic-for-two-outcomes."><i class="fa fa-check"></i><b>22.1.1</b> Softmax reduces to logistic for two outcomes.</a></li>
<li class="chapter" data-level="22.1.2" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#independence-from-irrelevant-attributes."><i class="fa fa-check"></i><b>22.1.2</b> Independence from irrelevant attributes.</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#conditional-logistic-regression"><i class="fa fa-check"></i><b>22.2</b> Conditional logistic regression</a></li>
<li class="chapter" data-level="22.3" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#implementation-in-jags-brms"><i class="fa fa-check"></i><b>22.3</b> Implementation in <del>JAGS</del> brms</a>
<ul>
<li class="chapter" data-level="22.3.1" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#softmax-model."><i class="fa fa-check"></i><b>22.3.1</b> Softmax model.</a></li>
<li class="chapter" data-level="22.3.2" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#conditional-logistic-model."><i class="fa fa-check"></i><b>22.3.2</b> Conditional logistic model.</a></li>
<li class="chapter" data-level="22.3.3" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#results-interpreting-the-regression-coefficients."><i class="fa fa-check"></i><b>22.3.3</b> Results: Interpreting the regression coefficients.</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#generalizations-and-variations-of-the-models"><i class="fa fa-check"></i><b>22.4</b> Generalizations and variations of the models</a></li>
<li class="chapter" data-level="" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#session-info-21"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html"><i class="fa fa-check"></i><b>23</b> Ordinal Predicted Variable</a>
<ul>
<li class="chapter" data-level="23.1" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#modeling-ordinal-data-with-an-underlying-metric-variable"><i class="fa fa-check"></i><b>23.1</b> Modeling ordinal data with an underlying metric variable</a></li>
<li class="chapter" data-level="23.2" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#the-case-of-a-single-group"><i class="fa fa-check"></i><b>23.2</b> The case of a single group</a>
<ul>
<li class="chapter" data-level="23.2.1" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#implementation-in-jags-brms.-3"><i class="fa fa-check"></i><b>23.2.1</b> Implementation in <del>JAGS</del> <strong>brms</strong>.</a></li>
<li class="chapter" data-level="23.2.2" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#examples-bayesian-estimation-recovers-true-parameter-values."><i class="fa fa-check"></i><b>23.2.2</b> Examples: Bayesian estimation recovers true parameter values.</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#the-case-of-two-groups"><i class="fa fa-check"></i><b>23.3</b> The case of two groups</a>
<ul>
<li class="chapter" data-level="23.3.1" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#implementation-in-jags-brms.-4"><i class="fa fa-check"></i><b>23.3.1</b> Implementation in <del>JAGS</del> <strong>brms</strong>.</a></li>
<li class="chapter" data-level="23.3.2" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#examples-not-funny."><i class="fa fa-check"></i><b>23.3.2</b> Examples: Not funny.</a></li>
</ul></li>
<li class="chapter" data-level="23.4" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#the-case-of-metric-predictors"><i class="fa fa-check"></i><b>23.4</b> The Case of metric predictors</a>
<ul>
<li class="chapter" data-level="23.4.1" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#implementation-in-jags-brms.-5"><i class="fa fa-check"></i><b>23.4.1</b> Implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="23.4.2" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#example-happiness-and-money."><i class="fa fa-check"></i><b>23.4.2</b> Example: Happiness and money.</a></li>
<li class="chapter" data-level="23.4.3" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#example-moviesthey-dont-make-em-like-they-used-to."><i class="fa fa-check"></i><b>23.4.3</b> Example: Movies–They don’t make ’em like they used to.</a></li>
<li class="chapter" data-level="23.4.4" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#why-are-some-thresholds-outside-the-data"><i class="fa fa-check"></i><b>23.4.4</b> Why are some thresholds outside the data?</a></li>
</ul></li>
<li class="chapter" data-level="23.5" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#posterior-prediction"><i class="fa fa-check"></i><b>23.5</b> Posterior prediction</a></li>
<li class="chapter" data-level="23.6" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#generalizations-and-extensions"><i class="fa fa-check"></i><b>23.6</b> Generalizations and extensions</a></li>
<li class="chapter" data-level="" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#session-info-22"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html"><i class="fa fa-check"></i><b>24</b> Count Predicted Variable</a>
<ul>
<li class="chapter" data-level="24.1" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#poisson-exponential-model"><i class="fa fa-check"></i><b>24.1</b> Poisson exponential model</a>
<ul>
<li class="chapter" data-level="24.1.1" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#data-structure."><i class="fa fa-check"></i><b>24.1.1</b> Data structure.</a></li>
<li class="chapter" data-level="24.1.2" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#exponential-link-function."><i class="fa fa-check"></i><b>24.1.2</b> Exponential link function.</a></li>
<li class="chapter" data-level="24.1.3" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#poisson-noise-distribution."><i class="fa fa-check"></i><b>24.1.3</b> Poisson noise distribution.</a></li>
<li class="chapter" data-level="24.1.4" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#the-complete-model-and-implementation-in-jags-brms."><i class="fa fa-check"></i><b>24.1.4</b> The complete model and implementation in <del>JAGS</del> brms.</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#example-hair-eye-go-again"><i class="fa fa-check"></i><b>24.2</b> Example: Hair eye go again</a></li>
<li class="chapter" data-level="24.3" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#example-interaction-contrasts-shrinkage-and-omnibus-test"><i class="fa fa-check"></i><b>24.3</b> Example: Interaction contrasts, shrinkage, and omnibus test</a></li>
<li class="chapter" data-level="24.4" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#log-linear-models-for-contingency-tables-bonus-alternative-parameterization"><i class="fa fa-check"></i><b>24.4</b> <del>Log-linear models for contingency tables</del> Bonus: Alternative parameterization</a></li>
<li class="chapter" data-level="" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#session-info-23"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html"><i class="fa fa-check"></i><b>25</b> Tools in the Trunk</a>
<ul>
<li class="chapter" data-level="25.1" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#reporting-a-bayesian-analysis"><i class="fa fa-check"></i><b>25.1</b> Reporting a Bayesian analysis</a>
<ul>
<li class="chapter" data-level="25.1.1" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#essential-points."><i class="fa fa-check"></i><b>25.1.1</b> Essential points.</a></li>
<li class="chapter" data-level="25.1.2" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#optional-points."><i class="fa fa-check"></i><b>25.1.2</b> Optional points.</a></li>
<li class="chapter" data-level="25.1.3" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#helpful-points."><i class="fa fa-check"></i><b>25.1.3</b> Helpful points.</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#functions-for-computing-highest-density-intervals"><i class="fa fa-check"></i><b>25.2</b> Functions for computing highest density intervals</a>
<ul>
<li class="chapter" data-level="25.2.1" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#r-code-for-computing-hdi-of-a-grid-approximation."><i class="fa fa-check"></i><b>25.2.1</b> R code for computing HDI of a grid approximation.</a></li>
<li class="chapter" data-level="25.2.2" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#hdi-of-unimodal-distribution-is-shortest-interval."><i class="fa fa-check"></i><b>25.2.2</b> HDI of unimodal distribution is shortest interval.</a></li>
<li class="chapter" data-level="25.2.3" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#r-code-for-computing-hdi-of-a-mcmc-sample."><i class="fa fa-check"></i><b>25.2.3</b> R code for computing HDI of a MCMC sample.</a></li>
<li class="chapter" data-level="25.2.4" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#r-code-for-computing-hdi-of-a-function."><i class="fa fa-check"></i><b>25.2.4</b> R code for computing HDI of a function.</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#reparameterization"><i class="fa fa-check"></i><b>25.3</b> Reparameterization</a></li>
<li class="chapter" data-level="25.4" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#censored-data-in-jags-brms"><i class="fa fa-check"></i><b>25.4</b> Censored data in <del>JAGS</del> brms</a>
<ul>
<li class="chapter" data-level="25.4.1" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#right-censoring-when-youre-uncertain-beyond-a-single-threshold."><i class="fa fa-check"></i><b>25.4.1</b> Right censoring: When you’re uncertain beyond a single threshold.</a></li>
<li class="chapter" data-level="25.4.2" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#interval-censoring-when-your-values-are-somewhere-in-the-middle."><i class="fa fa-check"></i><b>25.4.2</b> Interval censoring: When your values are somewhere in the middle.</a></li>
<li class="chapter" data-level="25.4.3" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#complex-censoring-when-the-going-gets-tough"><i class="fa fa-check"></i><b>25.4.3</b> Complex censoring: When the going gets tough…</a></li>
<li class="chapter" data-level="25.4.4" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#bonus-truncation."><i class="fa fa-check"></i><b>25.4.4</b> Bonus: Truncation.</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#what-next"><i class="fa fa-check"></i><b>25.5</b> What Next?</a></li>
<li class="chapter" data-level="" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#session-info-24"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Doing Bayesian Data Analysis</em> in brms and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="markov-chain-monte-carlo" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Markov Chain Monte Carlo<a href="markov-chain-monte-carlo.html#markov-chain-monte-carlo" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<blockquote>
<p>This chapter introduces the methods we will use for producing accurate approximations to Bayesian posterior distributions for realistic applications. The class of methods is called Markov chain Monte Carlo (MCMC), for reasons that will be explained later in the chapter. It is MCMC algorithms and software, along with fast computer hardware, that allow us to do Bayesian data analysis for realistic applications that would have been effectively impossible <span class="math inline">\(30\)</span> years ago. <span class="citation">(<a href="#ref-kruschkeDoingBayesianData2015" role="doc-biblioref">Kruschke, 2015, p. 144</a>)</span></p>
</blockquote>
<p>Statistician David Draper covered some of the history of MCMC in his lecture, <a href="https://www.youtube.com/watch?v=072Q18nX91I&amp;frags=pl%2Cwn"><em>Bayesian Statistical Reasoning</em></a>.</p>
<div id="approximating-a-distribution-with-a-large-sample" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Approximating a distribution with a large sample<a href="markov-chain-monte-carlo.html#approximating-a-distribution-with-a-large-sample" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>The concept of representing a distribution by a large representative sample is foundational for the approach we take to Bayesian analysis of complex models. The idea is applied intuitively and routinely in everyday life and in science. For example, polls and surveys are founded on this concept: By randomly sampling a subset of people from a population, we estimate the underlying tendencies in the entire population. The larger the sample, the better the estimation. What is new in the present application is that the population from which we are sampling is a mathematically defined distribution, such as a posterior probability distribution. (p. 145)</p>
</blockquote>
<p>Like in Chapters 4 and 6, we need to define the <code>hdi_of_icdf()</code> function.</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="markov-chain-monte-carlo.html#cb487-1" aria-hidden="true" tabindex="-1"></a>hdi_of_icdf <span class="ot">&lt;-</span> <span class="cf">function</span>(name, <span class="at">width =</span> .<span class="dv">95</span>, <span class="at">tol =</span> <span class="fl">1e-8</span>, ... ) {</span>
<span id="cb487-2"><a href="markov-chain-monte-carlo.html#cb487-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb487-3"><a href="markov-chain-monte-carlo.html#cb487-3" aria-hidden="true" tabindex="-1"></a>  incredible_mass <span class="ot">&lt;-</span> <span class="fl">1.0</span> <span class="sc">-</span> width</span>
<span id="cb487-4"><a href="markov-chain-monte-carlo.html#cb487-4" aria-hidden="true" tabindex="-1"></a>  interval_width <span class="ot">&lt;-</span> <span class="cf">function</span>(low_tail_prob, name, width, ...) {</span>
<span id="cb487-5"><a href="markov-chain-monte-carlo.html#cb487-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">name</span>(width <span class="sc">+</span> low_tail_prob, ...) <span class="sc">-</span> <span class="fu">name</span>(low_tail_prob, ...)</span>
<span id="cb487-6"><a href="markov-chain-monte-carlo.html#cb487-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb487-7"><a href="markov-chain-monte-carlo.html#cb487-7" aria-hidden="true" tabindex="-1"></a>  opt_info <span class="ot">&lt;-</span> <span class="fu">optimize</span>(interval_width, <span class="fu">c</span>(<span class="dv">0</span>, incredible_mass), </span>
<span id="cb487-8"><a href="markov-chain-monte-carlo.html#cb487-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> name, <span class="at">width =</span> width, </span>
<span id="cb487-9"><a href="markov-chain-monte-carlo.html#cb487-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">tol =</span> tol, ...)</span>
<span id="cb487-10"><a href="markov-chain-monte-carlo.html#cb487-10" aria-hidden="true" tabindex="-1"></a>  hdi_lower_tail_prob <span class="ot">&lt;-</span> opt_info<span class="sc">$</span>minimum</span>
<span id="cb487-11"><a href="markov-chain-monte-carlo.html#cb487-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">name</span>(hdi_lower_tail_prob, ...),</span>
<span id="cb487-12"><a href="markov-chain-monte-carlo.html#cb487-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">name</span>(width <span class="sc">+</span> hdi_lower_tail_prob, ...)))</span>
<span id="cb487-13"><a href="markov-chain-monte-carlo.html#cb487-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb487-14"><a href="markov-chain-monte-carlo.html#cb487-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Our <code>hdi_of_icdf()</code> function will compute the analytic 95% highest density intervals (HDIs) for the distribution under consideration in Figure 7.1, <span class="math inline">\(\operatorname{Beta}(\theta | 15, 7)\)</span>.</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="markov-chain-monte-carlo.html#cb488-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span></span>
<span id="cb488-2"><a href="markov-chain-monte-carlo.html#cb488-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hdi_of_icdf</span>(<span class="at">name =</span> qbeta,</span>
<span id="cb488-3"><a href="markov-chain-monte-carlo.html#cb488-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">shape1 =</span> <span class="dv">15</span>,</span>
<span id="cb488-4"><a href="markov-chain-monte-carlo.html#cb488-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">shape2 =</span> <span class="dv">7</span>)</span>
<span id="cb488-5"><a href="markov-chain-monte-carlo.html#cb488-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-6"><a href="markov-chain-monte-carlo.html#cb488-6" aria-hidden="true" tabindex="-1"></a>h</span></code></pre></div>
<pre><code>## [1] 0.4907001 0.8639305</code></pre>
<p>Using an equation from <a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#specifying-a-beta-prior.">Chapter 6</a>, <span class="math inline">\(\omega = (a − 1) / (a + b − 2)\)</span>, we can compute the corresponding mode.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="markov-chain-monte-carlo.html#cb490-1" aria-hidden="true" tabindex="-1"></a>(omega <span class="ot">&lt;-</span> (<span class="dv">15</span> <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> (<span class="dv">15</span> <span class="sc">+</span> <span class="dv">7</span> <span class="sc">-</span> <span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 0.7</code></pre>
<p>To get the density in the upper left panel of Figure 7.1, we’ll make use of the <code>dbeta()</code> function and of our <code>h[1:2]</code> and <code>omega</code> values.</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="markov-chain-monte-carlo.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb492-2"><a href="markov-chain-monte-carlo.html#cb492-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb492-3"><a href="markov-chain-monte-carlo.html#cb492-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-4"><a href="markov-chain-monte-carlo.html#cb492-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">theta =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb492-5"><a href="markov-chain-monte-carlo.html#cb492-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dbeta</span>(theta, <span class="at">shape1 =</span> <span class="dv">15</span>, <span class="at">shape2 =</span> <span class="dv">7</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb492-6"><a href="markov-chain-monte-carlo.html#cb492-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb492-7"><a href="markov-chain-monte-carlo.html#cb492-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb492-8"><a href="markov-chain-monte-carlo.html#cb492-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> density),</span>
<span id="cb492-9"><a href="markov-chain-monte-carlo.html#cb492-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb492-10"><a href="markov-chain-monte-carlo.html#cb492-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> h[<span class="dv">1</span>], <span class="at">xend =</span> h[<span class="dv">2</span>], <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">0</span>),</span>
<span id="cb492-11"><a href="markov-chain-monte-carlo.html#cb492-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> .<span class="dv">75</span>) <span class="sc">+</span></span>
<span id="cb492-12"><a href="markov-chain-monte-carlo.html#cb492-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> omega, <span class="at">y =</span> <span class="dv">0</span>),</span>
<span id="cb492-13"><a href="markov-chain-monte-carlo.html#cb492-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">shape =</span> <span class="dv">19</span>) <span class="sc">+</span></span>
<span id="cb492-14"><a href="markov-chain-monte-carlo.html#cb492-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> .<span class="dv">675</span>, <span class="at">y =</span> .<span class="dv">4</span>, </span>
<span id="cb492-15"><a href="markov-chain-monte-carlo.html#cb492-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;95% HDI&quot;</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb492-16"><a href="markov-chain-monte-carlo.html#cb492-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta), </span>
<span id="cb492-17"><a href="markov-chain-monte-carlo.html#cb492-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, h, omega, <span class="dv">1</span>),</span>
<span id="cb492-18"><a href="markov-chain-monte-carlo.html#cb492-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, h <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>), omega, <span class="st">&quot;1&quot;</span>)) <span class="sc">+</span></span>
<span id="cb492-19"><a href="markov-chain-monte-carlo.html#cb492-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Exact distribution&quot;</span>) <span class="sc">+</span></span>
<span id="cb492-20"><a href="markov-chain-monte-carlo.html#cb492-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">p</span>(theta))) <span class="sc">+</span></span>
<span id="cb492-21"><a href="markov-chain-monte-carlo.html#cb492-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-5-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Note how we’re continuing to use <code>theme_cowplot()</code>, which we introduced in the last chapter. The remaining panels in Figure 7.1 require we simulate the data.</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="markov-chain-monte-carlo.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb493-2"><a href="markov-chain-monte-carlo.html#cb493-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-3"><a href="markov-chain-monte-carlo.html#cb493-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb493-4"><a href="markov-chain-monte-carlo.html#cb493-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">n =</span> <span class="fu">c</span>(<span class="dv">500</span>, <span class="dv">5000</span>, <span class="dv">50000</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb493-5"><a href="markov-chain-monte-carlo.html#cb493-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">theta =</span> <span class="fu">map</span>(n, <span class="sc">~</span><span class="fu">rbeta</span>(., <span class="at">shape1 =</span> <span class="dv">15</span>, <span class="at">shape2 =</span> <span class="dv">7</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb493-6"><a href="markov-chain-monte-carlo.html#cb493-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(theta) <span class="sc">%&gt;%</span> </span>
<span id="cb493-7"><a href="markov-chain-monte-carlo.html#cb493-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">key =</span> <span class="fu">str_c</span>(<span class="st">&quot;Sample N = &quot;</span>, n))</span>
<span id="cb493-8"><a href="markov-chain-monte-carlo.html#cb493-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-9"><a href="markov-chain-monte-carlo.html#cb493-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##       n theta key           
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;         
## 1   500 0.806 Sample N = 500
## 2   500 0.756 Sample N = 500
## 3   500 0.727 Sample N = 500
## 4   500 0.784 Sample N = 500
## 5   500 0.782 Sample N = 500
## 6   500 0.590 Sample N = 500</code></pre>
<p>With the data in hand, we’re ready to plot the remaining panels for Figure 7.1. This time, we’ll use the handy <code>stat_pointinterval()</code> function from the <a href="https://github.com/mjskay/tidybayes"><strong>tidybayes</strong> package</a> to mark off the mode and 95% HDIs.</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="markov-chain-monte-carlo.html#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb495-2"><a href="markov-chain-monte-carlo.html#cb495-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb495-3"><a href="markov-chain-monte-carlo.html#cb495-3" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb495-4"><a href="markov-chain-monte-carlo.html#cb495-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb495-5"><a href="markov-chain-monte-carlo.html#cb495-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_histinterval</span>(<span class="at">point_interval =</span> mode_hdi, <span class="at">.width =</span> .<span class="dv">95</span>, </span>
<span id="cb495-6"><a href="markov-chain-monte-carlo.html#cb495-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb495-7"><a href="markov-chain-monte-carlo.html#cb495-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb495-8"><a href="markov-chain-monte-carlo.html#cb495-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb495-9"><a href="markov-chain-monte-carlo.html#cb495-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb495-10"><a href="markov-chain-monte-carlo.html#cb495-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> key, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-7-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>If we want the exact values for the mode and 95% HDIs, we can use the <code>tidybayes::mode_hdi()</code> function.</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="markov-chain-monte-carlo.html#cb496-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb496-2"><a href="markov-chain-monte-carlo.html#cb496-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> </span>
<span id="cb496-3"><a href="markov-chain-monte-carlo.html#cb496-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mode_hdi</span>(theta)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 7
##   key              theta .lower .upper .width .point .interval
##   &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 Sample N = 500   0.695  0.511  0.868   0.95 mode   hdi      
## 2 Sample N = 5000  0.688  0.497  0.870   0.95 mode   hdi      
## 3 Sample N = 50000 0.710  0.490  0.863   0.95 mode   hdi</code></pre>
<p>If you wanted a better sense of the phenomena, you could do a simulation. We’ll make a custom simulation function to compute the modes from many random draws from our <span class="math inline">\(\operatorname{Beta}(\theta | 15, 7)\)</span> distribution, with varying <span class="math inline">\(N\)</span> values.</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="markov-chain-monte-carlo.html#cb498-1" aria-hidden="true" tabindex="-1"></a>my_mode_simulation <span class="ot">&lt;-</span> <span class="cf">function</span>(seed) {</span>
<span id="cb498-2"><a href="markov-chain-monte-carlo.html#cb498-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb498-3"><a href="markov-chain-monte-carlo.html#cb498-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb498-4"><a href="markov-chain-monte-carlo.html#cb498-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb498-5"><a href="markov-chain-monte-carlo.html#cb498-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">n =</span> <span class="fu">c</span>(<span class="dv">500</span>, <span class="dv">5000</span>, <span class="dv">50000</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb498-6"><a href="markov-chain-monte-carlo.html#cb498-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">theta =</span> <span class="fu">map</span>(n, <span class="sc">~</span><span class="fu">rbeta</span>(., <span class="at">shape1 =</span> <span class="dv">15</span>, <span class="at">shape2 =</span> <span class="dv">7</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb498-7"><a href="markov-chain-monte-carlo.html#cb498-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(theta) <span class="sc">%&gt;%</span> </span>
<span id="cb498-8"><a href="markov-chain-monte-carlo.html#cb498-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">key =</span> <span class="fu">str_c</span>(<span class="st">&quot;Sample N = &quot;</span>, n)) <span class="sc">%&gt;%</span> </span>
<span id="cb498-9"><a href="markov-chain-monte-carlo.html#cb498-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> </span>
<span id="cb498-10"><a href="markov-chain-monte-carlo.html#cb498-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mode_hdi</span>(theta)</span>
<span id="cb498-11"><a href="markov-chain-monte-carlo.html#cb498-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb498-12"><a href="markov-chain-monte-carlo.html#cb498-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here we put our <code>my_mode_simulation()</code> function to work.</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="markov-chain-monte-carlo.html#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we need an index of the values we set our seed with in our `my_mode_simulation()` function</span></span>
<span id="cb499-2"><a href="markov-chain-monte-carlo.html#cb499-2" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span></span>
<span id="cb499-3"><a href="markov-chain-monte-carlo.html#cb499-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">seed =</span> <span class="dv">1</span><span class="sc">:</span><span class="fl">1e3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb499-4"><a href="markov-chain-monte-carlo.html#cb499-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(seed) <span class="sc">%&gt;%</span> </span>
<span id="cb499-5"><a href="markov-chain-monte-carlo.html#cb499-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inserting our subsamples</span></span>
<span id="cb499-6"><a href="markov-chain-monte-carlo.html#cb499-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">modes =</span> <span class="fu">map</span>(seed, my_mode_simulation)) <span class="sc">%&gt;%</span> </span>
<span id="cb499-7"><a href="markov-chain-monte-carlo.html#cb499-7" aria-hidden="true" tabindex="-1"></a>   <span class="co"># unnesting allows us to access our model results</span></span>
<span id="cb499-8"><a href="markov-chain-monte-carlo.html#cb499-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(modes) </span>
<span id="cb499-9"><a href="markov-chain-monte-carlo.html#cb499-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-10"><a href="markov-chain-monte-carlo.html#cb499-10" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&gt;%</span> </span>
<span id="cb499-11"><a href="markov-chain-monte-carlo.html#cb499-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> key)) <span class="sc">+</span></span>
<span id="cb499-12"><a href="markov-chain-monte-carlo.html#cb499-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">7</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb499-13"><a href="markov-chain-monte-carlo.html#cb499-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_histinterval</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>), <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb499-14"><a href="markov-chain-monte-carlo.html#cb499-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">expression</span>(<span class="st">&quot;Variability of the mode for simulations of &quot;</span><span class="sc">*</span><span class="fu">beta</span>(theta<span class="sc">*</span><span class="st">&#39;|&#39;</span><span class="sc">*</span><span class="dv">15</span><span class="sc">*</span><span class="st">&#39;, &#39;</span><span class="sc">*</span><span class="dv">7</span>)<span class="sc">*</span><span class="st">&quot;, the true mode of which is .7&quot;</span>),</span>
<span id="cb499-15"><a href="markov-chain-monte-carlo.html#cb499-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;For each sample size, the dot is the median, the inner thick line is the percentile-based 50% interval,</span><span class="sc">\n</span><span class="st">and the outer thin line the percentile-based 95% interval. Although the central tendency</span><span class="sc">\n</span><span class="st">approximates the true value for all three conditions, the variability of the mode estimate is inversely</span><span class="sc">\n</span><span class="st">related to the sample size.&quot;</span>,</span>
<span id="cb499-16"><a href="markov-chain-monte-carlo.html#cb499-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;mode&quot;</span>, </span>
<span id="cb499-17"><a href="markov-chain-monte-carlo.html#cb499-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb499-18"><a href="markov-chain-monte-carlo.html#cb499-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(.<span class="dv">6</span>, .<span class="dv">8</span>),</span>
<span id="cb499-19"><a href="markov-chain-monte-carlo.html#cb499-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.25</span>, <span class="fl">3.5</span>)) <span class="sc">+</span></span>
<span id="cb499-20"><a href="markov-chain-monte-carlo.html#cb499-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>(<span class="at">font_size =</span> <span class="fl">11.5</span>) <span class="sc">+</span></span>
<span id="cb499-21"><a href="markov-chain-monte-carlo.html#cb499-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb499-22"><a href="markov-chain-monte-carlo.html#cb499-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="07_files/figure-html/sim-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="a-simple-case-of-the-metropolis-algorithm" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> A simple case of the Metropolis algorithm<a href="markov-chain-monte-carlo.html#a-simple-case-of-the-metropolis-algorithm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>Our goal in Bayesian inference is to get an accurate representation of the posterior distribution. One way to do that is to sample a large number of representative points from the posterior. The question then becomes this: How can we sample a large number of representative values from a distribution? (p. 146).</p>
</blockquote>
<p>The answer, my friends, is MCMC.</p>
<div id="a-politician-stumbles-upon-the-metropolis-algorithm." class="section level3 hasAnchor" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> A politician stumbles upon the Metropolis algorithm.<a href="markov-chain-monte-carlo.html#a-politician-stumbles-upon-the-metropolis-algorithm." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>I’m not going to walk out Kruschke’s politician example in any detail, here. But if we denote <span class="math inline">\(P_\text{proposed}\)</span> as the population of the proposed island and <span class="math inline">\(P_\text{current}\)</span> as the population of the current island, then</p>
<p><span class="math display">\[p_\text{move} = \frac{P_\text{proposed}}{P_\text{current}}.\]</span></p>
<p>“What’s amazing about this heuristic is that it works: In the long run, the probability that the politician is on any one of the islands exactly matches the relative population of the island” (p. 147)!</p>
</div>
<div id="a-random-walk." class="section level3 hasAnchor" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> A random walk.<a href="markov-chain-monte-carlo.html#a-random-walk." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The code below will allow us to reproduce Kruschke’s random walk. To give credit where it’s due, this is a mild amendment to the code from Chapter 8 of McElreath’s <span class="citation">(<a href="#ref-mcelreathStatisticalRethinkingBayesian2015" role="doc-biblioref">2015</a>)</span> text, <a href="https://xcelab.net/rm/statistical-rethinking/"><em>Statistical rethinking: A Bayesian course with examples in R and Stan</em></a>.</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="markov-chain-monte-carlo.html#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb500-2"><a href="markov-chain-monte-carlo.html#cb500-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-3"><a href="markov-chain-monte-carlo.html#cb500-3" aria-hidden="true" tabindex="-1"></a>num_days  <span class="ot">&lt;-</span> <span class="fl">5e4</span></span>
<span id="cb500-4"><a href="markov-chain-monte-carlo.html#cb500-4" aria-hidden="true" tabindex="-1"></a>positions <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, num_days)</span>
<span id="cb500-5"><a href="markov-chain-monte-carlo.html#cb500-5" aria-hidden="true" tabindex="-1"></a>current   <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb500-6"><a href="markov-chain-monte-carlo.html#cb500-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_days) {</span>
<span id="cb500-7"><a href="markov-chain-monte-carlo.html#cb500-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># record current position</span></span>
<span id="cb500-8"><a href="markov-chain-monte-carlo.html#cb500-8" aria-hidden="true" tabindex="-1"></a>  positions[i] <span class="ot">&lt;-</span> current</span>
<span id="cb500-9"><a href="markov-chain-monte-carlo.html#cb500-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># flip coin to generate proposal</span></span>
<span id="cb500-10"><a href="markov-chain-monte-carlo.html#cb500-10" aria-hidden="true" tabindex="-1"></a>  proposal <span class="ot">&lt;-</span> current <span class="sc">+</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb500-11"><a href="markov-chain-monte-carlo.html#cb500-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># now make sure he loops around from 7 back to 1</span></span>
<span id="cb500-12"><a href="markov-chain-monte-carlo.html#cb500-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (proposal <span class="sc">&lt;</span> <span class="dv">1</span>) proposal <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb500-13"><a href="markov-chain-monte-carlo.html#cb500-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (proposal <span class="sc">&gt;</span> <span class="dv">7</span>) proposal <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb500-14"><a href="markov-chain-monte-carlo.html#cb500-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># move?</span></span>
<span id="cb500-15"><a href="markov-chain-monte-carlo.html#cb500-15" aria-hidden="true" tabindex="-1"></a>  prob_accept_the_proposal <span class="ot">&lt;-</span> proposal<span class="sc">/</span>current</span>
<span id="cb500-16"><a href="markov-chain-monte-carlo.html#cb500-16" aria-hidden="true" tabindex="-1"></a>  current <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> prob_accept_the_proposal, proposal, current)</span>
<span id="cb500-17"><a href="markov-chain-monte-carlo.html#cb500-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>If you missed it, <code>positions</code> is the main product of our simulation. Here we’ll put <code>positions</code> in a tibble and reproduce the top portion of Figure 7.2.</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="markov-chain-monte-carlo.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">theta =</span> positions) <span class="sc">%&gt;%</span> </span>
<span id="cb501-2"><a href="markov-chain-monte-carlo.html#cb501-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb501-3"><a href="markov-chain-monte-carlo.html#cb501-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta)) <span class="sc">+</span></span>
<span id="cb501-4"><a href="markov-chain-monte-carlo.html#cb501-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb501-5"><a href="markov-chain-monte-carlo.html#cb501-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta), <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb501-6"><a href="markov-chain-monte-carlo.html#cb501-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb501-7"><a href="markov-chain-monte-carlo.html#cb501-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Did you notice that <code>scale_y_continuous()</code> line in the code? Claus Wilke, the author of the <strong>cowplot</strong> package, has a lot of thoughts on data visualization. He even wrote a <span class="citation">(<a href="#ref-wilkeFundamentalsDataVisualization2019" role="doc-biblioref">2019</a>)</span> book on it: <a href="https://clauswilke.com/dataviz/"><em>Fundamentals of data visualization</em></a>. In his <span class="citation">(<a href="#ref-Wilke2020Themes" role="doc-biblioref">2020a</a>)</span> <a href="https://wilkelab.org/cowplot/articles/themes.html"><em>Themes</em></a> vignette, Wilke recommended against allowing for space between the bottoms of the bars in a bar plot and the <span class="math inline">\(x\)</span>-axis line. The <strong>ggplot2</strong> default is to allow for such a space. Here we followed Wilke and suppressed that space with <code>expand = expansion(mult = c(0, 0.05))</code>. You can learn more about the <code>ggplot2::expansion()</code> function <a href="https://ggplot2.tidyverse.org/reference/expansion.html">here</a>.</p>
<p>Here’s the middle portion of Figure 7.2.</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="markov-chain-monte-carlo.html#cb502-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">t     =</span> <span class="dv">1</span><span class="sc">:</span><span class="fl">5e4</span>,</span>
<span id="cb502-2"><a href="markov-chain-monte-carlo.html#cb502-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">theta =</span> positions) <span class="sc">%&gt;%</span> </span>
<span id="cb502-3"><a href="markov-chain-monte-carlo.html#cb502-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb502-4"><a href="markov-chain-monte-carlo.html#cb502-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb502-5"><a href="markov-chain-monte-carlo.html#cb502-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> t)) <span class="sc">+</span></span>
<span id="cb502-6"><a href="markov-chain-monte-carlo.html#cb502-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb502-7"><a href="markov-chain-monte-carlo.html#cb502-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb502-8"><a href="markov-chain-monte-carlo.html#cb502-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta), <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb502-9"><a href="markov-chain-monte-carlo.html#cb502-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="st">&quot;Time Step&quot;</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">20</span>, <span class="dv">100</span>, <span class="dv">500</span>)) <span class="sc">+</span></span>
<span id="cb502-10"><a href="markov-chain-monte-carlo.html#cb502-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-11-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>And now we make the bottom.</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="markov-chain-monte-carlo.html#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,</span>
<span id="cb503-2"><a href="markov-chain-monte-carlo.html#cb503-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb503-3"><a href="markov-chain-monte-carlo.html#cb503-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb503-4"><a href="markov-chain-monte-carlo.html#cb503-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb503-5"><a href="markov-chain-monte-carlo.html#cb503-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> .<span class="dv">2</span>, <span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb503-6"><a href="markov-chain-monte-carlo.html#cb503-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta), <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb503-7"><a href="markov-chain-monte-carlo.html#cb503-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="fu">p</span>(theta)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb503-8"><a href="markov-chain-monte-carlo.html#cb503-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-12-1.png" width="576" style="display: block; margin: auto;" /></p>
<blockquote>
<p>Notice that the sampled relative frequencies closely mimic the actual relative populations in the bottom panel! In fact, a sequence generated this way will converge, as the sequence gets longer, to an arbitrarily close approximation of the actual relative probabilities. (p. 149)</p>
</blockquote>
</div>
<div id="general-properties-of-a-random-walk." class="section level3 hasAnchor" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> General properties of a random walk.<a href="markov-chain-monte-carlo.html#general-properties-of-a-random-walk." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>The tajectory shown in Figure 7.2 is just one possible sequence of positions when the movement heuristic is applied. At each time step, the direction of the proposed move is random, and if the relative probability of the proposed position is less than that of the current position, then acceptance of the proposed move is also random. Because of the randomness, if the process were started over again, then the specific trajectory would almost certainly be different. Regardless of the specific trajectory, in the long run the relative frequency of visits mimics the target distribution.</p>
<p>Figure 7.3 shows the probability of being in each position as a function of time. (p. 149)</p>
</blockquote>
<p>I was initially stumped on how to reproduce the simulation depicted in Figure 7.3. However, fellow enthusiast <a href="https://github.com/cmoten">Cardy Moten III</a> kindly <a href="https://github.com/ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse/issues/14">shared a solution</a> which was itself based on Kruschke’s blog post from 2012, <a href="https://doingbayesiandataanalysis.blogspot.com/2012/08/metropolis-algorithm-discrete-position.html"><em>Metropolis algorithm: Discrete position probabilities</em></a>. Here’s a mild reworking of their solutions. First, we simulate.</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="markov-chain-monte-carlo.html#cb504-1" aria-hidden="true" tabindex="-1"></a>nslots   <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb504-2"><a href="markov-chain-monte-carlo.html#cb504-2" aria-hidden="true" tabindex="-1"></a>p_target <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb504-3"><a href="markov-chain-monte-carlo.html#cb504-3" aria-hidden="true" tabindex="-1"></a>p_target <span class="ot">&lt;-</span> p_target <span class="sc">/</span> <span class="fu">sum</span>(p_target)</span>
<span id="cb504-4"><a href="markov-chain-monte-carlo.html#cb504-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-5"><a href="markov-chain-monte-carlo.html#cb504-5" aria-hidden="true" tabindex="-1"></a><span class="co"># construct the transition matrix</span></span>
<span id="cb504-6"><a href="markov-chain-monte-carlo.html#cb504-6" aria-hidden="true" tabindex="-1"></a>proposal_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nslots, <span class="at">ncol =</span> nslots)</span>
<span id="cb504-7"><a href="markov-chain-monte-carlo.html#cb504-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-8"><a href="markov-chain-monte-carlo.html#cb504-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(from_idx <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nslots) {</span>
<span id="cb504-9"><a href="markov-chain-monte-carlo.html#cb504-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(to_idx <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nslots) {</span>
<span id="cb504-10"><a href="markov-chain-monte-carlo.html#cb504-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(to_idx <span class="sc">==</span> from_idx <span class="sc">-</span> <span class="dv">1</span>) {proposal_matrix[from_idx, to_idx] <span class="ot">&lt;-</span> <span class="fl">0.5</span>}</span>
<span id="cb504-11"><a href="markov-chain-monte-carlo.html#cb504-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(to_idx <span class="sc">==</span> from_idx <span class="sc">+</span> <span class="dv">1</span>) {proposal_matrix[from_idx, to_idx] <span class="ot">&lt;-</span> <span class="fl">0.5</span>}</span>
<span id="cb504-12"><a href="markov-chain-monte-carlo.html#cb504-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb504-13"><a href="markov-chain-monte-carlo.html#cb504-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb504-14"><a href="markov-chain-monte-carlo.html#cb504-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-15"><a href="markov-chain-monte-carlo.html#cb504-15" aria-hidden="true" tabindex="-1"></a><span class="co"># construct the acceptance matrix</span></span>
<span id="cb504-16"><a href="markov-chain-monte-carlo.html#cb504-16" aria-hidden="true" tabindex="-1"></a>acceptance_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nslots, <span class="at">ncol =</span> nslots)</span>
<span id="cb504-17"><a href="markov-chain-monte-carlo.html#cb504-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-18"><a href="markov-chain-monte-carlo.html#cb504-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(from_idx <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nslots) {</span>
<span id="cb504-19"><a href="markov-chain-monte-carlo.html#cb504-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(to_idx <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nslots) {</span>
<span id="cb504-20"><a href="markov-chain-monte-carlo.html#cb504-20" aria-hidden="true" tabindex="-1"></a>    acceptance_matrix[from_idx, to_idx] <span class="ot">&lt;-</span> <span class="fu">min</span>(p_target[to_idx] <span class="sc">/</span> p_target[from_idx], <span class="dv">1</span>)</span>
<span id="cb504-21"><a href="markov-chain-monte-carlo.html#cb504-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb504-22"><a href="markov-chain-monte-carlo.html#cb504-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb504-23"><a href="markov-chain-monte-carlo.html#cb504-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-24"><a href="markov-chain-monte-carlo.html#cb504-24" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the matrix of move probabilities</span></span>
<span id="cb504-25"><a href="markov-chain-monte-carlo.html#cb504-25" aria-hidden="true" tabindex="-1"></a>move_matrix <span class="ot">&lt;-</span> proposal_matrix <span class="sc">*</span> acceptance_matrix</span>
<span id="cb504-26"><a href="markov-chain-monte-carlo.html#cb504-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-27"><a href="markov-chain-monte-carlo.html#cb504-27" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the transition matrix, including the probability of staying in place</span></span>
<span id="cb504-28"><a href="markov-chain-monte-carlo.html#cb504-28" aria-hidden="true" tabindex="-1"></a>transition_matrix <span class="ot">&lt;-</span> move_matrix</span>
<span id="cb504-29"><a href="markov-chain-monte-carlo.html#cb504-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (diag_idx <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nslots) {</span>
<span id="cb504-30"><a href="markov-chain-monte-carlo.html#cb504-30" aria-hidden="true" tabindex="-1"></a>  transition_matrix[diag_idx, diag_idx] <span class="ot">=</span> <span class="fl">1.0</span> <span class="sc">-</span> <span class="fu">sum</span>(move_matrix[diag_idx, ])</span>
<span id="cb504-31"><a href="markov-chain-monte-carlo.html#cb504-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb504-32"><a href="markov-chain-monte-carlo.html#cb504-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-33"><a href="markov-chain-monte-carlo.html#cb504-33" aria-hidden="true" tabindex="-1"></a><span class="co"># specify starting position vector:</span></span>
<span id="cb504-34"><a href="markov-chain-monte-carlo.html#cb504-34" aria-hidden="true" tabindex="-1"></a>position_vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, nslots)</span>
<span id="cb504-35"><a href="markov-chain-monte-carlo.html#cb504-35" aria-hidden="true" tabindex="-1"></a>position_vec[<span class="fu">round</span>(nslots <span class="sc">/</span> <span class="dv">2</span>)] <span class="ot">&lt;-</span> <span class="fl">1.0</span></span>
<span id="cb504-36"><a href="markov-chain-monte-carlo.html#cb504-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-37"><a href="markov-chain-monte-carlo.html#cb504-37" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb504-38"><a href="markov-chain-monte-carlo.html#cb504-38" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> </span>
<span id="cb504-39"><a href="markov-chain-monte-carlo.html#cb504-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">position =</span> <span class="dv">1</span><span class="sc">:</span>nslots, </span>
<span id="cb504-40"><a href="markov-chain-monte-carlo.html#cb504-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob     =</span> position_vec)</span>
<span id="cb504-41"><a href="markov-chain-monte-carlo.html#cb504-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb504-42"><a href="markov-chain-monte-carlo.html#cb504-42" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through the requisite time indexes</span></span>
<span id="cb504-43"><a href="markov-chain-monte-carlo.html#cb504-43" aria-hidden="true" tabindex="-1"></a><span class="co"># update the data and transition vector</span></span>
<span id="cb504-44"><a href="markov-chain-monte-carlo.html#cb504-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(time_idx <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">99</span>) {</span>
<span id="cb504-45"><a href="markov-chain-monte-carlo.html#cb504-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb504-46"><a href="markov-chain-monte-carlo.html#cb504-46" aria-hidden="true" tabindex="-1"></a>  p[[time_idx]] <span class="ot">&lt;-</span> data</span>
<span id="cb504-47"><a href="markov-chain-monte-carlo.html#cb504-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb504-48"><a href="markov-chain-monte-carlo.html#cb504-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># update the position vec</span></span>
<span id="cb504-49"><a href="markov-chain-monte-carlo.html#cb504-49" aria-hidden="true" tabindex="-1"></a>  position_vec <span class="ot">&lt;-</span> position_vec <span class="sc">%*%</span> transition_matrix</span>
<span id="cb504-50"><a href="markov-chain-monte-carlo.html#cb504-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb504-51"><a href="markov-chain-monte-carlo.html#cb504-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># update the data</span></span>
<span id="cb504-52"><a href="markov-chain-monte-carlo.html#cb504-52" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="cn">NULL</span> </span>
<span id="cb504-53"><a href="markov-chain-monte-carlo.html#cb504-53" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> </span>
<span id="cb504-54"><a href="markov-chain-monte-carlo.html#cb504-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">position =</span> <span class="dv">1</span><span class="sc">:</span>nslots, </span>
<span id="cb504-55"><a href="markov-chain-monte-carlo.html#cb504-55" aria-hidden="true" tabindex="-1"></a>           <span class="at">prob     =</span> <span class="fu">t</span>(position_vec))</span>
<span id="cb504-56"><a href="markov-chain-monte-carlo.html#cb504-56" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we wrangle and plot.</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="markov-chain-monte-carlo.html#cb505-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">%&gt;%</span> </span>
<span id="cb505-2"><a href="markov-chain-monte-carlo.html#cb505-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble_col</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb505-3"><a href="markov-chain-monte-carlo.html#cb505-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facet =</span> <span class="fu">str_c</span>(<span class="st">&quot;italic(t)==&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">99</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb505-4"><a href="markov-chain-monte-carlo.html#cb505-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>, <span class="dv">99</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb505-5"><a href="markov-chain-monte-carlo.html#cb505-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb505-6"><a href="markov-chain-monte-carlo.html#cb505-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb505-7"><a href="markov-chain-monte-carlo.html#cb505-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">position =</span> <span class="dv">1</span><span class="sc">:</span>nslots, </span>
<span id="cb505-8"><a href="markov-chain-monte-carlo.html#cb505-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">prob     =</span> p_target, </span>
<span id="cb505-9"><a href="markov-chain-monte-carlo.html#cb505-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">facet    =</span> <span class="st">&quot;target&quot;</span>)</span>
<span id="cb505-10"><a href="markov-chain-monte-carlo.html#cb505-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb505-11"><a href="markov-chain-monte-carlo.html#cb505-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facet =</span> <span class="fu">factor</span>(facet, <span class="at">levels =</span> <span class="fu">c</span>(<span class="fu">str_c</span>(<span class="st">&quot;italic(t)==&quot;</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>, <span class="dv">99</span>)), <span class="st">&quot;target&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb505-12"><a href="markov-chain-monte-carlo.html#cb505-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb505-13"><a href="markov-chain-monte-carlo.html#cb505-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb505-14"><a href="markov-chain-monte-carlo.html#cb505-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> position, <span class="at">y =</span> prob, <span class="at">fill =</span> facet <span class="sc">==</span> <span class="st">&quot;target&quot;</span>)) <span class="sc">+</span></span>
<span id="cb505-15"><a href="markov-chain-monte-carlo.html#cb505-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb505-16"><a href="markov-chain-monte-carlo.html#cb505-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;goldenrod2&quot;</span>), <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb505-17"><a href="markov-chain-monte-carlo.html#cb505-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta), <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb505-18"><a href="markov-chain-monte-carlo.html#cb505-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(p)(theta)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))) <span class="sc">+</span></span>
<span id="cb505-19"><a href="markov-chain-monte-carlo.html#cb505-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb505-20"><a href="markov-chain-monte-carlo.html#cb505-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> facet, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">labeller =</span> label_parsed)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-14-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="why-we-care." class="section level3 hasAnchor" number="7.2.4">
<h3><span class="header-section-number">7.2.4</span> Why we care.<a href="markov-chain-monte-carlo.html#why-we-care." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Through the simple magic of the random walk procedure,</p>
<blockquote>
<p>we are able to do <em>indirectly</em> something we could not necessarily do directly: We can generate random samples from the target distribution. Moreover, we can generate those random samples from the target distribution even when the target distribution is not normalized.</p>
<p>This technique is profoundly useful when the target distribution <span class="math inline">\(P(\theta)\)</span> is a posterior proportional to <span class="math inline">\(p(D | \theta) p(\theta)\)</span>. Merely by evaluating <span class="math inline">\(p(D | \theta) p(\theta)\)</span>, without normalizing it by <span class="math inline">\(p(D)\)</span>, we can generate random representative values from the posterior distribution. This result is wonderful because the method obviates direct computation of the evidence <span class="math inline">\(p(D)\)</span>, which, as you’ll recall, is one of the most difficult aspects of Bayesian inference. By using MCMC techniques, we can do Bayesian inference in rich and complex models. It has only been with the development of MCMC algorithms and software that Bayesian inference is applicable to complex data analysis, and it has only been with the production of fast and cheap computer hardware that Bayesian inference is accessible to a wide audience. (p. 152, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
</div>
<div id="the-metropolis-algorithm-more-generally" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> The Metropolis algorithm more generally<a href="markov-chain-monte-carlo.html#the-metropolis-algorithm-more-generally" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>“The procedure described in the previous section was just a special case of a more general procedure known as the Metropolis algorithm, named after the first author of a famous article <span class="citation">(<a href="#ref-metropolisEquationStateCalculations1953" role="doc-biblioref">Metropolis et al., 1953</a>)</span>” (p. 156).</p>
<p>Here’s how to generate a proposed jump from a zero-mean normal distribution with a standard deviation of 0.2.</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="markov-chain-monte-carlo.html#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<pre><code>## [1] -0.1985524</code></pre>
<p>To get a sense of what draws from <code>rnorm()</code> looks like in the long run, we might plot.</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="markov-chain-monte-carlo.html#cb508-1" aria-hidden="true" tabindex="-1"></a>mu    <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb508-2"><a href="markov-chain-monte-carlo.html#cb508-2" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb508-3"><a href="markov-chain-monte-carlo.html#cb508-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb508-4"><a href="markov-chain-monte-carlo.html#cb508-4" aria-hidden="true" tabindex="-1"></a><span class="co"># how many proposals would you like?</span></span>
<span id="cb508-5"><a href="markov-chain-monte-carlo.html#cb508-5" aria-hidden="true" tabindex="-1"></a>n  <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb508-6"><a href="markov-chain-monte-carlo.html#cb508-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb508-7"><a href="markov-chain-monte-carlo.html#cb508-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb508-8"><a href="markov-chain-monte-carlo.html#cb508-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">proposed_jump =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb508-9"><a href="markov-chain-monte-carlo.html#cb508-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb508-10"><a href="markov-chain-monte-carlo.html#cb508-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> proposed_jump, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb508-11"><a href="markov-chain-monte-carlo.html#cb508-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="dv">0</span>, <span class="at">height =</span> .<span class="dv">1</span>, </span>
<span id="cb508-12"><a href="markov-chain-monte-carlo.html#cb508-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb508-13"><a href="markov-chain-monte-carlo.html#cb508-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this is the idealized distribution</span></span>
<span id="cb508-14"><a href="markov-chain-monte-carlo.html#cb508-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> mu, <span class="at">sd =</span> sigma),</span>
<span id="cb508-15"><a href="markov-chain-monte-carlo.html#cb508-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb508-16"><a href="markov-chain-monte-carlo.html#cb508-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">0.6</span>, <span class="at">to =</span> <span class="fl">0.6</span>, <span class="at">length.out =</span> <span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb508-17"><a href="markov-chain-monte-carlo.html#cb508-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb508-18"><a href="markov-chain-monte-carlo.html#cb508-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Jump proposals&quot;</span>,</span>
<span id="cb508-19"><a href="markov-chain-monte-carlo.html#cb508-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;The blue line shows the data generating distribution.&quot;</span>) <span class="sc">+</span></span>
<span id="cb508-20"><a href="markov-chain-monte-carlo.html#cb508-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-16-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Anyway,</p>
<blockquote>
<p>having generated a proposed new position, the algorithm then decides whether or not to accept the proposal. The decision rule is exactly what was already specified in Equation 7.1. In detail, this is accomplished by computing the ratio <span class="math inline">\(p_\text{move} = P(\theta_\text{proposed}) / P(\theta_\text{current})\)</span>. Then a random number from the uniform interval <span class="math inline">\([0, 1]\)</span> is generated; in R, this can be accomplished with the command <code>runif(1)</code>. If the random number is between <span class="math inline">\(0\)</span> and pmove, then the move is accepted. (p. 157)</p>
</blockquote>
<p>We’ll see what that might look like in the next section. In the meantime, here’s how to use <code>runif()</code>.</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="markov-chain-monte-carlo.html#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="fu">runif</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.2783186</code></pre>
<p>Just for kicks, here’s what that looks like in bulk.</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="markov-chain-monte-carlo.html#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many proposals would you like?</span></span>
<span id="cb511-2"><a href="markov-chain-monte-carlo.html#cb511-2" aria-hidden="true" tabindex="-1"></a>n  <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb511-3"><a href="markov-chain-monte-carlo.html#cb511-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-4"><a href="markov-chain-monte-carlo.html#cb511-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb511-5"><a href="markov-chain-monte-carlo.html#cb511-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">draw =</span> <span class="fu">runif</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb511-6"><a href="markov-chain-monte-carlo.html#cb511-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb511-7"><a href="markov-chain-monte-carlo.html#cb511-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> draw, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb511-8"><a href="markov-chain-monte-carlo.html#cb511-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="dv">0</span>, <span class="at">height =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, </span>
<span id="cb511-9"><a href="markov-chain-monte-carlo.html#cb511-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb511-10"><a href="markov-chain-monte-carlo.html#cb511-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dunif,</span>
<span id="cb511-11"><a href="markov-chain-monte-carlo.html#cb511-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb511-12"><a href="markov-chain-monte-carlo.html#cb511-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">5</span><span class="sc">/</span><span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb511-13"><a href="markov-chain-monte-carlo.html#cb511-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Uniform draws&quot;</span>,</span>
<span id="cb511-14"><a href="markov-chain-monte-carlo.html#cb511-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;The blue line shows the data generating distribution.&quot;</span>) <span class="sc">+</span></span>
<span id="cb511-15"><a href="markov-chain-monte-carlo.html#cb511-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-18-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>We do not see a concentration towards the mean, this time. The draws are uniformly distributed across the parameter space.</p>
<div id="metropolis-algorithm-applied-to-bernoulli-likelihood-and-beta-prior." class="section level3 hasAnchor" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Metropolis algorithm applied to Bernoulli likelihood and beta prior.<a href="markov-chain-monte-carlo.html#metropolis-algorithm-applied-to-bernoulli-likelihood-and-beta-prior." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can find Kruschke’s code in the <code>BernMetrop.R</code> file. I’m going to break it up a little.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="markov-chain-monte-carlo.html#cb512-1" aria-hidden="true" tabindex="-1"></a><span class="co"># specify the data, to be used in the likelihood function.</span></span>
<span id="cb512-2"><a href="markov-chain-monte-carlo.html#cb512-2" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">6</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">14</span>))</span>
<span id="cb512-3"><a href="markov-chain-monte-carlo.html#cb512-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-4"><a href="markov-chain-monte-carlo.html#cb512-4" aria-hidden="true" tabindex="-1"></a><span class="co"># define the Bernoulli likelihood function, p(D|theta).</span></span>
<span id="cb512-5"><a href="markov-chain-monte-carlo.html#cb512-5" aria-hidden="true" tabindex="-1"></a><span class="co"># the argument theta could be a vector, not just a scalar</span></span>
<span id="cb512-6"><a href="markov-chain-monte-carlo.html#cb512-6" aria-hidden="true" tabindex="-1"></a>likelihood <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, data) {</span>
<span id="cb512-7"><a href="markov-chain-monte-carlo.html#cb512-7" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> <span class="fu">sum</span>(data)</span>
<span id="cb512-8"><a href="markov-chain-monte-carlo.html#cb512-8" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(data)</span>
<span id="cb512-9"><a href="markov-chain-monte-carlo.html#cb512-9" aria-hidden="true" tabindex="-1"></a>  p_data_given_theta <span class="ot">&lt;-</span> theta<span class="sc">^</span>z <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> theta)<span class="sc">^</span>(n <span class="sc">-</span> z)</span>
<span id="cb512-10"><a href="markov-chain-monte-carlo.html#cb512-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the theta values passed into this function are generated at random,</span></span>
<span id="cb512-11"><a href="markov-chain-monte-carlo.html#cb512-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and therefore might be inadvertently greater than 1 or less than 0.</span></span>
<span id="cb512-12"><a href="markov-chain-monte-carlo.html#cb512-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the likelihood for theta &gt; 1 or for theta &lt; 0 is zero</span></span>
<span id="cb512-13"><a href="markov-chain-monte-carlo.html#cb512-13" aria-hidden="true" tabindex="-1"></a>  p_data_given_theta[theta <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">|</span> theta <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb512-14"><a href="markov-chain-monte-carlo.html#cb512-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p_data_given_theta)</span>
<span id="cb512-15"><a href="markov-chain-monte-carlo.html#cb512-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb512-16"><a href="markov-chain-monte-carlo.html#cb512-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-17"><a href="markov-chain-monte-carlo.html#cb512-17" aria-hidden="true" tabindex="-1"></a><span class="co"># define the prior density function. </span></span>
<span id="cb512-18"><a href="markov-chain-monte-carlo.html#cb512-18" aria-hidden="true" tabindex="-1"></a>prior_d <span class="ot">&lt;-</span> <span class="cf">function</span>(theta) {</span>
<span id="cb512-19"><a href="markov-chain-monte-carlo.html#cb512-19" aria-hidden="true" tabindex="-1"></a>  p_theta <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(theta, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb512-20"><a href="markov-chain-monte-carlo.html#cb512-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the theta values passed into this function are generated at random,</span></span>
<span id="cb512-21"><a href="markov-chain-monte-carlo.html#cb512-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and therefore might be inadvertently greater than 1 or less than 0.</span></span>
<span id="cb512-22"><a href="markov-chain-monte-carlo.html#cb512-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the prior for theta &gt; 1 or for theta &lt; 0 is zero</span></span>
<span id="cb512-23"><a href="markov-chain-monte-carlo.html#cb512-23" aria-hidden="true" tabindex="-1"></a>  p_theta[theta <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">|</span> theta <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb512-24"><a href="markov-chain-monte-carlo.html#cb512-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p_theta)</span>
<span id="cb512-25"><a href="markov-chain-monte-carlo.html#cb512-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb512-26"><a href="markov-chain-monte-carlo.html#cb512-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-27"><a href="markov-chain-monte-carlo.html#cb512-27" aria-hidden="true" tabindex="-1"></a><span class="co"># define the relative probability of the target distribution, </span></span>
<span id="cb512-28"><a href="markov-chain-monte-carlo.html#cb512-28" aria-hidden="true" tabindex="-1"></a><span class="co"># as a function of vector theta. for our application, this</span></span>
<span id="cb512-29"><a href="markov-chain-monte-carlo.html#cb512-29" aria-hidden="true" tabindex="-1"></a><span class="co"># target distribution is the unnormalized posterior distribution</span></span>
<span id="cb512-30"><a href="markov-chain-monte-carlo.html#cb512-30" aria-hidden="true" tabindex="-1"></a>target_rel_prob <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, data) {</span>
<span id="cb512-31"><a href="markov-chain-monte-carlo.html#cb512-31" aria-hidden="true" tabindex="-1"></a>  target_rel_prob <span class="ot">&lt;-</span> <span class="fu">likelihood</span>(theta, data) <span class="sc">*</span> <span class="fu">prior_d</span>(theta)</span>
<span id="cb512-32"><a href="markov-chain-monte-carlo.html#cb512-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(target_rel_prob)</span>
<span id="cb512-33"><a href="markov-chain-monte-carlo.html#cb512-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb512-34"><a href="markov-chain-monte-carlo.html#cb512-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-35"><a href="markov-chain-monte-carlo.html#cb512-35" aria-hidden="true" tabindex="-1"></a><span class="co"># specify the length of the trajectory, i.e., the number of jumps to try:</span></span>
<span id="cb512-36"><a href="markov-chain-monte-carlo.html#cb512-36" aria-hidden="true" tabindex="-1"></a>traj_length <span class="ot">&lt;-</span> <span class="dv">50000</span> <span class="co"># this is just an arbitrary large number</span></span>
<span id="cb512-37"><a href="markov-chain-monte-carlo.html#cb512-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-38"><a href="markov-chain-monte-carlo.html#cb512-38" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the vector that will store the results</span></span>
<span id="cb512-39"><a href="markov-chain-monte-carlo.html#cb512-39" aria-hidden="true" tabindex="-1"></a>trajectory <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, traj_length)</span>
<span id="cb512-40"><a href="markov-chain-monte-carlo.html#cb512-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-41"><a href="markov-chain-monte-carlo.html#cb512-41" aria-hidden="true" tabindex="-1"></a><span class="co"># specify where to start the trajectory:</span></span>
<span id="cb512-42"><a href="markov-chain-monte-carlo.html#cb512-42" aria-hidden="true" tabindex="-1"></a>trajectory[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">0.01</span> <span class="co"># another arbitrary value</span></span>
<span id="cb512-43"><a href="markov-chain-monte-carlo.html#cb512-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-44"><a href="markov-chain-monte-carlo.html#cb512-44" aria-hidden="true" tabindex="-1"></a><span class="co"># specify the burn-in period</span></span>
<span id="cb512-45"><a href="markov-chain-monte-carlo.html#cb512-45" aria-hidden="true" tabindex="-1"></a>burn_in <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fl">0.0</span> <span class="sc">*</span> traj_length) <span class="co"># arbitrary number, less than `traj_length`</span></span>
<span id="cb512-46"><a href="markov-chain-monte-carlo.html#cb512-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-47"><a href="markov-chain-monte-carlo.html#cb512-47" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize accepted, rejected counters, just to monitor performance:</span></span>
<span id="cb512-48"><a href="markov-chain-monte-carlo.html#cb512-48" aria-hidden="true" tabindex="-1"></a>n_accepted <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb512-49"><a href="markov-chain-monte-carlo.html#cb512-49" aria-hidden="true" tabindex="-1"></a>n_rejected <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
<p>That first part follows what Kruschke put in his script. I’m going to bundel the next large potion in a fucntion, <code>my_metropolis()</code> which will make it easier to plug the code into the <code>purrr::map()</code> function.</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="markov-chain-monte-carlo.html#cb513-1" aria-hidden="true" tabindex="-1"></a>my_metropolis <span class="ot">&lt;-</span> <span class="cf">function</span>(proposal_sd) {</span>
<span id="cb513-2"><a href="markov-chain-monte-carlo.html#cb513-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb513-3"><a href="markov-chain-monte-carlo.html#cb513-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># now generate the random walk. the &#39;t&#39; index is time or trial in the walk.</span></span>
<span id="cb513-4"><a href="markov-chain-monte-carlo.html#cb513-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># specify seed to reproduce same random walk</span></span>
<span id="cb513-5"><a href="markov-chain-monte-carlo.html#cb513-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">47405</span>)</span>
<span id="cb513-6"><a href="markov-chain-monte-carlo.html#cb513-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb513-7"><a href="markov-chain-monte-carlo.html#cb513-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb513-8"><a href="markov-chain-monte-carlo.html#cb513-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## I&#39;m taking this section out and will replace it</span></span>
<span id="cb513-9"><a href="markov-chain-monte-carlo.html#cb513-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb513-10"><a href="markov-chain-monte-carlo.html#cb513-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # specify standard deviation of proposal distribution</span></span>
<span id="cb513-11"><a href="markov-chain-monte-carlo.html#cb513-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># proposal_sd &lt;- c(0.02, 0.2, 2.0)[2]</span></span>
<span id="cb513-12"><a href="markov-chain-monte-carlo.html#cb513-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb513-13"><a href="markov-chain-monte-carlo.html#cb513-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## end of the section I took out</span></span>
<span id="cb513-14"><a href="markov-chain-monte-carlo.html#cb513-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb513-15"><a href="markov-chain-monte-carlo.html#cb513-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb513-16"><a href="markov-chain-monte-carlo.html#cb513-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(traj_length <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb513-17"><a href="markov-chain-monte-carlo.html#cb513-17" aria-hidden="true" tabindex="-1"></a>    current_position <span class="ot">&lt;-</span> trajectory[t]</span>
<span id="cb513-18"><a href="markov-chain-monte-carlo.html#cb513-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># use the proposal distribution to generate a proposed jump</span></span>
<span id="cb513-19"><a href="markov-chain-monte-carlo.html#cb513-19" aria-hidden="true" tabindex="-1"></a>    proposed_jump <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> proposal_sd)</span>
<span id="cb513-20"><a href="markov-chain-monte-carlo.html#cb513-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># compute the probability of accepting the proposed jump</span></span>
<span id="cb513-21"><a href="markov-chain-monte-carlo.html#cb513-21" aria-hidden="true" tabindex="-1"></a>    prob_accept <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">1</span>,</span>
<span id="cb513-22"><a href="markov-chain-monte-carlo.html#cb513-22" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">target_rel_prob</span>(current_position <span class="sc">+</span> proposed_jump, my_data)</span>
<span id="cb513-23"><a href="markov-chain-monte-carlo.html#cb513-23" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">/</span> <span class="fu">target_rel_prob</span>(current_position, my_data))</span>
<span id="cb513-24"><a href="markov-chain-monte-carlo.html#cb513-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate a random uniform value from the interval [0, 1] to</span></span>
<span id="cb513-25"><a href="markov-chain-monte-carlo.html#cb513-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># decide whether or not to accept the proposed jump</span></span>
<span id="cb513-26"><a href="markov-chain-monte-carlo.html#cb513-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> prob_accept) {</span>
<span id="cb513-27"><a href="markov-chain-monte-carlo.html#cb513-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># accept the proposed jump</span></span>
<span id="cb513-28"><a href="markov-chain-monte-carlo.html#cb513-28" aria-hidden="true" tabindex="-1"></a>      trajectory[t <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> current_position <span class="sc">+</span> proposed_jump</span>
<span id="cb513-29"><a href="markov-chain-monte-carlo.html#cb513-29" aria-hidden="true" tabindex="-1"></a>      <span class="co"># increment the accepted counter, just to monitor performance</span></span>
<span id="cb513-30"><a href="markov-chain-monte-carlo.html#cb513-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (t <span class="sc">&gt;</span> burn_in) {n_accepted <span class="ot">&lt;-</span> n_accepted <span class="sc">+</span> <span class="dv">1</span>}</span>
<span id="cb513-31"><a href="markov-chain-monte-carlo.html#cb513-31" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb513-32"><a href="markov-chain-monte-carlo.html#cb513-32" aria-hidden="true" tabindex="-1"></a>      <span class="co"># reject the proposed jump, stay at current position</span></span>
<span id="cb513-33"><a href="markov-chain-monte-carlo.html#cb513-33" aria-hidden="true" tabindex="-1"></a>      trajectory[t <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> current_position</span>
<span id="cb513-34"><a href="markov-chain-monte-carlo.html#cb513-34" aria-hidden="true" tabindex="-1"></a>      <span class="co"># increment the rejected counter, just to monitor performance</span></span>
<span id="cb513-35"><a href="markov-chain-monte-carlo.html#cb513-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (t <span class="sc">&gt;</span> burn_in) {n_rejected <span class="ot">&lt;-</span> n_rejected <span class="sc">+</span> <span class="dv">1</span>}</span>
<span id="cb513-36"><a href="markov-chain-monte-carlo.html#cb513-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb513-37"><a href="markov-chain-monte-carlo.html#cb513-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb513-38"><a href="markov-chain-monte-carlo.html#cb513-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb513-39"><a href="markov-chain-monte-carlo.html#cb513-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract the post-burn_in portion of the trajectory</span></span>
<span id="cb513-40"><a href="markov-chain-monte-carlo.html#cb513-40" aria-hidden="true" tabindex="-1"></a>  accepted_traj <span class="ot">&lt;-</span> trajectory[(burn_in <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">:</span> <span class="fu">length</span>(trajectory)]</span>
<span id="cb513-41"><a href="markov-chain-monte-carlo.html#cb513-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb513-42"><a href="markov-chain-monte-carlo.html#cb513-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">accepted_traj =</span> accepted_traj,</span>
<span id="cb513-43"><a href="markov-chain-monte-carlo.html#cb513-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_accepted    =</span> n_accepted, </span>
<span id="cb513-44"><a href="markov-chain-monte-carlo.html#cb513-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_rejected    =</span> n_rejected)</span>
<span id="cb513-45"><a href="markov-chain-monte-carlo.html#cb513-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># end of Metropolis algorithm</span></span>
<span id="cb513-46"><a href="markov-chain-monte-carlo.html#cb513-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb513-47"><a href="markov-chain-monte-carlo.html#cb513-47" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we have <code>my_metropolis()</code>, we can run the analysis based on the three <code>proposal_sd</code> values, nesting the results in a tibble.</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="markov-chain-monte-carlo.html#cb514-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb514-2"><a href="markov-chain-monte-carlo.html#cb514-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">proposal_sd =</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.2</span>, <span class="fl">2.0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb514-3"><a href="markov-chain-monte-carlo.html#cb514-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">accepted_traj =</span> <span class="fu">map</span>(proposal_sd, my_metropolis)) <span class="sc">%&gt;%</span> </span>
<span id="cb514-4"><a href="markov-chain-monte-carlo.html#cb514-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(accepted_traj)</span>
<span id="cb514-5"><a href="markov-chain-monte-carlo.html#cb514-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb514-6"><a href="markov-chain-monte-carlo.html#cb514-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d)</span></code></pre></div>
<pre><code>## Rows: 150,000
## Columns: 4
## $ proposal_sd   &lt;dbl&gt; 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02…
## $ accepted_traj &lt;dbl&gt; 0.01000000, 0.01000000, 0.01000000, 0.01000000, 0.01149173, 0.02550380, 0.02…
## $ n_accepted    &lt;dbl&gt; 46801, 46801, 46801, 46801, 46801, 46801, 46801, 46801, 46801, 46801, 46801,…
## $ n_rejected    &lt;dbl&gt; 3198, 3198, 3198, 3198, 3198, 3198, 3198, 3198, 3198, 3198, 3198, 3198, 3198…</code></pre>
<p>Now we have <code>d</code> in hand, here’s the top portion of Figure 7.4.</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="markov-chain-monte-carlo.html#cb516-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb516-2"><a href="markov-chain-monte-carlo.html#cb516-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb516-3"><a href="markov-chain-monte-carlo.html#cb516-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proposal_sd =</span> <span class="fu">str_c</span>(<span class="st">&quot;Proposal SD = &quot;</span>, proposal_sd),</span>
<span id="cb516-4"><a href="markov-chain-monte-carlo.html#cb516-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">iter        =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50000</span>, <span class="at">times =</span> <span class="dv">3</span>))</span>
<span id="cb516-5"><a href="markov-chain-monte-carlo.html#cb516-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb516-6"><a href="markov-chain-monte-carlo.html#cb516-6" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb516-7"><a href="markov-chain-monte-carlo.html#cb516-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> accepted_traj, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb516-8"><a href="markov-chain-monte-carlo.html#cb516-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_histinterval</span>(<span class="at">point_interval =</span> mode_hdi, <span class="at">.width =</span> .<span class="dv">95</span>,</span>
<span id="cb516-9"><a href="markov-chain-monte-carlo.html#cb516-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="at">slab_color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">outline_bars =</span> T,</span>
<span id="cb516-10"><a href="markov-chain-monte-carlo.html#cb516-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="dv">40</span>, <span class="at">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="sc">+</span></span>
<span id="cb516-11"><a href="markov-chain-monte-carlo.html#cb516-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta), <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">*</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb516-12"><a href="markov-chain-monte-carlo.html#cb516-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb516-13"><a href="markov-chain-monte-carlo.html#cb516-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb516-14"><a href="markov-chain-monte-carlo.html#cb516-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">panel_border</span>() <span class="sc">+</span></span>
<span id="cb516-15"><a href="markov-chain-monte-carlo.html#cb516-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> proposal_sd, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-21-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>The modes are the points and the lines depict the 95% HDIs. Also, did you notice our use of the <code>cowplot::panel_border()</code> function? The settings from <code>theme_cowplot()</code> can make it difficult to differentiate among subplots when faceting. By throwing in a call to <code>panel_border()</code> after <code>theme_cowplot()</code>, we added in lightweight panel borders.</p>
<p>Here’s the middle of Figure 7.4.</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="markov-chain-monte-carlo.html#cb517-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb517-2"><a href="markov-chain-monte-carlo.html#cb517-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> accepted_traj, <span class="at">y =</span> iter)) <span class="sc">+</span></span>
<span id="cb517-3"><a href="markov-chain-monte-carlo.html#cb517-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb517-4"><a href="markov-chain-monte-carlo.html#cb517-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb517-5"><a href="markov-chain-monte-carlo.html#cb517-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta), <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">*</span> <span class="fl">0.2</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb517-6"><a href="markov-chain-monte-carlo.html#cb517-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;Step in Chain&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">49900</span>, <span class="dv">50000</span>)) <span class="sc">+</span></span>
<span id="cb517-7"><a href="markov-chain-monte-carlo.html#cb517-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;End of Chain&quot;</span>) <span class="sc">+</span></span>
<span id="cb517-8"><a href="markov-chain-monte-carlo.html#cb517-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb517-9"><a href="markov-chain-monte-carlo.html#cb517-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">panel_border</span>() <span class="sc">+</span></span>
<span id="cb517-10"><a href="markov-chain-monte-carlo.html#cb517-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> proposal_sd, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-22-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>The bottom:</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="markov-chain-monte-carlo.html#cb518-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb518-2"><a href="markov-chain-monte-carlo.html#cb518-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> accepted_traj, <span class="at">y =</span> iter)) <span class="sc">+</span></span>
<span id="cb518-3"><a href="markov-chain-monte-carlo.html#cb518-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb518-4"><a href="markov-chain-monte-carlo.html#cb518-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb518-5"><a href="markov-chain-monte-carlo.html#cb518-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta), <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">*</span> <span class="fl">0.2</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb518-6"><a href="markov-chain-monte-carlo.html#cb518-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;Step in Chain&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb518-7"><a href="markov-chain-monte-carlo.html#cb518-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;End of Chain&quot;</span>) <span class="sc">+</span></span>
<span id="cb518-8"><a href="markov-chain-monte-carlo.html#cb518-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb518-9"><a href="markov-chain-monte-carlo.html#cb518-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">panel_border</span>() <span class="sc">+</span></span>
<span id="cb518-10"><a href="markov-chain-monte-carlo.html#cb518-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> proposal_sd, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-23-1.png" width="960" style="display: block; margin: auto;" /></p>
<blockquote>
<p>Regardless of the which proposal distribution in Figure 7.4 is used, the Metropolis algorithm will eventually produce an accurate representation of the posterior distribution, as is suggested by the histograms in the upper row of Figure 7.4. What differs is the efficiency of achieving a good approximation. (p. 160)</p>
</blockquote>
<p>Before we move on, you may have noticed the top row of Kruschke’s Figure 7.4 contains the estimates for the effective sample size (Eff.Sz.) for each chain, which Kruschke briefly mentioned on page 160. We’ll walk out effective sample sizes, later. But for now we can compute them with some of the helper functions from the <strong>posterior</strong> package <span class="citation">(<a href="#ref-R-posterior" role="doc-biblioref">Bürkner et al., 2021</a>)</span>. As it turns out, there are several kinds of effective sample size. With regards to the helper functions from <strong>posterior</strong>, I suspect the one closest to what Kruschke used in the text will be <code>ess_mean()</code>. Here’s how you might use <code>ess_mean()</code> to compute the Eff.Sz. estimate for each of our three chains.</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="markov-chain-monte-carlo.html#cb519-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb519-2"><a href="markov-chain-monte-carlo.html#cb519-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(proposal_sd, accepted_traj) <span class="sc">%&gt;%</span> </span>
<span id="cb519-3"><a href="markov-chain-monte-carlo.html#cb519-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(proposal_sd) <span class="sc">%&gt;%</span></span>
<span id="cb519-4"><a href="markov-chain-monte-carlo.html#cb519-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Eff.Sz. =</span> posterior<span class="sc">::</span><span class="fu">ess_mean</span>(accepted_traj))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   proposal_sd        Eff.Sz.
##   &lt;chr&gt;                &lt;dbl&gt;
## 1 Proposal SD = 0.02    500.
## 2 Proposal SD = 0.2   11340.
## 3 Proposal SD = 2      2105.</code></pre>
</div>
<div id="summary-of-metropolis-algorithm." class="section level3 hasAnchor" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Summary of Metropolis algorithm.<a href="markov-chain-monte-carlo.html#summary-of-metropolis-algorithm." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>The motivation for methods like the Metropolis algorithm is that they provide a high-resolution picture of the posterior distribution, even though in complex models we cannot explicitly solve the mathematical integral in Bayes’ rule. The idea is that we get a handle on the posterior distribution by generating a large sample of representative values. The larger the sample, the more accurate is our approximation. As emphasized previously, this is a sample of representative credible parameter values from the posterior distribution; it is not a resampling of data (there is a fixed data set).</p>
<p>The cleverness of the method is that representative parameter values can be randomly sampled from complicated posterior distributions without solving the integral in Bayes’ rule, and by using only simple proposal distributions for which efficient random number generators already exist. (p. 161)</p>
</blockquote>
</div>
</div>
<div id="toward-gibbs-sampling-estimating-two-coin-biases" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Toward Gibbs sampling: Estimating two coin biases<a href="markov-chain-monte-carlo.html#toward-gibbs-sampling-estimating-two-coin-biases" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>“The Metropolis method is very useful, but it can be inefficient. Other methods can be more efficient in some situations” (p. 162).</p>
<div id="prior-likelihood-and-posterior-for-two-biases." class="section level3 hasAnchor" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Prior, likelihood and posterior for two biases.<a href="markov-chain-monte-carlo.html#prior-likelihood-and-posterior-for-two-biases." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>We are considering situations in which there are two underlying biases, namely <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span>, for the two coins. We are trying to determine what we should believe about these biases after we have observed some data from the two coins. Recall that [Kruschke used] the term “bias” as the name of the parameter <span class="math inline">\(\theta\)</span>, and not to indicate that the value of <span class="math inline">\(\theta\)</span> deviates from <span class="math inline">\(0.5\)</span>….</p>
<p>What we have to do next is specify a particular mathematical form for the prior distribution. We will work through the mathematics of a particular case for two reasons: First, it will allow us to explore graphical displays of two-dimensional parameter spaces, which will inform our intuitions about Bayes’ rule and sampling from the posterior distribution. Second, the mathematics will set the stage for a specific example of Gibbs sampling. Later in the book when we do applied Bayesian analysis, we will <em>not</em> be doing any of this sort of mathematics. We are doing the math now, for simple cases, to understand how the methods work so we can properly interpret their outputs in realistically complex cases. (pp. 163–165, <em>emphasis</em> in the original)</p>
</blockquote>
</div>
<div id="the-posterior-via-exact-formal-analysis." class="section level3 hasAnchor" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> The posterior via exact formal analysis.<a href="markov-chain-monte-carlo.html#the-posterior-via-exact-formal-analysis." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The plots in the left column of Figure 7.5 are outside of my skill set. I believe they are referred to as wireframe plots and it’s my understanding that <strong>ggplot2</strong> does not support wireframe plots at this time. However, I can reproduce versions of the right hand column. For our initial attempt for the upper right corner, we’ll simulate.</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="markov-chain-monte-carlo.html#cb521-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb521-2"><a href="markov-chain-monte-carlo.html#cb521-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb521-3"><a href="markov-chain-monte-carlo.html#cb521-3" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span></span>
<span id="cb521-4"><a href="markov-chain-monte-carlo.html#cb521-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">theta_1 =</span> <span class="fu">rbeta</span>(<span class="fl">1e5</span>, <span class="at">shape1 =</span> <span class="dv">2</span>, <span class="at">shape2 =</span> <span class="dv">2</span>),</span>
<span id="cb521-5"><a href="markov-chain-monte-carlo.html#cb521-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">theta_2 =</span> <span class="fu">rbeta</span>(<span class="fl">1e5</span>, <span class="at">shape1 =</span> <span class="dv">2</span>, <span class="at">shape2 =</span> <span class="dv">2</span>))</span>
<span id="cb521-6"><a href="markov-chain-monte-carlo.html#cb521-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb521-7"><a href="markov-chain-monte-carlo.html#cb521-7" aria-hidden="true" tabindex="-1"></a>betas <span class="sc">%&gt;%</span> </span>
<span id="cb521-8"><a href="markov-chain-monte-carlo.html#cb521-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta_1, <span class="at">y =</span> theta_2)) <span class="sc">+</span></span>
<span id="cb521-9"><a href="markov-chain-monte-carlo.html#cb521-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density_2d</span>() <span class="sc">+</span></span>
<span id="cb521-10"><a href="markov-chain-monte-carlo.html#cb521-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(theta[<span class="dv">1</span>]),</span>
<span id="cb521-11"><a href="markov-chain-monte-carlo.html#cb521-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(theta[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb521-12"><a href="markov-chain-monte-carlo.html#cb521-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb521-13"><a href="markov-chain-monte-carlo.html#cb521-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span></code></pre></div>
<p><img src="07_files/figure-html/betas-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Instead of the contour lines, one might use color to depict the density variable.</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="markov-chain-monte-carlo.html#cb522-1" aria-hidden="true" tabindex="-1"></a>betas <span class="sc">%&gt;%</span> </span>
<span id="cb522-2"><a href="markov-chain-monte-carlo.html#cb522-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta_1, <span class="at">y =</span> theta_2, <span class="at">fill =</span> <span class="fu">after_stat</span>(density))) <span class="sc">+</span></span>
<span id="cb522-3"><a href="markov-chain-monte-carlo.html#cb522-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density_2d</span>(<span class="at">geom =</span> <span class="st">&quot;raster&quot;</span>, <span class="at">contour =</span> F) <span class="sc">+</span></span>
<span id="cb522-4"><a href="markov-chain-monte-carlo.html#cb522-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>) <span class="sc">+</span></span>
<span id="cb522-5"><a href="markov-chain-monte-carlo.html#cb522-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(theta[<span class="dv">1</span>]),</span>
<span id="cb522-6"><a href="markov-chain-monte-carlo.html#cb522-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(theta[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb522-7"><a href="markov-chain-monte-carlo.html#cb522-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb522-8"><a href="markov-chain-monte-carlo.html#cb522-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-25-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Remember how we talked about suppressing the unsightly white space between the bottom of bar-plot bars and the <span class="math inline">\(x\)</span>-axis? Well, look at all that unsightly white space between the axes and the boundaries of the parameter space in our bivariate Beta plot. We can further flex our <code>expansion()</code> skills to get rid of those in the next plot. Speaking of which, we might make a more precise version of that plot with the <code>dbeta()</code> function. This approach is also more in line with the title of this subsection: <em>The posterior via exact formal analysis</em>.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="markov-chain-monte-carlo.html#cb523-1" aria-hidden="true" tabindex="-1"></a>theta_sequence <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">01</span>)</span>
<span id="cb523-2"><a href="markov-chain-monte-carlo.html#cb523-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb523-3"><a href="markov-chain-monte-carlo.html#cb523-3" aria-hidden="true" tabindex="-1"></a><span class="fu">crossing</span>(<span class="at">theta_1 =</span> theta_sequence,</span>
<span id="cb523-4"><a href="markov-chain-monte-carlo.html#cb523-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">theta_2 =</span> theta_sequence) <span class="sc">%&gt;%</span></span>
<span id="cb523-5"><a href="markov-chain-monte-carlo.html#cb523-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prior_1 =</span> <span class="fu">dbeta</span>(<span class="at">x =</span> theta_1, <span class="at">shape1 =</span> <span class="dv">2</span>, <span class="at">shape2 =</span> <span class="dv">2</span>),</span>
<span id="cb523-6"><a href="markov-chain-monte-carlo.html#cb523-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">prior_2 =</span> <span class="fu">dbeta</span>(<span class="at">x =</span> theta_2, <span class="at">shape1 =</span> <span class="dv">2</span>, <span class="at">shape2 =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb523-7"><a href="markov-chain-monte-carlo.html#cb523-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb523-8"><a href="markov-chain-monte-carlo.html#cb523-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta_1, <span class="at">y =</span> theta_2, <span class="at">fill =</span> prior_1 <span class="sc">*</span> prior_2)) <span class="sc">+</span></span>
<span id="cb523-9"><a href="markov-chain-monte-carlo.html#cb523-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb523-10"><a href="markov-chain-monte-carlo.html#cb523-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="st">&quot;joint prior density&quot;</span>, <span class="at">option =</span> <span class="st">&quot;A&quot;</span>) <span class="sc">+</span></span>
<span id="cb523-11"><a href="markov-chain-monte-carlo.html#cb523-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta[<span class="dv">1</span>]), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb523-12"><a href="markov-chain-monte-carlo.html#cb523-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(theta[<span class="dv">2</span>]), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb523-13"><a href="markov-chain-monte-carlo.html#cb523-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb523-14"><a href="markov-chain-monte-carlo.html#cb523-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-26-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Look at that–no more unsightly white space! We’ll need the <code>bernoulli_likelihood()</code> function from back in Chapter 6 for the middle right of Figure 7.5.</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="markov-chain-monte-carlo.html#cb524-1" aria-hidden="true" tabindex="-1"></a>bernoulli_likelihood <span class="ot">&lt;-</span> <span class="cf">function</span>(theta, data) {</span>
<span id="cb524-2"><a href="markov-chain-monte-carlo.html#cb524-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb524-3"><a href="markov-chain-monte-carlo.html#cb524-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># theta = success probability parameter ranging from 0 to 1</span></span>
<span id="cb524-4"><a href="markov-chain-monte-carlo.html#cb524-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># data = the vector of data (i.e., a series of 0&#39;s and 1&#39;s)</span></span>
<span id="cb524-5"><a href="markov-chain-monte-carlo.html#cb524-5" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(data)</span>
<span id="cb524-6"><a href="markov-chain-monte-carlo.html#cb524-6" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> <span class="fu">sum</span>(data)</span>
<span id="cb524-7"><a href="markov-chain-monte-carlo.html#cb524-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb524-8"><a href="markov-chain-monte-carlo.html#cb524-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(theta<span class="sc">^</span>z <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> theta)<span class="sc">^</span>(n <span class="sc">-</span> <span class="fu">sum</span>(data)))</span>
<span id="cb524-9"><a href="markov-chain-monte-carlo.html#cb524-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb524-10"><a href="markov-chain-monte-carlo.html#cb524-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>With our trusty <code>bernoulli_likelihood()</code> function in hand, we’re almost ready to compute and plot the likelihood. We just need to define our data.</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="markov-chain-monte-carlo.html#cb525-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the parameters</span></span>
<span id="cb525-2"><a href="markov-chain-monte-carlo.html#cb525-2" aria-hidden="true" tabindex="-1"></a><span class="co"># coin 1</span></span>
<span id="cb525-3"><a href="markov-chain-monte-carlo.html#cb525-3" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb525-4"><a href="markov-chain-monte-carlo.html#cb525-4" aria-hidden="true" tabindex="-1"></a>z1 <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb525-5"><a href="markov-chain-monte-carlo.html#cb525-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb525-6"><a href="markov-chain-monte-carlo.html#cb525-6" aria-hidden="true" tabindex="-1"></a><span class="co"># coin 2</span></span>
<span id="cb525-7"><a href="markov-chain-monte-carlo.html#cb525-7" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb525-8"><a href="markov-chain-monte-carlo.html#cb525-8" aria-hidden="true" tabindex="-1"></a>z2 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb525-9"><a href="markov-chain-monte-carlo.html#cb525-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb525-10"><a href="markov-chain-monte-carlo.html#cb525-10" aria-hidden="true" tabindex="-1"></a><span class="co"># use the parameters to make the data</span></span>
<span id="cb525-11"><a href="markov-chain-monte-carlo.html#cb525-11" aria-hidden="true" tabindex="-1"></a>theta_1_data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">times =</span> <span class="fu">c</span>(n1 <span class="sc">-</span> z1, z1))</span>
<span id="cb525-12"><a href="markov-chain-monte-carlo.html#cb525-12" aria-hidden="true" tabindex="-1"></a>theta_2_data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">times =</span> <span class="fu">c</span>(n2 <span class="sc">-</span> z2, z2))</span>
<span id="cb525-13"><a href="markov-chain-monte-carlo.html#cb525-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb525-14"><a href="markov-chain-monte-carlo.html#cb525-14" aria-hidden="true" tabindex="-1"></a><span class="co"># take a look</span></span>
<span id="cb525-15"><a href="markov-chain-monte-carlo.html#cb525-15" aria-hidden="true" tabindex="-1"></a>theta_1_data</span></code></pre></div>
<pre><code>## [1] 0 0 1 1 1 1 1 1</code></pre>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="markov-chain-monte-carlo.html#cb527-1" aria-hidden="true" tabindex="-1"></a>theta_2_data</span></code></pre></div>
<pre><code>## [1] 0 0 0 0 0 1 1</code></pre>
<p>Note how these data sequences are of different sample sizes <span class="math inline">\((N_1 = 8; N_2 = 7 )\)</span>. Though it doesn’t matter much for the formal analysis approach, this will become very important when we fit the model with <strong>brms</strong>. But for right now, we’re finally ready to make a version of the middle right panel of Figure 7.5.</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="markov-chain-monte-carlo.html#cb529-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crossing</span>(<span class="at">theta_1 =</span> theta_sequence,</span>
<span id="cb529-2"><a href="markov-chain-monte-carlo.html#cb529-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">theta_2 =</span> theta_sequence) <span class="sc">%&gt;%</span></span>
<span id="cb529-3"><a href="markov-chain-monte-carlo.html#cb529-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">likelihood_1 =</span> <span class="fu">bernoulli_likelihood</span>(<span class="at">theta =</span> theta_1,</span>
<span id="cb529-4"><a href="markov-chain-monte-carlo.html#cb529-4" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">data =</span> theta_1_data),</span>
<span id="cb529-5"><a href="markov-chain-monte-carlo.html#cb529-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">likelihood_2 =</span> <span class="fu">bernoulli_likelihood</span>(<span class="at">theta =</span> theta_2,</span>
<span id="cb529-6"><a href="markov-chain-monte-carlo.html#cb529-6" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">data =</span> theta_2_data)) <span class="sc">%&gt;%</span></span>
<span id="cb529-7"><a href="markov-chain-monte-carlo.html#cb529-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb529-8"><a href="markov-chain-monte-carlo.html#cb529-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta_1, <span class="at">y =</span> theta_2, <span class="at">fill =</span> likelihood_1 <span class="sc">*</span> likelihood_2)) <span class="sc">+</span></span>
<span id="cb529-9"><a href="markov-chain-monte-carlo.html#cb529-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb529-10"><a href="markov-chain-monte-carlo.html#cb529-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="st">&quot;joint likelihood&quot;</span>, <span class="at">option =</span> <span class="st">&quot;A&quot;</span>) <span class="sc">+</span></span>
<span id="cb529-11"><a href="markov-chain-monte-carlo.html#cb529-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta[<span class="dv">1</span>]), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb529-12"><a href="markov-chain-monte-carlo.html#cb529-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(theta[<span class="dv">2</span>]), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb529-13"><a href="markov-chain-monte-carlo.html#cb529-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb529-14"><a href="markov-chain-monte-carlo.html#cb529-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-29-1.png" width="528" style="display: block; margin: auto;" /></p>
<p>Here’s how to make the two-dimensional posterior in the lower right panel of Figure 7.5.</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="markov-chain-monte-carlo.html#cb530-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this is a redo from two plots up, but saved as `d_prior`</span></span>
<span id="cb530-2"><a href="markov-chain-monte-carlo.html#cb530-2" aria-hidden="true" tabindex="-1"></a>d_prior <span class="ot">&lt;-</span></span>
<span id="cb530-3"><a href="markov-chain-monte-carlo.html#cb530-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">theta_1 =</span> theta_sequence,</span>
<span id="cb530-4"><a href="markov-chain-monte-carlo.html#cb530-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">theta_2 =</span> theta_sequence) <span class="sc">%&gt;%</span></span>
<span id="cb530-5"><a href="markov-chain-monte-carlo.html#cb530-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prior_1 =</span> <span class="fu">dbeta</span>(<span class="at">x =</span> theta_1, <span class="at">shape1 =</span> <span class="dv">2</span>, <span class="at">shape2 =</span> <span class="dv">2</span>),</span>
<span id="cb530-6"><a href="markov-chain-monte-carlo.html#cb530-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">prior_2 =</span> <span class="fu">dbeta</span>(<span class="at">x =</span> theta_2, <span class="at">shape1 =</span> <span class="dv">2</span>, <span class="at">shape2 =</span> <span class="dv">2</span>))</span>
<span id="cb530-7"><a href="markov-chain-monte-carlo.html#cb530-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-8"><a href="markov-chain-monte-carlo.html#cb530-8" aria-hidden="true" tabindex="-1"></a><span class="co"># this is a redo from one plot up, but saved as `d_likelihood`</span></span>
<span id="cb530-9"><a href="markov-chain-monte-carlo.html#cb530-9" aria-hidden="true" tabindex="-1"></a>d_likelihood <span class="ot">&lt;-</span></span>
<span id="cb530-10"><a href="markov-chain-monte-carlo.html#cb530-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">theta_1 =</span> theta_sequence,</span>
<span id="cb530-11"><a href="markov-chain-monte-carlo.html#cb530-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">theta_2 =</span> theta_sequence) <span class="sc">%&gt;%</span></span>
<span id="cb530-12"><a href="markov-chain-monte-carlo.html#cb530-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">likelihood_1 =</span> <span class="fu">bernoulli_likelihood</span>(<span class="at">theta =</span> theta_1,</span>
<span id="cb530-13"><a href="markov-chain-monte-carlo.html#cb530-13" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">data =</span> theta_1_data),</span>
<span id="cb530-14"><a href="markov-chain-monte-carlo.html#cb530-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">likelihood_2 =</span> <span class="fu">bernoulli_likelihood</span>(<span class="at">theta =</span> theta_2,</span>
<span id="cb530-15"><a href="markov-chain-monte-carlo.html#cb530-15" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">data =</span> theta_2_data))</span>
<span id="cb530-16"><a href="markov-chain-monte-carlo.html#cb530-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-17"><a href="markov-chain-monte-carlo.html#cb530-17" aria-hidden="true" tabindex="-1"></a><span class="co"># here we combine `d_prior` and `d_likelihood`</span></span>
<span id="cb530-18"><a href="markov-chain-monte-carlo.html#cb530-18" aria-hidden="true" tabindex="-1"></a>d_prior <span class="sc">%&gt;%</span> </span>
<span id="cb530-19"><a href="markov-chain-monte-carlo.html#cb530-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(d_likelihood, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;theta_1&quot;</span>, <span class="st">&quot;theta_2&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb530-20"><a href="markov-chain-monte-carlo.html#cb530-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we need the marginal likelihood, the denominator in Bayes&#39; rule</span></span>
<span id="cb530-21"><a href="markov-chain-monte-carlo.html#cb530-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">marginal_likelihood =</span> <span class="fu">sum</span>(prior_1 <span class="sc">*</span> prior_2 <span class="sc">*</span> likelihood_1 <span class="sc">*</span> likelihood_2)) <span class="sc">%&gt;%</span> </span>
<span id="cb530-22"><a href="markov-chain-monte-carlo.html#cb530-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># finally, the two-dimensional posterior</span></span>
<span id="cb530-23"><a href="markov-chain-monte-carlo.html#cb530-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">posterior =</span> (prior_1 <span class="sc">*</span> prior_2 <span class="sc">*</span> likelihood_1 <span class="sc">*</span> likelihood_2) <span class="sc">/</span> marginal_likelihood) <span class="sc">%&gt;%</span> </span>
<span id="cb530-24"><a href="markov-chain-monte-carlo.html#cb530-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb530-25"><a href="markov-chain-monte-carlo.html#cb530-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb530-26"><a href="markov-chain-monte-carlo.html#cb530-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta_1, <span class="at">y =</span> theta_2, <span class="at">fill =</span> posterior)) <span class="sc">+</span></span>
<span id="cb530-27"><a href="markov-chain-monte-carlo.html#cb530-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb530-28"><a href="markov-chain-monte-carlo.html#cb530-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(p)(theta[<span class="dv">1</span>]<span class="sc">*</span><span class="st">&#39;, &#39;</span><span class="sc">*</span>theta[<span class="dv">2</span>]<span class="sc">*</span><span class="st">&#39;|&#39;</span><span class="sc">*</span>D)), <span class="at">option =</span> <span class="st">&quot;A&quot;</span>) <span class="sc">+</span></span>
<span id="cb530-29"><a href="markov-chain-monte-carlo.html#cb530-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta[<span class="dv">1</span>]), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb530-30"><a href="markov-chain-monte-carlo.html#cb530-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(theta[<span class="dv">2</span>]), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb530-31"><a href="markov-chain-monte-carlo.html#cb530-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb530-32"><a href="markov-chain-monte-carlo.html#cb530-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-30-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>That last plot, my friends, is a depiction of</p>
<p><span class="math display">\[p(\theta_1, \theta_2 | D) = \frac{p(D | \theta_1, \theta_2) p(\theta_1, \theta_2)}{p(D)}.\]</span></p>
</div>
<div id="the-posterior-via-the-metropolis-algorithm." class="section level3 hasAnchor" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> The posterior via the Metropolis algorithm.<a href="markov-chain-monte-carlo.html#the-posterior-via-the-metropolis-algorithm." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>I initially skipped over this section because the purpose of this book is to explore Kruschke’s material with <strong>brms</strong>, which does not use the Metropolis algorithm (which really is primarily of historic interest, at this point). However, fellow enthusiast <a href="https://github.com/OmidGhasemi21">Omid Ghasemi</a> worked it through and kindly shared his solution. The workflow, below, is based heavily on his, with a few small adjustments.</p>
<p>To start off, we’ll refresh our two data sources and define a few custom functions.</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="markov-chain-monte-carlo.html#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we&#39;ve already defined these, but here they are again</span></span>
<span id="cb531-2"><a href="markov-chain-monte-carlo.html#cb531-2" aria-hidden="true" tabindex="-1"></a>theta_1_data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">times =</span> <span class="fu">c</span>(n1 <span class="sc">-</span> z1, z1))</span>
<span id="cb531-3"><a href="markov-chain-monte-carlo.html#cb531-3" aria-hidden="true" tabindex="-1"></a>theta_2_data <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">times =</span> <span class="fu">c</span>(n2 <span class="sc">-</span> z2, z2))</span>
<span id="cb531-4"><a href="markov-chain-monte-carlo.html#cb531-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb531-5"><a href="markov-chain-monte-carlo.html#cb531-5" aria-hidden="true" tabindex="-1"></a><span class="co"># define the bivariate Bernoulli likelihood</span></span>
<span id="cb531-6"><a href="markov-chain-monte-carlo.html#cb531-6" aria-hidden="true" tabindex="-1"></a>bivariate_bernoulli_likelihood <span class="ot">&lt;-</span> <span class="cf">function</span>(theta1, data1, theta2, data2) {</span>
<span id="cb531-7"><a href="markov-chain-monte-carlo.html#cb531-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb531-8"><a href="markov-chain-monte-carlo.html#cb531-8" aria-hidden="true" tabindex="-1"></a>  z1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(data1)</span>
<span id="cb531-9"><a href="markov-chain-monte-carlo.html#cb531-9" aria-hidden="true" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> <span class="fu">length</span>(data1)</span>
<span id="cb531-10"><a href="markov-chain-monte-carlo.html#cb531-10" aria-hidden="true" tabindex="-1"></a>  z2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(data2)</span>
<span id="cb531-11"><a href="markov-chain-monte-carlo.html#cb531-11" aria-hidden="true" tabindex="-1"></a>  n2 <span class="ot">&lt;-</span> <span class="fu">length</span>(data2)</span>
<span id="cb531-12"><a href="markov-chain-monte-carlo.html#cb531-12" aria-hidden="true" tabindex="-1"></a>  p_data_given_theta <span class="ot">&lt;-</span> (theta1<span class="sc">^</span>z1 <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> theta1)<span class="sc">^</span>(n1 <span class="sc">-</span> z1)) <span class="sc">*</span> (theta2<span class="sc">^</span>z2 <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> theta2)<span class="sc">^</span>(n2 <span class="sc">-</span> z2))</span>
<span id="cb531-13"><a href="markov-chain-monte-carlo.html#cb531-13" aria-hidden="true" tabindex="-1"></a>  p_data_given_theta[theta1 <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">|</span> theta1 <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb531-14"><a href="markov-chain-monte-carlo.html#cb531-14" aria-hidden="true" tabindex="-1"></a>  p_data_given_theta[theta2 <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">|</span> theta2 <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb531-15"><a href="markov-chain-monte-carlo.html#cb531-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb531-16"><a href="markov-chain-monte-carlo.html#cb531-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p_data_given_theta)</span>
<span id="cb531-17"><a href="markov-chain-monte-carlo.html#cb531-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb531-18"><a href="markov-chain-monte-carlo.html#cb531-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb531-19"><a href="markov-chain-monte-carlo.html#cb531-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb531-20"><a href="markov-chain-monte-carlo.html#cb531-20" aria-hidden="true" tabindex="-1"></a><span class="co"># we need to update the prior density function from above</span></span>
<span id="cb531-21"><a href="markov-chain-monte-carlo.html#cb531-21" aria-hidden="true" tabindex="-1"></a>prior_d <span class="ot">&lt;-</span> <span class="cf">function</span>(theta1, theta2) {</span>
<span id="cb531-22"><a href="markov-chain-monte-carlo.html#cb531-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb531-23"><a href="markov-chain-monte-carlo.html#cb531-23" aria-hidden="true" tabindex="-1"></a>  p_theta <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(theta1, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">dbeta</span>(theta2, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb531-24"><a href="markov-chain-monte-carlo.html#cb531-24" aria-hidden="true" tabindex="-1"></a>  p_theta[theta1 <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">|</span> theta1 <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb531-25"><a href="markov-chain-monte-carlo.html#cb531-25" aria-hidden="true" tabindex="-1"></a>  p_theta[theta2 <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">|</span> theta2 <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb531-26"><a href="markov-chain-monte-carlo.html#cb531-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb531-27"><a href="markov-chain-monte-carlo.html#cb531-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p_theta)</span>
<span id="cb531-28"><a href="markov-chain-monte-carlo.html#cb531-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb531-29"><a href="markov-chain-monte-carlo.html#cb531-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb531-30"><a href="markov-chain-monte-carlo.html#cb531-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb531-31"><a href="markov-chain-monte-carlo.html#cb531-31" aria-hidden="true" tabindex="-1"></a><span class="co"># we also need to update how we define the relative probability of the target distribution</span></span>
<span id="cb531-32"><a href="markov-chain-monte-carlo.html#cb531-32" aria-hidden="true" tabindex="-1"></a>target_rel_prob <span class="ot">&lt;-</span> <span class="cf">function</span>(theta1, data1, theta2, data2) {</span>
<span id="cb531-33"><a href="markov-chain-monte-carlo.html#cb531-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb531-34"><a href="markov-chain-monte-carlo.html#cb531-34" aria-hidden="true" tabindex="-1"></a>  l <span class="ot">&lt;-</span> <span class="fu">bivariate_bernoulli_likelihood</span>(theta1, data1, theta2, data2)</span>
<span id="cb531-35"><a href="markov-chain-monte-carlo.html#cb531-35" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">prior_d</span>(theta1, theta2)</span>
<span id="cb531-36"><a href="markov-chain-monte-carlo.html#cb531-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb531-37"><a href="markov-chain-monte-carlo.html#cb531-37" aria-hidden="true" tabindex="-1"></a>  target_rel_prob <span class="ot">&lt;-</span> l <span class="sc">*</span> p</span>
<span id="cb531-38"><a href="markov-chain-monte-carlo.html#cb531-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb531-39"><a href="markov-chain-monte-carlo.html#cb531-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(target_rel_prob)</span>
<span id="cb531-40"><a href="markov-chain-monte-carlo.html#cb531-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The next bit defines how we’ll apply the Metropolis algorithm to our bivariate Bernoulli data. Although the guts contain a lot of moving parts, there are only two parameters at the top level. The <code>traj_length</code> argument is set to 50,000, which will be our default number of MCMC draws. Of greater interest is the <code>proposal_sd</code> argument. From the text, we read:</p>
<blockquote>
<p>Recall that the Metropolis algorithm is a random walk through the parameter space that starts at some arbitrary point. We propose a jump to a new point in parameter space, with the proposed jump randomly generated from a proposal distribution from which it is easy to generate values. For our present purposes, the proposal distribution is a <em>bivariate</em> normal. (p. 168, <em>emphasis</em> in the original)</p>
</blockquote>
<p>For this exercise, the bivariate normal proposal distribution is centered at zero with an adjustable standard deviation. In the text, Kruschke compared the results for <span class="math inline">\(\operatorname{Normal}(0, 0.02)\)</span> and <span class="math inline">\(\operatorname{Normal}(0, 0.2)\)</span>. For our <code>my_bivariate_metropolis()</code> function, the <code>proposal_sd</code> argument controls that <span class="math inline">\(\sigma\)</span> parameter.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="markov-chain-monte-carlo.html#cb532-1" aria-hidden="true" tabindex="-1"></a>my_bivariate_metropolis <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">proposal_sd =</span> <span class="fl">0.02</span>,</span>
<span id="cb532-2"><a href="markov-chain-monte-carlo.html#cb532-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="co"># specify the length of the trajectory (i.e., the number of jumps to try)</span></span>
<span id="cb532-3"><a href="markov-chain-monte-carlo.html#cb532-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">traj_length =</span> <span class="dv">50000</span>) {</span>
<span id="cb532-4"><a href="markov-chain-monte-carlo.html#cb532-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb532-5"><a href="markov-chain-monte-carlo.html#cb532-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize the vector that will store the results</span></span>
<span id="cb532-6"><a href="markov-chain-monte-carlo.html#cb532-6" aria-hidden="true" tabindex="-1"></a>  trajectory1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, traj_length)</span>
<span id="cb532-7"><a href="markov-chain-monte-carlo.html#cb532-7" aria-hidden="true" tabindex="-1"></a>  trajectory2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, traj_length)</span>
<span id="cb532-8"><a href="markov-chain-monte-carlo.html#cb532-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb532-9"><a href="markov-chain-monte-carlo.html#cb532-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># specify where to start the trajectory:</span></span>
<span id="cb532-10"><a href="markov-chain-monte-carlo.html#cb532-10" aria-hidden="true" tabindex="-1"></a>  trajectory1[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co"># another arbitrary value</span></span>
<span id="cb532-11"><a href="markov-chain-monte-carlo.html#cb532-11" aria-hidden="true" tabindex="-1"></a>  trajectory2[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co"># another arbitrary value</span></span>
<span id="cb532-12"><a href="markov-chain-monte-carlo.html#cb532-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb532-13"><a href="markov-chain-monte-carlo.html#cb532-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># specify the burn-in period</span></span>
<span id="cb532-14"><a href="markov-chain-monte-carlo.html#cb532-14" aria-hidden="true" tabindex="-1"></a>  burn_in <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fl">0.0</span> <span class="sc">*</span> traj_length) <span class="co"># arbitrary number, less than `traj_length`</span></span>
<span id="cb532-15"><a href="markov-chain-monte-carlo.html#cb532-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb532-16"><a href="markov-chain-monte-carlo.html#cb532-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize accepted, rejected counters, just to monitor performance:</span></span>
<span id="cb532-17"><a href="markov-chain-monte-carlo.html#cb532-17" aria-hidden="true" tabindex="-1"></a>  n_accepted <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb532-18"><a href="markov-chain-monte-carlo.html#cb532-18" aria-hidden="true" tabindex="-1"></a>  n_rejected <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb532-19"><a href="markov-chain-monte-carlo.html#cb532-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb532-20"><a href="markov-chain-monte-carlo.html#cb532-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(traj_length <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb532-21"><a href="markov-chain-monte-carlo.html#cb532-21" aria-hidden="true" tabindex="-1"></a>    current_position1 <span class="ot">&lt;-</span> trajectory1[t]</span>
<span id="cb532-22"><a href="markov-chain-monte-carlo.html#cb532-22" aria-hidden="true" tabindex="-1"></a>    current_position2 <span class="ot">&lt;-</span> trajectory2[t]</span>
<span id="cb532-23"><a href="markov-chain-monte-carlo.html#cb532-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb532-24"><a href="markov-chain-monte-carlo.html#cb532-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># use the proposal distribution to generate a proposed jump</span></span>
<span id="cb532-25"><a href="markov-chain-monte-carlo.html#cb532-25" aria-hidden="true" tabindex="-1"></a>    proposed_jump1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> proposal_sd)</span>
<span id="cb532-26"><a href="markov-chain-monte-carlo.html#cb532-26" aria-hidden="true" tabindex="-1"></a>    proposed_jump2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> proposal_sd)</span>
<span id="cb532-27"><a href="markov-chain-monte-carlo.html#cb532-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb532-28"><a href="markov-chain-monte-carlo.html#cb532-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># compute the probability of accepting the proposed jump</span></span>
<span id="cb532-29"><a href="markov-chain-monte-carlo.html#cb532-29" aria-hidden="true" tabindex="-1"></a>    prob_accept <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">1</span>,</span>
<span id="cb532-30"><a href="markov-chain-monte-carlo.html#cb532-30" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">target_rel_prob</span>(current_position1 <span class="sc">+</span> proposed_jump1, theta_1_data,</span>
<span id="cb532-31"><a href="markov-chain-monte-carlo.html#cb532-31" aria-hidden="true" tabindex="-1"></a>                                       current_position2 <span class="sc">+</span> proposed_jump2, theta_2_data)</span>
<span id="cb532-32"><a href="markov-chain-monte-carlo.html#cb532-32" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">/</span> <span class="fu">target_rel_prob</span>(current_position1, theta_1_data, current_position2, theta_2_data))</span>
<span id="cb532-33"><a href="markov-chain-monte-carlo.html#cb532-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb532-34"><a href="markov-chain-monte-carlo.html#cb532-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate a random uniform value from the interval [0, 1] to</span></span>
<span id="cb532-35"><a href="markov-chain-monte-carlo.html#cb532-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># decide whether or not to accept the proposed jump</span></span>
<span id="cb532-36"><a href="markov-chain-monte-carlo.html#cb532-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> prob_accept) {</span>
<span id="cb532-37"><a href="markov-chain-monte-carlo.html#cb532-37" aria-hidden="true" tabindex="-1"></a>      <span class="co"># accept the proposed jump</span></span>
<span id="cb532-38"><a href="markov-chain-monte-carlo.html#cb532-38" aria-hidden="true" tabindex="-1"></a>      trajectory1[t <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> current_position1  <span class="sc">+</span> proposed_jump1</span>
<span id="cb532-39"><a href="markov-chain-monte-carlo.html#cb532-39" aria-hidden="true" tabindex="-1"></a>      trajectory2[t <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> current_position2  <span class="sc">+</span> proposed_jump2</span>
<span id="cb532-40"><a href="markov-chain-monte-carlo.html#cb532-40" aria-hidden="true" tabindex="-1"></a>      <span class="co"># increment the accepted counter, just to monitor performance</span></span>
<span id="cb532-41"><a href="markov-chain-monte-carlo.html#cb532-41" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (t <span class="sc">&gt;</span> burn_in) {n_accepted <span class="ot">&lt;-</span> n_accepted <span class="sc">+</span> <span class="dv">1</span>}</span>
<span id="cb532-42"><a href="markov-chain-monte-carlo.html#cb532-42" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb532-43"><a href="markov-chain-monte-carlo.html#cb532-43" aria-hidden="true" tabindex="-1"></a>      <span class="co"># reject the proposed jump, stay at current position</span></span>
<span id="cb532-44"><a href="markov-chain-monte-carlo.html#cb532-44" aria-hidden="true" tabindex="-1"></a>      trajectory1[t <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> current_position1</span>
<span id="cb532-45"><a href="markov-chain-monte-carlo.html#cb532-45" aria-hidden="true" tabindex="-1"></a>      trajectory2[t <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> current_position2</span>
<span id="cb532-46"><a href="markov-chain-monte-carlo.html#cb532-46" aria-hidden="true" tabindex="-1"></a>      <span class="co"># increment the rejected counter, just to monitor performance</span></span>
<span id="cb532-47"><a href="markov-chain-monte-carlo.html#cb532-47" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (t <span class="sc">&gt;</span> burn_in) {n_rejected <span class="ot">&lt;-</span> n_rejected <span class="sc">+</span> <span class="dv">1</span>}</span>
<span id="cb532-48"><a href="markov-chain-monte-carlo.html#cb532-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb532-49"><a href="markov-chain-monte-carlo.html#cb532-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb532-50"><a href="markov-chain-monte-carlo.html#cb532-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb532-51"><a href="markov-chain-monte-carlo.html#cb532-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract the post-burn_in portion of the trajectory</span></span>
<span id="cb532-52"><a href="markov-chain-monte-carlo.html#cb532-52" aria-hidden="true" tabindex="-1"></a>  accepted_traj1 <span class="ot">&lt;-</span> trajectory1[(burn_in <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">:</span> <span class="fu">length</span>(trajectory1)]</span>
<span id="cb532-53"><a href="markov-chain-monte-carlo.html#cb532-53" aria-hidden="true" tabindex="-1"></a>  accepted_traj2 <span class="ot">&lt;-</span> trajectory2[(burn_in <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">:</span> <span class="fu">length</span>(trajectory2)]</span>
<span id="cb532-54"><a href="markov-chain-monte-carlo.html#cb532-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb532-55"><a href="markov-chain-monte-carlo.html#cb532-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># collect the results</span></span>
<span id="cb532-56"><a href="markov-chain-monte-carlo.html#cb532-56" aria-hidden="true" tabindex="-1"></a>  metrop_2d_data <span class="ot">&lt;-</span> </span>
<span id="cb532-57"><a href="markov-chain-monte-carlo.html#cb532-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">iter           =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>traj_length),</span>
<span id="cb532-58"><a href="markov-chain-monte-carlo.html#cb532-58" aria-hidden="true" tabindex="-1"></a>           <span class="at">accepted_traj1 =</span> accepted_traj1,</span>
<span id="cb532-59"><a href="markov-chain-monte-carlo.html#cb532-59" aria-hidden="true" tabindex="-1"></a>           <span class="at">accepted_traj2 =</span> accepted_traj2,</span>
<span id="cb532-60"><a href="markov-chain-monte-carlo.html#cb532-60" aria-hidden="true" tabindex="-1"></a>           <span class="at">n_accepted     =</span> n_accepted, </span>
<span id="cb532-61"><a href="markov-chain-monte-carlo.html#cb532-61" aria-hidden="true" tabindex="-1"></a>           <span class="at">n_rejected     =</span> n_rejected)</span>
<span id="cb532-62"><a href="markov-chain-monte-carlo.html#cb532-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb532-63"><a href="markov-chain-monte-carlo.html#cb532-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(metrop_2d_data)</span>
<span id="cb532-64"><a href="markov-chain-monte-carlo.html#cb532-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb532-65"><a href="markov-chain-monte-carlo.html#cb532-65" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we’ve defined <code>my_bivariate_metropolis()</code> let’s apply it to our data with <code>proposal_sd == 0.02</code> and <code>proposal_sd == 0.2</code>. We’ll save the results as <code>mh</code>.</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="markov-chain-monte-carlo.html#cb533-1" aria-hidden="true" tabindex="-1"></a>mh <span class="ot">&lt;-</span></span>
<span id="cb533-2"><a href="markov-chain-monte-carlo.html#cb533-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">proposal_sd =</span> <span class="fu">c</span>(<span class="fl">0.02</span>, <span class="fl">0.2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb533-3"><a href="markov-chain-monte-carlo.html#cb533-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mh =</span> <span class="fu">map</span>(proposal_sd, my_bivariate_metropolis)) <span class="sc">%&gt;%</span> </span>
<span id="cb533-4"><a href="markov-chain-monte-carlo.html#cb533-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(mh)</span>
<span id="cb533-5"><a href="markov-chain-monte-carlo.html#cb533-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-6"><a href="markov-chain-monte-carlo.html#cb533-6" aria-hidden="true" tabindex="-1"></a>mh</span></code></pre></div>
<pre><code>## # A tibble: 100,000 × 6
##    proposal_sd  iter accepted_traj1 accepted_traj2 n_accepted n_rejected
##          &lt;dbl&gt; &lt;int&gt;          &lt;dbl&gt;          &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
##  1        0.02     1          0.5            0.5        46401       3598
##  2        0.02     2          0.535          0.486      46401       3598
##  3        0.02     3          0.541          0.477      46401       3598
##  4        0.02     4          0.507          0.495      46401       3598
##  5        0.02     5          0.511          0.484      46401       3598
##  6        0.02     6          0.522          0.500      46401       3598
##  7        0.02     7          0.544          0.491      46401       3598
##  8        0.02     8          0.572          0.473      46401       3598
##  9        0.02     9          0.591          0.509      46401       3598
## 10        0.02    10          0.579          0.513      46401       3598
## # … with 99,990 more rows</code></pre>
<p>If you look at the top of Figure 7.6, you’ll see Kruschke summarized his results with the acceptance rate, <span class="math inline">\(N_\text{acc} / N_\text{pro}\)</span>. Here are ours.</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="markov-chain-monte-carlo.html#cb535-1" aria-hidden="true" tabindex="-1"></a>mh <span class="sc">%&gt;%</span> </span>
<span id="cb535-2"><a href="markov-chain-monte-carlo.html#cb535-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(proposal_sd) <span class="sc">%&gt;%</span> </span>
<span id="cb535-3"><a href="markov-chain-monte-carlo.html#cb535-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb535-4"><a href="markov-chain-monte-carlo.html#cb535-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">acceptance_rate =</span> n_accepted <span class="sc">/</span> (n_accepted <span class="sc">+</span> n_rejected))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   proposal_sd acceptance_rate
##         &lt;dbl&gt;           &lt;dbl&gt;
## 1        0.02           0.928
## 2        0.2            0.428</code></pre>
<p>We can compute our effective sample sizes using the <code>effectiveSize()</code> function from the <a href="https://CRAN.R-project.org/package=coda"><strong>coda</strong> package</a> <span class="citation">(<a href="#ref-plummerCODA2006" role="doc-biblioref">Plummer et al., 2006</a>, <a href="#ref-R-coda" role="doc-biblioref">2020</a>)</span>.</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="markov-chain-monte-carlo.html#cb537-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coda)</span>
<span id="cb537-2"><a href="markov-chain-monte-carlo.html#cb537-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb537-3"><a href="markov-chain-monte-carlo.html#cb537-3" aria-hidden="true" tabindex="-1"></a>mh <span class="sc">%&gt;%</span> </span>
<span id="cb537-4"><a href="markov-chain-monte-carlo.html#cb537-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(proposal_sd) <span class="sc">%&gt;%</span> </span>
<span id="cb537-5"><a href="markov-chain-monte-carlo.html#cb537-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ess_theta_1 =</span> <span class="fu">effectiveSize</span>(accepted_traj1),</span>
<span id="cb537-6"><a href="markov-chain-monte-carlo.html#cb537-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">ess_theta_2 =</span> <span class="fu">effectiveSize</span>(accepted_traj2))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   proposal_sd ess_theta_1 ess_theta_2
##         &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1        0.02        188.        194.
## 2        0.2        6673.       5987.</code></pre>
<p>We really won’t use the <strong>coda</strong> package in this ebook beyond this chapter and the next. But do note it has a lot to offer and Kruschke used it a bit in his code.</p>
<p>Recall we might also compute the effective sample size estimates with functions from <strong>posterior</strong>, like at the end of <a href="markov-chain-monte-carlo.html#metropolis-algorithm-applied-to-bernoulli-likelihood-and-beta-prior.">Section 7.3.1</a>. Here are the results using <code>ess_mean()</code> and <code>ess_bulk()</code>.</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="markov-chain-monte-carlo.html#cb539-1" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior::ess_mean()</span></span>
<span id="cb539-2"><a href="markov-chain-monte-carlo.html#cb539-2" aria-hidden="true" tabindex="-1"></a>mh <span class="sc">%&gt;%</span> </span>
<span id="cb539-3"><a href="markov-chain-monte-carlo.html#cb539-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(proposal_sd) <span class="sc">%&gt;%</span> </span>
<span id="cb539-4"><a href="markov-chain-monte-carlo.html#cb539-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ess_theta_1 =</span> posterior<span class="sc">::</span><span class="fu">ess_mean</span>(accepted_traj1),</span>
<span id="cb539-5"><a href="markov-chain-monte-carlo.html#cb539-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">ess_theta_2 =</span> posterior<span class="sc">::</span><span class="fu">ess_mean</span>(accepted_traj2))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   proposal_sd ess_theta_1 ess_theta_2
##         &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1        0.02        195.        164.
## 2        0.2        6566.       6073.</code></pre>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="markov-chain-monte-carlo.html#cb541-1" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior::ess_bulk()</span></span>
<span id="cb541-2"><a href="markov-chain-monte-carlo.html#cb541-2" aria-hidden="true" tabindex="-1"></a>mh <span class="sc">%&gt;%</span> </span>
<span id="cb541-3"><a href="markov-chain-monte-carlo.html#cb541-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(proposal_sd) <span class="sc">%&gt;%</span> </span>
<span id="cb541-4"><a href="markov-chain-monte-carlo.html#cb541-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ess_theta_1 =</span> posterior<span class="sc">::</span><span class="fu">ess_bulk</span>(accepted_traj1),</span>
<span id="cb541-5"><a href="markov-chain-monte-carlo.html#cb541-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">ess_theta_2 =</span> posterior<span class="sc">::</span><span class="fu">ess_bulk</span>(accepted_traj2))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   proposal_sd ess_theta_1 ess_theta_2
##         &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1        0.02        210.        172.
## 2        0.2        6782.       6206.</code></pre>
<p>Different functions from different packages yield different results. Exciting, eh? Welcome to applied statistics, friends. Anyway, now we make our version of Figure 7.6.</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="markov-chain-monte-carlo.html#cb543-1" aria-hidden="true" tabindex="-1"></a>mh <span class="sc">%&gt;%</span> </span>
<span id="cb543-2"><a href="markov-chain-monte-carlo.html#cb543-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(iter <span class="sc">&lt;</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb543-3"><a href="markov-chain-monte-carlo.html#cb543-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb543-4"><a href="markov-chain-monte-carlo.html#cb543-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> accepted_traj1, <span class="at">y =</span> accepted_traj2)) <span class="sc">+</span></span>
<span id="cb543-5"><a href="markov-chain-monte-carlo.html#cb543-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb543-6"><a href="markov-chain-monte-carlo.html#cb543-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb543-7"><a href="markov-chain-monte-carlo.html#cb543-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta[<span class="dv">1</span>]), <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb543-8"><a href="markov-chain-monte-carlo.html#cb543-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(theta[<span class="dv">2</span>]), <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb543-9"><a href="markov-chain-monte-carlo.html#cb543-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb543-10"><a href="markov-chain-monte-carlo.html#cb543-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb543-11"><a href="markov-chain-monte-carlo.html#cb543-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">panel_border</span>() <span class="sc">+</span></span>
<span id="cb543-12"><a href="markov-chain-monte-carlo.html#cb543-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.spacing.x =</span> <span class="fu">unit</span>(<span class="fl">0.75</span>, <span class="st">&quot;cm&quot;</span>)) <span class="sc">+</span></span>
<span id="cb543-13"><a href="markov-chain-monte-carlo.html#cb543-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> proposal_sd, <span class="at">labeller =</span> label_both)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-37-1.png" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p>In the limit of infinite random walks, the Metropolis algorithm yields arbitrarily accurate representations of the underlying posterior distribution. The left and right panels of Figure 7.6 would eventually converge to an identical and highly accurate approximation to the posterior distribution. But in the real world of finite random walks, we care about how efficiently the algorithm generates an accurate representative sample. We prefer to use the proposal distribution from the right panel of Figure 7.6 because it will, typically, produce a more accurate approximation of the posterior than the proposal distribution from left panel, for the same number of proposed jumps. (p. 170)</p>
</blockquote>
</div>
<div id="gibbs-hamiltonian-monte-carlo-sampling." class="section level3 hasAnchor" number="7.4.4">
<h3><span class="header-section-number">7.4.4</span> <del>Gibbs</del> Hamiltonian Monte Carlo sampling.<a href="markov-chain-monte-carlo.html#gibbs-hamiltonian-monte-carlo-sampling." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Figure 7.7 is still out of my skill set. But let’s fit the model with our primary package, <strong>brms</strong>. First we need to load <strong>brms</strong>.</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="markov-chain-monte-carlo.html#cb544-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span></code></pre></div>
<p>These, recall, are the data.</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="markov-chain-monte-carlo.html#cb545-1" aria-hidden="true" tabindex="-1"></a>theta_1_data</span></code></pre></div>
<pre><code>## [1] 0 0 1 1 1 1 1 1</code></pre>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="markov-chain-monte-carlo.html#cb547-1" aria-hidden="true" tabindex="-1"></a>theta_2_data</span></code></pre></div>
<pre><code>## [1] 0 0 0 0 0 1 1</code></pre>
<p>Kruschke said he was starting us out simply. From a regression perspective, we are getting ready to fit an intercepts-only multivariate Bernoulli model, which isn’t the simplest of things to code into <strong>brms</strong>. Plus, this particular pair of data sets presents a complication we won’t usually have to contend with in this book: The data vectors are different lengths. Remember how we pointed that out in <a href="markov-chain-monte-carlo.html#the-posterior-via-exact-formal-analysis.">Section 7.4.2</a>? The issue is that whereas <strong>brms</strong> has extensive multivariate capacities <span class="citation">(<a href="#ref-Bürkner2022Multivariate" role="doc-biblioref">Bürkner, 2022b</a>)</span>, they’re usually designed for data with equal sample sizes (i.e., when the rows in the two columns of a data frame are of the same number). Since these are Bernoulli data, we have two options at our disposal:</p>
<ul>
<li>employ the <code>resp_subset()</code> helper function or</li>
<li>fit an aggregated binomial<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> model.</li>
</ul>
<p>Since each has its strengths and weaknesses, we’ll split this section up and fit the model both ways.</p>
<div id="uneven-multivariate-benoulli-via-the-resp_subset-approach." class="section level4 hasAnchor" number="7.4.4.1">
<h4><span class="header-section-number">7.4.4.1</span> Uneven multivariate Benoulli via the <code>resp_subset()</code> approach.<a href="markov-chain-monte-carlo.html#uneven-multivariate-benoulli-via-the-resp_subset-approach." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Though <strong>brms</strong> can receive data from a few different formats, our approach throughout this ebook will usually be with data frames or tibbles. Here’s how we might combine our two data vectors, <code>theta_1_data</code> and <code>theta_2_data</code>, into a single tibble called <code>d</code>.</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="markov-chain-monte-carlo.html#cb549-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb549-2"><a href="markov-chain-monte-carlo.html#cb549-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">y1 =</span> theta_1_data,</span>
<span id="cb549-3"><a href="markov-chain-monte-carlo.html#cb549-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">y2 =</span> <span class="fu">c</span>(theta_2_data, <span class="cn">NA</span>))</span>
<span id="cb549-4"><a href="markov-chain-monte-carlo.html#cb549-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb549-5"><a href="markov-chain-monte-carlo.html#cb549-5" aria-hidden="true" tabindex="-1"></a><span class="co"># what is this?</span></span>
<span id="cb549-6"><a href="markov-chain-monte-carlo.html#cb549-6" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## # A tibble: 8 × 2
##      y1    y2
##   &lt;int&gt; &lt;int&gt;
## 1     0     0
## 2     0     0
## 3     1     0
## 4     1     0
## 5     1     0
## 6     1     1
## 7     1     1
## 8     1    NA</code></pre>
<p>Because the second data vector was one unit shorter than the first, we had to compensate by adding an eighth cell, which we coded as <code>NA</code>, the universal indicator for missing values within the <strong>R</strong> ecosystem.</p>
<p>We’ll still need one more data column, though. Using the <code>if_else()</code> function, we will make a <code>subset</code> column with will be coded <code>TRUE</code> for all non-<code>NA</code> values in the <code>y2</code> columns, and <code>FALSE</code> whenever <code>is.na(y2)</code>.</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="markov-chain-monte-carlo.html#cb551-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb551-2"><a href="markov-chain-monte-carlo.html#cb551-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb551-3"><a href="markov-chain-monte-carlo.html#cb551-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subset =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(y2), <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span>
<span id="cb551-4"><a href="markov-chain-monte-carlo.html#cb551-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb551-5"><a href="markov-chain-monte-carlo.html#cb551-5" aria-hidden="true" tabindex="-1"></a><span class="co"># what is this?</span></span>
<span id="cb551-6"><a href="markov-chain-monte-carlo.html#cb551-6" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## # A tibble: 8 × 3
##      y1    y2 subset
##   &lt;int&gt; &lt;int&gt; &lt;lgl&gt; 
## 1     0     0 TRUE  
## 2     0     0 TRUE  
## 3     1     0 TRUE  
## 4     1     0 TRUE  
## 5     1     0 TRUE  
## 6     1     1 TRUE  
## 7     1     1 TRUE  
## 8     1    NA FALSE</code></pre>
<p><strong>brms</strong> includes a handful of helper functions that let users incorporate additional information about the criterion variable(s) into the model. For a full listing of these helper functions, check out the <code>addition-terms</code> section of the <a href="https://CRAN.R-project.org/package=brms/brms.pdf"><strong>brms</strong> reference manual</a> <span class="citation">(<a href="#ref-brms2022RM" role="doc-biblioref">Bürkner, 2022f</a>)</span>. Though we won’t be using a lot of these in this ebook, it just so turns out that two of them will come in handy for our multivariate Bernoulli data. In this case, we want the <code>resp_subset()</code> helper function, which, in practice, we will just call <code>subset()</code>. From the <strong>brms</strong> reference manual, we read:</p>
<blockquote>
<p>For multivariate models, <code>subset</code> may be used in the <code>aterms</code> part, to use different subsets of the data in different univariate models. For instance, if <code>sub</code> is a logical variable and <code>y</code> is the response of one of the univariate models, we may write <code>y | subset(sub) ~ predictors</code> so that <code>y</code> is predicted only for those observations for which <code>sub</code> evaluates to <code>TRUE</code>. (p. 42)</p>
</blockquote>
<p>In our case, the <code>subset</code> variable in the data tibble will be the logical variable for our criterion <code>y2</code>, which would leave us with the formula <code>y2 | subset(subset) ~ 1</code>. Note the use of the <code>|</code> operator, which is what you always use when adding information with a helper function of this kind. Since we will be using the data in all eight rows of the <code>y1</code> column, that corresponding formula would just be <code>y1 ~ 1</code>. In both cases, the <code>~ 1</code> portions of the formulas indicates these are intercept-only models. There are not predictors for either variable.</p>
<p>Next, we need to talk about how to combine these two formulas within the multivariate syntax. If you look through Bürkner’s <span class="citation">(<a href="#ref-Bürkner2022Multivariate" role="doc-biblioref">2022b</a>)</span> vignette, <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_multivariate.html"><em>Estimating multivariate models with brms</em></a>, you’ll see there are several ways to define a multivariate model with <strong>brms</strong>. In this case, I think it’ll be easiest to define each model as a separate object, which we’ll call <code>model_1</code> and <code>model_2</code>.</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="markov-chain-monte-carlo.html#cb553-1" aria-hidden="true" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">bf</span>(y1 <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb553-2"><a href="markov-chain-monte-carlo.html#cb553-2" aria-hidden="true" tabindex="-1"></a>model_2 <span class="ot">&lt;-</span> <span class="fu">bf</span>(y2 <span class="sc">|</span> <span class="fu">subset</span>(subset) <span class="sc">~</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Note how the formula syntax for each was wrapped within the <code>bf()</code> function. That’s shorthand for <code>brmsformula()</code>. If you wanted to, you could have defined these as <code>model_1 &lt;- brmsformula(y1 ~ 1)</code>, and so on.</p>
<p>Another issue we need to contend with is Kruschke’s <span class="math inline">\(\operatorname{Beta}(2, 2)\)</span> prior. By default, <strong>brms</strong> assumes an unbounded parameter space for the standard intercept priors. But we know that the beta distribution imposes boundaries within the range of <span class="math inline">\([0, 1]\)</span>. This is technically okay with a standard <strong>brms</strong> intercept prior, but it can lead to computational difficulties. When possible, it’s better to formally tell <strong>brms</strong> when you are using bounded priors. Here, then, is how we’ll define our <span class="math inline">\(\operatorname{Beta}(2, 2)\)</span> prior within the <code>prior()</code> function.</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="markov-chain-monte-carlo.html#cb554-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">class =</span> Intercept, <span class="at">lb =</span> <span class="dv">0</span>, <span class="at">ub =</span> <span class="dv">1</span>, <span class="at">resp =</span> y1)</span></code></pre></div>
<p>We set the lower boundary with the <code>lb</code> argument and then set the upper boundary with the <code>ub</code> argument. Also notice our use of the <code>resp</code> argument, which told <strong>brms</strong> this prior was connected to the <code>y1</code> criterion. For the other criterion, we’d set that to <code>resp = y2</code>.</p>
<p>Okay, here’s how to put all of this together to fit the model.</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="markov-chain-monte-carlo.html#cb555-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.1</span>a <span class="ot">&lt;-</span></span>
<span id="cb555-2"><a href="markov-chain-monte-carlo.html#cb555-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb555-3"><a href="markov-chain-monte-carlo.html#cb555-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">bernoulli</span>(<span class="at">link =</span> identity),</span>
<span id="cb555-4"><a href="markov-chain-monte-carlo.html#cb555-4" aria-hidden="true" tabindex="-1"></a>      model_1 <span class="sc">+</span> model_2,</span>
<span id="cb555-5"><a href="markov-chain-monte-carlo.html#cb555-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">class =</span> Intercept, <span class="at">lb =</span> <span class="dv">0</span>, <span class="at">ub =</span> <span class="dv">1</span>, <span class="at">resp =</span> y1),</span>
<span id="cb555-6"><a href="markov-chain-monte-carlo.html#cb555-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">class =</span> Intercept, <span class="at">lb =</span> <span class="dv">0</span>, <span class="at">ub =</span> <span class="dv">1</span>, <span class="at">resp =</span> y2)),</span>
<span id="cb555-7"><a href="markov-chain-monte-carlo.html#cb555-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">3000</span>, <span class="at">warmup =</span> <span class="dv">500</span>, <span class="at">cores =</span> <span class="dv">3</span>, <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb555-8"><a href="markov-chain-monte-carlo.html#cb555-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb555-9"><a href="markov-chain-monte-carlo.html#cb555-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit07.01a&quot;</span>)</span></code></pre></div>
<p>Notice how we combined our two model objects with the <code>+</code> operator (<code>model_1 + model_2</code>). Here is a summary of the results.</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="markov-chain-monte-carlo.html#cb556-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit7<span class="fl">.1</span>a)</span></code></pre></div>
<pre><code>##  Family: MV(bernoulli, bernoulli) 
##   Links: mu = identity
##          mu = identity 
## Formula: y1 ~ 1 
##          y2 | subset(subset) ~ 1 
##    Data: d (Number of observations: 8) 
##   Draws: 3 chains, each with iter = 3000; warmup = 500; thin = 1;
##          total post-warmup draws = 7500
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## y1_Intercept     0.67      0.13     0.40     0.88 1.00     5950     4467
## y2_Intercept     0.36      0.14     0.12     0.65 1.00     4632     3445
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here we’ll use the <code>as_draws_df()</code> function to collect out posterior draws and save them as a data frame, which we’ll name <code>draws.a</code>.</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="markov-chain-monte-carlo.html#cb558-1" aria-hidden="true" tabindex="-1"></a>draws.a <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit7<span class="fl">.1</span>a)</span>
<span id="cb558-2"><a href="markov-chain-monte-carlo.html#cb558-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-3"><a href="markov-chain-monte-carlo.html#cb558-3" aria-hidden="true" tabindex="-1"></a><span class="co"># what is this?</span></span>
<span id="cb558-4"><a href="markov-chain-monte-carlo.html#cb558-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(draws.a)</span></code></pre></div>
<pre><code>## # A draws_df: 6 iterations, 1 chains, and 4 variables
##   b_y1_Intercept b_y2_Intercept lprior lp__
## 1           0.60           0.33   0.65  -11
## 2           0.73           0.33   0.45  -11
## 3           0.62           0.38   0.69  -11
## 4           0.61           0.43   0.74  -11
## 5           0.66           0.45   0.70  -11
## 6           0.50           0.32   0.68  -12
## # ... hidden reserved variables {&#39;.chain&#39;, &#39;.iteration&#39;, &#39;.draw&#39;}</code></pre>
<p>With <code>draws.a</code> in hand, we’re ready to make our version of Figure 7.8. To reduce the overplotting, we’re only looking at the first 500 post-warmup draws.</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="markov-chain-monte-carlo.html#cb560-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb560-2"><a href="markov-chain-monte-carlo.html#cb560-2" aria-hidden="true" tabindex="-1"></a>  draws.a <span class="sc">%&gt;%</span> </span>
<span id="cb560-3"><a href="markov-chain-monte-carlo.html#cb560-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.draw <span class="sc">&lt;</span> <span class="dv">501</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb560-4"><a href="markov-chain-monte-carlo.html#cb560-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb560-5"><a href="markov-chain-monte-carlo.html#cb560-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> b_y1_Intercept, <span class="at">y =</span> b_y2_Intercept)) <span class="sc">+</span></span>
<span id="cb560-6"><a href="markov-chain-monte-carlo.html#cb560-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb560-7"><a href="markov-chain-monte-carlo.html#cb560-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb560-8"><a href="markov-chain-monte-carlo.html#cb560-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta[<span class="dv">1</span>]), <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb560-9"><a href="markov-chain-monte-carlo.html#cb560-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(theta[<span class="dv">2</span>]), <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb560-10"><a href="markov-chain-monte-carlo.html#cb560-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;fit7.1a (resp_subset() method)&quot;</span>) <span class="sc">+</span></span>
<span id="cb560-11"><a href="markov-chain-monte-carlo.html#cb560-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb560-12"><a href="markov-chain-monte-carlo.html#cb560-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span>
<span id="cb560-13"><a href="markov-chain-monte-carlo.html#cb560-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb560-14"><a href="markov-chain-monte-carlo.html#cb560-14" aria-hidden="true" tabindex="-1"></a>p1</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-46-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Finally, after all that terrible technical talk, our efforts payed off! I promise, it won’t always be this difficult to fit a model in <strong>brms</strong>. This is just one of those unfortunate cases where a textbook author’s seemingly simple example required non-default settings and approaches when applied to a software package that wasn’t the one they highlighted in their textbook.</p>
<p>Now let’s try out the second approach.</p>
</div>
<div id="uneven-multivariate-benoulli-via-the-aggregated-binomial-approach." class="section level4 hasAnchor" number="7.4.4.2">
<h4><span class="header-section-number">7.4.4.2</span> Uneven multivariate Benoulli via the aggregated binomial approach.<a href="markov-chain-monte-carlo.html#uneven-multivariate-benoulli-via-the-aggregated-binomial-approach." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Instead of thinking of our data as two vectors of 0’s and 1’s, we can use the aggregate form to summarize them more compactly.</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="markov-chain-monte-carlo.html#cb561-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb561-2"><a href="markov-chain-monte-carlo.html#cb561-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">n1 =</span> n1,</span>
<span id="cb561-3"><a href="markov-chain-monte-carlo.html#cb561-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">z1 =</span> z1, </span>
<span id="cb561-4"><a href="markov-chain-monte-carlo.html#cb561-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">n2 =</span> n2,</span>
<span id="cb561-5"><a href="markov-chain-monte-carlo.html#cb561-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">z2 =</span> z2)</span>
<span id="cb561-6"><a href="markov-chain-monte-carlo.html#cb561-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb561-7"><a href="markov-chain-monte-carlo.html#cb561-7" aria-hidden="true" tabindex="-1"></a><span class="co"># what does this look like?</span></span>
<span id="cb561-8"><a href="markov-chain-monte-carlo.html#cb561-8" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##      n1    z1    n2    z2
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     8     6     7     2</code></pre>
<p>The <code>resp_trials()</code> function is the second helper that will let us incorporate additional information about the criterion variable(s) into the model. In actual practice, we’ll use it as <code>trials()</code>. The basic idea is that for the first coin, we have <code>z1 == 6</code> heads out of <code>n1 == 8</code> trials. We can express that as an intercept-only model as <code>z1 | trials(n1) ~ 1</code>. Thus, we’ll define our two submodels like this.</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="markov-chain-monte-carlo.html#cb563-1" aria-hidden="true" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">bf</span>(z1 <span class="sc">|</span> <span class="fu">trials</span>(n1) <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb563-2"><a href="markov-chain-monte-carlo.html#cb563-2" aria-hidden="true" tabindex="-1"></a>model_2 <span class="ot">&lt;-</span> <span class="fu">bf</span>(z2 <span class="sc">|</span> <span class="fu">trials</span>(n2) <span class="sc">~</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Notice that when our data are in an aggregated format, we expressed both series of coin flips in one row of the data frame. Therefore, even though the first coin had more trials than the second coin (<code>n1 &gt; n2</code>), we don’t need to invoke the <code>subset()</code> helper. We just need to use <code>trials()</code> to tell <strong>brms</strong> how long each sequence of coin flips was.</p>
<p>The other new thing is that instead of directly using the Bernoulli likelihood function, we’ll instead be setting <code>family = binomial(link = "identity")</code>. Recall that the Bernoulli function is a special case of the binomial function for which <span class="math inline">\(N = 1\)</span>, for which each data point is a discrete trial<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>. When each data point is an aggregate of multiple trials, we use the binomial likelihood, instead.</p>
<p>Here’s how to fit the model.</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="markov-chain-monte-carlo.html#cb564-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.1</span>b <span class="ot">&lt;-</span></span>
<span id="cb564-2"><a href="markov-chain-monte-carlo.html#cb564-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb564-3"><a href="markov-chain-monte-carlo.html#cb564-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>),</span>
<span id="cb564-4"><a href="markov-chain-monte-carlo.html#cb564-4" aria-hidden="true" tabindex="-1"></a>      model_1 <span class="sc">+</span> model_2,</span>
<span id="cb564-5"><a href="markov-chain-monte-carlo.html#cb564-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">class =</span> Intercept, <span class="at">lb =</span> <span class="dv">0</span>, <span class="at">ub =</span> <span class="dv">1</span>, <span class="at">resp =</span> z1),</span>
<span id="cb564-6"><a href="markov-chain-monte-carlo.html#cb564-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">class =</span> Intercept, <span class="at">lb =</span> <span class="dv">0</span>, <span class="at">ub =</span> <span class="dv">1</span>, <span class="at">resp =</span> z2)),</span>
<span id="cb564-7"><a href="markov-chain-monte-carlo.html#cb564-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">3000</span>, <span class="at">warmup =</span> <span class="dv">500</span>, <span class="at">cores =</span> <span class="dv">3</span>, <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb564-8"><a href="markov-chain-monte-carlo.html#cb564-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb564-9"><a href="markov-chain-monte-carlo.html#cb564-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit07.01b&quot;</span>)</span></code></pre></div>
<p>The model summary for our <code>fit7.1b</code> aggregated binomial approach is very similar to the one from our previous <code>fit7.1a</code> approach using the <code>subset()</code> helper.</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="markov-chain-monte-carlo.html#cb565-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit7<span class="fl">.1</span>b)</span></code></pre></div>
<pre><code>##  Family: MV(binomial, binomial) 
##   Links: mu = identity
##          mu = identity 
## Formula: z1 | trials(n1) ~ 1 
##          z2 | trials(n2) ~ 1 
##    Data: d (Number of observations: 1) 
##   Draws: 3 chains, each with iter = 3000; warmup = 500; thin = 1;
##          total post-warmup draws = 7500
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## z1_Intercept     0.67      0.13     0.40     0.89 1.00     5660     4952
## z2_Intercept     0.36      0.14     0.12     0.65 1.00     6277     4453
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Here’s the updated version of Figure 7.8.</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="markov-chain-monte-carlo.html#cb567-1" aria-hidden="true" tabindex="-1"></a>draws.b <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit7<span class="fl">.1</span>b)</span>
<span id="cb567-2"><a href="markov-chain-monte-carlo.html#cb567-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-3"><a href="markov-chain-monte-carlo.html#cb567-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb567-4"><a href="markov-chain-monte-carlo.html#cb567-4" aria-hidden="true" tabindex="-1"></a>  draws.b <span class="sc">%&gt;%</span> </span>
<span id="cb567-5"><a href="markov-chain-monte-carlo.html#cb567-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.draw <span class="sc">&lt;</span> <span class="dv">501</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb567-6"><a href="markov-chain-monte-carlo.html#cb567-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb567-7"><a href="markov-chain-monte-carlo.html#cb567-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> b_z1_Intercept, <span class="at">y =</span> b_z2_Intercept)) <span class="sc">+</span></span>
<span id="cb567-8"><a href="markov-chain-monte-carlo.html#cb567-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb567-9"><a href="markov-chain-monte-carlo.html#cb567-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb567-10"><a href="markov-chain-monte-carlo.html#cb567-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(theta[<span class="dv">1</span>]), <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb567-11"><a href="markov-chain-monte-carlo.html#cb567-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">expression</span>(theta[<span class="dv">2</span>]), <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb567-12"><a href="markov-chain-monte-carlo.html#cb567-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;fit7.1b (aggregated binomial method)&quot;</span>) <span class="sc">+</span></span>
<span id="cb567-13"><a href="markov-chain-monte-carlo.html#cb567-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb567-14"><a href="markov-chain-monte-carlo.html#cb567-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span>
<span id="cb567-15"><a href="markov-chain-monte-carlo.html#cb567-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-16"><a href="markov-chain-monte-carlo.html#cb567-16" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb567-17"><a href="markov-chain-monte-carlo.html#cb567-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb567-18"><a href="markov-chain-monte-carlo.html#cb567-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-19"><a href="markov-chain-monte-carlo.html#cb567-19" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-50-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Just for kicks and giggles, we might also compare the two model types by plotting the marginal posterior densities. This will give is a better sense of how each of the marginal <span class="math inline">\(\theta\)</span> densities are shaped like the beta distribution.</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="markov-chain-monte-carlo.html#cb568-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the posterior samples from the two models</span></span>
<span id="cb568-2"><a href="markov-chain-monte-carlo.html#cb568-2" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span></span>
<span id="cb568-3"><a href="markov-chain-monte-carlo.html#cb568-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb568-4"><a href="markov-chain-monte-carlo.html#cb568-4" aria-hidden="true" tabindex="-1"></a>    draws.a <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(<span class="st">`</span><span class="at">theta[1]</span><span class="st">`</span> <span class="ot">=</span> b_y1_Intercept, <span class="st">`</span><span class="at">theta[2]</span><span class="st">`</span> <span class="ot">=</span> b_y2_Intercept),</span>
<span id="cb568-5"><a href="markov-chain-monte-carlo.html#cb568-5" aria-hidden="true" tabindex="-1"></a>    draws.b <span class="sc">%&gt;%</span> <span class="fu">transmute</span>(<span class="st">`</span><span class="at">theta[1]</span><span class="st">`</span> <span class="ot">=</span> b_z1_Intercept, <span class="st">`</span><span class="at">theta[2]</span><span class="st">`</span> <span class="ot">=</span> b_z2_Intercept)</span>
<span id="cb568-6"><a href="markov-chain-monte-carlo.html#cb568-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb568-7"><a href="markov-chain-monte-carlo.html#cb568-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;fit7.1a&quot;</span>, <span class="st">&quot;fit7.1b&quot;</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>))</span>
<span id="cb568-8"><a href="markov-chain-monte-carlo.html#cb568-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb568-9"><a href="markov-chain-monte-carlo.html#cb568-9" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb568-10"><a href="markov-chain-monte-carlo.html#cb568-10" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb568-11"><a href="markov-chain-monte-carlo.html#cb568-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>fit) <span class="sc">%&gt;%</span> </span>
<span id="cb568-12"><a href="markov-chain-monte-carlo.html#cb568-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb568-13"><a href="markov-chain-monte-carlo.html#cb568-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb568-14"><a href="markov-chain-monte-carlo.html#cb568-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb568-15"><a href="markov-chain-monte-carlo.html#cb568-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> mode_hdi, <span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb568-16"><a href="markov-chain-monte-carlo.html#cb568-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;posterior&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb568-17"><a href="markov-chain-monte-carlo.html#cb568-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb568-18"><a href="markov-chain-monte-carlo.html#cb568-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb568-19"><a href="markov-chain-monte-carlo.html#cb568-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.spacing.x =</span> <span class="fu">unit</span>(<span class="fl">0.75</span>, <span class="st">&quot;cm&quot;</span>)) <span class="sc">+</span></span>
<span id="cb568-20"><a href="markov-chain-monte-carlo.html#cb568-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">panel_border</span>() <span class="sc">+</span></span>
<span id="cb568-21"><a href="markov-chain-monte-carlo.html#cb568-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(fit <span class="sc">~</span> name, <span class="at">labeller =</span> label_parsed)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-51-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>I hope this makes clear that the two estimation methods returned results that are within simulation variance of one another. Had we asked <strong>brms</strong> for a larger number of posterior draws from each, the results would have been even closer.</p>
</div>
</div>
<div id="is-there-a-difference-between-biases" class="section level3 hasAnchor" number="7.4.5">
<h3><span class="header-section-number">7.4.5</span> Is there a difference between biases?<a href="markov-chain-monte-carlo.html#is-there-a-difference-between-biases" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In his Figure 7.9, Kruschke compared the marginal posterior for <span class="math inline">\(\theta_1 - \theta_2\)</span>, as computed by two methods from the Metropolis algorithm and another two methods from the Gibbs sampler. Here we’ll focus, instead, on the two methods we explored using <strong>brms</strong>-based Hamiltonian Monte Carlo (HMC).</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="markov-chain-monte-carlo.html#cb569-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb569-2"><a href="markov-chain-monte-carlo.html#cb569-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dif =</span> <span class="st">`</span><span class="at">theta[1]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">theta[2]</span><span class="st">`</span>,</span>
<span id="cb569-3"><a href="markov-chain-monte-carlo.html#cb569-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">fit =</span> <span class="fu">if_else</span>(fit <span class="sc">==</span> <span class="st">&quot;fit7.1a&quot;</span>, </span>
<span id="cb569-4"><a href="markov-chain-monte-carlo.html#cb569-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;fit7.1a (resp_subset() method)&quot;</span>, </span>
<span id="cb569-5"><a href="markov-chain-monte-carlo.html#cb569-5" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;fit7.1b (aggregated binomial method)&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb569-6"><a href="markov-chain-monte-carlo.html#cb569-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb569-7"><a href="markov-chain-monte-carlo.html#cb569-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dif, <span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb569-8"><a href="markov-chain-monte-carlo.html#cb569-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_histinterval</span>(<span class="at">point_interval =</span> mode_hdi, <span class="at">.width =</span> .<span class="dv">95</span>,</span>
<span id="cb569-9"><a href="markov-chain-monte-carlo.html#cb569-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> <span class="st">&quot;steelblue2&quot;</span>, <span class="at">slab_color =</span> <span class="st">&quot;steelblue4&quot;</span>, <span class="at">outline_bars =</span> T,</span>
<span id="cb569-10"><a href="markov-chain-monte-carlo.html#cb569-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="dv">40</span>, <span class="at">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="sc">+</span></span>
<span id="cb569-11"><a href="markov-chain-monte-carlo.html#cb569-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb569-12"><a href="markov-chain-monte-carlo.html#cb569-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(theta[<span class="dv">1</span>]<span class="sc">-</span>theta[<span class="dv">2</span>]),</span>
<span id="cb569-13"><a href="markov-chain-monte-carlo.html#cb569-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb569-14"><a href="markov-chain-monte-carlo.html#cb569-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">2.4</span>)) <span class="sc">+</span></span>
<span id="cb569-15"><a href="markov-chain-monte-carlo.html#cb569-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() </span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-52-1.png" width="504" style="display: block; margin: auto;" /></p>
<p>Here are the exact estimates of the mode and 95% HDIs for our difference distribution, <span class="math inline">\(\theta_1 - \theta_2\)</span>.</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="markov-chain-monte-carlo.html#cb570-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb570-2"><a href="markov-chain-monte-carlo.html#cb570-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dif =</span> <span class="st">`</span><span class="at">theta[1]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">theta[2]</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb570-3"><a href="markov-chain-monte-carlo.html#cb570-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fit) <span class="sc">%&gt;%</span> </span>
<span id="cb570-4"><a href="markov-chain-monte-carlo.html#cb570-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mode_hdi</span>(dif) <span class="sc">%&gt;%</span> </span>
<span id="cb570-5"><a href="markov-chain-monte-carlo.html#cb570-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 7
##   fit       dif .lower .upper .width .point .interval
##   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 fit7.1a 0.328 -0.062   0.67   0.95 mode   hdi      
## 2 fit7.1b 0.36  -0.064   0.66   0.95 mode   hdi</code></pre>
<p>I wouldn’t put too much emphasis on the seemingly large differences in the two modes. Among the three primary measures of central tendency, modes are particularly sensitive to things like sample variance. Here’s what happens if we compare the two methods with the mean, instead.</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="markov-chain-monte-carlo.html#cb572-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb572-2"><a href="markov-chain-monte-carlo.html#cb572-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dif =</span> <span class="st">`</span><span class="at">theta[1]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">theta[2]</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb572-3"><a href="markov-chain-monte-carlo.html#cb572-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fit) <span class="sc">%&gt;%</span> </span>
<span id="cb572-4"><a href="markov-chain-monte-carlo.html#cb572-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_of_the_difference_score =</span> <span class="fu">mean</span>(dif) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   fit     mean_of_the_difference_score
##   &lt;chr&gt;                          &lt;dbl&gt;
## 1 fit7.1a                        0.303
## 2 fit7.1b                        0.305</code></pre>
<p>Now the difference between the two methods seems trivial.</p>
</div>
<div id="terminology-mcmc." class="section level3 hasAnchor" number="7.4.6">
<h3><span class="header-section-number">7.4.6</span> Terminology: MCMC.<a href="markov-chain-monte-carlo.html#terminology-mcmc." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Any simulation that samples a lot of random values from a distribution is called a Monte Carlo simulation, named after the dice and spinners and shufflings of the famous casino locale. The appellation “Monte Carlo” is attributed <span class="citation">(<a href="#ref-eckhardtStanUlamJohn1987" role="doc-biblioref">Eckhardt, 1987</a>)</span> to the mathematicians <a href="https://en.wikipedia.org/wiki/Stanislaw_Ulam">Stanislaw Ulam</a> (1909–1984) and <a href="https://en.wikipedia.org/wiki/John_von_Neumann">John von Neumann</a> (1903–1957). (p. 177)</p>
</blockquote>
<p>In case you didn’t know, <strong>brms</strong> is a user-friendly interface for the <a href="https://mc-stan.org/">Stan probabilistic programing language</a> [Stan; <span class="citation">Carpenter et al. (<a href="#ref-carpenterStanProbabilisticProgramming2017" role="doc-biblioref">2017</a>)</span>] and Stan is named after Stanislaw Ulam.</p>
</div>
</div>
<div id="mcmc-representativeness-accuracy-and-efficiency" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> MCMC representativeness, accuracy, and efficiency<a href="markov-chain-monte-carlo.html#mcmc-representativeness-accuracy-and-efficiency" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>We have three main goals in generating an MCMC sample from the posterior distribution:</p>
<ol style="list-style-type: decimal">
<li>The values in the chain must be <em>representative</em> of the posterior distribution. They should not be unduly influenced by the arbitrary initial value of the chain, and they should fully explore the range of the posterior distribution without getting stuck.</li>
<li>The chain should be of sufficient size so that estimates are <em>accurate</em> and <em>stable</em>. In particular, the estimates of the central tendency (such as median or mode), and the limits of the <span class="math inline">\(95\%\)</span> HDI, should not be much different if the MCMC analysis is run again (using different seed states for the pseudorandom number generators).</li>
<li>The chain should be generated <em>efficiently</em>, with as few steps as possible, so not to exceed our patience or computing power. (p. 178, <em>emphasis</em> in the original)</li>
</ol>
</blockquote>
<div id="mcmc-representativeness." class="section level3 hasAnchor" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> MCMC representativeness.<a href="markov-chain-monte-carlo.html#mcmc-representativeness." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Kruschke defined our new data in the note for Figure 7.10 (p. 179).</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="markov-chain-monte-carlo.html#cb574-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="dv">35</span></span>
<span id="cb574-2"><a href="markov-chain-monte-carlo.html#cb574-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb574-3"><a href="markov-chain-monte-carlo.html#cb574-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-4"><a href="markov-chain-monte-carlo.html#cb574-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">y =</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">times =</span> <span class="fu">c</span>(n <span class="sc">-</span> z, z)))</span></code></pre></div>
<p>Here we fit the model. Note how since we’re just univariate, it’s easy to switch back to directly modeling with the Bernoulli likelihood.</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="markov-chain-monte-carlo.html#cb575-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.2</span> <span class="ot">&lt;-</span></span>
<span id="cb575-2"><a href="markov-chain-monte-carlo.html#cb575-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb575-3"><a href="markov-chain-monte-carlo.html#cb575-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">bernoulli</span>(<span class="at">link =</span> identity),</span>
<span id="cb575-4"><a href="markov-chain-monte-carlo.html#cb575-4" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb575-5"><a href="markov-chain-monte-carlo.html#cb575-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">class =</span> Intercept, <span class="at">lb =</span> <span class="dv">0</span>, <span class="at">ub =</span> <span class="dv">1</span>),</span>
<span id="cb575-6"><a href="markov-chain-monte-carlo.html#cb575-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">10000</span>, <span class="at">warmup =</span> <span class="dv">500</span>, <span class="at">cores =</span> <span class="dv">3</span>, <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb575-7"><a href="markov-chain-monte-carlo.html#cb575-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb575-8"><a href="markov-chain-monte-carlo.html#cb575-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/fit07.02&quot;</span>)</span></code></pre></div>
<p>On page 179, Kruschke discussed <em>burn-in</em> steps within the Gibbs framework:</p>
<blockquote>
<p>The preliminary steps, during which the chain moves from its unrepresentative initial value to the modal region of the posterior, is called the <em>burn-in</em> period. For realistic applications, it is routine to apply a burn-in period of several hundred to several thousand steps.</p>
</blockquote>
<p>For each HMC chain, the first <span class="math inline">\(n\)</span> iterations are called “warmups.” In this example, <span class="math inline">\(n = 500\)</span> (i.e., <code>warmup = 500</code>). Within the Stan-HMC paradigm, <a href="https://andrewgelman.com/2017/12/15/burn-vs-warm-iterative-simulation-algorithms/">warmups are somewhat analogous to but not synonymous with burn-in iterations</a> as done by the Gibbs sampling in JAGS. But HMC warmups are like Gibbs burn-ins in that both are discarded and not used to describe the posterior. For more on warmup, check out McElreath’s lecture, <a href="https://www.youtube.com/watch?v=13mEekRdOcQ&amp;t=75s">starting here</a> or, for more detail, the <a href="https://mc-stan.org/docs/2_29/reference-manual/hmc-algorithm-parameters.html"><em>HMC Algorithm Parameters</em> section (15.2)</a> of the <em>Stan reference manual</em>, version 2.29 <span class="citation">(<a href="#ref-standevelopmentteamStanReferenceManual2022" role="doc-biblioref">Stan Development Team, 2022b</a>)</span>.</p>
<p>It appears that the upshot of all this is some of the packages in the Stan ecosystem don’t make it easy to extract the warmup values. For example, the <code>brms::plot()</code> function excludes them from the trace plot without the option to include them.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="markov-chain-monte-carlo.html#cb576-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit7<span class="fl">.2</span>, <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-56-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Notice how the <span class="math inline">\(x\)</span>-axis on the trace plot ranges from 0 to 9,500. Now recall that our model code included <code>iter = 10000, warmup = 500</code>. Those 9,500 iterations in the trace plot are excluding the first 500 warmup iterations. This code is a little janky, but if you really want those warmup iterations, you can extract them from the <code>fit7.2</code> object like this.</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="markov-chain-monte-carlo.html#cb577-1" aria-hidden="true" tabindex="-1"></a>warmups <span class="ot">&lt;-</span></span>
<span id="cb577-2"><a href="markov-chain-monte-carlo.html#cb577-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(fit7<span class="fl">.2</span><span class="sc">$</span>fit<span class="sc">@</span>sim<span class="sc">$</span>samples[[<span class="dv">1</span>]]<span class="sc">$</span>b_Intercept[<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>], </span>
<span id="cb577-3"><a href="markov-chain-monte-carlo.html#cb577-3" aria-hidden="true" tabindex="-1"></a>    fit7<span class="fl">.2</span><span class="sc">$</span>fit<span class="sc">@</span>sim<span class="sc">$</span>samples[[<span class="dv">2</span>]]<span class="sc">$</span>b_Intercept[<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>], </span>
<span id="cb577-4"><a href="markov-chain-monte-carlo.html#cb577-4" aria-hidden="true" tabindex="-1"></a>    fit7<span class="fl">.2</span><span class="sc">$</span>fit<span class="sc">@</span>sim<span class="sc">$</span>samples[[<span class="dv">3</span>]]<span class="sc">$</span>b_Intercept[<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb577-5"><a href="markov-chain-monte-carlo.html#cb577-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># since these come from lists, here we&#39;ll convert them to a data frame</span></span>
<span id="cb577-6"><a href="markov-chain-monte-carlo.html#cb577-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb577-7"><a href="markov-chain-monte-carlo.html#cb577-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">b_Intercept =</span> <span class="st">&quot;.&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb577-8"><a href="markov-chain-monte-carlo.html#cb577-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we&#39;ll need to recapture the iteration and chain information</span></span>
<span id="cb577-9"><a href="markov-chain-monte-carlo.html#cb577-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter  =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>, <span class="at">times =</span> <span class="dv">3</span>),</span>
<span id="cb577-10"><a href="markov-chain-monte-carlo.html#cb577-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">chain =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">each =</span> <span class="dv">500</span>), </span>
<span id="cb577-11"><a href="markov-chain-monte-carlo.html#cb577-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>)))</span>
<span id="cb577-12"><a href="markov-chain-monte-carlo.html#cb577-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-13"><a href="markov-chain-monte-carlo.html#cb577-13" aria-hidden="true" tabindex="-1"></a>warmups <span class="sc">%&gt;%</span> </span>
<span id="cb577-14"><a href="markov-chain-monte-carlo.html#cb577-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##   b_Intercept iter chain
## 1   0.7625908    1     1
## 2   0.7625908    2     1
## 3   0.7625908    3     1
## 4   0.7655583    4     1
## 5   0.7444207    5     1
## 6   0.6654870    6     1</code></pre>
<p>The <a href="https://github.com/stan-dev/bayesplot"><strong>bayesplot</strong> package</a> <span class="citation">(<a href="#ref-gabry2019visualization" role="doc-biblioref">Gabry et al., 2019</a>; <a href="#ref-R-bayesplot" role="doc-biblioref">Gabry &amp; Mahr, 2022</a>)</span> makes it easier to reproduce some of the plots in Figure 7.10.</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="markov-chain-monte-carlo.html#cb579-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span></code></pre></div>
<p>We’ll reproduce the upper left panel with <code>mcmc_trace()</code>.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="markov-chain-monte-carlo.html#cb580-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(warmups, <span class="at">pars =</span> <span class="st">&quot;b_Intercept&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-59-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>As an alternative, we can also extract the warmup draws from a <code>brm()</code> fit with the <a href="https://cran.rstudio.com/package=ggmcmc"><strong>ggmcmc</strong> package</a> <span class="citation">(<a href="#ref-fernandezGGMCMCAnalysisofMCMC2016" role="doc-biblioref">Fernández i Marín, 2016</a>, <a href="#ref-R-ggmcmc" role="doc-biblioref">2021</a>)</span>.</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="markov-chain-monte-carlo.html#cb581-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmcmc)</span></code></pre></div>
<p>The <strong>ggmcmc</strong> package has a variety of convenience functions for working with MCMC chains. The <code>ggs()</code> function extracts the posterior draws, including <code>warmup</code>, and arranges them in a tidy tibble. With those in hand, we can now make a trace plot with warmup draws.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="markov-chain-monte-carlo.html#cb582-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs</span>(fit7<span class="fl">.2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb582-2"><a href="markov-chain-monte-carlo.html#cb582-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Iteration <span class="sc">&lt;</span> <span class="dv">501</span> <span class="sc">&amp;</span></span>
<span id="cb582-3"><a href="markov-chain-monte-carlo.html#cb582-3" aria-hidden="true" tabindex="-1"></a>           Parameter <span class="sc">==</span> <span class="st">&quot;b_Intercept&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb582-4"><a href="markov-chain-monte-carlo.html#cb582-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(Chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb582-5"><a href="markov-chain-monte-carlo.html#cb582-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb582-6"><a href="markov-chain-monte-carlo.html#cb582-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value, <span class="at">color =</span> chain)) <span class="sc">+</span></span>
<span id="cb582-7"><a href="markov-chain-monte-carlo.html#cb582-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb582-8"><a href="markov-chain-monte-carlo.html#cb582-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb582-9"><a href="markov-chain-monte-carlo.html#cb582-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;My custom trace plots with warmups via ggmcmc::ggs()&quot;</span>,</span>
<span id="cb582-10"><a href="markov-chain-monte-carlo.html#cb582-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb582-11"><a href="markov-chain-monte-carlo.html#cb582-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>(<span class="at">font_size =</span> <span class="dv">12</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-61-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>You can make the same basic plot by pulling the posterior draws with <code>as_draws_df()</code>, as long as you include the <code>inc_warmup = TRUE</code> argument. Then you just have to be careful to <code>filter()</code> by the correct values in the <code>.iteration</code> meta-column.</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="markov-chain-monte-carlo.html#cb583-1" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit7<span class="fl">.2</span>, <span class="at">inc_warmup =</span> T)</span>
<span id="cb583-2"><a href="markov-chain-monte-carlo.html#cb583-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb583-3"><a href="markov-chain-monte-carlo.html#cb583-3" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb583-4"><a href="markov-chain-monte-carlo.html#cb583-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.iteration <span class="sc">&lt;=</span> <span class="dv">500</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb583-5"><a href="markov-chain-monte-carlo.html#cb583-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb583-6"><a href="markov-chain-monte-carlo.html#cb583-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .iteration, <span class="at">y =</span> b_Intercept, <span class="at">color =</span> <span class="fu">factor</span>(.chain))) <span class="sc">+</span></span>
<span id="cb583-7"><a href="markov-chain-monte-carlo.html#cb583-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb583-8"><a href="markov-chain-monte-carlo.html#cb583-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="st">&quot;chain&quot;</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb583-9"><a href="markov-chain-monte-carlo.html#cb583-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;My custom trace plots with warmups via as_draws_df()&quot;</span>,</span>
<span id="cb583-10"><a href="markov-chain-monte-carlo.html#cb583-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb583-11"><a href="markov-chain-monte-carlo.html#cb583-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>(<span class="at">font_size =</span> <span class="dv">12</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-62-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Anyway, it appears our HMC warmup draws found the posterior quite quickly. Here’s the autocorrelation plot.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="markov-chain-monte-carlo.html#cb584-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_acf</span>(warmups, <span class="at">pars =</span> <span class="st">&quot;b_Intercept&quot;</span>, <span class="at">lags =</span> <span class="dv">25</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-63-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Our autocorrelation plots indicate substantially lower autocorrelations yielded by HMC as implemented by Stan than what Kruschke generated with the MH algorithm. This is one of the reasons folks using HMC tend to use fewer iterations than those using MH or Gibbs.</p>
<p>If you were unhappy with the way <code>mcmc_acf()</code> defaults to faceting the plot by chain, you could always extract the data from the function and use them to make the plot the way you prefer. E.g.,</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="markov-chain-monte-carlo.html#cb585-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_acf</span>(warmups)<span class="sc">$</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb585-2"><a href="markov-chain-monte-carlo.html#cb585-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb585-3"><a href="markov-chain-monte-carlo.html#cb585-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">==</span> <span class="st">&quot;b_Intercept&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb585-4"><a href="markov-chain-monte-carlo.html#cb585-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb585-5"><a href="markov-chain-monte-carlo.html#cb585-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Lag, <span class="at">y =</span> AC,</span>
<span id="cb585-6"><a href="markov-chain-monte-carlo.html#cb585-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> Chain <span class="sc">%&gt;%</span> <span class="fu">as.factor</span>())) <span class="sc">+</span></span>
<span id="cb585-7"><a href="markov-chain-monte-carlo.html#cb585-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb585-8"><a href="markov-chain-monte-carlo.html#cb585-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb585-9"><a href="markov-chain-monte-carlo.html#cb585-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb585-10"><a href="markov-chain-monte-carlo.html#cb585-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb585-11"><a href="markov-chain-monte-carlo.html#cb585-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Autocorrelation&quot;</span>) <span class="sc">+</span></span>
<span id="cb585-12"><a href="markov-chain-monte-carlo.html#cb585-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb585-13"><a href="markov-chain-monte-carlo.html#cb585-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-64-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Here are the overlaid densities.</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="markov-chain-monte-carlo.html#cb586-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_dens_overlay</span>(warmups, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;b_Intercept&quot;</span>))</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-65-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>The densities aren’t great, but they still appear nicer than those in for the burn-in iterations in the text. With our warmups in their current state, I’m not aware how we might conveniently make a shrink factor plot, as seen in the lower left of Figure 7.10. So it goes…</p>
<p>Figure 7.11 examined the post-burn-in iterations. We’ll follow suit with our post-warmup iterations. Note that for use with the <code>bayesplot::mcmc_</code> functions, we’ll generally want our posterior draws in a data frame format. We an do this by extracting them with the <code>brms::as_draws_df()</code> function.</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="markov-chain-monte-carlo.html#cb587-1" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit7<span class="fl">.2</span>)</span>
<span id="cb587-2"><a href="markov-chain-monte-carlo.html#cb587-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb587-3"><a href="markov-chain-monte-carlo.html#cb587-3" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb587-4"><a href="markov-chain-monte-carlo.html#cb587-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> .chain) <span class="sc">%&gt;%</span> </span>
<span id="cb587-5"><a href="markov-chain-monte-carlo.html#cb587-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(<span class="at">pars =</span> <span class="st">&quot;b_Intercept&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-66-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The autocorrelation plots:</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="markov-chain-monte-carlo.html#cb588-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb588-2"><a href="markov-chain-monte-carlo.html#cb588-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> .chain) <span class="sc">%&gt;%</span> </span>
<span id="cb588-3"><a href="markov-chain-monte-carlo.html#cb588-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_acf</span>(<span class="at">pars =</span> <span class="st">&quot;b_Intercept&quot;</span>, <span class="at">lags =</span> <span class="dv">40</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-67-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>As with the warmups, above, the post-warmup autocorrelation plots indicate substantially lower autocorrelations yielded by HMC as implemented by Stan than what Kruschke generated with the MH algorithm. This is one of the reasons folks using HMC tend to use fewer iterations than those using MH or Gibbs.</p>
<p>Here are the overlaid densities.</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="markov-chain-monte-carlo.html#cb589-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb589-2"><a href="markov-chain-monte-carlo.html#cb589-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> .chain) <span class="sc">%&gt;%</span> </span>
<span id="cb589-3"><a href="markov-chain-monte-carlo.html#cb589-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_dens_overlay</span>(<span class="at">pars =</span> <span class="st">&quot;b_Intercept&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-68-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Now that we’re focusing on the post-warmup iterations, we can make a shrink factor plot. We’ll do so with the <code>coda::gelman.plot()</code> function. But you can’t just dump your <code>brm()</code> fit object into <code>gelman.plot()</code>. It’s the wrong object type. However, <strong>brms</strong> offers the <code>as.mcmc()</code> function which will convert <code>brm()</code> objects for use in functions from the <strong>coda</strong> package.</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="markov-chain-monte-carlo.html#cb590-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.2</span>_c <span class="ot">&lt;-</span> <span class="fu">as.mcmc</span>(fit7<span class="fl">.2</span>)</span>
<span id="cb590-2"><a href="markov-chain-monte-carlo.html#cb590-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-3"><a href="markov-chain-monte-carlo.html#cb590-3" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.2</span>_c <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## List of 3
##  $ : &#39;mcmc&#39; num [1:9500, 1:3] 0.64 0.596 0.702 0.693 0.675 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ iterations: NULL
##   .. ..$ parameters: chr [1:3] &quot;b_Intercept&quot; &quot;lprior&quot; &quot;lp__&quot;
##   ..- attr(*, &quot;mcpar&quot;)= num [1:3] 501 10000 1
##  $ : &#39;mcmc&#39; num [1:9500, 1:3] 0.757 0.73 0.54 0.578 0.583 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ iterations: NULL
##   .. ..$ parameters: chr [1:3] &quot;b_Intercept&quot; &quot;lprior&quot; &quot;lp__&quot;
##   ..- attr(*, &quot;mcpar&quot;)= num [1:3] 501 10000 1
##  $ : &#39;mcmc&#39; num [1:9500, 1:3] 0.67 0.677 0.677 0.631 0.631 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ iterations: NULL
##   .. ..$ parameters: chr [1:3] &quot;b_Intercept&quot; &quot;lprior&quot; &quot;lp__&quot;
##   ..- attr(*, &quot;mcpar&quot;)= num [1:3] 501 10000 1
##  - attr(*, &quot;class&quot;)= chr &quot;mcmc.list&quot;</code></pre>
<p>With our freshly-converted <code>fit2_c</code> object in hand, we’re ready to plot.</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="markov-chain-monte-carlo.html#cb592-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.plot</span>(fit7<span class="fl">.2</span>_c[, <span class="st">&quot;b_Intercept&quot;</span>, ])</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-70-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Looks great. As Kruschke explained on page 181, that plot is based on the potential scale reduction factor, or <span class="math inline">\(\widehat R\)</span> as it’s typically referred to in the Stan ecosystem. Happily, <strong>brms</strong> reports the <span class="math inline">\(\widehat R\)</span> values for the major model parameters using <code>print()</code> or <code>summary()</code>.</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="markov-chain-monte-carlo.html#cb593-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit7<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>##  Family: bernoulli 
##   Links: mu = identity 
## Formula: y ~ 1 
##    Data: d (Number of observations: 50) 
##   Draws: 3 chains, each with iter = 10000; warmup = 500; thin = 1;
##          total post-warmup draws = 28500
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.69      0.06     0.56     0.80 1.00     9810    11160
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Instead of a running value, you get a single statistic in the ‘Rhat’ column.</p>
<p>On page 181, Kruschke discussed how his overlaid density plots include the HDIs, by chain. The convenience functions from <strong>brms</strong> and <strong>bayesplot</strong> don’t easily get us there. But we can get those easy enough with a little help <code>tidybayes::stat_halfeye()</code>. Note that for use with the various <strong>tidybayes</strong> functions, we’ll want the posterior draws in the format returned by the <code>brms::as_draws_df()</code> function, but this time without the warmups included.</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="markov-chain-monte-carlo.html#cb595-1" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(fit7<span class="fl">.2</span>) </span>
<span id="cb595-2"><a href="markov-chain-monte-carlo.html#cb595-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-3"><a href="markov-chain-monte-carlo.html#cb595-3" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb595-4"><a href="markov-chain-monte-carlo.html#cb595-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(.chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb595-5"><a href="markov-chain-monte-carlo.html#cb595-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb595-6"><a href="markov-chain-monte-carlo.html#cb595-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> b_Intercept, <span class="at">y =</span> chain, <span class="at">fill =</span> chain)) <span class="sc">+</span></span>
<span id="cb595-7"><a href="markov-chain-monte-carlo.html#cb595-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> mode_hdi,</span>
<span id="cb595-8"><a href="markov-chain-monte-carlo.html#cb595-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">.width =</span> .<span class="dv">95</span>) <span class="sc">+</span></span>
<span id="cb595-9"><a href="markov-chain-monte-carlo.html#cb595-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb595-10"><a href="markov-chain-monte-carlo.html#cb595-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fl">0.035</span>)) <span class="sc">+</span></span>
<span id="cb595-11"><a href="markov-chain-monte-carlo.html#cb595-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb595-12"><a href="markov-chain-monte-carlo.html#cb595-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-72-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>If you would like your chain-wise posterior densities to overlap, one way would be to play around with the <code>height</code> and <code>alpha</code> parameters within the <code>stat_halfeye()</code> function.</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="markov-chain-monte-carlo.html#cb596-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb596-2"><a href="markov-chain-monte-carlo.html#cb596-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(.chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb596-3"><a href="markov-chain-monte-carlo.html#cb596-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb596-4"><a href="markov-chain-monte-carlo.html#cb596-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> b_Intercept, <span class="at">y =</span> chain, <span class="at">fill =</span> chain)) <span class="sc">+</span></span>
<span id="cb596-5"><a href="markov-chain-monte-carlo.html#cb596-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> mode_hdi, <span class="at">.width =</span> .<span class="dv">95</span>, </span>
<span id="cb596-6"><a href="markov-chain-monte-carlo.html#cb596-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">height =</span> <span class="dv">9</span>, <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb596-7"><a href="markov-chain-monte-carlo.html#cb596-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>() <span class="sc">+</span></span>
<span id="cb596-8"><a href="markov-chain-monte-carlo.html#cb596-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb596-9"><a href="markov-chain-monte-carlo.html#cb596-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb596-10"><a href="markov-chain-monte-carlo.html#cb596-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-73-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="mcmc-accuracy." class="section level3 hasAnchor" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> MCMC accuracy.<a href="markov-chain-monte-carlo.html#mcmc-accuracy." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We want</p>
<blockquote>
<p>measures of chain length and accuracy that take into account the clumpiness of the chain. And for that, we need a measure of clumpiness. We will measure clumpiness as <em>autocorrelation</em>, which is simply the correlation of the chain values with the chain values <span class="math inline">\(k\)</span> steps ahead. There is a different autocorrelation for each choice of <span class="math inline">\(k\)</span>. (p. 182, <em>emphasis</em> in the original)</p>
</blockquote>
<p>We made a couple autocorrelation plots in the last section, but now it’s time to get a better sense of what they mean. Just a little further in the text, Kruschke wrote: “The number of steps between the chain and its superimposed copy is called the <em>lag</em>” (p. 182, <em>emphasis</em> in the original). In case it’s not clear, <em>lag</em> is a general term and can be applied to contexts outside of MCMC chains. You find it used sometimes in the longitudinal statistical literature, particularly for what are called <em>timeseries</em> models. Sadly, we won’t be fitting those in this book. If you’re curious, McElreath discussed them briefly in Chapter 16 of his <span class="citation">(<a href="#ref-mcelreathStatisticalRethinkingBayesian2020" role="doc-biblioref">2020</a>)</span> text.</p>
<p>We, however, will have to contend with a technical quirk within the <strong>tidyverse</strong>. The two <strong>dplyr</strong> functions relevant to lags are called <code>lag()</code> and <code>lead()</code>. Here’s a little example to see how they work.</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="markov-chain-monte-carlo.html#cb597-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">step =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb597-2"><a href="markov-chain-monte-carlo.html#cb597-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lag  =</span> <span class="fu">lag</span>(step, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb597-3"><a href="markov-chain-monte-carlo.html#cb597-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">lead =</span> <span class="fu">lead</span>(step, <span class="at">n =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##    step   lag  lead
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     1    NA     2
## 2     2     1     3
## 3     3     2     4
## 4     4     3     5
## 5     5     4    NA</code></pre>
<p>The original values are <code>1:5</code> in the <code>step</code> column. When you plug those into <code>lag(n = 1)</code>, you get back the value from the <em>previous row</em>. The opposite happens when you plug <code>step</code> into <code>lead(n = 1)</code>; there you get back the value from the <em>next row</em>. Returning to the block quote above, Kruschke wrote that autocorrelations are “the correlation of the chain values with the chain values <span class="math inline">\(k\)</span> <em>steps ahead</em>” (p. 182, <em>emphasis</em> added). Within the context of the <code>lag()</code> and <code>lead()</code> functions, their <code>n</code> arguments are what Kruschke called <span class="math inline">\(k\)</span>, which is no big deal. Confusingly, though, since Kruschke wanted to focus on MCMC chains values that were “<span class="math inline">\(k\)</span> steps ahead,” that means we’ll have to use the <code>lead()</code> function, not <code>lag()</code>. Please don’t fret about the semantics, here. Both Kruschke and the <strong>dplyr</strong> package are correct. We’re lagging. But in this specific case, we’ll be lagging our data with the <code>lead()</code> function. You can learn more about <code>lag()</code> and <code>lead()</code> <a href="https://dplyr.tidyverse.org/reference/lead-lag.html">here</a>.</p>
<p>On to the plot! If you read closely in the text (pp. 182–183), Kruschke didn’t elaborate on which model he was showcasing in Figure 7.12. We just get the vague explanation that the “upper panels show an MCMC chain of 70 steps, superimposed with the same chain translated a certain number of steps ahead” (p. 182). To make our lives simple, let’s just use the model we’ve been working with, <code>fit7.2</code>. Our sole parameter is the intercept which, as it turns out, will not be on the same scale as you see in the <span class="math inline">\(y\)</span>-axis of Figure 7.12. So it goes… But anyways, our first step towards making our variant of the plot is to wrangle out posterior draws a bit. We’ll call the wrangled data frame <code>lagged_draws</code>.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="markov-chain-monte-carlo.html#cb599-1" aria-hidden="true" tabindex="-1"></a>lagged_draws <span class="ot">&lt;-</span> </span>
<span id="cb599-2"><a href="markov-chain-monte-carlo.html#cb599-2" aria-hidden="true" tabindex="-1"></a>  draws <span class="sc">%&gt;%</span> </span>
<span id="cb599-3"><a href="markov-chain-monte-carlo.html#cb599-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.chain <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> .draw <span class="sc">&lt;</span> <span class="dv">71</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb599-4"><a href="markov-chain-monte-carlo.html#cb599-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_Intercept, .draw) <span class="sc">%&gt;%</span> </span>
<span id="cb599-5"><a href="markov-chain-monte-carlo.html#cb599-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sometimes the unlagged data are called lag_0</span></span>
<span id="cb599-6"><a href="markov-chain-monte-carlo.html#cb599-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">lag_0 =</span> b_Intercept) <span class="sc">%&gt;%</span> </span>
<span id="cb599-7"><a href="markov-chain-monte-carlo.html#cb599-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lags for three different levels of k</span></span>
<span id="cb599-8"><a href="markov-chain-monte-carlo.html#cb599-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lag_1  =</span> <span class="fu">lead</span>(lag_0, <span class="at">n =</span> <span class="dv">1</span>), </span>
<span id="cb599-9"><a href="markov-chain-monte-carlo.html#cb599-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">lag_5  =</span> <span class="fu">lead</span>(lag_0, <span class="at">n =</span> <span class="dv">5</span>),</span>
<span id="cb599-10"><a href="markov-chain-monte-carlo.html#cb599-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">lag_10 =</span> <span class="fu">lead</span>(lag_0, <span class="at">n =</span> <span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb599-11"><a href="markov-chain-monte-carlo.html#cb599-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>.draw, <span class="at">names_to =</span> <span class="st">&quot;key&quot;</span>) </span></code></pre></div>
<p>Now here’s our version of the top row.</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="markov-chain-monte-carlo.html#cb600-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> </span>
<span id="cb600-2"><a href="markov-chain-monte-carlo.html#cb600-2" aria-hidden="true" tabindex="-1"></a>  lagged_draws <span class="sc">%&gt;%</span> </span>
<span id="cb600-3"><a href="markov-chain-monte-carlo.html#cb600-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(key <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;lag_0&quot;</span>, <span class="st">&quot;lag_1&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb600-4"><a href="markov-chain-monte-carlo.html#cb600-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb600-5"><a href="markov-chain-monte-carlo.html#cb600-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .draw, <span class="at">y =</span> value, <span class="at">color =</span> key)) <span class="sc">+</span></span>
<span id="cb600-6"><a href="markov-chain-monte-carlo.html#cb600-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> .draw <span class="sc">==</span> <span class="dv">50</span>, <span class="at">shape =</span> .draw <span class="sc">==</span> <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb600-7"><a href="markov-chain-monte-carlo.html#cb600-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb600-8"><a href="markov-chain-monte-carlo.html#cb600-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb600-9"><a href="markov-chain-monte-carlo.html#cb600-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">46</span>, <span class="at">y =</span> <span class="fu">c</span>(.<span class="dv">825</span>, .<span class="dv">79</span>),</span>
<span id="cb600-10"><a href="markov-chain-monte-carlo.html#cb600-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;Original&quot;</span>, <span class="st">&quot;Lagged&quot;</span>),</span>
<span id="cb600-11"><a href="markov-chain-monte-carlo.html#cb600-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;steelblue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb600-12"><a href="markov-chain-monte-carlo.html#cb600-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;steelblue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb600-13"><a href="markov-chain-monte-carlo.html#cb600-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span> <span class="sc">/</span> <span class="dv">10</span>, <span class="at">limits =</span> <span class="fu">c</span>(.<span class="dv">53</span>, .<span class="dv">84</span>)) <span class="sc">+</span></span>
<span id="cb600-14"><a href="markov-chain-monte-carlo.html#cb600-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Lag 1&quot;</span>,</span>
<span id="cb600-15"><a href="markov-chain-monte-carlo.html#cb600-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Index 1:70&quot;</span>,</span>
<span id="cb600-16"><a href="markov-chain-monte-carlo.html#cb600-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(theta))</span>
<span id="cb600-17"><a href="markov-chain-monte-carlo.html#cb600-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-18"><a href="markov-chain-monte-carlo.html#cb600-18" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb600-19"><a href="markov-chain-monte-carlo.html#cb600-19" aria-hidden="true" tabindex="-1"></a>  lagged_draws <span class="sc">%&gt;%</span> </span>
<span id="cb600-20"><a href="markov-chain-monte-carlo.html#cb600-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(key <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;lag_0&quot;</span>, <span class="st">&quot;lag_5&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb600-21"><a href="markov-chain-monte-carlo.html#cb600-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb600-22"><a href="markov-chain-monte-carlo.html#cb600-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .draw, <span class="at">y =</span> value, <span class="at">color =</span> key)) <span class="sc">+</span></span>
<span id="cb600-23"><a href="markov-chain-monte-carlo.html#cb600-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> .draw <span class="sc">==</span> <span class="dv">50</span>, <span class="at">shape =</span> .draw <span class="sc">==</span> <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb600-24"><a href="markov-chain-monte-carlo.html#cb600-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb600-25"><a href="markov-chain-monte-carlo.html#cb600-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;steelblue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb600-26"><a href="markov-chain-monte-carlo.html#cb600-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> <span class="cn">NULL</span>, </span>
<span id="cb600-27"><a href="markov-chain-monte-carlo.html#cb600-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span> <span class="sc">/</span> <span class="dv">10</span>, <span class="at">limits =</span> <span class="fu">c</span>(.<span class="dv">53</span>, .<span class="dv">84</span>)) <span class="sc">+</span></span>
<span id="cb600-28"><a href="markov-chain-monte-carlo.html#cb600-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Lag 5&quot;</span>,</span>
<span id="cb600-29"><a href="markov-chain-monte-carlo.html#cb600-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Index 1:70&quot;</span>)</span>
<span id="cb600-30"><a href="markov-chain-monte-carlo.html#cb600-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb600-31"><a href="markov-chain-monte-carlo.html#cb600-31" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb600-32"><a href="markov-chain-monte-carlo.html#cb600-32" aria-hidden="true" tabindex="-1"></a>  lagged_draws <span class="sc">%&gt;%</span> </span>
<span id="cb600-33"><a href="markov-chain-monte-carlo.html#cb600-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(key <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;lag_0&quot;</span>, <span class="st">&quot;lag_10&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb600-34"><a href="markov-chain-monte-carlo.html#cb600-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb600-35"><a href="markov-chain-monte-carlo.html#cb600-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .draw, <span class="at">y =</span> value, <span class="at">color =</span> key)) <span class="sc">+</span></span>
<span id="cb600-36"><a href="markov-chain-monte-carlo.html#cb600-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> .draw <span class="sc">==</span> <span class="dv">50</span>, <span class="at">shape =</span> .draw <span class="sc">==</span> <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb600-37"><a href="markov-chain-monte-carlo.html#cb600-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb600-38"><a href="markov-chain-monte-carlo.html#cb600-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;steelblue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb600-39"><a href="markov-chain-monte-carlo.html#cb600-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> <span class="cn">NULL</span>, </span>
<span id="cb600-40"><a href="markov-chain-monte-carlo.html#cb600-40" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span> <span class="sc">/</span> <span class="dv">10</span>, <span class="at">limits =</span> <span class="fu">c</span>(.<span class="dv">53</span>, .<span class="dv">84</span>)) <span class="sc">+</span></span>
<span id="cb600-41"><a href="markov-chain-monte-carlo.html#cb600-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Lag 10&quot;</span>,</span>
<span id="cb600-42"><a href="markov-chain-monte-carlo.html#cb600-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Index 1:70&quot;</span>)</span>
<span id="cb600-43"><a href="markov-chain-monte-carlo.html#cb600-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-44"><a href="markov-chain-monte-carlo.html#cb600-44" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb600-45"><a href="markov-chain-monte-carlo.html#cb600-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb600-46"><a href="markov-chain-monte-carlo.html#cb600-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-47"><a href="markov-chain-monte-carlo.html#cb600-47" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3) <span class="sc">&amp;</span></span>
<span id="cb600-48"><a href="markov-chain-monte-carlo.html#cb600-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span>)) <span class="sc">&amp;</span></span>
<span id="cb600-49"><a href="markov-chain-monte-carlo.html#cb600-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="sc">&amp;</span></span>
<span id="cb600-50"><a href="markov-chain-monte-carlo.html#cb600-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">&amp;</span></span>
<span id="cb600-51"><a href="markov-chain-monte-carlo.html#cb600-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) </span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-76-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Here’s the middle row for Figure 7.12.</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="markov-chain-monte-carlo.html#cb601-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb601-2"><a href="markov-chain-monte-carlo.html#cb601-2" aria-hidden="true" tabindex="-1"></a>  lagged_draws <span class="sc">%&gt;%</span> </span>
<span id="cb601-3"><a href="markov-chain-monte-carlo.html#cb601-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> key, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb601-4"><a href="markov-chain-monte-carlo.html#cb601-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb601-5"><a href="markov-chain-monte-carlo.html#cb601-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag_1, <span class="at">y =</span> lag_0)) <span class="sc">+</span></span>
<span id="cb601-6"><a href="markov-chain-monte-carlo.html#cb601-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb601-7"><a href="markov-chain-monte-carlo.html#cb601-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> .draw <span class="sc">==</span> <span class="dv">50</span>, <span class="at">shape =</span> .draw <span class="sc">==</span> <span class="dv">50</span>))</span>
<span id="cb601-8"><a href="markov-chain-monte-carlo.html#cb601-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-9"><a href="markov-chain-monte-carlo.html#cb601-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb601-10"><a href="markov-chain-monte-carlo.html#cb601-10" aria-hidden="true" tabindex="-1"></a>  lagged_draws <span class="sc">%&gt;%</span> </span>
<span id="cb601-11"><a href="markov-chain-monte-carlo.html#cb601-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> key, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb601-12"><a href="markov-chain-monte-carlo.html#cb601-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb601-13"><a href="markov-chain-monte-carlo.html#cb601-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag_5, <span class="at">y =</span> lag_0)) <span class="sc">+</span></span>
<span id="cb601-14"><a href="markov-chain-monte-carlo.html#cb601-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb601-15"><a href="markov-chain-monte-carlo.html#cb601-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> .draw <span class="sc">==</span> <span class="dv">50</span>, <span class="at">shape =</span> .draw <span class="sc">==</span> <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb601-16"><a href="markov-chain-monte-carlo.html#cb601-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> <span class="cn">NULL</span>)</span>
<span id="cb601-17"><a href="markov-chain-monte-carlo.html#cb601-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-18"><a href="markov-chain-monte-carlo.html#cb601-18" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb601-19"><a href="markov-chain-monte-carlo.html#cb601-19" aria-hidden="true" tabindex="-1"></a>  lagged_draws <span class="sc">%&gt;%</span> </span>
<span id="cb601-20"><a href="markov-chain-monte-carlo.html#cb601-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> key, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb601-21"><a href="markov-chain-monte-carlo.html#cb601-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb601-22"><a href="markov-chain-monte-carlo.html#cb601-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag_10, <span class="at">y =</span> lag_0)) <span class="sc">+</span></span>
<span id="cb601-23"><a href="markov-chain-monte-carlo.html#cb601-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb601-24"><a href="markov-chain-monte-carlo.html#cb601-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> .draw <span class="sc">==</span> <span class="dv">50</span>, <span class="at">shape =</span> .draw <span class="sc">==</span> <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb601-25"><a href="markov-chain-monte-carlo.html#cb601-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> <span class="cn">NULL</span>)</span>
<span id="cb601-26"><a href="markov-chain-monte-carlo.html#cb601-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-27"><a href="markov-chain-monte-carlo.html#cb601-27" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb601-28"><a href="markov-chain-monte-carlo.html#cb601-28" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3) <span class="sc">&amp;</span> </span>
<span id="cb601-29"><a href="markov-chain-monte-carlo.html#cb601-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">1</span>)) <span class="sc">&amp;</span></span>
<span id="cb601-30"><a href="markov-chain-monte-carlo.html#cb601-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="sc">&amp;</span></span>
<span id="cb601-31"><a href="markov-chain-monte-carlo.html#cb601-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">&amp;</span></span>
<span id="cb601-32"><a href="markov-chain-monte-carlo.html#cb601-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-77-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>For kicks and giggles, we used <code>stat_smooth()</code> to add an OLS regression line with its 95% frequentist confidence intervals to each plot.</p>
<p>If you want the Pearson’s correlations among the lags, the <code>lowerCor()</code> function from the <a href="https://CRAN.R-project.org/package=psych"><strong>psych</strong> package</a> <span class="citation">(<a href="#ref-R-psych" role="doc-biblioref">Revelle, 2022</a>)</span> can be handy.</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="markov-chain-monte-carlo.html#cb602-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb602-2"><a href="markov-chain-monte-carlo.html#cb602-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-3"><a href="markov-chain-monte-carlo.html#cb602-3" aria-hidden="true" tabindex="-1"></a>lagged_draws <span class="sc">%&gt;%</span> </span>
<span id="cb602-4"><a href="markov-chain-monte-carlo.html#cb602-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> key, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb602-5"><a href="markov-chain-monte-carlo.html#cb602-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>.draw) <span class="sc">%&gt;%</span> </span>
<span id="cb602-6"><a href="markov-chain-monte-carlo.html#cb602-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lowerCor</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">use =</span> <span class="st">&quot;pairwise.complete.obs&quot;</span>)</span></code></pre></div>
<pre><code>##        lag_0  lag_1  lag_5  lg_10 
## lag_0   1.000                     
## lag_1   0.408  1.000              
## lag_5   0.202  0.012  1.000       
## lag_10 -0.121 -0.232  0.231  1.000</code></pre>
<p>For our version of the bottom of Figure 7.12, we’ll use the <code>bayesplot::mcmc_acf_bar()</code> function to get the autocorrelation bar plot, by chain.</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="markov-chain-monte-carlo.html#cb604-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span> </span>
<span id="cb604-2"><a href="markov-chain-monte-carlo.html#cb604-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> .chain) <span class="sc">%&gt;%</span> </span>
<span id="cb604-3"><a href="markov-chain-monte-carlo.html#cb604-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_acf_bar</span>(<span class="at">pars =</span> <span class="st">&quot;b_Intercept&quot;</span>,</span>
<span id="cb604-4"><a href="markov-chain-monte-carlo.html#cb604-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">lags =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="07_files/figure-html/unnamed-chunk-79-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>All three rows of our versions for Figure 7.12 indicate in their own way how much lower our autocorrelations were than the ones in the text.</p>
<p>If you’re curious of the effective sample sizes for the parameters in your <strong>brms</strong> models, just look at the model summary using either <code>summary()</code> or <code>print()</code>.</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="markov-chain-monte-carlo.html#cb605-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fit7<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>##  Family: bernoulli 
##   Links: mu = identity 
## Formula: y ~ 1 
##    Data: d (Number of observations: 50) 
##   Draws: 3 chains, each with iter = 10000; warmup = 500; thin = 1;
##          total post-warmup draws = 28500
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.69      0.06     0.56     0.80 1.00     9810    11160
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Look at the last two columns in the <code>Intercept</code> summary. Earlier versions of <strong>brms</strong> had one column named <code>Eff.Sample</code>, which reported the effect sample size as discussed by Kruschke. Starting with version 2.10.0, <strong>brms</strong> now returns <code>Bulk_ESS</code> and <code>Tail_ESS</code>, instead. These originate from a <span class="citation">(<a href="#ref-vehtariRanknormalizationFoldingLocalization2021" role="doc-biblioref">2021</a>)</span> <a href="https://doi.org/10.1214/20-BA1221">paper</a> by Stan-team all-stars Vehtari, Gelman, Simpson, Carpenter, and Bürkner. From their paper, we read:</p>
<blockquote>
<p>When reporting quantile estimates or posterior intervals, we strongly suggest assessing the convergence of the chains for these quantiles. In Section 4.3, we show that convergence of Markov chains is not uniform across the parameter space, that is, convergence might be different in the bulk of the distribution (e.g., for the mean or median) than in the tails (e.g., for extreme quantiles). We propose diagnostics and effective sample sizes specifically for extreme quantiles. This is different from the standard ESS estimate (which we refer to as bulk-ESS), which mainly assesses how well the centre of the distribution is resolved. Instead, these “tail-ESS” measures allow the user to estimate the MCSE for interval estimates. (pp. 672–673)</p>
</blockquote>
<p>For more technical details, see the paper. The <code>Bulk_ESS</code> column in current versions of <strong>brms</strong> is what was previously referred to as <code>Eff.Sample</code>. This is what corresponds to what Kruschke meant when referring to effective sample size. Now rather than focusing solely on ‘the center of the’ posterior distribution’ as indexed by <code>Bulk_ESS</code>, we also gauge the effective sample size in the posterior intervals using <code>Tail_ESS</code>.</p>
<p>Anyway, I’m not sure how to reproduce Kruschke’s MCMC ESS simulation studies. My confusion comes from at least two levels. If you read in the text, Kruschke described his simulation as based on “MCMC chains from the normal distribution” (p. 184). Though I do know how to initialize HMC chains for a model on data from the normal distribution, I have no idea how one would initialize chains from the standard normal distribution, itself. Second, if you view Kruschke’s simulation as based on a model which one could feasibly fit with <strong>brms</strong>, I don’t know how one would specify “an ESS of 10,000” for each iteration of the simulation. This is because <strong>brms</strong> is set up to fit models with a fixed number of iterations, for which the ESS values will vary. Kruschke’s simulation seems to be set in reverse. For more details on Kruschke’s simulation, you’ll just have to read through the text. Anyway, if you know how to fit such a simulation using <strong>brms</strong>, please share your code in my <a href="https://github.com/ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse/issues/15">GitHub issue #15</a>.</p>
<p>If you’re interested in the Monte Carlo standard error (MCSE) for your <strong>brms</strong> parameters, the easiest way is to tack <code>$fit</code> onto your fit object.</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="markov-chain-monte-carlo.html#cb607-1" aria-hidden="true" tabindex="-1"></a>fit7<span class="fl">.2</span><span class="sc">$</span>fit</span></code></pre></div>
<pre><code>## Inference for Stan model: 20e3ba6b38506cfef876fa747cb5168b.
## 3 chains, each with iter=10000; warmup=500; thin=1; 
## post-warmup draws per chain=9500, total post-warmup draws=28500.
## 
##               mean se_mean   sd   2.5%    25%    50%    75%  97.5% n_eff Rhat
## b_Intercept   0.69    0.00 0.06   0.56   0.65   0.69   0.73   0.80  9894    1
## lprior        0.23    0.00 0.12  -0.05   0.17   0.25   0.32   0.39  9423    1
## lp__        -32.34    0.01 0.70 -34.32 -32.51 -32.08 -31.90 -31.85 10484    1
## 
## Samples were drawn using NUTS(diag_e) at Wed Apr 20 09:33:05 2022.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<p>This returns an <a href="https://CRAN.R-project.org/package=rstan/vignettes/stanfit-objects.html">rstan-like summary</a> <span class="citation">(<a href="#ref-standevelopmentteamAccessingContentsStanfit2022" role="doc-biblioref">Stan Development Team, 2022a</a>)</span>. The ‘se_mean’ column is the MCSE.</p>
</div>
<div id="mcmc-efficiency." class="section level3 hasAnchor" number="7.5.3">
<h3><span class="header-section-number">7.5.3</span> MCMC efficiency.<a href="markov-chain-monte-carlo.html#mcmc-efficiency." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Kruschke wrote: “It is often the case in realistic applications that there is strong autocorrelation for some parameters, and therefore, an extremely long chain is required to achieve an adequate ESS or MCSE” (p. 187). As we’ll see, this is generally less of a problem for HMC than for MH or Gibbs. But it does still crop up, particularly in complicated models. As he wrote on the following page, “one sampling method that can be relatively efficient is Hamiltonian Monte Carlo.” Indeed.</p>
</div>
</div>
<div id="summary-1" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> Summary<a href="markov-chain-monte-carlo.html#summary-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>Let’s regain perspective on the forest of Bayesian inference after focusing on the trees of MCMC. Recall that the overarching goal of Bayesian analysis is identifying the credibility of parameter values in a descriptive model of data. Bayes’ rule provides an exact mathematical formulation for the posterior distribution on the parameter values. But the exact form requires evaluation of an integral that might be intractable for realistically complex models. Therefore, we approximate the posterior distribution, to arbitrarily high accuracy, using MCMC methods. Because of recent developments in MCMC algorithms, software that cleverly applies them in complex models, and hardware that runs them incredibly quickly, we can now use MCMC methods to analyze realistically complex models that would have been impossible only a few decades ago. (pp. 188–189)</p>
</blockquote>
</div>
<div id="session-info-6" class="section level2 unnumbered hasAnchor">
<h2>Session info<a href="markov-chain-monte-carlo.html#session-info-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="markov-chain-monte-carlo.html#cb609-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.2.2 (2022-10-31)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] psych_2.2.9      ggmcmc_1.5.1.1   bayesplot_1.10.0 patchwork_1.1.2  brms_2.18.0     
##  [6] Rcpp_1.0.9       coda_0.19-4      tidybayes_3.0.2  cowplot_1.1.1    forcats_0.5.1   
## [11] stringr_1.4.1    dplyr_1.0.10     purrr_1.0.1      readr_2.1.2      tidyr_1.2.1     
## [16] tibble_3.1.8     ggplot2_3.4.0    tidyverse_1.3.2 
## 
## loaded via a namespace (and not attached):
##   [1] readxl_1.4.1         backports_1.4.1      plyr_1.8.7           igraph_1.3.4        
##   [5] splines_4.2.2        svUnit_1.0.6         crosstalk_1.2.0      TH.data_1.1-1       
##   [9] rstantools_2.2.0     inline_0.3.19        digest_0.6.31        htmltools_0.5.3     
##  [13] fansi_1.0.3          magrittr_2.0.3       checkmate_2.1.0      googlesheets4_1.0.1 
##  [17] tzdb_0.3.0           modelr_0.1.8         RcppParallel_5.1.5   matrixStats_0.63.0  
##  [21] sandwich_3.0-2       xts_0.12.1           prettyunits_1.1.1    colorspace_2.0-3    
##  [25] rvest_1.0.2          ggdist_3.2.1         haven_2.5.1          xfun_0.35           
##  [29] callr_3.7.3          crayon_1.5.2         jsonlite_1.8.4       lme4_1.1-31         
##  [33] survival_3.4-0       zoo_1.8-10           glue_1.6.2           gtable_0.3.1        
##  [37] gargle_1.2.0         emmeans_1.8.0        distributional_0.3.1 pkgbuild_1.3.1      
##  [41] rstan_2.21.8         abind_1.4-5          scales_1.2.1         mvtnorm_1.1-3       
##  [45] GGally_2.1.2         DBI_1.1.3            miniUI_0.1.1.1       viridisLite_0.4.1   
##  [49] xtable_1.8-4         HDInterval_0.2.4     stats4_4.2.2         StanHeaders_2.21.0-7
##  [53] DT_0.24              htmlwidgets_1.5.4    httr_1.4.4           threejs_0.3.3       
##  [57] RColorBrewer_1.1-3   arrayhelpers_1.1-0   posterior_1.3.1      ellipsis_0.3.2      
##  [61] reshape_0.8.9        pkgconfig_2.0.3      loo_2.5.1            farver_2.1.1        
##  [65] sass_0.4.2           dbplyr_2.2.1         utf8_1.2.2           tidyselect_1.2.0    
##  [69] labeling_0.4.2       rlang_1.0.6          reshape2_1.4.4       later_1.3.0         
##  [73] munsell_0.5.0        cellranger_1.1.0     tools_4.2.2          cachem_1.0.6        
##  [77] cli_3.6.0            generics_0.1.3       broom_1.0.2          evaluate_0.18       
##  [81] fastmap_1.1.0        processx_3.8.0       knitr_1.40           fs_1.5.2            
##  [85] nlme_3.1-160         projpred_2.2.1       mime_0.12            xml2_1.3.3          
##  [89] compiler_4.2.2       shinythemes_1.2.0    rstudioapi_0.13      gamm4_0.2-6         
##  [93] reprex_2.0.2         bslib_0.4.0          stringi_1.7.8        highr_0.9           
##  [97] ps_1.7.2             Brobdingnag_1.2-8    lattice_0.20-45      Matrix_1.5-1        
## [101] nloptr_2.0.3         markdown_1.1         shinyjs_2.1.0        tensorA_0.36.2      
## [105] vctrs_0.5.1          pillar_1.8.1         lifecycle_1.0.3      jquerylib_0.1.4     
## [109] bridgesampling_1.1-2 estimability_1.4.1   httpuv_1.6.5         R6_2.5.1            
## [113] bookdown_0.28        promises_1.2.0.1     gridExtra_2.3        codetools_0.2-18    
## [117] boot_1.3-28          colourpicker_1.1.1   MASS_7.3-58.1        gtools_3.9.4        
## [121] assertthat_0.2.1     withr_2.5.0          mnormt_2.1.0         shinystan_2.6.0     
## [125] multcomp_1.4-20      mgcv_1.8-41          parallel_4.2.2       hms_1.1.1           
## [129] grid_4.2.2           minqa_1.2.5          rmarkdown_2.16       googledrive_2.0.0   
## [133] shiny_1.7.2          lubridate_1.8.0      base64enc_0.1-3      dygraphs_1.1.1.6</code></pre>
</div>
<div id="footnote-1" class="section level2 unnumbered hasAnchor">
<h2>Footnote<a href="markov-chain-monte-carlo.html#footnote-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-Bürkner2022Multivariate" class="csl-entry">
Bürkner, P.-C. (2022b). <em>Estimating multivariate models with brms</em>. <a href="https://CRAN.R-project.org/package=brms/vignettes/brms_multivariate.html">https://CRAN.R-project.org/package=brms/vignettes/brms_multivariate.html</a>
</div>
<div id="ref-brms2022RM" class="csl-entry">
Bürkner, P.-C. (2022f). <em><span class="nocase">brms</span> reference manual, <span>Version</span> 2.18.0</em>. <a href="https://CRAN.R-project.org/package=brms/brms.pdf">https://CRAN.R-project.org/package=brms/brms.pdf</a>
</div>
<div id="ref-R-posterior" class="csl-entry">
Bürkner, P.-C., Gabry, J., Kay, M., &amp; Vehtari, A. (2021). <em><span class="nocase">posterior</span>: <span>Tools</span> for working with posterior distributions</em> [Manual].
</div>
<div id="ref-carpenterStanProbabilisticProgramming2017" class="csl-entry">
Carpenter, B., Gelman, A., Hoffman, M. D., Lee, D., Goodrich, B., Betancourt, M., Brubaker, M., Guo, J., Li, P., &amp; Riddell, A. (2017). Stan: <span>A</span> probabilistic programming language. <em>Journal of Statistical Software</em>, <em>76</em>(1). <a href="https://doi.org/10.18637/jss.v076.i01">https://doi.org/10.18637/jss.v076.i01</a>
</div>
<div id="ref-eckhardtStanUlamJohn1987" class="csl-entry">
Eckhardt, R. (1987). Stan <span>Ulam</span>, <span>John</span> von <span>Neumann</span> and the <span>Monte Carlo</span> method. <em>Argonne, USA</em>. <a href="https://library.sciencemadness.org/lanl1_a/lib-www/pubs/00326867.pdf">https://library.sciencemadness.org/lanl1_a/lib-www/pubs/00326867.pdf</a>
</div>
<div id="ref-fernandezGGMCMCAnalysisofMCMC2016" class="csl-entry">
Fernández i Marín, X. (2016). <span class="nocase">ggmcmc</span>: <span>Analysis</span> of <span>MCMC</span> samples and <span>Bayesian</span> inference. <em>Journal of Statistical Software</em>, <em>70</em>(9), 1–20. <a href="https://doi.org/10.18637/jss.v070.i09">https://doi.org/10.18637/jss.v070.i09</a>
</div>
<div id="ref-R-ggmcmc" class="csl-entry">
Fernández i Marín, X. (2021). <em><span class="nocase">ggmcmc</span>: <span>Tools</span> for analyzing <span>MCMC</span> simulations from <span>Bayesian</span> inference</em> [Manual]. <a href="https://CRAN.R-project.org/package=ggmcmc">https://CRAN.R-project.org/package=ggmcmc</a>
</div>
<div id="ref-R-bayesplot" class="csl-entry">
Gabry, J., &amp; Mahr, T. (2022). <em><span class="nocase">bayesplot</span>: <span>Plotting</span> for <span>Bayesian</span> models</em>. <a href="https://CRAN.R-project.org/package=bayesplot">https://CRAN.R-project.org/package=bayesplot</a>
</div>
<div id="ref-gabry2019visualization" class="csl-entry">
Gabry, J., Simpson, D., Vehtari, A., Betancourt, M., &amp; Gelman, A. (2019). Visualization in <span>Bayesian</span> workflow. <em>Journal of the Royal Statistical Society: Series A (Statistics in Society)</em>, <em>182</em>(2), 389–402. <a href="https://doi.org/10.1111/rssa.12378">https://doi.org/10.1111/rssa.12378</a>
</div>
<div id="ref-kruschkeDoingBayesianData2015" class="csl-entry">
Kruschke, J. K. (2015). <em>Doing <span>Bayesian</span> data analysis: <span>A</span> tutorial with <span>R</span>, <span>JAGS</span>, and <span>Stan</span></em>. <span>Academic Press</span>. <a href="https://sites.google.com/site/doingbayesiandataanalysis/">https://sites.google.com/site/doingbayesiandataanalysis/</a>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2020" class="csl-entry">
McElreath, R. (2020). <em>Statistical rethinking: <span>A Bayesian</span> course with examples in <span>R</span> and <span>Stan</span></em> (Second Edition). <span>CRC Press</span>. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a>
</div>
<div id="ref-mcelreathStatisticalRethinkingBayesian2015" class="csl-entry">
McElreath, R. (2015). <em>Statistical rethinking: <span>A Bayesian</span> course with examples in <span>R</span> and <span>Stan</span></em>. <span>CRC press</span>. <a href="https://xcelab.net/rm/statistical-rethinking/">https://xcelab.net/rm/statistical-rethinking/</a>
</div>
<div id="ref-metropolisEquationStateCalculations1953" class="csl-entry">
Metropolis, N., Rosenbluth, A. W., Rosenbluth, M. N., Teller, A. H., &amp; Teller, E. (1953). Equation of state calculations by fast computing machines. <em>The Journal of Chemical Physics</em>, <em>21</em>(6), 1087–1092. <a href="https://doi.org/10.1063/1.1699114">https://doi.org/10.1063/1.1699114</a>
</div>
<div id="ref-plummerCODA2006" class="csl-entry">
Plummer, M., Best, N., Cowles, K., &amp; Vines, K. (2006). <span>CODA</span>: <span>Convergence</span> diagnosis and output analysis for <span>MCMC</span>. <em>R News</em>, <em>6</em>(1), 7–11. <a href="https://journal.r-project.org/archive/">https://journal.r-project.org/archive/</a>
</div>
<div id="ref-R-coda" class="csl-entry">
Plummer, M., Best, N., Cowles, K., Vines, K., Sarkar, D., Bates, D., Almond, R., &amp; Magnusson, A. (2020). <em><span class="nocase">coda</span>: <span>Output</span> analysis and diagnostics for <span>MCMC</span></em> [Manual]. <a href="https://CRAN.R-project.org/package=coda">https://CRAN.R-project.org/package=coda</a>
</div>
<div id="ref-R-psych" class="csl-entry">
Revelle, W. (2022). <em><span class="nocase">psych</span>: <span>Procedures</span> for psychological, psychometric, and personality research</em>. <a href="https://CRAN.R-project.org/package=psych">https://CRAN.R-project.org/package=psych</a>
</div>
<div id="ref-standevelopmentteamAccessingContentsStanfit2022" class="csl-entry">
Stan Development Team. (2022a). <em>Accessing the contents of a stanfit object</em>. <a href="https://CRAN.R-project.org/package=rstan/vignettes/stanfit-objects.html">https://CRAN.R-project.org/package=rstan/vignettes/stanfit-objects.html</a>
</div>
<div id="ref-standevelopmentteamStanReferenceManual2022" class="csl-entry">
Stan Development Team. (2022b). <em>Stan reference manual, <span>Version</span> 2.31</em>. <a href="https://mc-stan.org/docs/reference-manual/index.html">https://mc-stan.org/docs/reference-manual/index.html</a>
</div>
<div id="ref-vehtariRanknormalizationFoldingLocalization2021" class="csl-entry">
Vehtari, A., Gelman, A., Simpson, D., Carpenter, B., &amp; Bürkner, P.-C. (2021). Rank-normalization, folding, and localization: <span>An</span> improved <span><span class="math inline">\(\widehat{R}\)</span></span> for assessing convergence of <span>MCMC</span> (with <span>Discussion</span>). <em>Bayesian Analysis</em>, <em>16</em>(2), 667–718. <a href="https://doi.org/10.1214/20-BA1221">https://doi.org/10.1214/20-BA1221</a>
</div>
<div id="ref-Wilke2020Themes" class="csl-entry">
Wilke, C. O. (2020a). <em>Themes</em>. <a href="https://wilkelab.org/cowplot/articles/themes.html">https://wilkelab.org/cowplot/articles/themes.html</a>
</div>
<div id="ref-wilkeFundamentalsDataVisualization2019" class="csl-entry">
Wilke, C. O. (2019). <em>Fundamentals of data visualization</em>. <a href="https://clauswilke.com/dataviz/">https://clauswilke.com/dataviz/</a>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>We will get a proper introduction to the binomial probability distribution in <a href="null-hypothesis-significance-testing.html#with-intention-to-fix-n.">Section 11.1.2</a>.<a href="markov-chain-monte-carlo.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Kruschke briefly addressed this in his footnote #2 in Section 6.2 (p. 126). We will connect the Bernoulli and binomial approaches more fully in <a href="dichotomous-predicted-variable.html#dichotomous-predicted-variable">Chapter 21</a>.<a href="markov-chain-monte-carlo.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="jags-brms.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
