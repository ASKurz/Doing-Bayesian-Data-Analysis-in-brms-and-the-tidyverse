<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>24 Count Predicted Variable | Doing Bayesian Data Analysis in brms and the tidyverse</title>
  <meta name="description" content="This project is an attempt to re-express the code in Kruschke’s (2015) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="24 Count Predicted Variable | Doing Bayesian Data Analysis in brms and the tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This project is an attempt to re-express the code in Kruschke’s (2015) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  <meta name="github-repo" content="ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="24 Count Predicted Variable | Doing Bayesian Data Analysis in brms and the tidyverse" />
  <meta name="twitter:site" content="@SolomonKurz" />
  <meta name="twitter:description" content="This project is an attempt to re-express the code in Kruschke’s (2015) textbook. His models are re-fit in brms, plots are redone with ggplot2, and the general data wrangling code predominantly follows the tidyverse style." />
  

<meta name="author" content="A Solomon Kurz" />


<meta name="date" content="2020-05-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ordinal-predicted-variable.html"/>
<link rel="next" href="tools-in-the-trunk.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>What and why</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#we-have-updates"><i class="fa fa-check"></i>We have updates</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.1.0."><i class="fa fa-check"></i>Version 0.1.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#version-0.2.0."><i class="fa fa-check"></i>Version 0.2.0.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#were-not-done-yet-and-i-could-use-your-help."><i class="fa fa-check"></i>We’re not done yet and I could use your help.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#you-can-do-this-too"><i class="fa fa-check"></i>You can do this, too</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#thank-yous-are-in-order"><i class="fa fa-check"></i>Thank-you’s are in order</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html"><i class="fa fa-check"></i><b>1</b> What’s in This Book (Read This First!)</a><ul>
<li class="chapter" data-level="1.1" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#real-people-can-read-this-book"><i class="fa fa-check"></i><b>1.1</b> Real people can read this book</a></li>
<li class="chapter" data-level="1.2" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#whats-in-this-book"><i class="fa fa-check"></i><b>1.2</b> What’s in this book</a></li>
<li class="chapter" data-level="1.3" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#whats-new-in-the-second-edition"><i class="fa fa-check"></i><b>1.3</b> What’s new in the second edition</a></li>
<li class="chapter" data-level="1.4" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#gimme-feedback-be-polite"><i class="fa fa-check"></i><b>1.4</b> Gimme feedback (be polite)</a></li>
<li class="chapter" data-level="1.5" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#thank-you"><i class="fa fa-check"></i><b>1.5</b> Thank you!</a></li>
<li class="chapter" data-level="" data-path="whats-in-this-book-read-this-first.html"><a href="whats-in-this-book-read-this-first.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html"><i class="fa fa-check"></i><b>2</b> Introduction: Credibility, Models, and Parameters</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#bayesian-inference-is-reallocation-of-credibility-across-possibilities"><i class="fa fa-check"></i><b>2.1</b> Bayesian inference is reallocation of credibility across possibilities</a><ul>
<li class="chapter" data-level="2.1.1" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#data-are-noisy-and-inferences-are-probabilistic."><i class="fa fa-check"></i><b>2.1.1</b> Data are noisy and inferences are probabilistic.</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#possibilities-are-parameter-values-in-descriptive-models"><i class="fa fa-check"></i><b>2.2</b> Possibilities are parameter values in descriptive models</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#the-steps-of-bayesian-data-analysis"><i class="fa fa-check"></i><b>2.3</b> The steps of Bayesian data analysis</a></li>
<li class="chapter" data-level="" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#session-info-1"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html"><i class="fa fa-check"></i><b>3</b> The R Programming Language</a><ul>
<li class="chapter" data-level="3.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#get-the-software"><i class="fa fa-check"></i><b>3.1</b> Get the software</a><ul>
<li class="chapter" data-level="3.1.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#a-look-at-rstudio."><i class="fa fa-check"></i><b>3.1.1</b> A look at RStudio.</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#a-simple-example-of-r-in-action"><i class="fa fa-check"></i><b>3.2</b> A simple example of R in action</a><ul>
<li class="chapter" data-level="3.2.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#get-the-programs-used-with-this-book."><i class="fa fa-check"></i><b>3.2.1</b> Get the programs used with this book.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#basic-commands-and-operators-in-r"><i class="fa fa-check"></i><b>3.3</b> Basic commands and operators in R</a><ul>
<li class="chapter" data-level="3.3.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#getting-help-in-r."><i class="fa fa-check"></i><b>3.3.1</b> Getting help in R.</a></li>
<li class="chapter" data-level="3.3.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#arithmetic-and-logical-operators."><i class="fa fa-check"></i><b>3.3.2</b> Arithmetic and logical operators.</a></li>
<li class="chapter" data-level="3.3.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#assignment-relational-operators-and-tests-of-equality."><i class="fa fa-check"></i><b>3.3.3</b> Assignment, relational operators, and tests of equality.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#variable-types"><i class="fa fa-check"></i><b>3.4</b> Variable types</a><ul>
<li class="chapter" data-level="3.4.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#vector."><i class="fa fa-check"></i><b>3.4.1</b> Vector.</a></li>
<li class="chapter" data-level="3.4.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#factor."><i class="fa fa-check"></i><b>3.4.2</b> Factor.</a></li>
<li class="chapter" data-level="3.4.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#matrix-and-array."><i class="fa fa-check"></i><b>3.4.3</b> Matrix and array.</a></li>
<li class="chapter" data-level="3.4.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#list-and-data-frame."><i class="fa fa-check"></i><b>3.4.4</b> List and data frame.</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#loading-and-saving-data"><i class="fa fa-check"></i><b>3.5</b> Loading and saving data</a><ul>
<li class="chapter" data-level="3.5.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#the-read.csv-read_csv-and-read.table-read_table-functions."><i class="fa fa-check"></i><b>3.5.1</b> The <del>read.csv</del> <code>read_csv()</code> and <del>read.table</del> <code>read_table()</code> functions.</a></li>
<li class="chapter" data-level="3.5.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#saving-data-from-r."><i class="fa fa-check"></i><b>3.5.2</b> Saving data from R.</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#some-utility-functions"><i class="fa fa-check"></i><b>3.6</b> Some utility functions</a></li>
<li class="chapter" data-level="3.7" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#programming-in-r"><i class="fa fa-check"></i><b>3.7</b> Programming in R</a><ul>
<li class="chapter" data-level="3.7.1" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#variable-names-in-r."><i class="fa fa-check"></i><b>3.7.1</b> Variable names in R.</a></li>
<li class="chapter" data-level="3.7.2" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#running-a-program."><i class="fa fa-check"></i><b>3.7.2</b> Running a program.</a></li>
<li class="chapter" data-level="3.7.3" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#programming-a-function."><i class="fa fa-check"></i><b>3.7.3</b> Programming a function.</a></li>
<li class="chapter" data-level="3.7.4" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#conditions-and-loops."><i class="fa fa-check"></i><b>3.7.4</b> Conditions and loops.</a></li>
<li class="chapter" data-level="3.7.5" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#measuring-processing-time."><i class="fa fa-check"></i><b>3.7.5</b> Measuring processing time.</a></li>
<li class="chapter" data-level="3.7.6" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#debugging."><i class="fa fa-check"></i><b>3.7.6</b> Debugging.</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#graphical-plots-opening-and-saving"><i class="fa fa-check"></i><b>3.8</b> Graphical plots: Opening and saving</a></li>
<li class="chapter" data-level="" data-path="the-r-programming-language.html"><a href="the-r-programming-language.html#session-info-2"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html"><i class="fa fa-check"></i><b>4</b> What is This Stuff Called Probability?</a><ul>
<li class="chapter" data-level="4.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#the-set-of-all-possible-events"><i class="fa fa-check"></i><b>4.1</b> The set of all possible events</a></li>
<li class="chapter" data-level="4.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probability-outside-or-inside-the-head"><i class="fa fa-check"></i><b>4.2</b> Probability: Outside or inside the head</a><ul>
<li class="chapter" data-level="4.2.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#outside-the-head-long-run-relative-frequency."><i class="fa fa-check"></i><b>4.2.1</b> Outside the head: Long-run relative frequency.</a></li>
<li class="chapter" data-level="4.2.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#inside-the-head-subjective-belief."><i class="fa fa-check"></i><b>4.2.2</b> Inside the head: Subjective belief.</a></li>
<li class="chapter" data-level="4.2.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probabilities-assign-numbers-to-possibilities."><i class="fa fa-check"></i><b>4.2.3</b> Probabilities assign numbers to possibilities.</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#probability-distributions"><i class="fa fa-check"></i><b>4.3</b> Probability distributions</a><ul>
<li class="chapter" data-level="4.3.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#discrete-distributions-probability-mass."><i class="fa fa-check"></i><b>4.3.1</b> Discrete distributions: Probability mass.</a></li>
<li class="chapter" data-level="4.3.2" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#continuous-distributions-rendezvous-with-density."><i class="fa fa-check"></i><b>4.3.2</b> Continuous distributions: Rendezvous with density.</a></li>
<li class="chapter" data-level="4.3.3" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#mean-and-variance-of-a-distribution."><i class="fa fa-check"></i><b>4.3.3</b> Mean and variance of a distribution.</a></li>
<li class="chapter" data-level="4.3.4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#highest-density-interval-hdi."><i class="fa fa-check"></i><b>4.3.4</b> Highest density interval (HDI).</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#two-way-distributions"><i class="fa fa-check"></i><b>4.4</b> Two-way distributions</a><ul>
<li class="chapter" data-level="4.4.1" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#conditional-probability."><i class="fa fa-check"></i><b>4.4.1</b> Conditional probability.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="what-is-this-stuff-called-probability.html"><a href="what-is-this-stuff-called-probability.html#session-info-3"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bayes-rule.html"><a href="bayes-rule.html"><i class="fa fa-check"></i><b>5</b> Bayes’ Rule</a><ul>
<li class="chapter" data-level="5.1" data-path="bayes-rule.html"><a href="bayes-rule.html#bayes-rule-1"><i class="fa fa-check"></i><b>5.1</b> Bayes’ rule</a><ul>
<li class="chapter" data-level="5.1.1" data-path="bayes-rule.html"><a href="bayes-rule.html#derived-from-definitions-of-conditional-probability."><i class="fa fa-check"></i><b>5.1.1</b> Derived from definitions of conditional probability.</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="bayes-rule.html"><a href="bayes-rule.html#applied-to-parameters-and-data"><i class="fa fa-check"></i><b>5.2</b> Applied to parameters and data</a></li>
<li class="chapter" data-level="5.3" data-path="bayes-rule.html"><a href="bayes-rule.html#complete-examples-estimating-bias-in-a-coin"><i class="fa fa-check"></i><b>5.3</b> Complete examples: Estimating bias in a coin</a><ul>
<li class="chapter" data-level="5.3.1" data-path="bayes-rule.html"><a href="bayes-rule.html#influence-of-sample-size-on-the-posterior."><i class="fa fa-check"></i><b>5.3.1</b> Influence of sample size on the posterior.</a></li>
<li class="chapter" data-level="5.3.2" data-path="bayes-rule.html"><a href="bayes-rule.html#influence-of-prior-on-the-posterior."><i class="fa fa-check"></i><b>5.3.2</b> Influence of prior on the posterior.</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="bayes-rule.html"><a href="bayes-rule.html#why-bayesian-inference-can-be-difficult"><i class="fa fa-check"></i><b>5.4</b> Why Bayesian inference can be difficult</a></li>
<li class="chapter" data-level="" data-path="bayes-rule.html"><a href="bayes-rule.html#session-info-4"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><i class="fa fa-check"></i><b>6</b> Inferring a Binomial Probability via Exact Mathematical Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#the-likelihood-function-the-bernoulli-distribution"><i class="fa fa-check"></i><b>6.1</b> The likelihood function: The Bernoulli distribution</a></li>
<li class="chapter" data-level="6.2" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#a-description-of-credibilities-the-beta-distribution"><i class="fa fa-check"></i><b>6.2</b> A description of credibilities: The beta distribution</a><ul>
<li class="chapter" data-level="6.2.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#specifying-a-beta-prior."><i class="fa fa-check"></i><b>6.2.1</b> Specifying a beta prior.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#the-posterior-beta"><i class="fa fa-check"></i><b>6.3</b> The posterior beta</a><ul>
<li class="chapter" data-level="6.3.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#posterior-is-compromise-of-prior-and-likelihood."><i class="fa fa-check"></i><b>6.3.1</b> Posterior is compromise of prior and likelihood.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#examples"><i class="fa fa-check"></i><b>6.4</b> Examples</a><ul>
<li class="chapter" data-level="6.4.1" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#prior-knowledge-expressed-as-a-beta-distribution."><i class="fa fa-check"></i><b>6.4.1</b> Prior knowledge expressed as a beta distribution.</a></li>
<li class="chapter" data-level="6.4.2" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#prior-knowledge-that-cannot-be-expressed-as-a-beta-distribution."><i class="fa fa-check"></i><b>6.4.2</b> Prior knowledge that cannot be expressed as a beta distribution.</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#summary"><i class="fa fa-check"></i><b>6.5</b> Summary</a></li>
<li class="chapter" data-level="" data-path="inferring-a-binomial-probability-via-exact-mathematical-analysis.html"><a href="inferring-a-binomial-probability-via-exact-mathematical-analysis.html#session-info-5"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>7</b> Markov Chain Monte Carlo</a><ul>
<li class="chapter" data-level="7.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#approximating-a-distribution-with-a-large-sample"><i class="fa fa-check"></i><b>7.1</b> Approximating a distribution with a large sample</a></li>
<li class="chapter" data-level="7.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-simple-case-of-the-metropolis-algorithm"><i class="fa fa-check"></i><b>7.2</b> A simple case of the Metropolis algorithm</a><ul>
<li class="chapter" data-level="7.2.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-politician-stumbles-upon-the-metropolis-algorithm."><i class="fa fa-check"></i><b>7.2.1</b> A politician stumbles upon the Metropolis algorithm.</a></li>
<li class="chapter" data-level="7.2.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#a-random-walk."><i class="fa fa-check"></i><b>7.2.2</b> A random walk.</a></li>
<li class="chapter" data-level="7.2.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#general-properties-of-a-random-walk."><i class="fa fa-check"></i><b>7.2.3</b> General properties of a random walk.</a></li>
<li class="chapter" data-level="7.2.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#why-we-care."><i class="fa fa-check"></i><b>7.2.4</b> Why we care.</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-metropolis-algorithm-more-generally"><i class="fa fa-check"></i><b>7.3</b> The Metropolis algorithm more generally</a><ul>
<li class="chapter" data-level="7.3.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#metropolis-algorithm-applied-to-bernoulli-likelihood-and-beta-prior."><i class="fa fa-check"></i><b>7.3.1</b> Metropolis algorithm applied to Bernoulli likelihood and beta prior.</a></li>
<li class="chapter" data-level="7.3.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#summary-of-metropolis-algorithm."><i class="fa fa-check"></i><b>7.3.2</b> Summary of Metropolis algorithm.</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#toward-gibbs-sampling-estimating-two-coin-biases"><i class="fa fa-check"></i><b>7.4</b> Toward Gibbs sampling: Estimating two coin biases</a><ul>
<li class="chapter" data-level="7.4.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#prior-likelihood-and-posterior-for-two-biases."><i class="fa fa-check"></i><b>7.4.1</b> Prior, likelihood and posterior for two biases.</a></li>
<li class="chapter" data-level="7.4.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-posterior-via-exact-formal-analysis."><i class="fa fa-check"></i><b>7.4.2</b> The posterior via exact formal analysis.</a></li>
<li class="chapter" data-level="7.4.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#the-posterior-via-the-metropolis-algorithm."><i class="fa fa-check"></i><b>7.4.3</b> The posterior via the Metropolis algorithm.</a></li>
<li class="chapter" data-level="7.4.4" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#gibbs-hamiltonian-monte-carlo-sampling."><i class="fa fa-check"></i><b>7.4.4</b> <del>Gibbs</del> Hamiltonian Monte Carlo sampling.</a></li>
<li class="chapter" data-level="7.4.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#is-there-a-difference-between-biases"><i class="fa fa-check"></i><b>7.4.5</b> Is there a difference between biases?</a></li>
<li class="chapter" data-level="7.4.6" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#terminology-mcmc."><i class="fa fa-check"></i><b>7.4.6</b> Terminology: MCMC.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-representativeness-accuracy-and-efficiency"><i class="fa fa-check"></i><b>7.5</b> MCMC representativeness, accuracy, and efficiency</a><ul>
<li class="chapter" data-level="7.5.1" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-representativeness."><i class="fa fa-check"></i><b>7.5.1</b> MCMC representativeness.</a></li>
<li class="chapter" data-level="7.5.2" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-accuracy."><i class="fa fa-check"></i><b>7.5.2</b> MCMC accuracy.</a></li>
<li class="chapter" data-level="7.5.3" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#mcmc-efficiency."><i class="fa fa-check"></i><b>7.5.3</b> MCMC efficiency.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov-chain-monte-carlo.html"><a href="markov-chain-monte-carlo.html#session-info-6"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="jags-brms.html"><a href="jags-brms.html"><i class="fa fa-check"></i><b>8</b> <del>JAGS</del> brms</a><ul>
<li class="chapter" data-level="8.1" data-path="jags-brms.html"><a href="jags-brms.html#jags-brms-and-its-relation-to-r"><i class="fa fa-check"></i><b>8.1</b> <del>JAGS</del> brms and its relation to R</a></li>
<li class="chapter" data-level="8.2" data-path="jags-brms.html"><a href="jags-brms.html#a-complete-example"><i class="fa fa-check"></i><b>8.2</b> A complete example</a><ul>
<li class="chapter" data-level="8.2.1" data-path="jags-brms.html"><a href="jags-brms.html#load-data."><i class="fa fa-check"></i><b>8.2.1</b> Load data.</a></li>
<li class="chapter" data-level="8.2.2" data-path="jags-brms.html"><a href="jags-brms.html#specify-model."><i class="fa fa-check"></i><b>8.2.2</b> Specify model.</a></li>
<li class="chapter" data-level="8.2.3" data-path="jags-brms.html"><a href="jags-brms.html#initialize-chains."><i class="fa fa-check"></i><b>8.2.3</b> Initialize chains.</a></li>
<li class="chapter" data-level="8.2.4" data-path="jags-brms.html"><a href="jags-brms.html#generate-chains."><i class="fa fa-check"></i><b>8.2.4</b> Generate chains.</a></li>
<li class="chapter" data-level="8.2.5" data-path="jags-brms.html"><a href="jags-brms.html#examine-chains."><i class="fa fa-check"></i><b>8.2.5</b> Examine chains.</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="jags-brms.html"><a href="jags-brms.html#simplified-scripts-for-frequently-used-analyses"><i class="fa fa-check"></i><b>8.3</b> Simplified scripts for frequently used analyses</a></li>
<li class="chapter" data-level="8.4" data-path="jags-brms.html"><a href="jags-brms.html#example-difference-of-biases"><i class="fa fa-check"></i><b>8.4</b> Example: Difference of biases</a></li>
<li class="chapter" data-level="8.5" data-path="jags-brms.html"><a href="jags-brms.html#sampling-from-the-prior-distribution-in-jags-brms"><i class="fa fa-check"></i><b>8.5</b> Sampling from the prior distribution in <del>JAGS</del> brms</a></li>
<li class="chapter" data-level="8.6" data-path="jags-brms.html"><a href="jags-brms.html#probability-distributions-available-in-jags-brms"><i class="fa fa-check"></i><b>8.6</b> Probability distributions available in <del>JAGS</del> brms</a><ul>
<li class="chapter" data-level="8.6.1" data-path="jags-brms.html"><a href="jags-brms.html#defining-new-likelihood-functions."><i class="fa fa-check"></i><b>8.6.1</b> Defining new likelihood functions.</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="jags-brms.html"><a href="jags-brms.html#faster-sampling-with-parallel-processing-in-runjags-brmsbrm"><i class="fa fa-check"></i><b>8.7</b> Faster sampling with parallel processing in <del>runjags</del> <code>brms::brm()</code></a></li>
<li class="chapter" data-level="8.8" data-path="jags-brms.html"><a href="jags-brms.html#tips-for-expanding-jags-brms-models"><i class="fa fa-check"></i><b>8.8</b> Tips for expanding <del>JAGS</del> brms models</a></li>
<li class="chapter" data-level="" data-path="jags-brms.html"><a href="jags-brms.html#session-info-7"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="hierarchical-models.html"><a href="hierarchical-models.html"><i class="fa fa-check"></i><b>9</b> Hierarchical Models</a><ul>
<li class="chapter" data-level="9.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-single-coin-from-a-single-mint"><i class="fa fa-check"></i><b>9.1</b> A single coin from a single mint</a><ul>
<li class="chapter" data-level="9.1.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#posterior-via-grid-approximation."><i class="fa fa-check"></i><b>9.1.1</b> Posterior via grid approximation.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#multiple-coins-from-a-single-mint"><i class="fa fa-check"></i><b>9.2</b> Multiple coins from a single mint</a><ul>
<li class="chapter" data-level="9.2.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#posterior-via-grid-approximation.-1"><i class="fa fa-check"></i><b>9.2.1</b> Posterior via grid approximation.</a></li>
<li class="chapter" data-level="9.2.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-realistic-model-with-mcmc."><i class="fa fa-check"></i><b>9.2.2</b> A realistic model with MCMC.</a></li>
<li class="chapter" data-level="9.2.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#doing-it-with-jags-brms."><i class="fa fa-check"></i><b>9.2.3</b> Doing it with <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="9.2.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-therapeutic-touch."><i class="fa fa-check"></i><b>9.2.4</b> Example: Therapeutic touch.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#shrinkage-in-hierarchical-models"><i class="fa fa-check"></i><b>9.3</b> Shrinkage in hierarchical models</a></li>
<li class="chapter" data-level="9.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#speeding-up-jags-brms"><i class="fa fa-check"></i><b>9.4</b> Speeding up <del>JAGS</del> brms</a></li>
<li class="chapter" data-level="9.5" data-path="hierarchical-models.html"><a href="hierarchical-models.html#extending-the-hierarchy-subjects-within-categories"><i class="fa fa-check"></i><b>9.5</b> Extending the hierarchy: Subjects within categories</a><ul>
<li class="chapter" data-level="9.5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-baseball-batting-abilities-by-position."><i class="fa fa-check"></i><b>9.5.1</b> Example: Baseball batting abilities by position.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hierarchical-models.html"><a href="hierarchical-models.html#session-info-8"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html"><i class="fa fa-check"></i><b>10</b> Model Comparison and Hierarchical Modeling</a><ul>
<li class="chapter" data-level="10.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#general-formula-and-the-bayes-factor"><i class="fa fa-check"></i><b>10.1</b> General formula and the Bayes factor</a></li>
<li class="chapter" data-level="10.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#example-two-factories-of-coins"><i class="fa fa-check"></i><b>10.2</b> Example: Two factories of coins</a><ul>
<li class="chapter" data-level="10.2.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-formal-analysis."><i class="fa fa-check"></i><b>10.2.1</b> Solution by formal analysis.</a></li>
<li class="chapter" data-level="10.2.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-grid-approximation."><i class="fa fa-check"></i><b>10.2.2</b> Solution by grid approximation.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#solution-by-mcmc"><i class="fa fa-check"></i><b>10.3</b> Solution by MCMC</a><ul>
<li class="chapter" data-level="10.3.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#nonhierarchical-mcmc-computation-of-each-models-marginal-likelihood."><i class="fa fa-check"></i><b>10.3.1</b> Nonhierarchical MCMC computation of each model’s marginal likelihood.</a></li>
<li class="chapter" data-level="10.3.2" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#hierarchical-mcmc-computation-of-relative-model-probability-is-not-available-in-brms-well-cover-information-criteria-instead."><i class="fa fa-check"></i><b>10.3.2</b> Hierarchical MCMC computation <del>of relative model probability</del> is not available in brms: We’ll cover information criteria instead.</a></li>
<li class="chapter" data-level="10.3.3" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#models-with-different-noise-distributions-in-jags-brms."><i class="fa fa-check"></i><b>10.3.3</b> Models with different “noise” distributions in <del>JAGS</del> brms.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#prediction-model-averaging"><i class="fa fa-check"></i><b>10.4</b> Prediction: Model averaging</a></li>
<li class="chapter" data-level="10.5" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#model-complexity-naturally-accounted-for"><i class="fa fa-check"></i><b>10.5</b> Model complexity naturally accounted for</a><ul>
<li class="chapter" data-level="10.5.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#caveats-regarding-nested-model-comparison."><i class="fa fa-check"></i><b>10.5.1</b> Caveats regarding nested model comparison.</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#extreme-sensitivity-to-the-prior-distribution"><i class="fa fa-check"></i><b>10.6</b> Extreme sensitivity to the prior distribution</a><ul>
<li class="chapter" data-level="10.6.1" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#priors-of-different-models-should-be-equally-informed."><i class="fa fa-check"></i><b>10.6.1</b> Priors of different models should be equally informed.</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#bonus-theres-danger-ahead"><i class="fa fa-check"></i><b>10.7</b> Bonus: There’s danger ahead</a></li>
<li class="chapter" data-level="" data-path="model-comparison-and-hierarchical-modeling.html"><a href="model-comparison-and-hierarchical-modeling.html#session-info-9"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html"><i class="fa fa-check"></i><b>11</b> Null Hypothesis Significance Testing</a><ul>
<li class="chapter" data-level="11.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#paved-with-good-intentions"><i class="fa fa-check"></i><b>11.1</b> Paved with good intentions</a><ul>
<li class="chapter" data-level="11.1.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#definition-of-p-value."><i class="fa fa-check"></i><b>11.1.1</b> Definition of <span class="math inline">\(p\)</span> value.</a></li>
<li class="chapter" data-level="11.1.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-fix-n."><i class="fa fa-check"></i><b>11.1.2</b> With intention to fix <span class="math inline">\(N\)</span>.</a></li>
<li class="chapter" data-level="11.1.3" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-fix-z."><i class="fa fa-check"></i><b>11.1.3</b> With intention to fix <span class="math inline">\(z\)</span>.</a></li>
<li class="chapter" data-level="11.1.4" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-fix-duration."><i class="fa fa-check"></i><b>11.1.4</b> With intention to fix duration.</a></li>
<li class="chapter" data-level="11.1.5" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#with-intention-to-make-multiple-tests."><i class="fa fa-check"></i><b>11.1.5</b> With intention to make multiple tests.</a></li>
<li class="chapter" data-level="11.1.6" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#soul-searching."><i class="fa fa-check"></i><b>11.1.6</b> Soul searching.</a></li>
<li class="chapter" data-level="11.1.7" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#bayesian-analysis."><i class="fa fa-check"></i><b>11.1.7</b> Bayesian analysis.</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#prior-knowledge"><i class="fa fa-check"></i><b>11.2</b> Prior knowledge</a><ul>
<li class="chapter" data-level="11.2.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#nhst-analysis."><i class="fa fa-check"></i><b>11.2.1</b> NHST analysis.</a></li>
<li class="chapter" data-level="11.2.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#bayesian-analysis.-1"><i class="fa fa-check"></i><b>11.2.2</b> Bayesian analysis.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#confidence-interval-and-highest-density-interval"><i class="fa fa-check"></i><b>11.3</b> Confidence interval and highest density interval</a><ul>
<li class="chapter" data-level="11.3.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#ci-depends-on-intention."><i class="fa fa-check"></i><b>11.3.1</b> CI depends on intention.</a></li>
<li class="chapter" data-level="11.3.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#bayesian-hdi."><i class="fa fa-check"></i><b>11.3.2</b> Bayesian HDI.</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#multiple-comparisons"><i class="fa fa-check"></i><b>11.4</b> Multiple comparisons</a><ul>
<li class="chapter" data-level="11.4.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#nhst-correction-for-experiment-wise-error."><i class="fa fa-check"></i><b>11.4.1</b> NHST correction for experiment wise error.</a></li>
<li class="chapter" data-level="11.4.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#just-one-bayesian-posterior-no-matter-how-you-look-at-it."><i class="fa fa-check"></i><b>11.4.2</b> Just one Bayesian posterior no matter how you look at it.</a></li>
<li class="chapter" data-level="11.4.3" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#how-bayesian-analysis-mitigates-false-alarms."><i class="fa fa-check"></i><b>11.4.3</b> How Bayesian analysis mitigates false alarms.</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#what-a-sampling-distribution-is-good-for"><i class="fa fa-check"></i><b>11.5</b> What a sampling distribution is good for</a><ul>
<li class="chapter" data-level="11.5.1" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#planning-an-experiment."><i class="fa fa-check"></i><b>11.5.1</b> Planning an experiment.</a></li>
<li class="chapter" data-level="11.5.2" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#exploring-model-predictions-posterior-predictive-check."><i class="fa fa-check"></i><b>11.5.2</b> Exploring model predictions (posterior predictive check).</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="null-hypothesis-significance-testing.html"><a href="null-hypothesis-significance-testing.html#session-info-10"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><i class="fa fa-check"></i><b>12</b> Bayesian Approaches to Testing a Point (“Null”) Hypothesis</a><ul>
<li class="chapter" data-level="12.1" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#the-estimation-approach"><i class="fa fa-check"></i><b>12.1</b> The estimation approach</a><ul>
<li class="chapter" data-level="12.1.1" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#region-of-practical-equivalence."><i class="fa fa-check"></i><b>12.1.1</b> Region of practical equivalence.</a></li>
<li class="chapter" data-level="12.1.2" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#some-examples."><i class="fa fa-check"></i><b>12.1.2</b> Some examples.</a></li>
<li class="chapter" data-level="12.1.3" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#differences-of-correlated-parameters."><i class="fa fa-check"></i><b>12.1.3</b> Differences of correlated parameters.</a></li>
<li class="chapter" data-level="12.1.4" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#why-hdi-and-not-equal-tailed-interval"><i class="fa fa-check"></i><b>12.1.4</b> Why HDI and not equal-tailed interval?</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#the-model-comparison-approach"><i class="fa fa-check"></i><b>12.2</b> The model-comparison approach</a><ul>
<li class="chapter" data-level="12.2.1" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#is-a-coin-fair-or-not"><i class="fa fa-check"></i><b>12.2.1</b> Is a coin fair or not?</a></li>
<li class="chapter" data-level="12.2.2" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#bayes-factor-can-accept-null-with-poor-precision."><i class="fa fa-check"></i><b>12.2.2</b> Bayes’ factor can accept null with poor precision.</a></li>
<li class="chapter" data-level="12.2.3" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#are-different-groups-equal-or-not"><i class="fa fa-check"></i><b>12.2.3</b> Are different groups equal or not?</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#relations-of-parameter-estimation-and-model-comparison"><i class="fa fa-check"></i><b>12.3</b> Relations of parameter estimation and model comparison</a></li>
<li class="chapter" data-level="12.4" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#estimation-and-model-comparison"><i class="fa fa-check"></i><b>12.4</b> Estimation and model comparison?</a></li>
<li class="chapter" data-level="" data-path="bayesian-approaches-to-testing-a-point-null-hypothesis.html"><a href="bayesian-approaches-to-testing-a-point-null-hypothesis.html#session-info-11"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html"><i class="fa fa-check"></i><b>13</b> Goals, Power, and Sample Size</a><ul>
<li class="chapter" data-level="13.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#the-will-to-power"><i class="fa fa-check"></i><b>13.1</b> The will to power</a><ul>
<li class="chapter" data-level="13.1.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#goals-and-obstacles."><i class="fa fa-check"></i><b>13.1.1</b> Goals and obstacles.</a></li>
<li class="chapter" data-level="13.1.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power."><i class="fa fa-check"></i><b>13.1.2</b> Power.</a></li>
<li class="chapter" data-level="13.1.3" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#sample-size."><i class="fa fa-check"></i><b>13.1.3</b> Sample size.</a></li>
<li class="chapter" data-level="13.1.4" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#other-expressions-of-goals."><i class="fa fa-check"></i><b>13.1.4</b> Other expressions of goals.</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#computing-power-and-sample-size"><i class="fa fa-check"></i><b>13.2</b> Computing power and sample size</a><ul>
<li class="chapter" data-level="13.2.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#when-the-goal-is-to-exclude-a-null-value."><i class="fa fa-check"></i><b>13.2.1</b> When the goal is to exclude a null value.</a></li>
<li class="chapter" data-level="13.2.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#formal-solution-and-implementation-in-r."><i class="fa fa-check"></i><b>13.2.2</b> Formal solution and implementation in R.</a></li>
<li class="chapter" data-level="13.2.3" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#when-the-goal-is-precision."><i class="fa fa-check"></i><b>13.2.3</b> When the goal is precision.</a></li>
<li class="chapter" data-level="13.2.4" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#monte-carlo-approximation-of-power."><i class="fa fa-check"></i><b>13.2.4</b> Monte Carlo approximation of power.</a></li>
<li class="chapter" data-level="13.2.5" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power-from-idealized-or-actual-data."><i class="fa fa-check"></i><b>13.2.5</b> Power from idealized or actual data.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#sequential-testing-and-the-goal-of-precision"><i class="fa fa-check"></i><b>13.3</b> Sequential testing and the goal of precision</a><ul>
<li class="chapter" data-level="13.3.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#examples-ofsequential-tests."><i class="fa fa-check"></i><b>13.3.1</b> Examples ofsequential tests.</a></li>
<li class="chapter" data-level="13.3.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#average-behavior-of-sequential-tests."><i class="fa fa-check"></i><b>13.3.2</b> Average behavior of sequential tests.</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#discussion"><i class="fa fa-check"></i><b>13.4</b> Discussion</a><ul>
<li class="chapter" data-level="13.4.1" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power-and-multiple-comparisons."><i class="fa fa-check"></i><b>13.4.1</b> Power and multiple comparisons.</a></li>
<li class="chapter" data-level="13.4.2" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power-prospective-retrospective-and-replication."><i class="fa fa-check"></i><b>13.4.2</b> Power: prospective, retrospective, and replication.</a></li>
<li class="chapter" data-level="13.4.3" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#power-analysis-requires-verisimilitude-of-simulated-data."><i class="fa fa-check"></i><b>13.4.3</b> Power analysis requires verisimilitude of simulated data.</a></li>
<li class="chapter" data-level="13.4.4" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#the-importance-of-planning."><i class="fa fa-check"></i><b>13.4.4</b> The importance of planning.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="goals-power-and-sample-size.html"><a href="goals-power-and-sample-size.html#session-info-12"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="stan.html"><a href="stan.html"><i class="fa fa-check"></i><b>14</b> Stan</a><ul>
<li class="chapter" data-level="14.1" data-path="stan.html"><a href="stan.html#hmc-sampling"><i class="fa fa-check"></i><b>14.1</b> HMC sampling</a></li>
<li class="chapter" data-level="14.2" data-path="stan.html"><a href="stan.html#installing-stan"><i class="fa fa-check"></i><b>14.2</b> Installing Stan</a></li>
<li class="chapter" data-level="14.3" data-path="stan.html"><a href="stan.html#a-complete-example-1"><i class="fa fa-check"></i><b>14.3</b> A Complete example</a><ul>
<li class="chapter" data-level="14.3.1" data-path="stan.html"><a href="stan.html#reusing-the-compiled-model."><i class="fa fa-check"></i><b>14.3.1</b> Reusing the compiled model.</a></li>
<li class="chapter" data-level="14.3.2" data-path="stan.html"><a href="stan.html#general-structure-of-stan-model-specification."><i class="fa fa-check"></i><b>14.3.2</b> General structure of Stan model specification.</a></li>
<li class="chapter" data-level="14.3.3" data-path="stan.html"><a href="stan.html#think-log-probability-to-think-like-stan."><i class="fa fa-check"></i><b>14.3.3</b> Think log probability to think like Stan.</a></li>
<li class="chapter" data-level="14.3.4" data-path="stan.html"><a href="stan.html#sampling-the-prior-in-stan."><i class="fa fa-check"></i><b>14.3.4</b> Sampling the prior in Stan.</a></li>
<li class="chapter" data-level="14.3.5" data-path="stan.html"><a href="stan.html#simplified-scripts-for-frequently-used-analyses."><i class="fa fa-check"></i><b>14.3.5</b> Simplified scripts for frequently used analyses.</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="stan.html"><a href="stan.html#specify-models-top-down-in-stan"><i class="fa fa-check"></i><b>14.4</b> Specify models top-down in Stan</a></li>
<li class="chapter" data-level="14.5" data-path="stan.html"><a href="stan.html#limitations-and-extras"><i class="fa fa-check"></i><b>14.5</b> Limitations and extras</a></li>
<li class="chapter" data-level="" data-path="stan.html"><a href="stan.html#session-info-13"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>15</b> Overview of the Generalized Linear Model</a><ul>
<li class="chapter" data-level="15.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#types-of-variables"><i class="fa fa-check"></i><b>15.1</b> Types of variables</a><ul>
<li class="chapter" data-level="15.1.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#predictor-and-predicted-variables."><i class="fa fa-check"></i><b>15.1.1</b> Predictor and predicted variables.</a></li>
<li class="chapter" data-level="15.1.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#scale-types-metric-ordinal-nominal-and-count."><i class="fa fa-check"></i><b>15.1.2</b> Scale types: metric, ordinal, nominal, and count.</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#linear-combination-of-predictors"><i class="fa fa-check"></i><b>15.2</b> Linear combination of predictors</a><ul>
<li class="chapter" data-level="15.2.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#linear-function-of-a-single-metric-predictor."><i class="fa fa-check"></i><b>15.2.1</b> Linear function of a single metric predictor.</a></li>
<li class="chapter" data-level="15.2.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#additive-combination-of-metric-predictors."><i class="fa fa-check"></i><b>15.2.2</b> Additive combination of metric predictors.</a></li>
<li class="chapter" data-level="15.2.3" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#nonadditive-interaction-of-metric-predictors."><i class="fa fa-check"></i><b>15.2.3</b> Nonadditive interaction of metric predictors.</a></li>
<li class="chapter" data-level="15.2.4" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#nominal-predictors."><i class="fa fa-check"></i><b>15.2.4</b> Nominal predictors.</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#linking-from-combined-predictors-to-noisy-predicted-data"><i class="fa fa-check"></i><b>15.3</b> Linking from combined predictors to noisy predicted data</a><ul>
<li class="chapter" data-level="15.3.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#from-predictors-to-predicted-central-tendency."><i class="fa fa-check"></i><b>15.3.1</b> From predictors to predicted central tendency.</a></li>
<li class="chapter" data-level="15.3.2" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#from-predicted-central-tendency-to-noisy-data."><i class="fa fa-check"></i><b>15.3.2</b> From predicted central tendency to noisy data.</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#formal-expression-of-the-glm"><i class="fa fa-check"></i><b>15.4</b> Formal expression of the GLM</a><ul>
<li class="chapter" data-level="15.4.1" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#cases-of-the-glm."><i class="fa fa-check"></i><b>15.4.1</b> Cases of the GLM.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="overview-of-the-generalized-linear-model.html"><a href="overview-of-the-generalized-linear-model.html#session-info-14"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html"><i class="fa fa-check"></i><b>16</b> Metric-Predicted Variable on One or Two Groups</a><ul>
<li class="chapter" data-level="16.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#estimating-the-mean-and-standard-deviation-of-a-normal-distribution"><i class="fa fa-check"></i><b>16.1</b> Estimating the mean and standard deviation of a normal distribution</a><ul>
<li class="chapter" data-level="16.1.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#solution-by-mathematical-analysis-heads-up-on-precision."><i class="fa fa-check"></i><b>16.1.1</b> <del>Solution by mathematical analysis</del> Heads up on precision.</a></li>
<li class="chapter" data-level="16.1.2" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#approximation-by-mcmc-in-jags-hmc-in-brms."><i class="fa fa-check"></i><b>16.1.2</b> Approximation by <del>MCMC in JAGS</del> HMC in brms.</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#outliers-and-robust-estimation-the-t-distribution"><i class="fa fa-check"></i><b>16.2</b> Outliers and robust estimation: The <span class="math inline">\(t\)</span> distribution</a><ul>
<li class="chapter" data-level="16.2.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#using-the-t-distribution-in-jags-brms."><i class="fa fa-check"></i><b>16.2.1</b> Using the <span class="math inline">\(t\)</span> distribution in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="16.2.2" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#using-the-t-distribution-in-stan."><i class="fa fa-check"></i><b>16.2.2</b> Using the <span class="math inline">\(t\)</span> distribution in Stan.</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#two-groups"><i class="fa fa-check"></i><b>16.3</b> Two groups</a><ul>
<li class="chapter" data-level="16.3.1" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#analysis-by-nhst."><i class="fa fa-check"></i><b>16.3.1</b> Analysis by NHST.</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#other-noise-distributions-and-transforming-data"><i class="fa fa-check"></i><b>16.4</b> Other noise distributions and transforming data</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-on-one-or-two-groups.html"><a href="metric-predicted-variable-on-one-or-two-groups.html#session-info-15"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html"><i class="fa fa-check"></i><b>17</b> Metric Predicted Variable with One Metric Predictor</a><ul>
<li class="chapter" data-level="17.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#simple-linear-regression"><i class="fa fa-check"></i><b>17.1</b> Simple linear regression</a></li>
<li class="chapter" data-level="17.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#robust-linear-regression"><i class="fa fa-check"></i><b>17.2</b> Robust linear regression</a><ul>
<li class="chapter" data-level="17.2.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#robust-linear-regression-in-jags-brms."><i class="fa fa-check"></i><b>17.2.1</b> Robust linear regression in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="17.2.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#robust-linear-regression-in-stan."><i class="fa fa-check"></i><b>17.2.2</b> Robust linear regression in Stan.</a></li>
<li class="chapter" data-level="17.2.3" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#stan-or-jags"><i class="fa fa-check"></i><b>17.2.3</b> Stan or JAGS?</a></li>
<li class="chapter" data-level="17.2.4" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#interpreting-the-posterior-distribution."><i class="fa fa-check"></i><b>17.2.4</b> Interpreting the posterior distribution.</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#hierarchical-regression-on-individuals-within-groups"><i class="fa fa-check"></i><b>17.3</b> Hierarchical regression on individuals within groups</a><ul>
<li class="chapter" data-level="17.3.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#the-model-and-implementation-in-jags-brms."><i class="fa fa-check"></i><b>17.3.1</b> The model and implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="17.3.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#the-posterior-distribution-shrinkage-and-prediction."><i class="fa fa-check"></i><b>17.3.2</b> The posterior distribution: Shrinkage and prediction.</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#quadratic-trend-and-weighted-data"><i class="fa fa-check"></i><b>17.4</b> Quadratic trend and weighted data</a><ul>
<li class="chapter" data-level="17.4.1" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#results-and-interpretation."><i class="fa fa-check"></i><b>17.4.1</b> Results and interpretation.</a></li>
<li class="chapter" data-level="17.4.2" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#further-extensions."><i class="fa fa-check"></i><b>17.4.2</b> Further extensions.</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#procedure-and-perils-for-expanding-a-model"><i class="fa fa-check"></i><b>17.5</b> Procedure and perils for expanding a model</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-one-metric-predictor.html"><a href="metric-predicted-variable-with-one-metric-predictor.html#session-info-16"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html"><i class="fa fa-check"></i><b>18</b> Metric Predicted Variable with Multiple Metric Predictors</a><ul>
<li class="chapter" data-level="18.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#multiple-linear-regression"><i class="fa fa-check"></i><b>18.1</b> Multiple linear regression</a><ul>
<li class="chapter" data-level="18.1.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#the-perils-of-correlated-predictors."><i class="fa fa-check"></i><b>18.1.1</b> The perils of correlated predictors.</a></li>
<li class="chapter" data-level="18.1.2" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#the-model-and-implementation."><i class="fa fa-check"></i><b>18.1.2</b> The model and implementation.</a></li>
<li class="chapter" data-level="18.1.3" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#the-posterior-distribution."><i class="fa fa-check"></i><b>18.1.3</b> The posterior distribution.</a></li>
<li class="chapter" data-level="18.1.4" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#redundant-predictors."><i class="fa fa-check"></i><b>18.1.4</b> Redundant predictors.</a></li>
<li class="chapter" data-level="18.1.5" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#informative-priors-sparse-data-and-correlated-predictors."><i class="fa fa-check"></i><b>18.1.5</b> Informative priors, sparse data, and correlated predictors.</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#multiplicative-interaction-of-metric-predictors"><i class="fa fa-check"></i><b>18.2</b> Multiplicative interaction of metric predictors</a><ul>
<li class="chapter" data-level="18.2.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#an-example."><i class="fa fa-check"></i><b>18.2.1</b> An example.</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#shrinkage-of-regression-coefficients"><i class="fa fa-check"></i><b>18.3</b> Shrinkage of regression coefficients</a></li>
<li class="chapter" data-level="18.4" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#variable-selection"><i class="fa fa-check"></i><b>18.4</b> Variable selection</a><ul>
<li class="chapter" data-level="18.4.1" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#inclusion-probability-is-strongly-affected-by-vagueness-of-prior."><i class="fa fa-check"></i><b>18.4.1</b> Inclusion probability is strongly affected by vagueness of prior.</a></li>
<li class="chapter" data-level="18.4.2" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#variable-selection-with-hierarchical-shrinkage."><i class="fa fa-check"></i><b>18.4.2</b> Variable selection with hierarchical shrinkage.</a></li>
<li class="chapter" data-level="18.4.3" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#what-to-report-and-what-to-conclude."><i class="fa fa-check"></i><b>18.4.3</b> What to report and what to conclude.</a></li>
<li class="chapter" data-level="18.4.4" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#caution-computational-methods."><i class="fa fa-check"></i><b>18.4.4</b> Caution: Computational methods.</a></li>
<li class="chapter" data-level="18.4.5" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#caution-interaction-variables."><i class="fa fa-check"></i><b>18.4.5</b> Caution: Interaction variables.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-multiple-metric-predictors.html"><a href="metric-predicted-variable-with-multiple-metric-predictors.html#session-info-17"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html"><i class="fa fa-check"></i><b>19</b> Metric Predicted Variable with One Nominal Predictor</a><ul>
<li class="chapter" data-level="19.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#describing-multiple-groups-of-metric-data"><i class="fa fa-check"></i><b>19.1</b> Describing multiple groups of metric data</a></li>
<li class="chapter" data-level="19.2" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#traditional-analysis-of-variance"><i class="fa fa-check"></i><b>19.2</b> Traditional analysis of variance</a></li>
<li class="chapter" data-level="19.3" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#hierarchical-bayesian-approach"><i class="fa fa-check"></i><b>19.3</b> Hierarchical Bayesian approach</a><ul>
<li class="chapter" data-level="19.3.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#implementation-in-jags-brms."><i class="fa fa-check"></i><b>19.3.1</b> Implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="19.3.2" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#example-sex-and-death."><i class="fa fa-check"></i><b>19.3.2</b> Example: Sex and death.</a></li>
<li class="chapter" data-level="19.3.3" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#contrasts."><i class="fa fa-check"></i><b>19.3.3</b> Contrasts.</a></li>
<li class="chapter" data-level="19.3.4" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#multiple-comparisons-and-shrinkage."><i class="fa fa-check"></i><b>19.3.4</b> Multiple comparisons and shrinkage.</a></li>
<li class="chapter" data-level="19.3.5" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#the-two-group-case."><i class="fa fa-check"></i><b>19.3.5</b> The two-group case.</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#including-a-metric-predictor"><i class="fa fa-check"></i><b>19.4</b> Including a metric predictor</a><ul>
<li class="chapter" data-level="19.4.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#example-sex-death-and-size."><i class="fa fa-check"></i><b>19.4.1</b> Example: Sex, death, and size.</a></li>
<li class="chapter" data-level="19.4.2" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#analogous-to-traditional-ancova."><i class="fa fa-check"></i><b>19.4.2</b> Analogous to traditional ANCOVA.</a></li>
<li class="chapter" data-level="19.4.3" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#relation-to-hierarchical-linear-regression."><i class="fa fa-check"></i><b>19.4.3</b> Relation to hierarchical linear regression.</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#heterogeneous-variances-and-robustness-against-outliers"><i class="fa fa-check"></i><b>19.5</b> Heterogeneous variances and robustness against outliers</a><ul>
<li class="chapter" data-level="19.5.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#example-contrast-of-means-with-different-variances."><i class="fa fa-check"></i><b>19.5.1</b> Example: Contrast of means with different variances.</a></li>
</ul></li>
<li class="chapter" data-level="19.6" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#exercises-walk-out-an-effect-size"><i class="fa fa-check"></i><b>19.6</b> <del>Exercises</del> Walk out an effect size</a><ul>
<li class="chapter" data-level="19.6.1" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#populations-and-samples."><i class="fa fa-check"></i><b>19.6.1</b> Populations and samples.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-one-nominal-predictor.html"><a href="metric-predicted-variable-with-one-nominal-predictor.html#session-info-18"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html"><i class="fa fa-check"></i><b>20</b> Metric Predicted Variable with Multiple Nominal Predictors</a><ul>
<li class="chapter" data-level="20.1" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#describing-groups-of-metric-data-with-multiple-nominal-predictors"><i class="fa fa-check"></i><b>20.1</b> Describing groups of metric data with multiple nominal predictors</a><ul>
<li class="chapter" data-level="20.1.1" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#interaction."><i class="fa fa-check"></i><b>20.1.1</b> Interaction.</a></li>
<li class="chapter" data-level="20.1.2" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#traditional-anova."><i class="fa fa-check"></i><b>20.1.2</b> Traditional ANOVA.</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#hierarchical-bayesian-approach-1"><i class="fa fa-check"></i><b>20.2</b> Hierarchical Bayesian approach</a><ul>
<li class="chapter" data-level="20.2.1" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#implementation-in-jags-brms.-1"><i class="fa fa-check"></i><b>20.2.1</b> Implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="20.2.2" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#example-its-only-money."><i class="fa fa-check"></i><b>20.2.2</b> Example: It’s only money.</a></li>
<li class="chapter" data-level="20.2.3" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#main-effect-contrasts."><i class="fa fa-check"></i><b>20.2.3</b> Main effect contrasts.</a></li>
<li class="chapter" data-level="20.2.4" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#interaction-contrasts-and-simple-effects."><i class="fa fa-check"></i><b>20.2.4</b> Interaction contrasts and simple effects.</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#rescaling-can-change-interactions-homogeneity-and-normality"><i class="fa fa-check"></i><b>20.3</b> Rescaling can change interactions, homogeneity, and normality</a></li>
<li class="chapter" data-level="20.4" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#heterogeneous-variances-and-robustness-against-outliers-1"><i class="fa fa-check"></i><b>20.4</b> Heterogeneous variances and robustness against outliers</a></li>
<li class="chapter" data-level="20.5" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#within-subject-designs"><i class="fa fa-check"></i><b>20.5</b> Within-subject designs</a><ul>
<li class="chapter" data-level="20.5.1" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#why-use-a-within-subject-design-and-why-not"><i class="fa fa-check"></i><b>20.5.1</b> Why use a within-subject design? And why not?</a></li>
<li class="chapter" data-level="20.5.2" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#split-plot-design."><i class="fa fa-check"></i><b>20.5.2</b> Split-plot design.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#session-info-19"><i class="fa fa-check"></i>Session info</a></li>
<li class="chapter" data-level="" data-path="metric-predicted-variable-with-multiple-nominal-predictors.html"><a href="metric-predicted-variable-with-multiple-nominal-predictors.html#footnote"><i class="fa fa-check"></i>Footnote</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html"><i class="fa fa-check"></i><b>21</b> Dichotomous Predicted Variable</a><ul>
<li class="chapter" data-level="21.1" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#multiple-metric-predictors"><i class="fa fa-check"></i><b>21.1</b> Multiple metric predictors</a><ul>
<li class="chapter" data-level="21.1.1" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#the-model-and-implementation-in-jags-brms.-1"><i class="fa fa-check"></i><b>21.1.1</b> The model and implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="21.1.2" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#example-height-weight-and-gender."><i class="fa fa-check"></i><b>21.1.2</b> Example: Height, weight, and gender.</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#interpreting-the-regression-coefficients"><i class="fa fa-check"></i><b>21.2</b> Interpreting the regression coefficients</a><ul>
<li class="chapter" data-level="21.2.1" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#log-odds."><i class="fa fa-check"></i><b>21.2.1</b> Log odds.</a></li>
<li class="chapter" data-level="21.2.2" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#when-there-are-few-1s-or-0s-in-the-data."><i class="fa fa-check"></i><b>21.2.2</b> When there are few 1’s or 0’s in the data.</a></li>
<li class="chapter" data-level="21.2.3" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#correlated-predictors."><i class="fa fa-check"></i><b>21.2.3</b> Correlated predictors.</a></li>
<li class="chapter" data-level="21.2.4" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#interaction-of-metric-predictors."><i class="fa fa-check"></i><b>21.2.4</b> Interaction of metric predictors.</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#robust-logistic-regression"><i class="fa fa-check"></i><b>21.3</b> Robust logistic regression</a></li>
<li class="chapter" data-level="21.4" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#nominal-predictors"><i class="fa fa-check"></i><b>21.4</b> Nominal predictors</a><ul>
<li class="chapter" data-level="21.4.1" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#single-group."><i class="fa fa-check"></i><b>21.4.1</b> Single group.</a></li>
<li class="chapter" data-level="21.4.2" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#multiple-groups."><i class="fa fa-check"></i><b>21.4.2</b> Multiple groups.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="dichotomous-predicted-variable.html"><a href="dichotomous-predicted-variable.html#session-info-20"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html"><i class="fa fa-check"></i><b>22</b> Nominal Predicted Variable</a><ul>
<li class="chapter" data-level="22.1" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#softmax-regression"><i class="fa fa-check"></i><b>22.1</b> Softmax regression</a><ul>
<li class="chapter" data-level="22.1.1" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#softmax-reduces-to-logistic-for-two-outcomes."><i class="fa fa-check"></i><b>22.1.1</b> Softmax reduces to logistic for two outcomes.</a></li>
<li class="chapter" data-level="22.1.2" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#independence-from-irrelevant-attributes."><i class="fa fa-check"></i><b>22.1.2</b> Independence from irrelevant attributes.</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#conditional-logistic-regression"><i class="fa fa-check"></i><b>22.2</b> Conditional logistic regression</a></li>
<li class="chapter" data-level="22.3" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#implementation-in-jags-brms"><i class="fa fa-check"></i><b>22.3</b> Implementation in <del>JAGS</del> brms</a><ul>
<li class="chapter" data-level="22.3.1" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#softmax-model."><i class="fa fa-check"></i><b>22.3.1</b> Softmax model.</a></li>
<li class="chapter" data-level="22.3.2" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#conditional-logistic-model."><i class="fa fa-check"></i><b>22.3.2</b> Conditional logistic model.</a></li>
<li class="chapter" data-level="22.3.3" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#results-interpreting-the-regression-coefficients."><i class="fa fa-check"></i><b>22.3.3</b> Results: Interpreting the regression coefficients.</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#generalizations-and-variations-of-the-models"><i class="fa fa-check"></i><b>22.4</b> Generalizations and variations of the models</a></li>
<li class="chapter" data-level="" data-path="nominal-predicted-variable.html"><a href="nominal-predicted-variable.html#session-info-21"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html"><i class="fa fa-check"></i><b>23</b> Ordinal Predicted Variable</a><ul>
<li class="chapter" data-level="23.1" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#modeling-ordinal-data-with-an-underlying-metric-variable"><i class="fa fa-check"></i><b>23.1</b> Modeling ordinal data with an underlying metric variable</a></li>
<li class="chapter" data-level="23.2" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#the-case-of-a-single-group"><i class="fa fa-check"></i><b>23.2</b> The case of a single group</a><ul>
<li class="chapter" data-level="23.2.1" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#implementation-in-jags-brms.-3"><i class="fa fa-check"></i><b>23.2.1</b> Implementation in <del>JAGS</del> <strong>brms</strong>.</a></li>
<li class="chapter" data-level="23.2.2" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#examples-bayesian-estimation-recovers-true-parameter-values."><i class="fa fa-check"></i><b>23.2.2</b> Examples: Bayesian estimation recovers true parameter values.</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#the-case-of-two-groups"><i class="fa fa-check"></i><b>23.3</b> The case of two groups</a><ul>
<li class="chapter" data-level="23.3.1" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#implementation-in-jags-brms.-4"><i class="fa fa-check"></i><b>23.3.1</b> Implementation in <del>JAGS</del> <strong>brms</strong>.</a></li>
<li class="chapter" data-level="23.3.2" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#examples-not-funny."><i class="fa fa-check"></i><b>23.3.2</b> Examples: Not funny.</a></li>
</ul></li>
<li class="chapter" data-level="23.4" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#the-case-of-metric-predictors"><i class="fa fa-check"></i><b>23.4</b> The Case of metric predictors</a><ul>
<li class="chapter" data-level="23.4.1" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#implementation-in-jags-brms.-5"><i class="fa fa-check"></i><b>23.4.1</b> Implementation in <del>JAGS</del> brms.</a></li>
<li class="chapter" data-level="23.4.2" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#example-happiness-and-money."><i class="fa fa-check"></i><b>23.4.2</b> Example: Happiness and money.</a></li>
<li class="chapter" data-level="23.4.3" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#example-moviesthey-dont-make-em-like-they-used-to."><i class="fa fa-check"></i><b>23.4.3</b> Example: Movies–They don’t make ’em like they used to.</a></li>
<li class="chapter" data-level="23.4.4" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#why-are-some-thresholds-outside-the-data"><i class="fa fa-check"></i><b>23.4.4</b> Why are some thresholds outside the data?</a></li>
</ul></li>
<li class="chapter" data-level="23.5" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#posterior-prediction"><i class="fa fa-check"></i><b>23.5</b> Posterior prediction</a></li>
<li class="chapter" data-level="23.6" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#generalizations-and-extensions"><i class="fa fa-check"></i><b>23.6</b> Generalizations and extensions</a></li>
<li class="chapter" data-level="" data-path="ordinal-predicted-variable.html"><a href="ordinal-predicted-variable.html#session-info-22"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html"><i class="fa fa-check"></i><b>24</b> Count Predicted Variable</a><ul>
<li class="chapter" data-level="24.1" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#poisson-exponential-model"><i class="fa fa-check"></i><b>24.1</b> Poisson exponential model</a><ul>
<li class="chapter" data-level="24.1.1" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#data-structure."><i class="fa fa-check"></i><b>24.1.1</b> Data structure.</a></li>
<li class="chapter" data-level="24.1.2" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#exponential-link-function."><i class="fa fa-check"></i><b>24.1.2</b> Exponential link function.</a></li>
<li class="chapter" data-level="24.1.3" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#poisson-noise-distribution."><i class="fa fa-check"></i><b>24.1.3</b> Poisson noise distribution.</a></li>
<li class="chapter" data-level="24.1.4" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#the-complete-model-and-implementation-in-jags-brms."><i class="fa fa-check"></i><b>24.1.4</b> The complete model and implementation in <del>JAGS</del> brms.</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#example-hair-eye-go-again"><i class="fa fa-check"></i><b>24.2</b> Example: Hair eye go again</a></li>
<li class="chapter" data-level="24.3" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#example-interaction-contrasts-shrinkage-and-omnibus-test"><i class="fa fa-check"></i><b>24.3</b> Example: Interaction contrasts, shrinkage, and omnibus test</a></li>
<li class="chapter" data-level="24.4" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#log-linear-models-for-contingency-tables-bonus-alternative-parameterization"><i class="fa fa-check"></i><b>24.4</b> <del>Log-linear models for contingency tables</del> Bonus: Alternative parameterization</a></li>
<li class="chapter" data-level="" data-path="count-predicted-variable.html"><a href="count-predicted-variable.html#session-info-23"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html"><i class="fa fa-check"></i><b>25</b> Tools in the Trunk</a><ul>
<li class="chapter" data-level="25.1" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#reporting-a-bayesian-analysis"><i class="fa fa-check"></i><b>25.1</b> Reporting a Bayesian analysis</a><ul>
<li class="chapter" data-level="25.1.1" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#essential-points."><i class="fa fa-check"></i><b>25.1.1</b> Essential points.</a></li>
<li class="chapter" data-level="25.1.2" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#optional-points."><i class="fa fa-check"></i><b>25.1.2</b> Optional points.</a></li>
<li class="chapter" data-level="25.1.3" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#helpful-points."><i class="fa fa-check"></i><b>25.1.3</b> Helpful points.</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#functions-for-computing-highest-density-intervals"><i class="fa fa-check"></i><b>25.2</b> Functions for computing highest density intervals</a><ul>
<li class="chapter" data-level="25.2.1" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#r-code-for-computing-hdi-of-a-grid-approximation."><i class="fa fa-check"></i><b>25.2.1</b> R code for computing HDI of a grid approximation.</a></li>
<li class="chapter" data-level="25.2.2" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#hdi-of-unimodal-distribution-is-shortest-interval."><i class="fa fa-check"></i><b>25.2.2</b> HDI of unimodal distribution is shortest interval.</a></li>
<li class="chapter" data-level="25.2.3" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#r-code-for-computing-hdi-of-a-mcmc-sample."><i class="fa fa-check"></i><b>25.2.3</b> R code for computing HDI of a MCMC sample.</a></li>
<li class="chapter" data-level="25.2.4" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#r-code-for-computing-hdi-of-a-function."><i class="fa fa-check"></i><b>25.2.4</b> R code for computing HDI of a function.</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#reparameterization"><i class="fa fa-check"></i><b>25.3</b> Reparameterization</a></li>
<li class="chapter" data-level="25.4" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#censored-data-in-jags-brms"><i class="fa fa-check"></i><b>25.4</b> Censored Data in <del>JAGS</del> brms</a></li>
<li class="chapter" data-level="25.5" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#what-next"><i class="fa fa-check"></i><b>25.5</b> What Next?</a></li>
<li class="chapter" data-level="" data-path="tools-in-the-trunk.html"><a href="tools-in-the-trunk.html#session-info-24"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><em>Doing Bayesian Data Analysis</em> in brms and the tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="count-predicted-variable" class="section level1">
<h1><span class="header-section-number">24</span> Count Predicted Variable</h1>
<blockquote>
<p>Consider a situation in which we observe two nominal values for every item measured…. Across the whole sample, the result is a table of counts for each combination of values of the nominal variables. The counts are what we are trying to predict and the nominal variables are the predictors. This is the type of situation addressed in this chapter….</p>
<p>In the context of the generalized linear model (GLM) introduced in Chapter 15, this chapter’s situation involves a predicted value that is a count, for which we will use an inverse-link function that is exponential along with a Poisson distribution for describing noise in the data <span class="citation">(Kruschke, <a href="#ref-kruschkeDoingBayesianData2015">2015</a>, pp. 703–704)</span></p>
</blockquote>
<div id="poisson-exponential-model" class="section level2">
<h2><span class="header-section-number">24.1</span> Poisson exponential model</h2>
<p>Following Kruschke, we will “refer to the model that will be explained in this section as Poisson exponential because, as we will see, the noise distribution is a Poisson distribution and the inverse-link function is exponential” (p. 704).</p>
<div id="data-structure." class="section level3">
<h3><span class="header-section-number">24.1.1</span> Data structure.</h3>
<p>Kruschke has the <span class="citation">Snee (<a href="#ref-sneeGraphicalDisplayTwoway1974">1974</a>)</span> data for Table 24.1 saved as the <code>HairEyeColor.csv</code> file.</p>
<div class="sourceCode" id="cb2212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2212-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb2212-2" data-line-number="2"><span class="kw">library</span>(janitor)</a>
<a class="sourceLine" id="cb2212-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2212-4" data-line-number="4">my_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data.R/HairEyeColor.csv&quot;</span>)</a>
<a class="sourceLine" id="cb2212-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2212-6" data-line-number="6"><span class="kw">glimpse</span>(my_data)</a></code></pre></div>
<pre><code>## Rows: 16
## Columns: 3
## $ Hair  &lt;chr&gt; &quot;Black&quot;, &quot;Black&quot;, &quot;Black&quot;, &quot;Black&quot;, &quot;Blond&quot;, &quot;Blond&quot;, &quot;Blond&quot;, …
## $ Eye   &lt;chr&gt; &quot;Blue&quot;, &quot;Brown&quot;, &quot;Green&quot;, &quot;Hazel&quot;, &quot;Blue&quot;, &quot;Brown&quot;, &quot;Green&quot;, &quot;H…
## $ Count &lt;dbl&gt; 20, 68, 5, 15, 94, 7, 16, 10, 84, 119, 29, 54, 17, 26, 14, 14</code></pre>
<p>In order to retain some of the ordering in Table 24.1, we’ll want to make <code>Hair</code> a factor and recode <code>Brown</code> as <code>Brunette</code>.</p>
<div class="sourceCode" id="cb2214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2214-1" data-line-number="1">my_data &lt;-</a>
<a class="sourceLine" id="cb2214-2" data-line-number="2"><span class="st">  </span>my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2214-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Hair =</span> <span class="kw">if_else</span>(Hair <span class="op">==</span><span class="st"> &quot;Brown&quot;</span>, <span class="st">&quot;Brunette&quot;</span>, Hair) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2214-4" data-line-number="4"><span class="st">           </span><span class="kw">factor</span>(., <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Black&quot;</span>, <span class="st">&quot;Brunette&quot;</span>, <span class="st">&quot;Red&quot;</span>, <span class="st">&quot;Blond&quot;</span>)))</a></code></pre></div>
<p>Here’s a quick way to use <code>pivot_wider()</code> to make most of the table.</p>
<div class="sourceCode" id="cb2215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2215-1" data-line-number="1">my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2215-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> Hair,</a>
<a class="sourceLine" id="cb2215-3" data-line-number="3">              <span class="dt">values_from =</span> Count)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   Eye   Black Blond Brunette   Red
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
## 1 Blue     20    94       84    17
## 2 Brown    68     7      119    26
## 3 Green     5    16       29    14
## 4 Hazel    15    10       54    14</code></pre>
<p>However, that didn’t get us the marginal totals. For those, we’ll <code>uncount()</code> the cells in the data and then make the full table with <code>janitor::tabyl()</code> and <code>janitor::adorn_totals()</code>.</p>
<div class="sourceCode" id="cb2217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2217-1" data-line-number="1">my_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2217-2" data-line-number="2"><span class="st">  </span><span class="kw">uncount</span>(<span class="dt">weights =</span> Count, <span class="dt">.remove =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2217-3" data-line-number="3"><span class="st">  </span><span class="kw">tabyl</span>(Eye, Hair) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2217-4" data-line-number="4"><span class="st">  </span><span class="kw">adorn_totals</span>(<span class="kw">c</span>(<span class="st">&quot;row&quot;</span>, <span class="st">&quot;col&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2217-5" data-line-number="5"><span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Eye</th>
<th align="right">Black</th>
<th align="right">Brunette</th>
<th align="right">Red</th>
<th align="right">Blond</th>
<th align="right">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Blue</td>
<td align="right">20</td>
<td align="right">84</td>
<td align="right">17</td>
<td align="right">94</td>
<td align="right">215</td>
</tr>
<tr class="even">
<td align="left">Brown</td>
<td align="right">68</td>
<td align="right">119</td>
<td align="right">26</td>
<td align="right">7</td>
<td align="right">220</td>
</tr>
<tr class="odd">
<td align="left">Green</td>
<td align="right">5</td>
<td align="right">29</td>
<td align="right">14</td>
<td align="right">16</td>
<td align="right">64</td>
</tr>
<tr class="even">
<td align="left">Hazel</td>
<td align="right">15</td>
<td align="right">54</td>
<td align="right">14</td>
<td align="right">10</td>
<td align="right">93</td>
</tr>
<tr class="odd">
<td align="left">Total</td>
<td align="right">108</td>
<td align="right">286</td>
<td align="right">71</td>
<td align="right">127</td>
<td align="right">592</td>
</tr>
</tbody>
</table>
<p>That last <code>knitr::kable()</code> line just formatted the output a bit.</p>
</div>
<div id="exponential-link-function." class="section level3">
<h3><span class="header-section-number">24.1.2</span> Exponential link function.</h3>
<p>To analyze data like those above,</p>
<blockquote>
<p>a natural candidate for the needed likelihood distribution is the Poisson (described later), which takes a non-negative value <span class="math inline">\(\lambda\)</span> and gives a probability for each integer from zero to infinity. But this motivation may seem a bit arbitrary, even if there’s nothing wrong with it in principle.</p>
<p>A different motivation starts by treating the cell counts as representative of underlying cell probabilities, and then asking whether the two nominal variables contribute independent influences to the cell probabilities. (p. 705).</p>
</blockquote>
<p>The additive model of cell counts of a table of rows <span class="math inline">\(r\)</span> and columns <span class="math inline">\(c\)</span> follows the form</p>
<p><span class="math display">\[\lambda_{r, c} = \exp (\beta_0 + \beta_r + \beta_c),\]</span></p>
<p>where <span class="math inline">\(\lambda_{r, c}\)</span> is the tendency of counts within row <span class="math inline">\(r\)</span> and column <span class="math inline">\(c\)</span>. In the case of an interaction model, the equation expands to</p>
<p><span class="math display">\[\lambda_{r, c} = \exp (\beta_0 + \beta_r + \beta_c + \beta_{r, c}),\]</span></p>
<p>with the following constraints:</p>
<p><span class="math display">\[\begin{align*}
\sum_r \beta_r = 0, &amp;&amp; \sum_c \beta_c = 0, &amp;&amp; \sum_r \beta_{r, c} = 0 \text{ for all } c, &amp;&amp; \text{and} &amp;&amp; \sum_c \beta_{r, c} = 0 \text{ for all } r.
\end{align*}\]</span></p>
</div>
<div id="poisson-noise-distribution." class="section level3">
<h3><span class="header-section-number">24.1.3</span> Poisson noise distribution.</h3>
<p><a href="https://upload.wikimedia.org/wikipedia/commons/e/e8/E._Marcellot_Siméon-Denis_Poisson_1804.jpg">Simon-Denis Poisson</a>’s distribution follows the form</p>
<p><span class="math display">\[p(y | \lambda) = \frac{\lambda^y \exp (-\lambda)}{y!},\]</span></p>
<blockquote>
<p>where <span class="math inline">\(y\)</span> is a non-negative integer and <span class="math inline">\(\lambda\)</span> is a non-negative real number. The mean of the Poisson distribution is <span class="math inline">\(\lambda\)</span>. Importantly, the variance of the Poisson distribution is also <span class="math inline">\(\lambda\)</span> (i.e., the standard deviation is <span class="math inline">\(\sqrt \lambda\)</span>). Thus, in the Poisson distribution, the variance is completely yoked to the mean. (p. 707)</p>
</blockquote>
<p>We can work with that expression directly in base <strong>R</strong>. Here we use <span class="math inline">\(\lambda = 5.5\)</span> and <span class="math inline">\(y = 2\)</span>.</p>
<div class="sourceCode" id="cb2218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2218-1" data-line-number="1">lambda &lt;-<span class="st"> </span><span class="fl">5.5</span></a>
<a class="sourceLine" id="cb2218-2" data-line-number="2">y      &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb2218-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2218-4" data-line-number="4">lambda<span class="op">^</span>y <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>lambda) <span class="op">/</span><span class="st"> </span><span class="kw">factorial</span>(y)</a></code></pre></div>
<pre><code>## [1] 0.06181242</code></pre>
<p>If we’d like to simulate from the Poisson distribution, we’d use the <code>rpois()</code> function. It takes two arguments, <code>n</code> and <code>lambda</code>. Let’s generate 1,000 draws based on <span class="math inline">\(\lambda = 5\)</span>.</p>
<div class="sourceCode" id="cb2220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2220-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">24</span>)</a>
<a class="sourceLine" id="cb2220-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2220-3" data-line-number="3">d &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">y =</span> <span class="kw">rpois</span>(<span class="dt">n =</span> <span class="dv">1000</span>, <span class="dt">lambda =</span> <span class="dv">5</span>))</a></code></pre></div>
<p>Here are the mean and variance.</p>
<div class="sourceCode" id="cb2221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2221-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2221-2" data-line-number="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean     =</span> <span class="kw">mean</span>(y),</a>
<a class="sourceLine" id="cb2221-3" data-line-number="3">            <span class="dt">variance =</span> <span class="kw">var</span>(y))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    mean variance
##   &lt;dbl&gt;    &lt;dbl&gt;
## 1  4.98     5.17</code></pre>
<p>They’re not exactly the same because of simulation variance, but they get that way real quick with a larger sample.</p>
<div class="sourceCode" id="cb2223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2223-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">24</span>)</a>
<a class="sourceLine" id="cb2223-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2223-3" data-line-number="3"><span class="kw">tibble</span>(<span class="dt">y =</span> <span class="kw">rpois</span>(<span class="dt">n =</span> <span class="dv">100000</span>, <span class="dt">lambda =</span> <span class="dv">5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2223-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean     =</span> <span class="kw">mean</span>(y),</a>
<a class="sourceLine" id="cb2223-5" data-line-number="5">            <span class="dt">variance =</span> <span class="kw">var</span>(y))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    mean variance
##   &lt;dbl&gt;    &lt;dbl&gt;
## 1  4.99     4.98</code></pre>
<p>Let’s put <code>rpois()</code> to work and make Figure 24.1.</p>
<div class="sourceCode" id="cb2225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2225-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">24</span>)</a>
<a class="sourceLine" id="cb2225-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2225-3" data-line-number="3"><span class="kw">tibble</span>(<span class="dt">lambda =</span> <span class="kw">c</span>(<span class="fl">1.8</span>, <span class="fl">8.3</span>, <span class="fl">32.1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2225-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="kw">map</span>(lambda, rpois, <span class="dt">n =</span> <span class="fl">1e5</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2225-5" data-line-number="5"><span class="st">  </span><span class="kw">unnest</span>(y) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2225-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb2225-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2225-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">stat</span>(density)),</a>
<a class="sourceLine" id="cb2225-9" data-line-number="9">                 <span class="dt">binwidth =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;grey92&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2225-10" data-line-number="10"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;p(y)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2225-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb2225-12" data-line-number="12"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>lambda, <span class="dt">ncol =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2225-13" data-line-number="13">             <span class="dt">labeller =</span> <span class="kw">label_bquote</span>(<span class="kw">dpois</span>(y<span class="op">*</span><span class="st">&quot;|&quot;</span><span class="op">*</span>lambda <span class="op">==</span><span class="st"> </span>.(lambda))))</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>For more on our <code>labeller = label_bquote</code> syntax, check out <a href="https://ggplot2.tidyverse.org/reference/label_bquote.html">this</a>.</p>
<p>But anyway, given <span class="math inline">\(\lambda\)</span>, the Poisson distribution gives the probabilities of specific non-negative integers. And instead of using our hand-coded function from above, we can also use <code>dpois()</code> to get precise density values.</p>
<div class="sourceCode" id="cb2226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2226-1" data-line-number="1"><span class="kw">dpois</span>(<span class="dv">2</span>, <span class="dt">lambda =</span> <span class="fl">5.5</span>)</a></code></pre></div>
<pre><code>## [1] 0.06181242</code></pre>
</div>
<div id="the-complete-model-and-implementation-in-jags-brms." class="section level3">
<h3><span class="header-section-number">24.1.4</span> The complete model and implementation in <del>JAGS</del> brms.</h3>
<p>Using Kruschke’s method,</p>
<blockquote>
<p>the prior is supposed to be broad on the scale of the data, but we must be careful about what scale is being modeled by the baseline and deflections. <em>The counts are being directly described by</em> <span class="math inline">\(\lambda\)</span><em>, but it is</em> <span class="math inline">\(\log (\lambda)\)</span> <em>being described by the baseline and deflections</em>. Thus, the prior on the baseline and deflections should be broad on the scale of the logarithm of the data. To establish a generic baseline, consider that if the data points were distributed equally among the cells, the mean count would be the total count divided by the number of cells. The biggest possible standard deviation across cells would occur when all the counts were loaded into a single cell and all the other cells were zero. (pp. 709–710, <em>emphasis</em> added)</p>
</blockquote>
<p>Before we show how to fit the model, we need the old <code>gamma_a_b_from_omega_sigma()</code> function.</p>
<div class="sourceCode" id="cb2228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2228-1" data-line-number="1">gamma_a_b_from_omega_sigma &lt;-<span class="st"> </span><span class="cf">function</span>(mode, sd) {</a>
<a class="sourceLine" id="cb2228-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb2228-3" data-line-number="3">  <span class="cf">if</span> (mode <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">stop</span>(<span class="st">&quot;mode must be &gt; 0&quot;</span>)</a>
<a class="sourceLine" id="cb2228-4" data-line-number="4">  <span class="cf">if</span> (sd   <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">stop</span>(<span class="st">&quot;sd must be &gt; 0&quot;</span>)</a>
<a class="sourceLine" id="cb2228-5" data-line-number="5">  rate &lt;-<span class="st"> </span>(mode <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(mode<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span>sd<span class="op">^</span><span class="dv">2</span>)) <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sd<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2228-6" data-line-number="6">  shape &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>mode <span class="op">*</span><span class="st"> </span>rate</a>
<a class="sourceLine" id="cb2228-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb2228-8" data-line-number="8">  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">shape =</span> shape, <span class="dt">rate =</span> rate))</a>
<a class="sourceLine" id="cb2228-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb2228-10" data-line-number="10">}</a></code></pre></div>
<p>Here are a few intermediate values before we set the <code>stanvars</code>.</p>
<div class="sourceCode" id="cb2229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2229-1" data-line-number="1">n_x1_level &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(my_data<span class="op">$</span>x1))</a>
<a class="sourceLine" id="cb2229-2" data-line-number="2">n_x2_level &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(my_data<span class="op">$</span>x2))</a>
<a class="sourceLine" id="cb2229-3" data-line-number="3">n_cell     &lt;-<span class="st"> </span><span class="kw">nrow</span>(my_data)</a></code></pre></div>
<p>Now we’re ready to define the <code>stanvars</code>.</p>
<div class="sourceCode" id="cb2230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2230-1" data-line-number="1">y_log_mean &lt;-</a>
<a class="sourceLine" id="cb2230-2" data-line-number="2"><span class="st">  </span><span class="kw">log</span>(<span class="kw">sum</span>(my_data<span class="op">$</span>y) <span class="op">/</span><span class="st"> </span>(n_x1_level <span class="op">*</span><span class="st"> </span>n_x2_level))</a>
<a class="sourceLine" id="cb2230-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2230-4" data-line-number="4">y_log_sd &lt;-</a>
<a class="sourceLine" id="cb2230-5" data-line-number="5"><span class="st">  </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>, n_cell <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="kw">sum</span>(my_data<span class="op">$</span>y)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2230-6" data-line-number="6"><span class="st">  </span><span class="kw">sd</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2230-7" data-line-number="7"><span class="st">  </span><span class="kw">log</span>()</a>
<a class="sourceLine" id="cb2230-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2230-9" data-line-number="9">s_r &lt;-<span class="st"> </span><span class="kw">gamma_a_b_from_omega_sigma</span>(<span class="dt">mode =</span> y_log_sd, <span class="dt">sd =</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>y_log_sd)</a>
<a class="sourceLine" id="cb2230-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2230-11" data-line-number="11">stanvars &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb2230-12" data-line-number="12"><span class="st">  </span><span class="kw">stanvar</span>(y_log_mean, <span class="dt">name =</span> <span class="st">&quot;y_log_mean&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2230-13" data-line-number="13"><span class="st">  </span><span class="kw">stanvar</span>(y_log_sd,   <span class="dt">name =</span> <span class="st">&quot;y_log_sd&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2230-14" data-line-number="14"><span class="st">  </span><span class="kw">stanvar</span>(s_r<span class="op">$</span>shape,  <span class="dt">name =</span> <span class="st">&quot;alpha&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2230-15" data-line-number="15"><span class="st">  </span><span class="kw">stanvar</span>(s_r<span class="op">$</span>rate,   <span class="dt">name =</span> <span class="st">&quot;beta&quot;</span>)</a></code></pre></div>
<p>You’d then fit a Poisson model with two nominal predictors using Kruschke’s hierarchical-shrinkage method like this.</p>
<div class="sourceCode" id="cb2231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2231-1" data-line-number="1">fit &lt;-</a>
<a class="sourceLine" id="cb2231-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> my_data,</a>
<a class="sourceLine" id="cb2231-3" data-line-number="3">      <span class="dt">family =</span> poisson,</a>
<a class="sourceLine" id="cb2231-4" data-line-number="4">      y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>x1) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>x2) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>x1<span class="op">:</span>x2),</a>
<a class="sourceLine" id="cb2231-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(y_log_mean, y_log_sd <span class="op">*</span><span class="st"> </span><span class="dv">2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb2231-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">gamma</span>(alpha, beta), <span class="dt">class =</span> sd)),</a>
<a class="sourceLine" id="cb2231-7" data-line-number="7">      <span class="dt">stanvars =</span> stanvars)</a></code></pre></div>
<p>By <strong>brms</strong> default, <code>family = poisson</code> uses the log link. Thus <code>family = poisson(link = &quot;log&quot;)</code> should return the same results. Notice the right-hand side of the model <code>formula</code>. We have three hierarchical variance parameters. This hierarchical-shrinkage approach to frequency-table data has its origins in <span class="citation">Gelman (<a href="#ref-gelmanAnalysisVarianceWhy2005">2005</a>)</span>, <a href="https://projecteuclid.org/download/pdfview_1/euclid.aos/1112967698"><em>Analysis of variance–why it is more important than ever</em></a>.</p>
</div>
</div>
<div id="example-hair-eye-go-again" class="section level2">
<h2><span class="header-section-number">24.2</span> Example: Hair eye go again</h2>
<p>We’ll be using the same data, from above. As an alternative to Table 24.1, it might be handy to take a more colorful approach to wading into the data.</p>
<div class="sourceCode" id="cb2232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2232-1" data-line-number="1"><span class="co"># wrangle</span></a>
<a class="sourceLine" id="cb2232-2" data-line-number="2">my_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2232-3" data-line-number="3"><span class="st">  </span><span class="kw">uncount</span>(<span class="dt">weights =</span> Count, <span class="dt">.remove =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2232-4" data-line-number="4"><span class="st">  </span><span class="kw">tabyl</span>(Eye, Hair) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2232-5" data-line-number="5"><span class="st">  </span><span class="kw">adorn_totals</span>(<span class="kw">c</span>(<span class="st">&quot;row&quot;</span>, <span class="st">&quot;col&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2232-6" data-line-number="6"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2232-7" data-line-number="7"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>Eye, <span class="dt">names_to =</span> <span class="st">&quot;Hair&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2232-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Eye =</span> <span class="kw">fct_rev</span>(Eye)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2232-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb2232-10" data-line-number="10"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb2232-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Hair, <span class="dt">y =</span> Eye)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2232-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2232-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> value, <span class="dt">color =</span> value <span class="op">&lt;</span><span class="st"> </span><span class="dv">300</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2232-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="dt">option =</span> <span class="st">&quot;D&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2232-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;white&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2232-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">position =</span> <span class="st">&quot;top&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2232-17" data-line-number="17"><span class="st">  </span><span class="kw">scale_y_discrete</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2232-18" data-line-number="18"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb2232-19" data-line-number="19">        <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb2232-20" data-line-number="20">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-16-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Load the <strong>brms</strong> and <strong>tidybayes</strong> packages.</p>
<div class="sourceCode" id="cb2233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2233-1" data-line-number="1"><span class="kw">library</span>(brms)</a>
<a class="sourceLine" id="cb2233-2" data-line-number="2"><span class="kw">library</span>(tidybayes)</a></code></pre></div>
<p>Now we’ll make save the prepatory values necessary for the <code>stanvars</code>.</p>
<div class="sourceCode" id="cb2234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2234-1" data-line-number="1">n_x1_level &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(my_data<span class="op">$</span>Hair))</a>
<a class="sourceLine" id="cb2234-2" data-line-number="2">n_x2_level &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(my_data<span class="op">$</span>Eye))</a>
<a class="sourceLine" id="cb2234-3" data-line-number="3">n_cell     &lt;-<span class="st"> </span><span class="kw">nrow</span>(my_data)</a>
<a class="sourceLine" id="cb2234-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2234-5" data-line-number="5">n_x1_level</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb2236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2236-1" data-line-number="1">n_x2_level</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb2238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2238-1" data-line-number="1">n_cell</a></code></pre></div>
<pre><code>## [1] 16</code></pre>
<p>Here are the values we’ll save as <code>stanvars</code>.</p>
<div class="sourceCode" id="cb2240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2240-1" data-line-number="1">y_log_mean &lt;-</a>
<a class="sourceLine" id="cb2240-2" data-line-number="2"><span class="st">  </span><span class="kw">log</span>(<span class="kw">sum</span>(my_data<span class="op">$</span>Count) <span class="op">/</span><span class="st"> </span>(n_x1_level <span class="op">*</span><span class="st"> </span>n_x2_level))</a>
<a class="sourceLine" id="cb2240-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2240-4" data-line-number="4">y_log_sd &lt;-</a>
<a class="sourceLine" id="cb2240-5" data-line-number="5"><span class="st">  </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>, n_cell <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="kw">sum</span>(my_data<span class="op">$</span>Count)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2240-6" data-line-number="6"><span class="st">  </span><span class="kw">sd</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2240-7" data-line-number="7"><span class="st">  </span><span class="kw">log</span>()</a>
<a class="sourceLine" id="cb2240-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2240-9" data-line-number="9">s_r &lt;-<span class="st"> </span><span class="kw">gamma_a_b_from_omega_sigma</span>(<span class="dt">mode =</span> y_log_sd, <span class="dt">sd =</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>y_log_sd)</a>
<a class="sourceLine" id="cb2240-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2240-11" data-line-number="11">y_log_mean</a></code></pre></div>
<pre><code>## [1] 3.610918</code></pre>
<div class="sourceCode" id="cb2242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2242-1" data-line-number="1">y_log_sd</a></code></pre></div>
<pre><code>## [1] 4.997212</code></pre>
<div class="sourceCode" id="cb2244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2244-1" data-line-number="1">s_r<span class="op">$</span>shape</a></code></pre></div>
<pre><code>## [1] 1.640388</code></pre>
<div class="sourceCode" id="cb2246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2246-1" data-line-number="1">s_r<span class="op">$</span>rate</a></code></pre></div>
<pre><code>## [1] 0.1281491</code></pre>
<p>As a quick detour, it might be interesting to see what the kind of gamma distribution is entailed by those last two values.</p>
<div class="sourceCode" id="cb2248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2248-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">70</span>, <span class="dt">length.out =</span> <span class="fl">1e3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2248-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">dgamma</span>(x, s_r<span class="op">$</span>shape, s_r<span class="op">$</span>rate)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2248-3" data-line-number="3"><span class="st">  </span></a>
<a class="sourceLine" id="cb2248-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> density)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2248-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2248-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2248-7" data-line-number="7"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw">expression</span>(<span class="st">&quot;Kruschke&#39;s wide prior for &quot;</span><span class="op">*</span>sigma[beta<span class="op">*</span>x]),</a>
<a class="sourceLine" id="cb2248-8" data-line-number="8">       <span class="dt">x =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2248-9" data-line-number="9"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">60</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2248-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-20-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Save the <code>stanvars</code>.</p>
<div class="sourceCode" id="cb2249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2249-1" data-line-number="1">stanvars &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb2249-2" data-line-number="2"><span class="st">  </span><span class="kw">stanvar</span>(y_log_mean, <span class="dt">name =</span> <span class="st">&quot;y_log_mean&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2249-3" data-line-number="3"><span class="st">  </span><span class="kw">stanvar</span>(y_log_sd,   <span class="dt">name =</span> <span class="st">&quot;y_log_sd&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2249-4" data-line-number="4"><span class="st">  </span><span class="kw">stanvar</span>(s_r<span class="op">$</span>shape,  <span class="dt">name =</span> <span class="st">&quot;alpha&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2249-5" data-line-number="5"><span class="st">  </span><span class="kw">stanvar</span>(s_r<span class="op">$</span>rate,   <span class="dt">name =</span> <span class="st">&quot;beta&quot;</span>)</a></code></pre></div>
<p>Fit Kruschke’s model with <strong>brms</strong>.</p>
<div class="sourceCode" id="cb2250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2250-1" data-line-number="1">fit24<span class="fl">.1</span> &lt;-</a>
<a class="sourceLine" id="cb2250-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> my_data,</a>
<a class="sourceLine" id="cb2250-3" data-line-number="3">      <span class="dt">family =</span> poisson,</a>
<a class="sourceLine" id="cb2250-4" data-line-number="4">      Count <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Hair) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Eye) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Hair<span class="op">:</span>Eye),</a>
<a class="sourceLine" id="cb2250-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(y_log_mean, y_log_sd <span class="op">*</span><span class="st"> </span><span class="dv">2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb2250-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">gamma</span>(alpha, beta), <span class="dt">class =</span> sd)),</a>
<a class="sourceLine" id="cb2250-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">3000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb2250-8" data-line-number="8">      <span class="dt">seed =</span> <span class="dv">24</span>,</a>
<a class="sourceLine" id="cb2250-9" data-line-number="9">      <span class="dt">stanvars =</span> stanvars,</a>
<a class="sourceLine" id="cb2250-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/fit24.01&quot;</span>)</a></code></pre></div>
<p>As it turns out, if you try to fit Kruschke’s model with <strong>brms</strong> as is, you’ll run into difficulties with divergent transitions and the like. One approach is to try tuning the <code>adapt_delta</code> and <code>max_treedepth</code> parameters. I had no luck with that approach. E.g., cranking <code>adapt_delta</code> up past <code>0.9999</code> still returned a divergent transition or two.</p>
<p>Another approach is to step back and assess the model. We’re trying to fit a multilevel model with two grouping variables and their interaction with a total of 16 data points. That’s not a lot of data for fitting such a model. If you take a close look at our priors, you’ll notice they’re really quite weak. If you’re willing to tighten them up just a bit, the model can fit more smoothly. That will be our approach.</p>
<p>For the <span class="math inline">\(\sigma\)</span> hyperparameter of the overall intercept’s Gaussian prior, Kruschke would have us multiply <code>y_log_sd</code> by 2. Here we’ll tighten up that <span class="math inline">\(\sigma\)</span> hyperparameter by simply setting it to <code>y_log_sd</code>. The gamma priors for the upper-level variance parameters were based on a mode of <code>y_log_sd</code> and a standard deviation of the same but multiplied by 2 (i.e., <code>2 * y_log_sd</code>). We’ll tighten that up a bit by simply defining those gammas by a standard deviation of <code>y_log_sd</code>. When you make those adjustments, the model fits with less fuss. In case you’re curious, here is what those priors look like.</p>
<div class="sourceCode" id="cb2251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2251-1" data-line-number="1"><span class="co"># redifine our shape and rate</span></a>
<a class="sourceLine" id="cb2251-2" data-line-number="2">s_r &lt;-<span class="st"> </span><span class="kw">gamma_a_b_from_omega_sigma</span>(<span class="dt">mode =</span> y_log_sd, <span class="dt">sd =</span> y_log_sd)</a>
<a class="sourceLine" id="cb2251-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2251-4" data-line-number="4"><span class="co"># wrangle</span></a>
<a class="sourceLine" id="cb2251-5" data-line-number="5"><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb2251-6" data-line-number="6">  <span class="co"># define beta[0]</span></a>
<a class="sourceLine" id="cb2251-7" data-line-number="7">  <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> y_log_mean <span class="op">-</span><span class="st"> </span>(<span class="dv">4</span> <span class="op">*</span><span class="st"> </span>y_log_sd), <span class="dt">to =</span> y_log_mean <span class="op">+</span><span class="st"> </span>(<span class="dv">4</span> <span class="op">*</span><span class="st"> </span>y_log_sd), <span class="dt">length.out =</span> <span class="fl">1e3</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2251-8" data-line-number="8"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">dnorm</span>(x, y_log_mean, y_log_sd)),</a>
<a class="sourceLine" id="cb2251-9" data-line-number="9">  <span class="co"># define sigma[beta[x]]</span></a>
<a class="sourceLine" id="cb2251-10" data-line-number="10">  <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">40</span>, <span class="dt">length.out =</span> <span class="fl">1e3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2251-11" data-line-number="11"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">dgamma</span>(x, s_r<span class="op">$</span>shape, s_r<span class="op">$</span>rate))</a>
<a class="sourceLine" id="cb2251-12" data-line-number="12">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2251-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;beta[0]&quot;</span>, <span class="st">&quot;sigma[beta*x]&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2251-14" data-line-number="14"><span class="st">  </span></a>
<a class="sourceLine" id="cb2251-15" data-line-number="15"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb2251-16" data-line-number="16"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> density)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2251-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2251-18" data-line-number="18"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2251-19" data-line-number="19"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Priors&quot;</span>,</a>
<a class="sourceLine" id="cb2251-20" data-line-number="20">       <span class="dt">x =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2251-21" data-line-number="21"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb2251-22" data-line-number="22"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>prior, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-23-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Update the <code>stanvars</code>.</p>
<div class="sourceCode" id="cb2252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2252-1" data-line-number="1">stanvars &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb2252-2" data-line-number="2"><span class="st">  </span><span class="kw">stanvar</span>(y_log_mean, <span class="dt">name =</span> <span class="st">&quot;y_log_mean&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2252-3" data-line-number="3"><span class="st">  </span><span class="kw">stanvar</span>(y_log_sd,   <span class="dt">name =</span> <span class="st">&quot;y_log_sd&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2252-4" data-line-number="4"><span class="st">  </span><span class="kw">stanvar</span>(s_r<span class="op">$</span>shape,  <span class="dt">name =</span> <span class="st">&quot;alpha&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2252-5" data-line-number="5"><span class="st">  </span><span class="kw">stanvar</span>(s_r<span class="op">$</span>rate,   <span class="dt">name =</span> <span class="st">&quot;beta&quot;</span>)</a></code></pre></div>
<p>Now we’ve updated our <code>stanvars</code>, we’ll fit the modified model. We should note that even this version required some adjustment to the <code>adapt_delta</code> and <code>max_treedepth</code> parameters. But it wasn’t nearly the exercise in frustration entailed in the version, above.</p>
<div class="sourceCode" id="cb2253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2253-1" data-line-number="1">fit24<span class="fl">.1</span> &lt;-</a>
<a class="sourceLine" id="cb2253-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> my_data,</a>
<a class="sourceLine" id="cb2253-3" data-line-number="3">      <span class="dt">family =</span> poisson,</a>
<a class="sourceLine" id="cb2253-4" data-line-number="4">      Count <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Hair) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Eye) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>Hair<span class="op">:</span>Eye),</a>
<a class="sourceLine" id="cb2253-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(y_log_mean, y_log_sd), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb2253-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">gamma</span>(alpha, beta), <span class="dt">class =</span> sd)),</a>
<a class="sourceLine" id="cb2253-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">3000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb2253-8" data-line-number="8">      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.99</span>,</a>
<a class="sourceLine" id="cb2253-9" data-line-number="9">                     <span class="dt">max_treedepth =</span> <span class="dv">11</span>),</a>
<a class="sourceLine" id="cb2253-10" data-line-number="10">      <span class="dt">stanvars =</span> stanvars,</a>
<a class="sourceLine" id="cb2253-11" data-line-number="11">      <span class="dt">seed =</span> <span class="dv">24</span>,</a>
<a class="sourceLine" id="cb2253-12" data-line-number="12">      <span class="dt">file =</span> <span class="st">&quot;fits/fit24.01&quot;</span>)</a></code></pre></div>
<p>Take a look at the parameter summary.</p>
<div class="sourceCode" id="cb2254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2254-1" data-line-number="1"><span class="kw">print</span>(fit24<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##  Family: poisson 
##   Links: mu = log 
## Formula: Count ~ 1 + (1 | Hair) + (1 | Eye) + (1 | Hair:Eye) 
##    Data: my_data (Number of observations: 16) 
## Samples: 4 chains, each with iter = 3000; warmup = 1000; thin = 1;
##          total post-warmup samples = 8000
## 
## Group-Level Effects: 
## ~Eye (Number of levels: 4) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     1.83      1.62     0.29     6.37 1.00     3494     5176
## 
## ~Hair (Number of levels: 4) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     1.93      1.57     0.36     6.16 1.00     3326     5218
## 
## ~Hair:Eye (Number of levels: 16) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.94      0.29     0.54     1.63 1.00     3344     5137
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     3.22      1.54    -0.04     6.49 1.00     4685     4300
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>You’ll notice that even though we tightened up the priors, the parameter estimates are still quite small relative to the values they allowed for. So even our tightened priors were quite permissive.</p>
<p>Let’s post process in preparation for Figure 24.3.</p>
<div class="sourceCode" id="cb2256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2256-1" data-line-number="1">nd &lt;-</a>
<a class="sourceLine" id="cb2256-2" data-line-number="2"><span class="st">  </span>my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2256-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(Eye, Hair) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2256-4" data-line-number="4"><span class="st">  </span><span class="co"># make the titles for the facet strips</span></a>
<a class="sourceLine" id="cb2256-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">strip =</span> <span class="kw">str_c</span>(<span class="st">&quot;E:&quot;</span>, Eye, <span class="st">&quot; H:&quot;</span>, Hair, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">N = &quot;</span>, Count))</a>
<a class="sourceLine" id="cb2256-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2256-7" data-line-number="7">f &lt;-</a>
<a class="sourceLine" id="cb2256-8" data-line-number="8"><span class="st">  </span><span class="kw">fitted</span>(fit24<span class="fl">.1</span>,</a>
<a class="sourceLine" id="cb2256-9" data-line-number="9">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb2256-10" data-line-number="10">         <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2256-11" data-line-number="11"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2256-12" data-line-number="12"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">pull</span>(nd, strip))</a>
<a class="sourceLine" id="cb2256-13" data-line-number="13"></a>
<a class="sourceLine" id="cb2256-14" data-line-number="14"><span class="kw">glimpse</span>(f)</a></code></pre></div>
<pre><code>## Rows: 8,000
## Columns: 16
## $ `E:Blue H:Black\nN = 20`      &lt;dbl&gt; 24.23364, 13.63719, 19.55832, 26.13812,…
## $ `E:Blue H:Brunette\nN = 84`   &lt;dbl&gt; 86.39334, 97.81758, 72.61219, 79.27535,…
## $ `E:Blue H:Red\nN = 17`        &lt;dbl&gt; 20.54182, 21.13492, 14.66423, 18.26783,…
## $ `E:Blue H:Blond\nN = 94`      &lt;dbl&gt; 77.78793, 89.48316, 110.42520, 95.60393…
## $ `E:Brown H:Black\nN = 68`     &lt;dbl&gt; 73.53992, 64.42050, 71.93415, 70.85845,…
## $ `E:Brown H:Brunette\nN = 119` &lt;dbl&gt; 107.03246, 141.67926, 98.50453, 105.916…
## $ `E:Brown H:Red\nN = 26`       &lt;dbl&gt; 15.75136, 26.04823, 28.05642, 26.50590,…
## $ `E:Brown H:Blond\nN = 7`      &lt;dbl&gt; 3.623288, 7.148385, 5.402978, 7.771755,…
## $ `E:Green H:Black\nN = 5`      &lt;dbl&gt; 2.225095, 6.290099, 4.262199, 5.220274,…
## $ `E:Green H:Brunette\nN = 29`  &lt;dbl&gt; 33.02071, 31.74593, 33.22965, 27.76614,…
## $ `E:Green H:Red\nN = 14`       &lt;dbl&gt; 19.039984, 14.301296, 13.630850, 19.270…
## $ `E:Green H:Blond\nN = 16`     &lt;dbl&gt; 22.66838, 13.21046, 11.65272, 15.55048,…
## $ `E:Hazel H:Black\nN = 15`     &lt;dbl&gt; 11.094318, 7.580367, 21.340511, 19.2891…
## $ `E:Hazel H:Brunette\nN = 54`  &lt;dbl&gt; 68.04391, 57.82478, 49.07217, 50.65642,…
## $ `E:Hazel H:Red\nN = 14`       &lt;dbl&gt; 14.986971, 16.206171, 10.938308, 14.923…
## $ `E:Hazel H:Blond\nN = 10`     &lt;dbl&gt; 10.105688, 6.760359, 9.542513, 10.05444…</code></pre>
<p>Notice that when working with a Poisson model, <code>fitted()</code> defaults to returning estimates in the <span class="math inline">\(\lambda\)</span> metric. If we want proportions/probabilities, we’ll have to compute them by dividing by the total <span class="math inline">\(N\)</span>. In this case <span class="math inline">\(N = 592\)</span>, which we get with <code>sum(my_data$Count)</code>. Here we convert the data to the long format, compute the proportions, and plot to make the top portion of Figure 24.3.</p>
<div class="sourceCode" id="cb2258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2258-1" data-line-number="1">f <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2258-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>(key, count) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2258-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">proportion =</span> count <span class="op">/</span><span class="st"> </span><span class="dv">592</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2258-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb2258-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> proportion, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2258-6" data-line-number="6"><span class="st">  </span><span class="kw">stat_histintervalh</span>(<span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="fl">.95</span>,</a>
<a class="sourceLine" id="cb2258-7" data-line-number="7">                     <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">slab_color =</span> <span class="st">&quot;grey92&quot;</span>,</a>
<a class="sourceLine" id="cb2258-8" data-line-number="8">                     <span class="dt">breaks =</span> <span class="dv">20</span>, <span class="dt">slab_size =</span> <span class="fl">.125</span>, <span class="dt">outline_bars =</span> T,</a>
<a class="sourceLine" id="cb2258-9" data-line-number="9">                     <span class="dt">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2258-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.1</span>, <span class="fl">.2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2258-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2258-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.25</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2258-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb2258-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-27-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>We’ll have to work a bit to get the deflection differences. If this was a simple multilevel model with a single random grouping variable, we could just use the <code>ranef()</code> function to return the deflections. Like <code>fitted()</code>, it’ll return summaries by default. But you can get the posterior draws with the <code>summary = F</code> argument. But since we used two grouping variables and their interaction, it’d be a bit of a pain to work that way. Happily, we do have a handy alternative. First, if we use the <code>scale = &quot;linear&quot;</code> argument, <code>fitted()</code> will return the draws in the <span class="math inline">\(\lambda\)</span> scale rather than the original count metric. With the group-level draws in the <span class="math inline">\(\lambda\)</span> metric, all we need to do is subtract the fixed effect (i.e., the grand mean, the population estimate) from each to convert them to the deflection metric. So below, we’ll</p>
<ol style="list-style-type: lower-alpha">
<li>make a custom <code>make_deflection()</code> function to do the conversions,</li>
<li>redefine our <code>nd</code> data to make our naming conventions a little more streamlined,</li>
<li>use <code>fitted()</code> and its <code>scale = &quot;linear&quot;</code> argument to get the draws in the <span class="math inline">\(\lambda\)</span> metric,</li>
<li>wrangle a touch, and</li>
<li>use our handy <code>make_deflection()</code> function to convert the results to the deflection metric.</li>
</ol>
<p>I know; that’s a lot. If you get lost, just go step by step and examine the results along the way.</p>
<div class="sourceCode" id="cb2259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2259-1" data-line-number="1"><span class="co"># a. make a custom function</span></a>
<a class="sourceLine" id="cb2259-2" data-line-number="2">make_deflection &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb2259-3" data-line-number="3">  x <span class="op">-</span><span class="st"> </span><span class="kw">posterior_samples</span>(fit24<span class="fl">.1</span>)<span class="op">$</span>b_Intercept</a>
<a class="sourceLine" id="cb2259-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb2259-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2259-6" data-line-number="6"><span class="co"># b. streamline `nd`</span></a>
<a class="sourceLine" id="cb2259-7" data-line-number="7">nd &lt;-</a>
<a class="sourceLine" id="cb2259-8" data-line-number="8"><span class="st">  </span>my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2259-9" data-line-number="9"><span class="st">  </span><span class="kw">arrange</span>(Eye, Hair) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2259-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">strip =</span> <span class="kw">str_c</span>(<span class="st">&quot;E:&quot;</span>, Eye, <span class="st">&quot; H:&quot;</span>, Hair))</a>
<a class="sourceLine" id="cb2259-11" data-line-number="11"></a>
<a class="sourceLine" id="cb2259-12" data-line-number="12"><span class="co"># c. use `fitted()`</span></a>
<a class="sourceLine" id="cb2259-13" data-line-number="13">deflections &lt;-</a>
<a class="sourceLine" id="cb2259-14" data-line-number="14"><span class="st">  </span><span class="kw">fitted</span>(fit24<span class="fl">.1</span>,</a>
<a class="sourceLine" id="cb2259-15" data-line-number="15">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb2259-16" data-line-number="16">         <span class="dt">summary =</span> F,</a>
<a class="sourceLine" id="cb2259-17" data-line-number="17">         <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2259-18" data-line-number="18"><span class="st">  </span><span class="co"># d. wrangle</span></a>
<a class="sourceLine" id="cb2259-19" data-line-number="19"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2259-20" data-line-number="20"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">pull</span>(nd, strip)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2259-21" data-line-number="21"><span class="st">  </span><span class="co"># e. use the `make_deflection()` function</span></a>
<a class="sourceLine" id="cb2259-22" data-line-number="22"><span class="st">  </span><span class="kw">mutate_all</span>(<span class="dt">.funs =</span> make_deflection)</a>
<a class="sourceLine" id="cb2259-23" data-line-number="23"></a>
<a class="sourceLine" id="cb2259-24" data-line-number="24"><span class="co"># what have we done?</span></a>
<a class="sourceLine" id="cb2259-25" data-line-number="25"><span class="kw">glimpse</span>(deflections)</a></code></pre></div>
<pre><code>## Rows: 8,000
## Columns: 16
## $ `E:Blue H:Black`     &lt;dbl&gt; 0.4002170, -1.5435698, -0.4282591, -0.2441199, -…
## $ `E:Blue H:Brunette`  &lt;dbl&gt; 1.67138593, 0.42673381, 0.88347286, 0.86541257, …
## $ `E:Blue H:Red`       &lt;dbl&gt; 0.23493821, -1.10544406, -0.71624886, -0.6023731…
## $ `E:Blue H:Blond`     &lt;dbl&gt; 1.5664616, 0.3376799, 1.3026784, 1.0526994, 0.82…
## $ `E:Brown H:Black`    &lt;dbl&gt; 1.510303801, 0.009061406, 0.874091152, 0.7531695…
## $ `E:Brown H:Brunette` &lt;dbl&gt; 1.8856075, 0.7971953, 1.1884426, 1.1551389, 0.89…
## $ `E:Brown H:Red`      &lt;dbl&gt; -0.03059798, -0.89642081, -0.06744234, -0.230147…
## $ `E:Brown H:Blond`    &lt;dbl&gt; -1.5001427, -2.1894841, -1.7147097, -1.4570187, …
## $ `E:Green H:Black`    &lt;dbl&gt; -1.98772482, -2.31739364, -1.95187475, -1.854964…
## $ `E:Green H:Brunette` &lt;dbl&gt; 0.70961034, -0.69860606, 0.10178253, -0.18369737…
## $ `E:Green H:Red`      &lt;dbl&gt; 0.1590166, -1.4960203, -0.7893244, -0.5489481, -…
## $ `E:Green H:Blond`    &lt;dbl&gt; 0.3334465, -1.5753613, -0.9461204, -0.7634230, -…
## $ `E:Hazel H:Black`    &lt;dbl&gt; -0.3810916, -2.1308089, -0.3410528, -0.5479710, …
## $ `E:Hazel H:Brunette` &lt;dbl&gt; 1.43262856, -0.09895315, 0.49163215, 0.41755128,…
## $ `E:Hazel H:Red`      &lt;dbl&gt; -0.08034337, -1.37097844, -1.00938884, -0.804557…
## $ `E:Hazel H:Blond`    &lt;dbl&gt; -0.47442621, -2.24529451, -1.14590312, -1.199499…</code></pre>
<p>Now we’re ready to define our difference columns and plot our version of the lower panels in Figure 24.3.</p>
<div class="sourceCode" id="cb2261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2261-1" data-line-number="1">deflections <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2261-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">Blue − Brown @ Black</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">E:Blue H:Black</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">E:Brown H:Black</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb2261-3" data-line-number="3">            <span class="st">`</span><span class="dt">Blue − Brown @ Blond</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">E:Blue H:Blond</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">E:Brown H:Blond</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2261-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Blue.v.Brown</span><span class="ch">\n</span><span class="dt">(x)</span><span class="ch">\n</span><span class="dt">Black.v.Blond</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">Blue − Brown @ Black</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">Blue − Brown @ Blond</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2261-5" data-line-number="5"><span class="st">  </span><span class="kw">gather</span>(key, difference) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2261-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb2261-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> difference, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2261-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_rect</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> <span class="fl">-.1</span>, <span class="dt">xmax =</span> <span class="fl">.1</span>,</a>
<a class="sourceLine" id="cb2261-9" data-line-number="9">                <span class="dt">ymin =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb2261-10" data-line-number="10">            <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2261-11" data-line-number="11"><span class="st">  </span><span class="kw">stat_histintervalh</span>(<span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="fl">.95</span>,</a>
<a class="sourceLine" id="cb2261-12" data-line-number="12">                     <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">slab_color =</span> <span class="st">&quot;grey92&quot;</span>,</a>
<a class="sourceLine" id="cb2261-13" data-line-number="13">                     <span class="dt">breaks =</span> <span class="dv">30</span>, <span class="dt">slab_size =</span> <span class="fl">.25</span>, <span class="dt">outline_bars =</span> T,</a>
<a class="sourceLine" id="cb2261-14" data-line-number="14">                     <span class="dt">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2261-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2261-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb2261-17" data-line-number="17"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-29-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>If you’re curious, here are the precise summary values.</p>
<div class="sourceCode" id="cb2262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2262-1" data-line-number="1">deflections <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2262-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Blue − Brown @ Black</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">E:Blue H:Black</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">E:Brown H:Black</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb2262-3" data-line-number="3">         <span class="st">`</span><span class="dt">Blue − Brown @ Blond</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">E:Blue H:Blond</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">E:Brown H:Blond</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2262-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Blue.v.Brown</span><span class="ch">\n</span><span class="dt">(x)</span><span class="ch">\n</span><span class="dt">Black.v.Blond</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">Blue − Brown @ Black</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">Blue − Brown @ Blond</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2262-5" data-line-number="5"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="st">`</span><span class="dt">Blue − Brown @ Black</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">Blue.v.Brown</span><span class="ch">\n</span><span class="dt">(x)</span><span class="ch">\n</span><span class="dt">Black.v.Blond</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2262-6" data-line-number="6"><span class="st">  </span><span class="kw">group_by</span>(name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2262-7" data-line-number="7"><span class="st">  </span><span class="kw">mode_hdi</span>(value)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 7
##   name                               value .lower .upper .width .point .interval
##   &lt;chr&gt;                              &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 &quot;Blue − Brown @ Black&quot;             -1.23  -1.70 -0.716   0.95 mode   hdi      
## 2 &quot;Blue − Brown @ Blond&quot;              2.39   1.73  3.14    0.95 mode   hdi      
## 3 &quot;Blue.v.Brown\n(x)\nBlack.v.Blond&quot; -3.56  -4.50 -2.73    0.95 mode   hdi</code></pre>
</div>
<div id="example-interaction-contrasts-shrinkage-and-omnibus-test" class="section level2">
<h2><span class="header-section-number">24.3</span> Example: Interaction contrasts, shrinkage, and omnibus test</h2>
<p>“In this section, we consider some contrived data to illustrate aspects of interaction contrasts. Like the eye and hair data, the fictitious data have two attributes with four levels each” (p. 713). Let’s make the data.</p>
<div class="sourceCode" id="cb2264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2264-1" data-line-number="1">my_data &lt;-</a>
<a class="sourceLine" id="cb2264-2" data-line-number="2"><span class="st">  </span><span class="kw">crossing</span>(<span class="dt">a =</span> <span class="kw">str_c</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>),</a>
<a class="sourceLine" id="cb2264-3" data-line-number="3">           <span class="dt">b =</span> <span class="kw">str_c</span>(<span class="st">&quot;b&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2264-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">count =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">22</span>, <span class="dv">11</span>), <span class="dt">each =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rep</span>(., <span class="dt">times =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb2264-5" data-line-number="5">                   <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">11</span>, <span class="dv">22</span>), <span class="dt">each =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rep</span>(., <span class="dt">times =</span> <span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb2264-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2264-7" data-line-number="7"><span class="kw">head</span>(my_data)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   a     b     count
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
## 1 a1    b1       22
## 2 a1    b2       22
## 3 a1    b3       11
## 4 a1    b4       11
## 5 a2    b1       22
## 6 a2    b2       22</code></pre>
<p>In the last section, we covered how Kruschke’s broad priors can make fitting these kinds of models difficult when using HMC, particularly with so few cells. Our solution was to reign in the <span class="math inline">\(\sigma\)</span> hyperparameter for the level-one intercept and to compute the gamma prior for the hierarchical deflections based on a standard deviation of the log of the maximum standard deviation for the data rather than two times that value. Let’s explore more options.</p>
<p>This data set has 16 cells. With so few cells, one might argue for a more conservative prior on the hierarchical deflections. Why not ditch the gamma altogether for a half normal centered on zero and with a <span class="math inline">\(\sigma\)</span> hyperparameter of 1? Even though this is much tighter than Kruschke’s gamma prior approach, it’s still permissive on the <span class="math inline">\(\log\)</span> scale. As for our intercept, we’ll continue with the same approach from last time.</p>
<p>With that in mind, make the <code>stanvars</code>.</p>
<div class="sourceCode" id="cb2266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2266-1" data-line-number="1">n_x1_level &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(my_data<span class="op">$</span>a))</a>
<a class="sourceLine" id="cb2266-2" data-line-number="2">n_x2_level &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(my_data<span class="op">$</span>b))</a>
<a class="sourceLine" id="cb2266-3" data-line-number="3">n_cell     &lt;-<span class="st"> </span><span class="kw">nrow</span>(my_data)</a>
<a class="sourceLine" id="cb2266-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2266-5" data-line-number="5">y_log_mean &lt;-</a>
<a class="sourceLine" id="cb2266-6" data-line-number="6"><span class="st">  </span><span class="kw">log</span>(<span class="kw">sum</span>(my_data<span class="op">$</span>count) <span class="op">/</span><span class="st"> </span>(n_x1_level <span class="op">*</span><span class="st"> </span>n_x2_level))</a>
<a class="sourceLine" id="cb2266-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2266-8" data-line-number="8">y_log_sd &lt;-</a>
<a class="sourceLine" id="cb2266-9" data-line-number="9"><span class="st">  </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>, n_cell <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="kw">sum</span>(my_data<span class="op">$</span>count)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2266-10" data-line-number="10"><span class="st">  </span><span class="kw">sd</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2266-11" data-line-number="11"><span class="st">  </span><span class="kw">log</span>()</a>
<a class="sourceLine" id="cb2266-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2266-13" data-line-number="13">stanvars &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb2266-14" data-line-number="14"><span class="st">  </span><span class="kw">stanvar</span>(y_log_mean, <span class="dt">name =</span> <span class="st">&quot;y_log_mean&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2266-15" data-line-number="15"><span class="st">  </span><span class="kw">stanvar</span>(y_log_sd,   <span class="dt">name =</span> <span class="st">&quot;y_log_sd&quot;</span>)</a></code></pre></div>
<p>Just for kicks, let’s take a quick look at our priors.</p>
<div class="sourceCode" id="cb2267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2267-1" data-line-number="1"><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb2267-2" data-line-number="2">  <span class="co"># define beta[0]</span></a>
<a class="sourceLine" id="cb2267-3" data-line-number="3">  <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> y_log_mean <span class="op">-</span><span class="st"> </span>(<span class="dv">4</span> <span class="op">*</span><span class="st"> </span>y_log_sd), <span class="dt">to =</span> y_log_mean <span class="op">+</span><span class="st"> </span>(<span class="dv">4</span> <span class="op">*</span><span class="st"> </span>y_log_sd), <span class="dt">length.out =</span> <span class="fl">1e3</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2267-4" data-line-number="4"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">dnorm</span>(x, y_log_mean, y_log_sd)),</a>
<a class="sourceLine" id="cb2267-5" data-line-number="5">  <span class="co"># define sigma[beta[x]]</span></a>
<a class="sourceLine" id="cb2267-6" data-line-number="6">  <span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">5</span>, <span class="dt">length.out =</span> <span class="fl">1e3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2267-7" data-line-number="7"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">density =</span> <span class="kw">dnorm</span>(x, <span class="dv">0</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb2267-8" data-line-number="8">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2267-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prior =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;beta[0]&quot;</span>, <span class="st">&quot;sigma[beta*x]&quot;</span>), <span class="dt">each =</span> <span class="kw">n</span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2267-10" data-line-number="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb2267-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> density)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2267-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2267-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2267-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Priors&quot;</span>,</a>
<a class="sourceLine" id="cb2267-15" data-line-number="15">       <span class="dt">x =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2267-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb2267-17" data-line-number="17"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>prior, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">labeller =</span> label_parsed)</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-33-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Fit the model.</p>
<div class="sourceCode" id="cb2268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2268-1" data-line-number="1">fit24<span class="fl">.2</span> &lt;-</a>
<a class="sourceLine" id="cb2268-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> my_data,</a>
<a class="sourceLine" id="cb2268-3" data-line-number="3">      <span class="dt">family =</span> poisson,</a>
<a class="sourceLine" id="cb2268-4" data-line-number="4">      count <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>a) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>b) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>a<span class="op">:</span>b),</a>
<a class="sourceLine" id="cb2268-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(y_log_mean, y_log_sd), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb2268-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sd)),</a>
<a class="sourceLine" id="cb2268-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">3000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb2268-8" data-line-number="8">      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.999</span>),</a>
<a class="sourceLine" id="cb2268-9" data-line-number="9">      <span class="dt">stanvars =</span> stanvars,</a>
<a class="sourceLine" id="cb2268-10" data-line-number="10">      <span class="dt">seed =</span> <span class="dv">24</span>,</a>
<a class="sourceLine" id="cb2268-11" data-line-number="11">      <span class="dt">file =</span> <span class="st">&quot;fits/fit24.02&quot;</span>)</a></code></pre></div>
<p>Review the summary.</p>
<div class="sourceCode" id="cb2269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2269-1" data-line-number="1"><span class="kw">print</span>(fit24<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>##  Family: poisson 
##   Links: mu = log 
## Formula: count ~ 1 + (1 | a) + (1 | b) + (1 | a:b) 
##    Data: my_data (Number of observations: 16) 
## Samples: 4 chains, each with iter = 3000; warmup = 1000; thin = 1;
##          total post-warmup samples = 8000
## 
## Group-Level Effects: 
## ~a (Number of levels: 4) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.17      0.19     0.00     0.66 1.00     2578     4184
## 
## ~a:b (Number of levels: 16) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.31      0.12     0.10     0.57 1.00     2555     2693
## 
## ~b (Number of levels: 4) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.16      0.19     0.00     0.69 1.00     3072     3874
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     2.76      0.20     2.35     3.16 1.00     3655     3416
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>We might plot our <span class="math inline">\(\sigma[x]\)</span> posteriors against our prior to get a sense of how strong it was.</p>
<div class="sourceCode" id="cb2271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2271-1" data-line-number="1"><span class="kw">posterior_samples</span>(fit24<span class="fl">.2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2271-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;sd&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2271-3" data-line-number="3"><span class="st">  </span><span class="co"># set_names(str_c(&quot;expression(sigma&quot;, c(&quot;*a&quot;, &quot;*ab&quot;, &quot;*b&quot;), &quot;)&quot;)) %&gt;% </span></a>
<a class="sourceLine" id="cb2271-4" data-line-number="4"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>(),</a>
<a class="sourceLine" id="cb2271-5" data-line-number="5">               <span class="dt">names_to =</span> <span class="st">&quot;sd&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2271-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb2271-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2271-8" data-line-number="8"><span class="st">  </span><span class="co"># prior</span></a>
<a class="sourceLine" id="cb2271-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">data =</span> <span class="kw">tibble</span>(<span class="dt">value =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="fl">3.5</span>, <span class="dt">by  =</span>.<span class="dv">01</span>)),</a>
<a class="sourceLine" id="cb2271-10" data-line-number="10">              <span class="kw">aes</span>(<span class="dt">ymin =</span> <span class="dv">0</span>, <span class="dt">ymax =</span> <span class="kw">dnorm</span>(value, <span class="dv">0</span>, <span class="dv">1</span>)),</a>
<a class="sourceLine" id="cb2271-11" data-line-number="11">              <span class="dt">fill =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2271-12" data-line-number="12"><span class="st">  </span><span class="co"># posterior</span></a>
<a class="sourceLine" id="cb2271-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> sd),</a>
<a class="sourceLine" id="cb2271-14" data-line-number="14">               <span class="dt">size =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2271-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">begin =</span> <span class="fl">.2</span>, <span class="dt">end =</span> <span class="fl">.8</span>,</a>
<a class="sourceLine" id="cb2271-16" data-line-number="16">                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="kw">expression</span>(sigma[a]),</a>
<a class="sourceLine" id="cb2271-17" data-line-number="17">                                  <span class="kw">expression</span>(sigma[ab]),</a>
<a class="sourceLine" id="cb2271-18" data-line-number="18">                                  <span class="kw">expression</span>(sigma[b])),</a>
<a class="sourceLine" id="cb2271-19" data-line-number="19">                       <span class="dt">guide =</span> <span class="kw">guide_legend</span>(<span class="dt">label.hjust =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2271-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2271-21" data-line-number="21"><span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2271-22" data-line-number="22"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb2271-23" data-line-number="23">        <span class="dt">legend.position =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.8</span>),</a>
<a class="sourceLine" id="cb2271-24" data-line-number="24">        <span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>))</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-35-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Our <span class="math inline">\(\operatorname{Normal}^+ (0, 1)\)</span> prior is that short medium-gray shape in the background. The posteriors are the taller and more colorful mounds in the foreground. Here’s the top part of Figure 24.4.</p>
<div class="sourceCode" id="cb2272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2272-1" data-line-number="1">nd &lt;-</a>
<a class="sourceLine" id="cb2272-2" data-line-number="2"><span class="st">  </span>my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2272-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">strip =</span> <span class="kw">str_c</span>(<span class="st">&quot;a:&quot;</span>, a, <span class="st">&quot; b:&quot;</span>, b, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">N = &quot;</span>, count))</a>
<a class="sourceLine" id="cb2272-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2272-5" data-line-number="5"><span class="kw">fitted</span>(fit24<span class="fl">.2</span>,</a>
<a class="sourceLine" id="cb2272-6" data-line-number="6">       <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb2272-7" data-line-number="7">       <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2272-8" data-line-number="8"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2272-9" data-line-number="9"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">pull</span>(nd, strip)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2272-10" data-line-number="10"><span class="st">  </span><span class="kw">gather</span>(key, count) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2272-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">proportion =</span> count <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(my_data<span class="op">$</span>count)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2272-12" data-line-number="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb2272-13" data-line-number="13"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb2272-14" data-line-number="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> proportion, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2272-15" data-line-number="15"><span class="st">  </span><span class="kw">stat_histintervalh</span>(<span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="fl">.95</span>,</a>
<a class="sourceLine" id="cb2272-16" data-line-number="16">                     <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">slab_color =</span> <span class="st">&quot;grey92&quot;</span>,</a>
<a class="sourceLine" id="cb2272-17" data-line-number="17">                     <span class="dt">breaks =</span> <span class="dv">20</span>, <span class="dt">slab_size =</span> <span class="fl">.25</span>, <span class="dt">outline_bars =</span> T,</a>
<a class="sourceLine" id="cb2272-18" data-line-number="18">                     <span class="dt">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2272-19" data-line-number="19"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(.<span class="dv">05</span>, <span class="fl">.1</span>, <span class="fl">.15</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2272-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2272-21" data-line-number="21"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.15</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2272-22" data-line-number="22"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb2272-23" data-line-number="23"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-36-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Like before, we’ll have to work a bit to get the deflection differences.</p>
<div class="sourceCode" id="cb2273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2273-1" data-line-number="1"><span class="co"># streamline `nd`</span></a>
<a class="sourceLine" id="cb2273-2" data-line-number="2">nd &lt;-</a>
<a class="sourceLine" id="cb2273-3" data-line-number="3"><span class="st">  </span>my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2273-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">strip =</span> <span class="kw">str_c</span>(<span class="st">&quot;a:&quot;</span>, a, <span class="st">&quot; b:&quot;</span>, b))</a>
<a class="sourceLine" id="cb2273-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2273-6" data-line-number="6"><span class="co"># use `fitted()`</span></a>
<a class="sourceLine" id="cb2273-7" data-line-number="7">deflections &lt;-</a>
<a class="sourceLine" id="cb2273-8" data-line-number="8"><span class="st">  </span><span class="kw">fitted</span>(fit24<span class="fl">.2</span>,</a>
<a class="sourceLine" id="cb2273-9" data-line-number="9">         <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb2273-10" data-line-number="10">         <span class="dt">summary =</span> F,</a>
<a class="sourceLine" id="cb2273-11" data-line-number="11">         <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2273-12" data-line-number="12"><span class="st">  </span><span class="co"># wrangle</span></a>
<a class="sourceLine" id="cb2273-13" data-line-number="13"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2273-14" data-line-number="14"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">pull</span>(nd, strip)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2273-15" data-line-number="15"><span class="st">  </span><span class="co"># use the `make_deflection()` function</span></a>
<a class="sourceLine" id="cb2273-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate_all</span>(<span class="dt">.funs =</span> make_deflection)</a>
<a class="sourceLine" id="cb2273-17" data-line-number="17"></a>
<a class="sourceLine" id="cb2273-18" data-line-number="18"><span class="co"># what have we done?</span></a>
<a class="sourceLine" id="cb2273-19" data-line-number="19"><span class="kw">glimpse</span>(deflections)</a></code></pre></div>
<pre><code>## Rows: 8,000
## Columns: 16
## $ `a:a1 b:b1` &lt;dbl&gt; 0.25711971, -1.23839562, -0.26126870, -0.50365853, -0.813…
## $ `a:a1 b:b2` &lt;dbl&gt; 0.33022495, -1.14228560, -0.25753173, -0.57421602, -1.134…
## $ `a:a1 b:b3` &lt;dbl&gt; -0.1192869, -1.7308527, -0.4387441, -1.4138614, -1.194692…
## $ `a:a1 b:b4` &lt;dbl&gt; 0.1517327, -1.2943771, -1.2349436, -0.6238803, -1.2244664…
## $ `a:a2 b:b1` &lt;dbl&gt; 0.30888843, -1.15477128, -0.31054063, -0.28530205, -1.082…
## $ `a:a2 b:b2` &lt;dbl&gt; 0.28453788, -1.34459314, -0.17528220, -0.60812582, -0.835…
## $ `a:a2 b:b3` &lt;dbl&gt; 0.1917940, -1.2556402, -1.1079670, -0.7956730, -1.0369094…
## $ `a:a2 b:b4` &lt;dbl&gt; -0.03761425, -1.52218327, -1.06944893, -0.76729942, -1.22…
## $ `a:a3 b:b1` &lt;dbl&gt; 0.01037051, -1.46550902, -0.89236624, -0.90323453, -1.437…
## $ `a:a3 b:b2` &lt;dbl&gt; -0.15321344, -1.61504248, -0.59620940, -1.30486758, -1.11…
## $ `a:a3 b:b3` &lt;dbl&gt; 0.2817608, -1.1612039, -0.1037781, -0.8032772, -1.0008909…
## $ `a:a3 b:b4` &lt;dbl&gt; 0.07675266, -1.33198991, -0.19882258, -0.52332314, -1.105…
## $ `a:a4 b:b1` &lt;dbl&gt; -0.08454566, -1.48251247, -0.85633052, -1.08666326, -1.20…
## $ `a:a4 b:b2` &lt;dbl&gt; -0.05636790, -1.66313517, -0.64427839, -1.37506480, -1.25…
## $ `a:a4 b:b3` &lt;dbl&gt; 0.3882341, -0.9849345, -0.4873845, -0.3698213, -0.8213263…
## $ `a:a4 b:b4` &lt;dbl&gt; 0.16714657, -1.15726058, -0.45468887, -0.67137900, -0.958…</code></pre>
<p>Now we’re ready to define some of the difference columns and plot our version of the leftmost lower panel in Figure 24.4.</p>
<div class="sourceCode" id="cb2275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2275-1" data-line-number="1">deflections <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2275-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">a2 - a3 @ b2</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">a:a2 b:b2</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">a:a3 b:b2</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb2275-3" data-line-number="3">            <span class="st">`</span><span class="dt">a2 - a3 @ b3</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">a:a2 b:b3</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">a:a3 b:b3</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2275-4" data-line-number="4"><span class="st">  </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">a2.v.a3</span><span class="ch">\n</span><span class="dt">(x)</span><span class="ch">\n</span><span class="dt">b2.v.b3</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">a2 - a3 @ b2</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">a2 - a3 @ b3</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2275-5" data-line-number="5"><span class="st">  </span><span class="kw">gather</span>(key, difference) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2275-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb2275-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> difference, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2275-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_rect</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> <span class="fl">-.1</span>, <span class="dt">xmax =</span> <span class="fl">.1</span>,</a>
<a class="sourceLine" id="cb2275-9" data-line-number="9">                <span class="dt">ymin =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb2275-10" data-line-number="10">            <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2275-11" data-line-number="11"><span class="st">  </span><span class="kw">stat_histintervalh</span>(<span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="fl">.95</span>,</a>
<a class="sourceLine" id="cb2275-12" data-line-number="12">                     <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">slab_color =</span> <span class="st">&quot;grey92&quot;</span>,</a>
<a class="sourceLine" id="cb2275-13" data-line-number="13">                     <span class="dt">breaks =</span> <span class="dv">30</span>, <span class="dt">slab_size =</span> <span class="fl">.25</span>, <span class="dt">outline_bars =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb2275-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2275-15" data-line-number="15"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span>.<span class="dv">5</span>, <span class="fl">2.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2275-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb2275-17" data-line-number="17"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-38-1.png" width="312" style="display: block; margin: auto;" /></p>
<p>For Figure 24.4, bottom right, we average across the four cells in each quadrant and then compute the contrast.</p>
<div class="sourceCode" id="cb2276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2276-1" data-line-number="1">deflections <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2276-2" data-line-number="2"><span class="st">  </span><span class="co"># in this intermediate step, we compute the quadrant averages</span></a>
<a class="sourceLine" id="cb2276-3" data-line-number="3"><span class="st">  </span><span class="co"># `tl` = top left, `br` = bottom right, and so on</span></a>
<a class="sourceLine" id="cb2276-4" data-line-number="4"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">tl =</span> (<span class="st">`</span><span class="dt">a:a1 b:b1</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">a:a1 b:b2</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">a:a2 b:b1</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">a:a2 b:b2</span><span class="st">`</span>) <span class="op">/</span><span class="st"> </span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb2276-5" data-line-number="5">            <span class="dt">tr =</span> (<span class="st">`</span><span class="dt">a:a1 b:b3</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">a:a1 b:b4</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">a:a2 b:b3</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">a:a2 b:b4</span><span class="st">`</span>) <span class="op">/</span><span class="st"> </span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb2276-6" data-line-number="6">            <span class="dt">bl =</span> (<span class="st">`</span><span class="dt">a:a3 b:b1</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">a:a3 b:b2</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">a:a4 b:b1</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">a:a4 b:b2</span><span class="st">`</span>) <span class="op">/</span><span class="st"> </span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb2276-7" data-line-number="7">            <span class="dt">br =</span> (<span class="st">`</span><span class="dt">a:a3 b:b3</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">a:a3 b:b4</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">a:a4 b:b3</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">a:a4 b:b4</span><span class="st">`</span>) <span class="op">/</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2276-8" data-line-number="8"><span class="st">  </span><span class="co"># compute the contrast of interest</span></a>
<a class="sourceLine" id="cb2276-9" data-line-number="9"><span class="st">  </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">A1.A2.v.A3.A4</span><span class="ch">\n</span><span class="dt">(x)</span><span class="ch">\n</span><span class="dt">B1.B2.v.B3.B4</span><span class="st">`</span> =<span class="st"> </span>(tl <span class="op">-</span><span class="st"> </span>bl) <span class="op">-</span><span class="st"> </span>(tr <span class="op">-</span><span class="st"> </span>br)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2276-10" data-line-number="10"><span class="st">  </span><span class="kw">gather</span>(key, difference) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2276-11" data-line-number="11"><span class="st">  </span></a>
<a class="sourceLine" id="cb2276-12" data-line-number="12"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb2276-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> difference, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2276-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_rect</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> <span class="fl">-.1</span>, <span class="dt">xmax =</span> <span class="fl">.1</span>,</a>
<a class="sourceLine" id="cb2276-15" data-line-number="15">                <span class="dt">ymin =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb2276-16" data-line-number="16">            <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2276-17" data-line-number="17"><span class="st">  </span><span class="kw">stat_histintervalh</span>(<span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="fl">.95</span>,</a>
<a class="sourceLine" id="cb2276-18" data-line-number="18">                     <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">slab_color =</span> <span class="st">&quot;grey92&quot;</span>,</a>
<a class="sourceLine" id="cb2276-19" data-line-number="19">                     <span class="dt">breaks =</span> <span class="dv">30</span>, <span class="dt">slab_size =</span> <span class="fl">.25</span>, <span class="dt">outline_bars =</span> T) <span class="op">+</span></a>
<a class="sourceLine" id="cb2276-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2276-21" data-line-number="21"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span>.<span class="dv">5</span>, <span class="fl">2.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2276-22" data-line-number="22"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb2276-23" data-line-number="23"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-39-1.png" width="312" style="display: block; margin: auto;" /></p>
<blockquote>
<p>The model presented here has no way to conduct an “ominbus” test of interaction. However, like the ANOVA-style models presented in Chapters 19 and 20, it is easy to extend the model so it has an inclusion coefficient on the interaction deflections. The inclusion coefficient can have values of 0 or 1, and is given a Bernoulli prior. (p. 716)</p>
</blockquote>
<p>Like we discussed in earlier chapters, this isn’t a feasible approach for <strong>brms</strong>. However, we can compare this model with a simpler one that omits the interaction. First, fit the model.</p>
<div class="sourceCode" id="cb2277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2277-1" data-line-number="1">fit24<span class="fl">.3</span> &lt;-</a>
<a class="sourceLine" id="cb2277-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> my_data,</a>
<a class="sourceLine" id="cb2277-3" data-line-number="3">      <span class="dt">family =</span> poisson,</a>
<a class="sourceLine" id="cb2277-4" data-line-number="4">      count <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>a) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>b),</a>
<a class="sourceLine" id="cb2277-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(y_log_mean, y_log_sd), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb2277-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sd)),</a>
<a class="sourceLine" id="cb2277-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">3000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb2277-8" data-line-number="8">      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.9999</span>),</a>
<a class="sourceLine" id="cb2277-9" data-line-number="9">      <span class="dt">stanvars =</span> stanvars,</a>
<a class="sourceLine" id="cb2277-10" data-line-number="10">      <span class="dt">seed =</span> <span class="dv">24</span>,</a>
<a class="sourceLine" id="cb2277-11" data-line-number="11">      <span class="dt">file =</span> <span class="st">&quot;fits/fit24.03&quot;</span>)</a></code></pre></div>
<p>Now we can compare them by their stacking weights.</p>
<div class="sourceCode" id="cb2278"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2278-1" data-line-number="1"><span class="kw">model_weights</span>(fit24<span class="fl">.2</span>, fit24<span class="fl">.3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2278-2" data-line-number="2"><span class="st">  </span><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## fit24.2 fit24.3 
##       1       0</code></pre>
<p>Virtually all the weight went to the interaction model. Also, if we step back and ask ourselves what the purpose of an omnibus text of an interaction is for in this context, we’d conclude such a test is asking the question <em>Is</em> <span class="math inline">\(\sigma_{a \times b}\)</span> <em>the same as zero?</em> Let’s look again at that posterior from <code>fit24.2</code>.</p>
<div class="sourceCode" id="cb2280"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2280-1" data-line-number="1"><span class="kw">posterior_samples</span>(fit24<span class="fl">.2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2280-2" data-line-number="2"><span class="st">  </span></a>
<a class="sourceLine" id="cb2280-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">sd_a:b__Intercept</span><span class="st">`</span>, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2280-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2280-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2280-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Does this look the same as zero, to you?&quot;</span>,</a>
<a class="sourceLine" id="cb2280-7" data-line-number="7">       <span class="dt">x =</span> <span class="kw">expression</span>(sigma[a<span class="op">%*%</span>b])) <span class="op">+</span></a>
<a class="sourceLine" id="cb2280-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-41-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Sure, there’s some uncertainty in that posterior. But that is not zero. We didn’t need an omnibus test or even model comparison via stacking weights to figure that one out.</p>
<p>If you wanted to get fancy with it, we might even do a hierarchical variance decomposition. Here the question is what percentage of the hierarchical variance is attributed to <code>a</code>, <code>b</code> and their interaction? Recall that <strong>brms</strong> returns those variance parameters in the <span class="math inline">\(\sigma\)</span> metric. So before we can compare them in terms of percentages of the total variance, we have to first have to square them.</p>
<div class="sourceCode" id="cb2281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2281-1" data-line-number="1">post &lt;-</a>
<a class="sourceLine" id="cb2281-2" data-line-number="2"><span class="st">  </span><span class="kw">posterior_samples</span>(fit24<span class="fl">.2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2281-3" data-line-number="3"><span class="st">  </span><span class="kw">transmute</span>(<span class="st">`</span><span class="dt">sigma[a]^2</span><span class="st">`</span>  =<span class="st"> </span>sd_a__Intercept<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb2281-4" data-line-number="4">            <span class="st">`</span><span class="dt">sigma[b]^2</span><span class="st">`</span>  =<span class="st"> </span>sd_b__Intercept<span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb2281-5" data-line-number="5">            <span class="st">`</span><span class="dt">sigma[ab]^2</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">sd_a:b__Intercept</span><span class="st">`</span><span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2281-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">sigma[total]^2</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">sigma[a]^2</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">sigma[b]^2</span><span class="st">`</span> <span class="op">+</span><span class="st"> `</span><span class="dt">sigma[ab]^2</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb2281-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2281-8" data-line-number="8"><span class="kw">head</span>(post)</a></code></pre></div>
<pre><code>##     sigma[a]^2  sigma[b]^2 sigma[ab]^2 sigma[total]^2
## 1 0.0008054698 0.001235870  0.05442256     0.05646390
## 2 0.0009392091 0.001403585  0.07406198     0.07640477
## 3 0.0231857141 0.392527369  0.19486678     0.61057987
## 4 0.0258658175 0.098367269  0.16084684     0.28507993
## 5 0.0086783402 0.164631688  0.05889993     0.23220996
## 6 0.0554753005 0.051478990  0.18147490     0.28842919</code></pre>
<p>Now we just need to divide the individual variance parameters by their total and multiply by 100 to get the percent of variance for each. We’ll look at the results in a plot.</p>
<div class="sourceCode" id="cb2283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2283-1" data-line-number="1">post <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2283-2" data-line-number="2"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span><span class="st">`</span><span class="dt">sigma[total]^2</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2283-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">% hierarchical variance</span><span class="st">`</span> =<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span>value <span class="op">/</span><span class="st"> `</span><span class="dt">sigma[total]^2</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2283-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb2283-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">% hierarchical variance</span><span class="st">`</span>, <span class="dt">y =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2283-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">5</span>, <span class="fl">.95</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2283-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_y_discrete</span>(<span class="ot">NULL</span>, <span class="dt">labels =</span> ggplot2<span class="op">:::</span>parse_safe) <span class="op">+</span></a>
<a class="sourceLine" id="cb2283-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-43-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Just as each of the variance parameters was estimated with uncertainty, all that uncertainty got propagated into their transformations. Even in the midst of all this uncertainty, it’s clear that a good healthy portion of the hierarchical variance is from the interaction. Again, whatever you might think about <span class="math inline">\(a \times b\)</span>, it’s definitely not zero.</p>
</div>
<div id="log-linear-models-for-contingency-tables-bonus-alternative-parameterization" class="section level2">
<h2><span class="header-section-number">24.4</span> <del>Log-linear models for contingency tables</del> Bonus: Alternative parameterization</h2>
<p>The Poisson distribution is widely used for count data. But notice how in our figures, we converted the results to the proportion metric. Once you’re talking about proportions, it’s not hard to further adjust your approach to thinking in terms of probabilities. So instead of thinking about the <span class="math inline">\(n\)</span> within each cell of our contingency table, we might also think about the probability of a given condition. To approach the data this way, we could use a multilevel aggregated binomial model. McElreath covered this in Chapter 10 of his <a href="https://xcelab.net/rm/statistical-rethinking/"><em>Statistical rethinking</em></a>. See my <span class="citation">(<a href="#ref-kurzStatisticalRethinkingBrms2020">2020</a>)</span> <a href="https://bookdown.org/content/3890/counting-and-classification.html#aggregated-binomial-chimpanzees-again-condensed.">translation of the text into brms code</a>, too.</p>
<p>Here’s how to fit that model.</p>
<div class="sourceCode" id="cb2284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2284-1" data-line-number="1">fit24<span class="fl">.4</span> &lt;-</a>
<a class="sourceLine" id="cb2284-2" data-line-number="2"><span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> my_data,</a>
<a class="sourceLine" id="cb2284-3" data-line-number="3">      <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb2284-4" data-line-number="4">      count <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(<span class="dv">264</span>) <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>a) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>b) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>a<span class="op">:</span>b),</a>
<a class="sourceLine" id="cb2284-5" data-line-number="5">      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">class =</span> Intercept),</a>
<a class="sourceLine" id="cb2284-6" data-line-number="6">                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sd)),</a>
<a class="sourceLine" id="cb2284-7" data-line-number="7">      <span class="dt">iter =</span> <span class="dv">3000</span>, <span class="dt">warmup =</span> <span class="dv">1000</span>, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb2284-8" data-line-number="8">      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.999</span>),</a>
<a class="sourceLine" id="cb2284-9" data-line-number="9">      <span class="dt">seed =</span> <span class="dv">24</span>,</a>
<a class="sourceLine" id="cb2284-10" data-line-number="10">      <span class="dt">file =</span> <span class="st">&quot;fits/fit24.04&quot;</span>)</a></code></pre></div>
<p>A few things about the syntax: The aggregated binomial model uses the logit link, just like with typical logistic regression. So when you specify <code>family = binomial</code>, you’re requesting the logit link. The left side of the <code>formula</code> argument, <code>count | trials(264)</code> indicates a few things. First, our criterion is <code>count</code>. The bar <code>|</code> that follows on its right indicates we’d like add additional information about the criterion. In the case of binomial regression, <strong>brms</strong> requires we specify how many trials the value in each cell of the data is referring to. When we coded <code>trials(264)</code>, we indicated each cell was a total count of 264 trials. In case it isn’t clear, here is where the value 264 came from.</p>
<div class="sourceCode" id="cb2285"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2285-1" data-line-number="1">my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2285-2" data-line-number="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_trials =</span> <span class="kw">sum</span>(count))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   total_trials
##          &lt;dbl&gt;
## 1          264</code></pre>
<p>Now look over the summary.</p>
<div class="sourceCode" id="cb2287"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2287-1" data-line-number="1"><span class="kw">print</span>(fit24<span class="fl">.4</span>)</a></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: count | trials(264) ~ 1 + (1 | a) + (1 | b) + (1 | a:b) 
##    Data: my_data (Number of observations: 16) 
## Samples: 4 chains, each with iter = 3000; warmup = 1000; thin = 1;
##          total post-warmup samples = 8000
## 
## Group-Level Effects: 
## ~a (Number of levels: 4) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.17      0.18     0.01     0.68 1.00     2658     4026
## 
## ~a:b (Number of levels: 16) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.34      0.12     0.12     0.61 1.00     2399     2487
## 
## ~b (Number of levels: 4) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.17      0.19     0.00     0.66 1.00     2826     3992
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -2.72      0.20    -3.09    -2.27 1.00     3595     3357
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>See that <code>mu = logit</code> part in the second line of the summary? Yep, that’s our link function. Since we used a different likelihood and link function from earlier models, it shouldn’t be surprising the parameters look different. But notice how the aggregated binomial model yields virtually the same results for the top portion of Figure 24.4.</p>
<div class="sourceCode" id="cb2289"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2289-1" data-line-number="1">nd &lt;-</a>
<a class="sourceLine" id="cb2289-2" data-line-number="2"><span class="st">  </span>my_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2289-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">strip =</span> <span class="kw">str_c</span>(<span class="st">&quot;a:&quot;</span>, a, <span class="st">&quot; b:&quot;</span>, b, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">N = &quot;</span>, count))</a>
<a class="sourceLine" id="cb2289-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2289-5" data-line-number="5"><span class="kw">fitted</span>(fit24<span class="fl">.4</span>,</a>
<a class="sourceLine" id="cb2289-6" data-line-number="6">       <span class="dt">newdata =</span> nd,</a>
<a class="sourceLine" id="cb2289-7" data-line-number="7">       <span class="dt">summary =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2289-8" data-line-number="8"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2289-9" data-line-number="9"><span class="st">  </span><span class="kw">set_names</span>(<span class="kw">pull</span>(nd, strip)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2289-10" data-line-number="10"><span class="st">  </span><span class="kw">gather</span>(key, count) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2289-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">proportion =</span> count <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(my_data<span class="op">$</span>count)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2289-12" data-line-number="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb2289-13" data-line-number="13"><span class="st">  </span><span class="co"># plot!</span></a>
<a class="sourceLine" id="cb2289-14" data-line-number="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> proportion, <span class="dt">y =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2289-15" data-line-number="15"><span class="st">  </span><span class="kw">stat_histintervalh</span>(<span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="fl">.95</span>,</a>
<a class="sourceLine" id="cb2289-16" data-line-number="16">                     <span class="dt">fill =</span> <span class="st">&quot;grey67&quot;</span>, <span class="dt">slab_color =</span> <span class="st">&quot;grey92&quot;</span>,</a>
<a class="sourceLine" id="cb2289-17" data-line-number="17">                     <span class="dt">breaks =</span> <span class="dv">20</span>, <span class="dt">slab_size =</span> <span class="fl">.25</span>, <span class="dt">outline_bars =</span> T,</a>
<a class="sourceLine" id="cb2289-18" data-line-number="18">                     <span class="dt">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2289-19" data-line-number="19"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(.<span class="dv">05</span>, <span class="fl">.1</span>, <span class="fl">.15</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2289-20" data-line-number="20"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2289-21" data-line-number="21"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.15</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2289-22" data-line-number="22"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb2289-23" data-line-number="23"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>key, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-46-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>To further demonstrate the similarity of this approach to Kruschke’s multilevel Poisson approach, let’s compare the model-based cell estimates for each of the combinations of <code>a</code> and <code>b</code>, by both <code>fit24.2</code> and <code>fit24.4</code>.</p>
<div class="sourceCode" id="cb2290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2290-1" data-line-number="1"><span class="co"># compute the fitted summary statistics</span></a>
<a class="sourceLine" id="cb2290-2" data-line-number="2"><span class="kw">rbind</span>(<span class="kw">fitted</span>(fit24<span class="fl">.2</span>),</a>
<a class="sourceLine" id="cb2290-3" data-line-number="3">      <span class="kw">fitted</span>(fit24<span class="fl">.4</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2290-4" data-line-number="4"><span class="st">  </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2290-5" data-line-number="5"><span class="st">  </span><span class="co"># add an augmented version of the data</span></a>
<a class="sourceLine" id="cb2290-6" data-line-number="6"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">expand</span>(my_data, </a>
<a class="sourceLine" id="cb2290-7" data-line-number="7">                   <span class="dt">fit =</span> <span class="kw">c</span>(<span class="st">&quot;fit2 (Poisson likelihood)&quot;</span>, <span class="st">&quot;fit4 (binomial likelihood)&quot;</span>),</a>
<a class="sourceLine" id="cb2290-8" data-line-number="8">                   <span class="kw">nesting</span>(a, b, count))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2290-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cell =</span> <span class="kw">str_c</span>(a, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, b)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2290-10" data-line-number="10"><span class="st">  </span></a>
<a class="sourceLine" id="cb2290-11" data-line-number="11"><span class="st">  </span><span class="co"># plot</span></a>
<a class="sourceLine" id="cb2290-12" data-line-number="12"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> cell)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2290-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(<span class="dv">11</span>, <span class="dv">22</span>), <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2290-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Estimate, <span class="dt">ymin =</span> Q2<span class="fl">.5</span>, <span class="dt">ymax =</span> Q97<span class="fl">.5</span>, <span class="dt">color =</span> fit),</a>
<a class="sourceLine" id="cb2290-15" data-line-number="15">                  <span class="dt">fatten =</span> <span class="fl">1.25</span>, <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2290-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> count),</a>
<a class="sourceLine" id="cb2290-17" data-line-number="17">             <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2290-18" data-line-number="18"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>(<span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">begin =</span> <span class="fl">.4</span>, <span class="dt">end =</span> <span class="fl">.6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2290-19" data-line-number="19"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;count&quot;</span>, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">11</span>, <span class="dv">22</span>, <span class="dv">33</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">33</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2290-20" data-line-number="20"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb2290-21" data-line-number="21">        <span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>)</a></code></pre></div>
<p><img src="24_files/figure-gfm/unnamed-chunk-47-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>The black points are the raw data. The colored point-ranges to the left and right of each data point are the posterior means and percentile-based 95% intervals for each of the cells. The results are virtually the same between the two models. Also note how both models partially pooled towards the grand mean. That’s one of the distinctive features of using the hierarchical approach.</p>
<p>Wrapping up, this chapter focused on how one might use the Poisson likelihood to model contingency-table data from a multilevel modeling framework. The Poisson likelihood is also handy for count data within a single-level structure, with metric predictors, and with various combinations of metric and nominal predictors. For more practice along those lines, check out <a href="https://bookdown.org/content/3890/counting-and-classification.html#poisson-regression">Section 10.2</a> in my project recoding McElreath’s <a href="https://xcelab.net/rm/statistical-rethinking/"><em>Statistical rethinking</em></a>.</p>
</div>
<div id="session-info-23" class="section level2 unnumbered">
<h2>Session info</h2>
<div class="sourceCode" id="cb2291"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2291-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.6.3 (2020-02-29)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS Catalina 10.15.3
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] tidybayes_2.0.3.9000 brms_2.12.0          Rcpp_1.0.4.6        
##  [4] janitor_2.0.1        forcats_0.5.0        stringr_1.4.0       
##  [7] dplyr_0.8.5          purrr_0.3.4          readr_1.3.1         
## [10] tidyr_1.0.2          tibble_3.0.1         ggplot2_3.3.0       
## [13] tidyverse_1.3.0     
## 
## loaded via a namespace (and not attached):
##   [1] colorspace_1.4-1     ellipsis_0.3.0       ggridges_0.5.2      
##   [4] rsconnect_0.8.16     snakecase_0.11.0     markdown_1.1        
##   [7] base64enc_0.1-3      fs_1.4.1             rstudioapi_0.11     
##  [10] farver_2.0.3         rstan_2.19.3         svUnit_1.0.3        
##  [13] DT_0.13              fansi_0.4.1          mvtnorm_1.1-0       
##  [16] lubridate_1.7.8      xml2_1.3.1           bridgesampling_1.0-0
##  [19] knitr_1.28           shinythemes_1.1.2    bayesplot_1.7.1     
##  [22] jsonlite_1.6.1       broom_0.5.5          dbplyr_1.4.2        
##  [25] shiny_1.4.0.2        compiler_3.6.3       httr_1.4.1          
##  [28] backports_1.1.6      assertthat_0.2.1     Matrix_1.2-18       
##  [31] fastmap_1.0.1        cli_2.0.2            later_1.0.0         
##  [34] prettyunits_1.1.1    htmltools_0.4.0      tools_3.6.3         
##  [37] igraph_1.2.5         coda_0.19-3          gtable_0.3.0        
##  [40] glue_1.4.0           reshape2_1.4.4       cellranger_1.1.0    
##  [43] vctrs_0.3.0          nlme_3.1-144         crosstalk_1.1.0.1   
##  [46] xfun_0.13            ps_1.3.3             rvest_0.3.5         
##  [49] mime_0.9             miniUI_0.1.1.1       lifecycle_0.2.0     
##  [52] gtools_3.8.2         zoo_1.8-7            scales_1.1.1        
##  [55] colourpicker_1.0     hms_0.5.3            promises_1.1.0      
##  [58] Brobdingnag_1.2-6    parallel_3.6.3       inline_0.3.15       
##  [61] shinystan_2.5.0      yaml_2.2.1           gridExtra_2.3       
##  [64] StanHeaders_2.21.0-1 loo_2.2.0            stringi_1.4.6       
##  [67] highr_0.8            dygraphs_1.1.1.6     pkgbuild_1.0.8      
##  [70] rlang_0.4.6          pkgconfig_2.0.3      matrixStats_0.56.0  
##  [73] HDInterval_0.2.0     evaluate_0.14        lattice_0.20-38     
##  [76] rstantools_2.0.0     htmlwidgets_1.5.1    labeling_0.3        
##  [79] tidyselect_1.0.0     processx_3.4.2       plyr_1.8.6          
##  [82] magrittr_1.5         bookdown_0.18        R6_2.4.1            
##  [85] generics_0.0.2       DBI_1.1.0            pillar_1.4.4        
##  [88] haven_2.2.0          withr_2.2.0          xts_0.12-0          
##  [91] abind_1.4-5          modelr_0.1.6         crayon_1.3.4        
##  [94] arrayhelpers_1.1-0   utf8_1.1.4           rmarkdown_2.1       
##  [97] grid_3.6.3           readxl_1.3.1         callr_3.4.3         
## [100] threejs_0.3.3        reprex_0.3.0         digest_0.6.25       
## [103] xtable_1.8-4         httpuv_1.5.2         stats4_3.6.3        
## [106] munsell_0.5.0        viridisLite_0.3.0    shinyjs_1.1</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-gelmanAnalysisVarianceWhy2005">
<p>Gelman, A. (2005). Analysis of variance–Why it is more important than ever. <em>Annals of Statistics</em>, <em>33</em>(1), 1–53. <a href="https://doi.org/10.1214/009053604000001048">https://doi.org/10.1214/009053604000001048</a></p>
</div>
<div id="ref-kruschkeDoingBayesianData2015">
<p>Kruschke, J. K. (2015). <em>Doing Bayesian data analysis: A tutorial with R, JAGS, and Stan</em>. Academic Press. <a href="https://sites.google.com/site/doingbayesiandataanalysis/">https://sites.google.com/site/doingbayesiandataanalysis/</a></p>
</div>
<div id="ref-kurzStatisticalRethinkingBrms2020">
<p>Kurz, A. S. (2020). <em>Statistical rethinking with brms, ggplot2, and the tidyverse</em>. <a href="https://doi.org/10.5281/zenodo.3693202.svg">https://doi.org/10.5281/zenodo.3693202.svg</a></p>
</div>
<div id="ref-sneeGraphicalDisplayTwoway1974">
<p>Snee, R. D. (1974). Graphical display of two-way contingency tables. <em>The American Statistician</em>, <em>28</em>(1), 9–12. <a href="https://doi.org/10.1080/00031305.1974.10479053">https://doi.org/10.1080/00031305.1974.10479053</a></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ordinal-predicted-variable.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tools-in-the-trunk.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
